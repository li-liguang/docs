"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[2717],{9791:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});var s=r(4848),l=r(8453);const t={id:"k8s",title:"Kubernetes\u8be6\u7ec6\u6559\u7a0b",sidebar_label:"Kubernetes\u8be6\u7ec6\u6559\u7a0b"},d=void 0,i={id:"cloud/k8s/k8s",title:"Kubernetes\u8be6\u7ec6\u6559\u7a0b",description:"1. Kubernetes\u4ecb\u7ecd",source:"@site/docs/cloud/2-k8s/Kubernetes.md",sourceDirName:"cloud/2-k8s",slug:"/cloud/k8s/k8s",permalink:"/docs/docs/cloud/k8s/k8s",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"k8s",title:"Kubernetes\u8be6\u7ec6\u6559\u7a0b",sidebar_label:"Kubernetes\u8be6\u7ec6\u6559\u7a0b"},sidebar:"cloudSidebar",previous:{title:"\u5236\u4f5cdocker\u955c\u50cf",permalink:"/docs/docs/cloud/docker/build-image"},next:{title:"Kubernetes\u5e38\u7528\u547d\u4ee4",permalink:"/docs/docs/cloud/k8s/Kubernetes\u5e38\u7528\u547d\u4ee4"}},o={},c=[{value:"1. Kubernetes\u4ecb\u7ecd",id:"1-kubernetes\u4ecb\u7ecd",level:2},{value:"1.1 \u5e94\u7528\u90e8\u7f72\u65b9\u5f0f\u6f14\u53d8",id:"11-\u5e94\u7528\u90e8\u7f72\u65b9\u5f0f\u6f14\u53d8",level:3},{value:"1.2 kubernetes\u7b80\u4ecb",id:"12-kubernetes\u7b80\u4ecb",level:3},{value:"1.3 kubernetes\u7ec4\u4ef6",id:"13-kubernetes\u7ec4\u4ef6",level:3},{value:"1.4 kubernetes\u6982\u5ff5",id:"14-kubernetes\u6982\u5ff5",level:3},{value:"2. kubernetes\u96c6\u7fa4\u73af\u5883\u642d\u5efa",id:"2-kubernetes\u96c6\u7fa4\u73af\u5883\u642d\u5efa",level:2},{value:"2.1 \u524d\u7f6e\u77e5\u8bc6\u70b9",id:"21-\u524d\u7f6e\u77e5\u8bc6\u70b9",level:3},{value:"2.2 kubeadm \u90e8\u7f72\u65b9\u5f0f\u4ecb\u7ecd",id:"22-kubeadm-\u90e8\u7f72\u65b9\u5f0f\u4ecb\u7ecd",level:3},{value:"2.3 \u5b89\u88c5\u8981\u6c42",id:"23-\u5b89\u88c5\u8981\u6c42",level:3},{value:"2.4 \u6700\u7ec8\u76ee\u6807",id:"24-\u6700\u7ec8\u76ee\u6807",level:3},{value:"2.5 \u51c6\u5907\u73af\u5883",id:"25-\u51c6\u5907\u73af\u5883",level:3},{value:"2.6 \u73af\u5883\u521d\u59cb\u5316",id:"26-\u73af\u5883\u521d\u59cb\u5316",level:3},{value:"2.6.1 \u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u7684\u7248\u672c",id:"261-\u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u7684\u7248\u672c",level:4},{value:"2.6.2 \u4e3b\u673a\u540d\u89e3\u6790",id:"262-\u4e3b\u673a\u540d\u89e3\u6790",level:4},{value:"2.6.3 \u65f6\u95f4\u540c\u6b65",id:"263-\u65f6\u95f4\u540c\u6b65",level:4},{value:"2.6.4  \u7981\u7528iptable\u548cfirewalld\u670d\u52a1",id:"264--\u7981\u7528iptable\u548cfirewalld\u670d\u52a1",level:4},{value:"2.6.5 \u7981\u7528selinux",id:"265-\u7981\u7528selinux",level:4},{value:"2.6.6 \u7981\u7528swap\u5206\u533a",id:"266-\u7981\u7528swap\u5206\u533a",level:4},{value:"2.6.7 \u4fee\u6539linux\u7684\u5185\u6838\u53c2\u6570",id:"267-\u4fee\u6539linux\u7684\u5185\u6838\u53c2\u6570",level:4},{value:"2.6.8 \u914d\u7f6eipvs\u529f\u80fd",id:"268-\u914d\u7f6eipvs\u529f\u80fd",level:4},{value:"2.6.9 \u5b89\u88c5docker",id:"269-\u5b89\u88c5docker",level:4},{value:"2.6.10 \u5b89\u88c5Kubernetes\u7ec4\u4ef6",id:"2610-\u5b89\u88c5kubernetes\u7ec4\u4ef6",level:4},{value:"2.6.11 \u51c6\u5907\u96c6\u7fa4\u955c\u50cf",id:"2611-\u51c6\u5907\u96c6\u7fa4\u955c\u50cf",level:4},{value:"2.6.12 \u96c6\u7fa4\u521d\u59cb\u5316",id:"2612-\u96c6\u7fa4\u521d\u59cb\u5316",level:4},{value:"2.6.13 \u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ea\u5728master\u8282\u70b9\u64cd\u4f5c\u5373\u53ef",id:"2613-\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\u53ea\u5728master\u8282\u70b9\u64cd\u4f5c\u5373\u53ef",level:4},{value:"2.6.14 \u4f7f\u7528kubeadm reset\u91cd\u7f6e\u96c6\u7fa4",id:"2614-\u4f7f\u7528kubeadm-reset\u91cd\u7f6e\u96c6\u7fa4",level:4},{value:"2.6.15 \u91cd\u542fkubelet\u548cdocker",id:"2615-\u91cd\u542fkubelet\u548cdocker",level:4},{value:"2.6.16 kubeadm\u4e2d\u7684\u547d\u4ee4",id:"2616-kubeadm\u4e2d\u7684\u547d\u4ee4",level:4},{value:"2.7 \u96c6\u7fa4\u6d4b\u8bd5",id:"27-\u96c6\u7fa4\u6d4b\u8bd5",level:3},{value:"2.7.1 \u521b\u5efa\u4e00\u4e2anginx\u670d\u52a1",id:"271-\u521b\u5efa\u4e00\u4e2anginx\u670d\u52a1",level:4},{value:"2.7.2 \u66b4\u9732\u7aef\u53e3",id:"272-\u66b4\u9732\u7aef\u53e3",level:4},{value:"2.7.3 \u67e5\u770b\u670d\u52a1",id:"273-\u67e5\u770b\u670d\u52a1",level:4},{value:"2.7.4 \u67e5\u770bpod",id:"274-\u67e5\u770bpod",level:4},{value:"3. \u8d44\u6e90\u7ba1\u7406",id:"3-\u8d44\u6e90\u7ba1\u7406",level:2},{value:"3.1 \u8d44\u6e90\u7ba1\u7406\u4ecb\u7ecd",id:"31-\u8d44\u6e90\u7ba1\u7406\u4ecb\u7ecd",level:3},{value:"3.2 YAML\u8bed\u8a00\u4ecb\u7ecd",id:"32-yaml\u8bed\u8a00\u4ecb\u7ecd",level:3},{value:"3.3 \u8d44\u6e90\u7ba1\u7406\u65b9\u5f0f",id:"33-\u8d44\u6e90\u7ba1\u7406\u65b9\u5f0f",level:3},{value:"3.3.1 \u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406",id:"331-\u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406",level:4},{value:"3.3.2 \u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e",id:"332-\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e",level:4},{value:"3.3.3 \u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e",id:"333-\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e",level:4},{value:"4. \u5b9e\u6218\u5165\u95e8",id:"4-\u5b9e\u6218\u5165\u95e8",level:2},{value:"4.1 Namespace",id:"41-namespace",level:3},{value:"4.1.1 <strong>\u67e5\u770b</strong>",id:"411-\u67e5\u770b",level:4},{value:"4.1.2 <strong>\u521b\u5efa</strong>",id:"412-\u521b\u5efa",level:4},{value:"4.1.3 <strong>\u5220\u9664</strong>",id:"413-\u5220\u9664",level:4},{value:"4.1.4 <strong>\u914d\u7f6e\u65b9\u5f0f</strong>",id:"414-\u914d\u7f6e\u65b9\u5f0f",level:4},{value:"4.2 Pod",id:"42-pod",level:3},{value:"4.2.1 \u521b\u5efa\u5e76\u8fd0\u884c",id:"421-\u521b\u5efa\u5e76\u8fd0\u884c",level:4},{value:"4.2.2 \u67e5\u770bpod\u4fe1\u606f",id:"422-\u67e5\u770bpod\u4fe1\u606f",level:4},{value:"4.2.3 \u8bbf\u95eePod",id:"423-\u8bbf\u95eepod",level:4},{value:"4.2.4 \u5220\u9664\u6307\u5b9aPod",id:"424-\u5220\u9664\u6307\u5b9apod",level:4},{value:"4.2.5 \u914d\u7f6e\u64cd\u4f5c",id:"425-\u914d\u7f6e\u64cd\u4f5c",level:4},{value:"4.3 Label",id:"43-label",level:3},{value:"4.3.1 \u547d\u4ee4\u65b9\u5f0f",id:"431-\u547d\u4ee4\u65b9\u5f0f",level:4},{value:"4.3.2 \u914d\u7f6e\u65b9\u5f0f",id:"432-\u914d\u7f6e\u65b9\u5f0f",level:4},{value:"4.4 Deployment",id:"44-deployment",level:3},{value:"4.4.1 \u547d\u4ee4\u64cd\u4f5c",id:"441-\u547d\u4ee4\u64cd\u4f5c",level:4},{value:"4.4.2 \u914d\u7f6e\u64cd\u4f5c",id:"442-\u914d\u7f6e\u64cd\u4f5c",level:4},{value:"4.5 Service",id:"45-service",level:3},{value:"4.5.1 \u521b\u5efa\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\u7684Service",id:"451-\u521b\u5efa\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\u7684service",level:4},{value:"4.5.2 \u521b\u5efa\u96c6\u7fa4\u5916\u90e8\u4e5f\u53ef\u8bbf\u95ee\u7684Service",id:"452-\u521b\u5efa\u96c6\u7fa4\u5916\u90e8\u4e5f\u53ef\u8bbf\u95ee\u7684service",level:4},{value:"4.5.3 \u5220\u9664Service",id:"453-\u5220\u9664service",level:4},{value:"4.5.4 \u914d\u7f6e\u65b9\u5f0f",id:"454-\u914d\u7f6e\u65b9\u5f0f",level:4},{value:"5. Pod\u8be6\u89e3",id:"5-pod\u8be6\u89e3",level:2},{value:"5.1 Pod\u4ecb\u7ecd",id:"51-pod\u4ecb\u7ecd",level:3},{value:"5.1.1 Pod\u7ed3\u6784",id:"511-pod\u7ed3\u6784",level:4},{value:"5.1.2 Pod\u5b9a\u4e49",id:"512-pod\u5b9a\u4e49",level:4},{value:"5.2 Pod\u914d\u7f6e",id:"52-pod\u914d\u7f6e",level:3},{value:"5.2.1 \u57fa\u672c\u914d\u7f6e",id:"521-\u57fa\u672c\u914d\u7f6e",level:4},{value:"5.2.2 \u955c\u50cf\u62c9\u53d6",id:"522-\u955c\u50cf\u62c9\u53d6",level:4},{value:"5.2.3 \u542f\u52a8\u547d\u4ee4",id:"523-\u542f\u52a8\u547d\u4ee4",level:4},{value:"5.2.4 \u73af\u5883\u53d8\u91cf",id:"524-\u73af\u5883\u53d8\u91cf",level:4},{value:"5.2.5 \u7aef\u53e3\u8bbe\u7f6e",id:"525-\u7aef\u53e3\u8bbe\u7f6e",level:4},{value:"5.2.6 \u8d44\u6e90\u914d\u989d",id:"526-\u8d44\u6e90\u914d\u989d",level:4},{value:"5.3 Pod\u751f\u547d\u5468\u671f",id:"53-pod\u751f\u547d\u5468\u671f",level:3},{value:"5.3.1 \u521b\u5efa\u548c\u7ec8\u6b62",id:"531-\u521b\u5efa\u548c\u7ec8\u6b62",level:4},{value:"5.3.2 \u521d\u59cb\u5316\u5bb9\u5668",id:"532-\u521d\u59cb\u5316\u5bb9\u5668",level:4},{value:"5.3.3 \u94a9\u5b50\u51fd\u6570",id:"533-\u94a9\u5b50\u51fd\u6570",level:4},{value:"5.3.4 \u5bb9\u5668\u63a2\u6d4b",id:"534-\u5bb9\u5668\u63a2\u6d4b",level:4},{value:"5.3.5 \u91cd\u542f\u7b56\u7565",id:"535-\u91cd\u542f\u7b56\u7565",level:4},{value:"5.4 Pod\u8c03\u5ea6",id:"54-pod\u8c03\u5ea6",level:3},{value:"5.4.1 \u5b9a\u5411\u8c03\u5ea6",id:"541-\u5b9a\u5411\u8c03\u5ea6",level:4},{value:"5.4.2 \u4eb2\u548c\u6027\u8c03\u5ea6",id:"542-\u4eb2\u548c\u6027\u8c03\u5ea6",level:4},{value:"5.4.3 \u6c61\u70b9\u548c\u5bb9\u5fcd",id:"543-\u6c61\u70b9\u548c\u5bb9\u5fcd",level:4},{value:"6. Pod\u63a7\u5236\u5668\u8be6\u89e3",id:"6-pod\u63a7\u5236\u5668\u8be6\u89e3",level:2},{value:"6.1 Pod\u63a7\u5236\u5668\u4ecb\u7ecd",id:"61-pod\u63a7\u5236\u5668\u4ecb\u7ecd",level:3},{value:"6.2 ReplicaSet(RS)",id:"62-replicasetrs",level:3},{value:"6.3 Deployment(Deploy)",id:"63-deploymentdeploy",level:3},{value:"6.3.1 \u521b\u5efadeployment",id:"631-\u521b\u5efadeployment",level:4},{value:"6.3.2 \u6269\u7f29\u5bb9",id:"632-\u6269\u7f29\u5bb9",level:4},{value:"6.3.3 \u7248\u672c\u56de\u9000",id:"633-\u7248\u672c\u56de\u9000",level:4},{value:"6.3.4 \u91d1\u4e1d\u96c0\u53d1\u5e03",id:"634-\u91d1\u4e1d\u96c0\u53d1\u5e03",level:4},{value:"6.4 Horizontal Pod Autoscaler(HPA)",id:"64-horizontal-pod-autoscalerhpa",level:3},{value:"6.4.1 \u5b89\u88c5metrics-server",id:"641-\u5b89\u88c5metrics-server",level:4},{value:"6.4.2 \u51c6\u5907deployment\u548cservie",id:"642-\u51c6\u5907deployment\u548cservie",level:4},{value:"6.4.3 \u90e8\u7f72HPA",id:"643-\u90e8\u7f72hpa",level:4},{value:"6.4.4 \u6d4b\u8bd5",id:"644-\u6d4b\u8bd5",level:4},{value:"6.5 DaemonSet(DS)",id:"65-daemonsetds",level:3},{value:"6.6 Job",id:"66-job",level:3},{value:"6.7 CronJob(CJ)",id:"67-cronjobcj",level:3},{value:"7. Service\u8be6\u89e3",id:"7-service\u8be6\u89e3",level:2},{value:"7.1 Service\u4ecb\u7ecd",id:"71-service\u4ecb\u7ecd",level:3},{value:"7.1.1 userspace \u6a21\u5f0f",id:"711-userspace-\u6a21\u5f0f",level:4},{value:"7.1.2 iptables \u6a21\u5f0f",id:"712-iptables-\u6a21\u5f0f",level:4},{value:"7.1.3 ipvs \u6a21\u5f0f",id:"713-ipvs-\u6a21\u5f0f",level:4},{value:"7.2 Service\u7c7b\u578b",id:"72-service\u7c7b\u578b",level:3},{value:"7.3 Service\u4f7f\u7528",id:"73-service\u4f7f\u7528",level:3},{value:"7.3.1 \u5b9e\u9a8c\u73af\u5883\u51c6\u5907",id:"731-\u5b9e\u9a8c\u73af\u5883\u51c6\u5907",level:4},{value:"7.3.2 ClusterIP\u7c7b\u578b\u7684Service",id:"732-clusterip\u7c7b\u578b\u7684service",level:4},{value:"7.3.3 Endpoint",id:"733-endpoint",level:4},{value:"7.3.4 HeadLiness\u7c7b\u578b\u7684Service",id:"734-headliness\u7c7b\u578b\u7684service",level:4},{value:"7.3.5 NodePort\u7c7b\u578b\u7684Service",id:"735-nodeport\u7c7b\u578b\u7684service",level:4},{value:"7.3.6 LoadBalancer\u7c7b\u578b\u7684Service",id:"736-loadbalancer\u7c7b\u578b\u7684service",level:4},{value:"7.3.7 ExternalName\u7c7b\u578b\u7684Service",id:"737-externalname\u7c7b\u578b\u7684service",level:4},{value:"7.4 Ingress\u4ecb\u7ecd",id:"74-ingress\u4ecb\u7ecd",level:3},{value:"7.5 Ingress\u4f7f\u7528",id:"75-ingress\u4f7f\u7528",level:3},{value:"7.5.1 \u73af\u5883\u51c6\u5907 \u642d\u5efaingress\u73af\u5883",id:"751-\u73af\u5883\u51c6\u5907-\u642d\u5efaingress\u73af\u5883",level:4},{value:"7.5.2 \u51c6\u5907service\u548cpod",id:"752-\u51c6\u5907service\u548cpod",level:4},{value:"7.5.3 Http\u4ee3\u7406",id:"753-http\u4ee3\u7406",level:4},{value:"7.5.4 Https\u4ee3\u7406",id:"754-https\u4ee3\u7406",level:4},{value:"8. \u6570\u636e\u5b58\u50a8",id:"8-\u6570\u636e\u5b58\u50a8",level:2},{value:"8.1 \u57fa\u672c\u5b58\u50a8",id:"81-\u57fa\u672c\u5b58\u50a8",level:3},{value:"8.1.1 EmptyDir",id:"811-emptydir",level:4},{value:"8.1.2 HostPath",id:"812-hostpath",level:4},{value:"8.1.3 NFS",id:"813-nfs",level:4},{value:"8.2 \u9ad8\u7ea7\u5b58\u50a8",id:"82-\u9ad8\u7ea7\u5b58\u50a8",level:3},{value:"8.2.1 PV",id:"821-pv",level:4},{value:"8.2.2 PVC",id:"822-pvc",level:4},{value:"8.2.3 \u751f\u547d\u5468\u671f",id:"823-\u751f\u547d\u5468\u671f",level:4},{value:"8.3 \u914d\u7f6e\u5b58\u50a8",id:"83-\u914d\u7f6e\u5b58\u50a8",level:3},{value:"8.3.1 ConfigMap",id:"831-configmap",level:4},{value:"8.3.2 Secret",id:"832-secret",level:4},{value:"9. \u5b89\u5168\u8ba4\u8bc1",id:"9-\u5b89\u5168\u8ba4\u8bc1",level:2},{value:"9.1 \u8bbf\u95ee\u63a7\u5236\u6982\u8ff0",id:"91-\u8bbf\u95ee\u63a7\u5236\u6982\u8ff0",level:3},{value:"9.2 \u8ba4\u8bc1\u7ba1\u7406",id:"92-\u8ba4\u8bc1\u7ba1\u7406",level:3},{value:"9.3 \u6388\u6743\u7ba1\u7406",id:"93-\u6388\u6743\u7ba1\u7406",level:3},{value:"9.4 \u51c6\u5165\u63a7\u5236",id:"94-\u51c6\u5165\u63a7\u5236",level:3},{value:"10. DashBoard",id:"10-dashboard",level:2},{value:"10.1 \u90e8\u7f72Dashboard",id:"101-\u90e8\u7f72dashboard",level:3},{value:"10.2 \u4f7f\u7528DashBoard",id:"102-\u4f7f\u7528dashboard",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"1-kubernetes\u4ecb\u7ecd",children:"1. Kubernetes\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.h3,{id:"11-\u5e94\u7528\u90e8\u7f72\u65b9\u5f0f\u6f14\u53d8",children:"1.1 \u5e94\u7528\u90e8\u7f72\u65b9\u5f0f\u6f14\u53d8"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u5f0f\u4e0a\uff0c\u4e3b\u8981\u7ecf\u5386\u4e86\u4e09\u4e2a\u65f6\u4ee3\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u4f20\u7edf\u90e8\u7f72"}),"\uff1a\u4e92\u8054\u7f51\u65e9\u671f\uff0c\u4f1a\u76f4\u63a5\u5c06\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5728\u7269\u7406\u673a\u4e0a"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f18\u70b9\uff1a\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u5176\u5b83\u6280\u672f\u7684\u53c2\u4e0e"}),"\n",(0,s.jsx)(n.p,{children:"\u7f3a\u70b9\uff1a\u4e0d\u80fd\u4e3a\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u8d44\u6e90\u4f7f\u7528\u8fb9\u754c\uff0c\u5f88\u96be\u5408\u7406\u5730\u5206\u914d\u8ba1\u7b97\u8d44\u6e90\uff0c\u800c\u4e14\u7a0b\u5e8f\u4e4b\u95f4\u5bb9\u6613\u4ea7\u751f\u5f71\u54cd"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u865a\u62df\u5316\u90e8\u7f72"}),"\uff1a\u53ef\u4ee5\u5728\u4e00\u53f0\u7269\u7406\u673a\u4e0a\u8fd0\u884c\u591a\u4e2a\u865a\u62df\u673a\uff0c\u6bcf\u4e2a\u865a\u62df\u673a\u90fd\u662f\u72ec\u7acb\u7684\u4e00\u4e2a\u73af\u5883"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f18\u70b9\uff1a\u7a0b\u5e8f\u73af\u5883\u4e0d\u4f1a\u76f8\u4e92\u4ea7\u751f\u5f71\u54cd\uff0c\u63d0\u4f9b\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u7684\u5b89\u5168\u6027"}),"\n",(0,s.jsx)(n.p,{children:"\u7f3a\u70b9\uff1a\u589e\u52a0\u4e86\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6d6a\u8d39\u4e86\u90e8\u5206\u8d44\u6e90"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u5bb9\u5668\u5316\u90e8\u7f72"}),"\uff1a\u4e0e\u865a\u62df\u5316\u7c7b\u4f3c\uff0c\u4f46\u662f\u5171\u4eab\u4e86\u64cd\u4f5c\u7cfb\u7edf"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f18\u70b9\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u4fdd\u8bc1\u6bcf\u4e2a\u5bb9\u5668\u62e5\u6709\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u3001CPU\u3001\u5185\u5b58\u3001\u8fdb\u7a0b\u7a7a\u95f4\u7b49"}),"\n",(0,s.jsx)(n.p,{children:"\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u8981\u7684\u8d44\u6e90\u90fd\u88ab\u5bb9\u5668\u5305\u88c5\uff0c\u5e76\u548c\u5e95\u5c42\u57fa\u7840\u67b6\u6784\u89e3\u8026"}),"\n",(0,s.jsx)(n.p,{children:"\u5bb9\u5668\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u8de8\u4e91\u670d\u52a1\u5546\u3001\u8de8Linux\u64cd\u4f5c\u7cfb\u7edf\u53d1\u884c\u7248\u8fdb\u884c\u90e8\u7f72"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200505183738289",src:r(465).A+"",width:"1112",height:"418"})}),"\n",(0,s.jsx)(n.p,{children:"\u5bb9\u5668\u5316\u90e8\u7f72\u65b9\u5f0f\u7ed9\u5e26\u6765\u5f88\u591a\u7684\u4fbf\u5229\uff0c\u4f46\u662f\u4e5f\u4f1a\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\u8bf4\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e00\u4e2a\u5bb9\u5668\u6545\u969c\u505c\u673a\u4e86\uff0c\u600e\u4e48\u6837\u8ba9\u53e6\u5916\u4e00\u4e2a\u5bb9\u5668\u7acb\u523b\u542f\u52a8\u53bb\u66ff\u8865\u505c\u673a\u7684\u5bb9\u5668"}),"\n",(0,s.jsx)(n.li,{children:"\u5f53\u5e76\u53d1\u8bbf\u95ee\u91cf\u53d8\u5927\u7684\u65f6\u5019\uff0c\u600e\u4e48\u6837\u505a\u5230\u6a2a\u5411\u6269\u5c55\u5bb9\u5668\u6570\u91cf"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u4e9b\u5bb9\u5668\u7ba1\u7406\u7684\u95ee\u9898\u7edf\u79f0\u4e3a",(0,s.jsx)(n.strong,{children:"\u5bb9\u5668\u7f16\u6392"}),"\u95ee\u9898\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u5bb9\u5668\u7f16\u6392\u95ee\u9898\uff0c\u5c31\u4ea7\u751f\u4e86\u4e00\u4e9b\u5bb9\u5668\u7f16\u6392\u7684\u8f6f\u4ef6\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Swarm"}),"\uff1aDocker\u81ea\u5df1\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mesos"}),"\uff1aApache\u7684\u4e00\u4e2a\u8d44\u6e90\u7edf\u4e00\u7ba1\u63a7\u7684\u5de5\u5177\uff0c\u9700\u8981\u548cMarathon\u7ed3\u5408\u4f7f\u7528"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Kubernetes"}),"\uff1aGoogle\u5f00\u6e90\u7684\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200524150339551",src:r(4103).A+"",width:"593",height:"272"})}),"\n",(0,s.jsx)(n.h3,{id:"12-kubernetes\u7b80\u4ecb",children:"1.2 kubernetes\u7b80\u4ecb"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200406232838722",src:r(5121).A+"",width:"541",height:"281"})}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\uff0c\u662f\u4e00\u4e2a\u5168\u65b0\u7684\u57fa\u4e8e\u5bb9\u5668\u6280\u672f\u7684\u5206\u5e03\u5f0f\u67b6\u6784\u9886\u5148\u65b9\u6848\uff0c\u662f\u8c37\u6b4c\u4e25\u683c\u4fdd\u5bc6\u5341\u51e0\u5e74\u7684\u79d8\u5bc6\u6b66\u5668----Borg\u7cfb\u7edf\u7684\u4e00\u4e2a\u5f00\u6e90\u7248\u672c\uff0c\u4e8e2014\u5e749\u6708\u53d1\u5e03\u7b2c\u4e00\u4e2a\u7248\u672c\uff0c2015\u5e747\u6708\u53d1\u5e03\u7b2c\u4e00\u4e2a\u6b63\u5f0f\u7248\u672c\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["kubernetes\u7684\u672c\u8d28\u662f",(0,s.jsx)(n.strong,{children:"\u4e00\u7ec4\u670d\u52a1\u5668\u96c6\u7fa4"}),"\uff0c\u5b83\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u7279\u5b9a\u7684\u7a0b\u5e8f\uff0c\u6765\u5bf9\u8282\u70b9\u4e2d\u7684\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406\u3002\u76ee\u7684\u662f\u5b9e\u73b0\u8d44\u6e90\u7ba1\u7406\u7684\u81ea\u52a8\u5316\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u5982\u4e0b\u7684\u4e3b\u8981\u529f\u80fd\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u81ea\u6211\u4fee\u590d"}),"\uff1a\u4e00\u65e6\u67d0\u4e00\u4e2a\u5bb9\u5668\u5d29\u6e83\uff0c\u80fd\u591f\u57281\u79d2\u4e2d\u5de6\u53f3\u8fc5\u901f\u542f\u52a8\u65b0\u7684\u5bb9\u5668"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5f39\u6027\u4f38\u7f29"}),"\uff1a\u53ef\u4ee5\u6839\u636e\u9700\u8981\uff0c\u81ea\u52a8\u5bf9\u96c6\u7fa4\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u6570\u91cf\u8fdb\u884c\u8c03\u6574"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u670d\u52a1\u53d1\u73b0"}),"\uff1a\u670d\u52a1\u53ef\u4ee5\u901a\u8fc7\u81ea\u52a8\u53d1\u73b0\u7684\u5f62\u5f0f\u627e\u5230\u5b83\u6240\u4f9d\u8d56\u7684\u670d\u52a1"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8d1f\u8f7d\u5747\u8861"}),"\uff1a\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u8d77\u52a8\u4e86\u591a\u4e2a\u5bb9\u5668\uff0c\u80fd\u591f\u81ea\u52a8\u5b9e\u73b0\u8bf7\u6c42\u7684\u8d1f\u8f7d\u5747\u8861"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7248\u672c\u56de\u9000"}),"\uff1a\u5982\u679c\u53d1\u73b0\u65b0\u53d1\u5e03\u7684\u7a0b\u5e8f\u7248\u672c\u6709\u95ee\u9898\uff0c\u53ef\u4ee5\u7acb\u5373\u56de\u9000\u5230\u539f\u6765\u7684\u7248\u672c"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5b58\u50a8\u7f16\u6392"}),"\uff1a\u53ef\u4ee5\u6839\u636e\u5bb9\u5668\u81ea\u8eab\u7684\u9700\u6c42\u81ea\u52a8\u521b\u5efa\u5b58\u50a8\u5377"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"13-kubernetes\u7ec4\u4ef6",children:"1.3 kubernetes\u7ec4\u4ef6"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u4e2akubernetes\u96c6\u7fa4\u4e3b\u8981\u662f\u7531",(0,s.jsx)(n.strong,{children:"\u63a7\u5236\u8282\u70b9(master)"}),"\u3001**\u5de5\u4f5c\u8282\u70b9(node)**\u6784\u6210\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u4f1a\u5b89\u88c5\u4e0d\u540c\u7684\u7ec4\u4ef6\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"master\uff1a\u96c6\u7fa4\u7684\u63a7\u5236\u5e73\u9762\uff0c\u8d1f\u8d23\u96c6\u7fa4\u7684\u51b3\u7b56 ( \u7ba1\u7406 )"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"ApiServer"})," : \u8d44\u6e90\u64cd\u4f5c\u7684\u552f\u4e00\u5165\u53e3\uff0c\u63a5\u6536\u7528\u6237\u8f93\u5165\u7684\u547d\u4ee4\uff0c\u63d0\u4f9b\u8ba4\u8bc1\u3001\u6388\u6743\u3001API\u6ce8\u518c\u548c\u53d1\u73b0\u7b49\u673a\u5236"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scheduler"})," : \u8d1f\u8d23\u96c6\u7fa4\u8d44\u6e90\u8c03\u5ea6\uff0c\u6309\u7167\u9884\u5b9a\u7684\u8c03\u5ea6\u7b56\u7565\u5c06Pod\u8c03\u5ea6\u5230\u76f8\u5e94\u7684node\u8282\u70b9\u4e0a"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"ControllerManager"})," : \u8d1f\u8d23\u7ef4\u62a4\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u7a0b\u5e8f\u90e8\u7f72\u5b89\u6392\u3001\u6545\u969c\u68c0\u6d4b\u3001\u81ea\u52a8\u6269\u5c55\u3001\u6eda\u52a8\u66f4\u65b0\u7b49"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Etcd"})," \uff1a\u8d1f\u8d23\u5b58\u50a8\u96c6\u7fa4\u4e2d\u5404\u79cd\u8d44\u6e90\u5bf9\u8c61\u7684\u4fe1\u606f"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"node\uff1a\u96c6\u7fa4\u7684\u6570\u636e\u5e73\u9762\uff0c\u8d1f\u8d23\u4e3a\u5bb9\u5668\u63d0\u4f9b\u8fd0\u884c\u73af\u5883 ( \u5e72\u6d3b )"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Kubelet"})," : \u8d1f\u8d23\u7ef4\u62a4\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\uff0c\u5373\u901a\u8fc7\u63a7\u5236docker\uff0c\u6765\u521b\u5efa\u3001\u66f4\u65b0\u3001\u9500\u6bc1\u5bb9\u5668"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"KubeProxy"})," : \u8d1f\u8d23\u63d0\u4f9b\u96c6\u7fa4\u5185\u90e8\u7684\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker"})," : \u8d1f\u8d23\u8282\u70b9\u4e0a\u5bb9\u5668\u7684\u5404\u79cd\u64cd\u4f5c"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200406184656917",src:r(6013).A+"",width:"1436",height:"745"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\uff0c\u4ee5\u90e8\u7f72\u4e00\u4e2anginx\u670d\u52a1\u6765\u8bf4\u660ekubernetes\u7cfb\u7edf\u5404\u4e2a\u7ec4\u4ef6\u8c03\u7528\u5173\u7cfb\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\u8981\u660e\u786e\uff0c\u4e00\u65e6kubernetes\u73af\u5883\u542f\u52a8\u4e4b\u540e\uff0cmaster\u548cnode\u90fd\u4f1a\u5c06\u81ea\u8eab\u7684\u4fe1\u606f\u5b58\u50a8\u5230etcd\u6570\u636e\u5e93\u4e2d"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e2anginx\u670d\u52a1\u7684\u5b89\u88c5\u8bf7\u6c42\u4f1a\u9996\u5148\u88ab\u53d1\u9001\u5230master\u8282\u70b9\u7684apiServer\u7ec4\u4ef6"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiServer\u7ec4\u4ef6\u4f1a\u8c03\u7528scheduler\u7ec4\u4ef6\u6765\u51b3\u5b9a\u5230\u5e95\u5e94\u8be5\u628a\u8fd9\u4e2a\u670d\u52a1\u5b89\u88c5\u5230\u54ea\u4e2anode\u8282\u70b9\u4e0a"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6b64\u65f6\uff0c\u5b83\u4f1a\u4eceetcd\u4e2d\u8bfb\u53d6\u5404\u4e2anode\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u7136\u540e\u6309\u7167\u4e00\u5b9a\u7684\u7b97\u6cd5\u8fdb\u884c\u9009\u62e9\uff0c\u5e76\u5c06\u7ed3\u679c\u544a\u77e5apiServer"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiServer\u8c03\u7528controller-manager\u53bb\u8c03\u5ea6Node\u8282\u70b9\u5b89\u88c5nginx\u670d\u52a1"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"kubelet\u63a5\u6536\u5230\u6307\u4ee4\u540e\uff0c\u4f1a\u901a\u77e5docker\uff0c\u7136\u540e\u7531docker\u6765\u542f\u52a8\u4e00\u4e2anginx\u7684pod"}),"\n",(0,s.jsx)(n.p,{children:"pod\u662fkubernetes\u7684\u6700\u5c0f\u64cd\u4f5c\u5355\u5143\uff0c\u5bb9\u5668\u5fc5\u987b\u8dd1\u5728pod\u4e2d\u81f3\u6b64\uff0c"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e2anginx\u670d\u52a1\u5c31\u8fd0\u884c\u4e86\uff0c\u5982\u679c\u9700\u8981\u8bbf\u95eenginx\uff0c\u5c31\u9700\u8981\u901a\u8fc7kube-proxy\u6765\u5bf9pod\u4ea7\u751f\u8bbf\u95ee\u7684\u4ee3\u7406"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\uff0c\u5916\u754c\u7528\u6237\u5c31\u53ef\u4ee5\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u7684nginx\u670d\u52a1\u4e86"}),"\n",(0,s.jsx)(n.h3,{id:"14-kubernetes\u6982\u5ff5",children:"1.4 kubernetes\u6982\u5ff5"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Master"}),"\uff1a\u96c6\u7fa4\u63a7\u5236\u8282\u70b9\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u9700\u8981\u81f3\u5c11\u4e00\u4e2amaster\u8282\u70b9\u8d1f\u8d23\u96c6\u7fa4\u7684\u7ba1\u63a7"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Node"}),"\uff1a\u5de5\u4f5c\u8d1f\u8f7d\u8282\u70b9\uff0c\u7531master\u5206\u914d\u5bb9\u5668\u5230\u8fd9\u4e9bnode\u5de5\u4f5c\u8282\u70b9\u4e0a\uff0c\u7136\u540enode\u8282\u70b9\u4e0a\u7684docker\u8d1f\u8d23\u5bb9\u5668\u7684\u8fd0\u884c"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pod"}),"\uff1akubernetes\u7684\u6700\u5c0f\u63a7\u5236\u5355\u5143\uff0c\u5bb9\u5668\u90fd\u662f\u8fd0\u884c\u5728pod\u4e2d\u7684\uff0c\u4e00\u4e2apod\u4e2d\u53ef\u4ee5\u67091\u4e2a\u6216\u8005\u591a\u4e2a\u5bb9\u5668"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Controller"}),"\uff1a\u63a7\u5236\u5668\uff0c\u901a\u8fc7\u5b83\u6765\u5b9e\u73b0\u5bf9pod\u7684\u7ba1\u7406\uff0c\u6bd4\u5982\u542f\u52a8pod\u3001\u505c\u6b62pod\u3001\u4f38\u7f29pod\u7684\u6570\u91cf\u7b49\u7b49"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Service"}),"\uff1apod\u5bf9\u5916\u670d\u52a1\u7684\u7edf\u4e00\u5165\u53e3\uff0c\u4e0b\u9762\u53ef\u4ee5\u7ef4\u62a4\u8005\u540c\u4e00\u7c7b\u7684\u591a\u4e2apod"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Label"}),"\uff1a\u6807\u7b7e\uff0c\u7528\u4e8e\u5bf9pod\u8fdb\u884c\u5206\u7c7b\uff0c\u540c\u4e00\u7c7bpod\u4f1a\u62e5\u6709\u76f8\u540c\u7684\u6807\u7b7e"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"NameSpace"}),"\uff1a\u547d\u540d\u7a7a\u95f4\uff0c\u7528\u6765\u9694\u79bbpod\u7684\u8fd0\u884c\u73af\u5883"]}),"\n",(0,s.jsx)(n.h2,{id:"2-kubernetes\u96c6\u7fa4\u73af\u5883\u642d\u5efa",children:"2. kubernetes\u96c6\u7fa4\u73af\u5883\u642d\u5efa"}),"\n",(0,s.jsx)(n.h3,{id:"21-\u524d\u7f6e\u77e5\u8bc6\u70b9",children:"2.1 \u524d\u7f6e\u77e5\u8bc6\u70b9"}),"\n",(0,s.jsx)(n.p,{children:"\u76ee\u524d\u751f\u4ea7\u90e8\u7f72Kubernetes \u96c6\u7fa4\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"kubeadm"})}),"\n",(0,s.jsx)(n.p,{children:"Kubeadm \u662f\u4e00\u4e2aK8s \u90e8\u7f72\u5de5\u5177\uff0c\u63d0\u4f9bkubeadm init \u548ckubeadm join\uff0c\u7528\u4e8e\u5feb\u901f\u90e8\u7f72Kubernetes \u96c6\u7fa4\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5b98\u65b9\u5730\u5740\uff1a",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/",children:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u4e8c\u8fdb\u5236\u5305"})}),"\n",(0,s.jsx)(n.p,{children:"\u4ecegithub \u4e0b\u8f7d\u53d1\u884c\u7248\u7684\u4e8c\u8fdb\u5236\u5305\uff0c\u624b\u52a8\u90e8\u7f72\u6bcf\u4e2a\u7ec4\u4ef6\uff0c\u7ec4\u6210Kubernetes \u96c6\u7fa4\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Kubeadm \u964d\u4f4e\u90e8\u7f72\u95e8\u69db\uff0c\u4f46\u5c4f\u853d\u4e86\u5f88\u591a\u7ec6\u8282\uff0c\u9047\u5230\u95ee\u9898\u5f88\u96be\u6392\u67e5\u3002\u5982\u679c\u60f3\u66f4\u5bb9\u6613\u53ef\u63a7\uff0c\u63a8\u8350\u4f7f\u7528\u4e8c\u8fdb\u5236\u5305\u90e8\u7f72Kubernetes \u96c6\u7fa4\uff0c\u867d\u7136\u624b\u52a8\u90e8\u7f72\u9ebb\u70e6\u70b9\uff0c\u671f\u95f4\u53ef\u4ee5\u5b66\u4e60\u5f88\u591a\u5de5\u4f5c\u539f\u7406\uff0c\u4e5f\u5229\u4e8e\u540e\u671f\u7ef4\u62a4\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200404094800622",src:r(2851).A+"",width:"1291",height:"513"})}),"\n",(0,s.jsx)(n.h3,{id:"22-kubeadm-\u90e8\u7f72\u65b9\u5f0f\u4ecb\u7ecd",children:"2.2 kubeadm \u90e8\u7f72\u65b9\u5f0f\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"kubeadm \u662f\u5b98\u65b9\u793e\u533a\u63a8\u51fa\u7684\u4e00\u4e2a\u7528\u4e8e\u5feb\u901f\u90e8\u7f72kubernetes \u96c6\u7fa4\u7684\u5de5\u5177\uff0c\u8fd9\u4e2a\u5de5\u5177\u80fd\u901a\u8fc7\u4e24\u6761\u6307\u4ee4\u5b8c\u6210\u4e00\u4e2akubernetes \u96c6\u7fa4\u7684\u90e8\u7f72\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2aMaster \u8282\u70b9kubeadm init"}),"\n",(0,s.jsxs)(n.li,{children:["\u5c06Node \u8282\u70b9\u52a0\u5165\u5230\u5f53\u524d\u96c6\u7fa4\u4e2d",(0,s.jsx)(n.code,{children:"$ kubeadm join <Master \u8282\u70b9\u7684IP \u548c\u7aef\u53e3>"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"23-\u5b89\u88c5\u8981\u6c42",children:"2.3 \u5b89\u88c5\u8981\u6c42"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u90e8\u7f72Kubernetes \u96c6\u7fa4\u673a\u5668\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u51e0\u4e2a\u6761\u4ef6\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e00\u53f0\u6216\u591a\u53f0\u673a\u5668\uff0c\u64cd\u4f5c\u7cfb\u7edfCentOS7.x-86_x64"}),"\n",(0,s.jsx)(n.li,{children:"\u786c\u4ef6\u914d\u7f6e\uff1a2GB \u6216\u66f4\u591aRAM\uff0c2 \u4e2aCPU \u6216\u66f4\u591aCPU\uff0c\u786c\u76d830GB \u6216\u66f4\u591a"}),"\n",(0,s.jsx)(n.li,{children:"\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u4e4b\u95f4\u7f51\u7edc\u4e92\u901a"}),"\n",(0,s.jsx)(n.li,{children:"\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\uff0c\u9700\u8981\u62c9\u53d6\u955c\u50cf"}),"\n",(0,s.jsx)(n.li,{children:"\u7981\u6b62swap \u5206\u533a"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"24-\u6700\u7ec8\u76ee\u6807",children:"2.4 \u6700\u7ec8\u76ee\u6807"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728\u6240\u6709\u8282\u70b9\u4e0a\u5b89\u88c5Docker \u548ckubeadm"}),"\n",(0,s.jsx)(n.li,{children:"\u90e8\u7f72Kubernetes Master"}),"\n",(0,s.jsx)(n.li,{children:"\u90e8\u7f72\u5bb9\u5668\u7f51\u7edc\u63d2\u4ef6"}),"\n",(0,s.jsx)(n.li,{children:"\u90e8\u7f72Kubernetes Node\uff0c\u5c06\u8282\u70b9\u52a0\u5165Kubernetes \u96c6\u7fa4\u4e2d"}),"\n",(0,s.jsx)(n.li,{children:"\u90e8\u7f72Dashboard Web \u9875\u9762\uff0c\u53ef\u89c6\u5316\u67e5\u770bKubernetes \u8d44\u6e90"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"25-\u51c6\u5907\u73af\u5883",children:"2.5 \u51c6\u5907\u73af\u5883"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20210609000002940",src:r(9443).A+"",width:"662",height:"455"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u89d2\u8272"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"IP\u5730\u5740"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ec4\u4ef6"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"master01"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"192.168.5.3"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"docker\uff0ckubectl\uff0ckubeadm\uff0ckubelet"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"node01"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"192.168.5.4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"docker\uff0ckubectl\uff0ckubeadm\uff0ckubelet"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"node02"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"192.168.5.5"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"docker\uff0ckubectl\uff0ckubeadm\uff0ckubelet"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"26-\u73af\u5883\u521d\u59cb\u5316",children:"2.6 \u73af\u5883\u521d\u59cb\u5316"}),"\n",(0,s.jsx)(n.h4,{id:"261-\u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u7684\u7248\u672c",children:"2.6.1 \u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u7684\u7248\u672c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u6b64\u65b9\u5f0f\u4e0b\u5b89\u88c5kubernetes\u96c6\u7fa4\u8981\u6c42Centos\u7248\u672c\u8981\u57287.5\u6216\u4e4b\u4e0a\r\n[root@master ~]# cat /etc/redhat-release\r\nCentos Linux 7.5.1804 (Core)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"262-\u4e3b\u673a\u540d\u89e3\u6790",children:"2.6.2 \u4e3b\u673a\u540d\u89e3\u6790"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u65b9\u4fbf\u96c6\u7fa4\u8282\u70b9\u95f4\u7684\u76f4\u63a5\u8c03\u7528\uff0c\u5728\u8fd9\u4e2a\u914d\u7f6e\u4e00\u4e0b\u4e3b\u673a\u540d\u89e3\u6790\uff0c\u4f01\u4e1a\u4e2d\u63a8\u8350\u4f7f\u7528\u5185\u90e8DNS\u670d\u52a1\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u4e3b\u673a\u540d\u6210\u89e3\u6790 \u7f16\u8f91\u4e09\u53f0\u670d\u52a1\u5668\u7684/etc/hosts\u6587\u4ef6\uff0c\u6dfb\u52a0\u4e0b\u9762\u5185\u5bb9\r\n192.168.90.100 master\r\n192.168.90.106 node1\r\n192.168.90.107 node2\n"})}),"\n",(0,s.jsx)(n.h4,{id:"263-\u65f6\u95f4\u540c\u6b65",children:"2.6.3 \u65f6\u95f4\u540c\u6b65"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u8981\u6c42\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u65f6\u95f4\u5fc5\u987b\u7cbe\u786e\u4e00\u81f4\uff0c\u8fd9\u91cc\u4f7f\u7528chronyd\u670d\u52a1\u4ece\u7f51\u7edc\u540c\u6b65\u65f6\u95f4"}),"\n",(0,s.jsx)(n.p,{children:"\u4f01\u4e1a\u4e2d\u5efa\u8bae\u914d\u7f6e\u5185\u90e8\u7684\u4f1a\u89c1\u540c\u6b65\u670d\u52a1\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u542f\u52a8chronyd\u670d\u52a1\r\n[root@master ~]# systemctl start chronyd\r\n[root@master ~]# systemctl enable chronyd\r\n[root@master ~]# date\n"})}),"\n",(0,s.jsx)(n.h4,{id:"264--\u7981\u7528iptable\u548cfirewalld\u670d\u52a1",children:"2.6.4  \u7981\u7528iptable\u548cfirewalld\u670d\u52a1"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u548cdocker \u5728\u8fd0\u884c\u7684\u4e2d\u4f1a\u4ea7\u751f\u5927\u91cf\u7684iptables\u89c4\u5219\uff0c\u4e3a\u4e86\u4e0d\u8ba9\u7cfb\u7edf\u89c4\u5219\u8ddf\u5b83\u4eec\u6df7\u6dc6\uff0c\u76f4\u63a5\u5173\u95ed\u7cfb\u7edf\u7684\u89c4\u5219"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# 1 \u5173\u95edfirewalld\u670d\u52a1\r\n[root@master ~]# systemctl stop firewalld\r\n[root@master ~]# systemctl disable firewalld\r\n# 2 \u5173\u95ediptables\u670d\u52a1\r\n[root@master ~]# systemctl stop iptables\r\n[root@master ~]# systemctl disable iptables\n"})}),"\n",(0,s.jsx)(n.h4,{id:"265-\u7981\u7528selinux",children:"2.6.5 \u7981\u7528selinux"}),"\n",(0,s.jsx)(n.p,{children:"selinux\u662flinux\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u5b89\u5168\u670d\u52a1\uff0c\u5982\u679c\u4e0d\u5173\u95ed\u5b83\uff0c\u5728\u5b89\u88c5\u96c6\u7fa4\u4e2d\u4f1a\u4ea7\u751f\u5404\u79cd\u5404\u6837\u7684\u5947\u8469\u95ee\u9898"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u7f16\u8f91 /etc/selinux/config \u6587\u4ef6\uff0c\u4fee\u6539SELINUX\u7684\u503c\u4e3adisable\r\n# \u6ce8\u610f\u4fee\u6539\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981\u91cd\u542flinux\u670d\u52a1\r\nSELINUX=disabled\n"})}),"\n",(0,s.jsx)(n.h4,{id:"266-\u7981\u7528swap\u5206\u533a",children:"2.6.6 \u7981\u7528swap\u5206\u533a"}),"\n",(0,s.jsxs)(n.p,{children:["swap\u5206\u533a\u6307\u7684\u662f\u865a\u62df\u5185\u5b58\u5206\u533a\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u7269\u7406\u5185\u5b58\u4f7f\u7528\u5b8c\uff0c\u4e4b\u540e\u5c06\u78c1\u76d8\u7a7a\u95f4\u865a\u62df\u6210\u5185\u5b58\u6765\u4f7f\u7528\uff0c\u542f\u7528swap\u8bbe\u5907\u4f1a\u5bf9\u7cfb\u7edf\u7684\u6027\u80fd\u4ea7\u751f\u975e\u5e38\u8d1f\u9762\u7684\u5f71\u54cd\uff0c",(0,s.jsx)(n.strong,{children:"\u56e0\u6b64kubernetes\u8981\u6c42\u6bcf\u4e2a\u8282\u70b9\u90fd\u8981\u7981\u7528swap\u8bbe\u5907"}),"\uff0c\u4f46\u662f\u5982\u679c\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u786e\u5b9e\u4e0d\u80fd\u5173\u95edswap\u5206\u533a\uff0c\u5c31\u9700\u8981\u5728\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u660e\u786e\u7684\u53c2\u6570\u8fdb\u884c\u914d\u7f6e\u8bf4\u660e"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u7f16\u8f91\u5206\u533a\u914d\u7f6e\u6587\u4ef6/etc/fstab\uff0c\u6ce8\u91ca\u6389swap\u5206\u533a\u4e00\u884c\r\n# \u6ce8\u610f\u4fee\u6539\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981\u91cd\u542flinux\u670d\u52a1\r\nvim /etc/fstab\r\n\u6ce8\u91ca\u6389 /dev/mapper/centos-swap swap\r\n# /dev/mapper/centos-swap swap\n"})}),"\n",(0,s.jsx)(n.h4,{id:"267-\u4fee\u6539linux\u7684\u5185\u6838\u53c2\u6570",children:"2.6.7 \u4fee\u6539linux\u7684\u5185\u6838\u53c2\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u4fee\u6539linux\u7684\u5185\u6838\u91c7\u7eb3\u6570\uff0c\u6dfb\u52a0\u7f51\u6865\u8fc7\u6ee4\u548c\u5730\u5740\u8f6c\u53d1\u529f\u80fd\r\n# \u7f16\u8f91/etc/sysctl.d/kubernetes.conf\u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a\r\nnet.bridge.bridge-nf-call-ip6tables = 1\r\nnet.bridge.bridge-nf-call-iptables = 1\r\nnet.ipv4.ip_forward = 1\r\n\r\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\r\n[root@master ~]# sysctl -p\r\n# \u52a0\u8f7d\u7f51\u6865\u8fc7\u6ee4\u6a21\u5757\r\n[root@master ~]# modprobe br_netfilter\r\n# \u67e5\u770b\u7f51\u6865\u8fc7\u6ee4\u6a21\u5757\u662f\u5426\u52a0\u8f7d\u6210\u529f\r\n[root@master ~]# lsmod | grep br_netfilter\n"})}),"\n",(0,s.jsx)(n.h4,{id:"268-\u914d\u7f6eipvs\u529f\u80fd",children:"2.6.8 \u914d\u7f6eipvs\u529f\u80fd"}),"\n",(0,s.jsx)(n.p,{children:"\u5728Kubernetes\u4e2dService\u6709\u4e24\u79cd\u5e26\u6765\u6a21\u578b\uff0c\u4e00\u79cd\u662f\u57fa\u4e8eiptables\u7684\uff0c\u4e00\u79cd\u662f\u57fa\u4e8eipvs\u7684\u4e24\u8005\u6bd4\u8f83\u7684\u8bdd\uff0cipvs\u7684\u6027\u80fd\u660e\u663e\u8981\u9ad8\u4e00\u4e9b\uff0c\u4f46\u662f\u5982\u679c\u8981\u4f7f\u7528\u5b83\uff0c\u9700\u8981\u624b\u52a8\u8f7d\u5165ipvs\u6a21\u5757"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# 1.\u5b89\u88c5ipset\u548cipvsadm\r\n[root@master ~]# yum install ipset ipvsadm -y\r\n# 2.\u6dfb\u52a0\u9700\u8981\u52a0\u8f7d\u7684\u6a21\u5757\u5199\u5165\u811a\u672c\u6587\u4ef6\r\n[root@master ~]# cat <<EOF> /etc/sysconfig/modules/ipvs.modules\r\n#!/bin/bash\r\nmodprobe -- ip_vs\r\nmodprobe -- ip_vs_rr\r\nmodprobe -- ip_vs_wrr\r\nmodprobe -- ip_vs_sh\r\nmodprobe -- nf_conntrack_ipv4\r\nEOF\r\n# 3.\u4e3a\u811a\u672c\u6dfb\u52a0\u6267\u884c\u6743\u9650\r\n[root@master ~]# chmod +x /etc/sysconfig/modules/ipvs.modules\r\n# 4.\u6267\u884c\u811a\u672c\u6587\u4ef6\r\n[root@master ~]# /bin/bash /etc/sysconfig/modules/ipvs.modules\r\n# 5.\u67e5\u770b\u5bf9\u5e94\u7684\u6a21\u5757\u662f\u5426\u52a0\u8f7d\u6210\u529f\r\n[root@master ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u91cd\u542f\u670d\u52a1\u5668"})}),"\n",(0,s.jsx)(n.h4,{id:"269-\u5b89\u88c5docker",children:"2.6.9 \u5b89\u88c5docker"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'# 1\u3001\u5207\u6362\u955c\u50cf\u6e90\r\n[root@master ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo\r\n\r\n# 2\u3001\u67e5\u770b\u5f53\u524d\u955c\u50cf\u6e90\u4e2d\u652f\u6301\u7684docker\u7248\u672c\r\n[root@master ~]# yum list docker-ce --showduplicates\r\n\r\n# 3\u3001\u5b89\u88c5\u7279\u5b9a\u7248\u672c\u7684docker-ce\r\n# \u5fc5\u987b\u5236\u5b9a--setopt=obsoletes=0\uff0c\u5426\u5219yum\u4f1a\u81ea\u52a8\u5b89\u88c5\u66f4\u9ad8\u7248\u672c\r\n[root@master ~]# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y\r\n\r\n# 4\u3001\u6dfb\u52a0\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\r\n#Docker \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528Vgroup Driver\u4e3acgroupfs\uff0c\u800cKubernetes\u63a8\u8350\u4f7f\u7528systemd\u6765\u66ff\u4ee3cgroupfs\r\n[root@master ~]# mkdir /etc/docker\r\n[root@master ~]# cat <<EOF> /etc/docker/daemon.json\r\n{\r\n\t"exec-opts": ["native.cgroupdriver=systemd"],\r\n\t"registry-mirrors": ["https://kn0t2bca.mirror.aliyuncs.com"]\r\n}\r\nEOF\r\n\r\n# 5\u3001\u542f\u52a8dokcer\r\n[root@master ~]# systemctl restart docker\r\n[root@master ~]# systemctl enable docker\n'})}),"\n",(0,s.jsx)(n.h4,{id:"2610-\u5b89\u88c5kubernetes\u7ec4\u4ef6",children:"2.6.10 \u5b89\u88c5Kubernetes\u7ec4\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'# 1\u3001\u7531\u4e8ekubernetes\u7684\u955c\u50cf\u5728\u56fd\u5916\uff0c\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u8fd9\u91cc\u5207\u6362\u6210\u56fd\u5185\u7684\u955c\u50cf\u6e90\r\n# 2\u3001\u7f16\u8f91/etc/yum.repos.d/kubernetes.repo,\u6dfb\u52a0\u4e0b\u9762\u7684\u914d\u7f6e\r\n[kubernetes]\r\nname=Kubernetes\r\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\r\nenabled=1\r\ngpgchech=0\r\nrepo_gpgcheck=0\r\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\r\n\t\t\thttp://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\r\n\r\n# 3\u3001\u5b89\u88c5kubeadm\u3001kubelet\u548ckubectl\r\n[root@master ~]# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y\r\n\r\n# 4\u3001\u914d\u7f6ekubelet\u7684cgroup\r\n#\u7f16\u8f91/etc/sysconfig/kubelet, \u6dfb\u52a0\u4e0b\u9762\u7684\u914d\u7f6e\r\nKUBELET_CGROUP_ARGS="--cgroup-driver=systemd"\r\nKUBE_PROXY_MODE="ipvs"\r\n\r\n# 5\u3001\u8bbe\u7f6ekubelet\u5f00\u673a\u81ea\u542f\r\n[root@master ~]# systemctl enable kubelet\n'})}),"\n",(0,s.jsx)(n.h4,{id:"2611-\u51c6\u5907\u96c6\u7fa4\u955c\u50cf",children:"2.6.11 \u51c6\u5907\u96c6\u7fa4\u955c\u50cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u5728\u5b89\u88c5kubernetes\u96c6\u7fa4\u4e4b\u524d\uff0c\u5fc5\u987b\u8981\u63d0\u524d\u51c6\u5907\u597d\u96c6\u7fa4\u9700\u8981\u7684\u955c\u50cf\uff0c\u6240\u9700\u955c\u50cf\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b\r\n[root@master ~]# kubeadm config images list\r\n\r\n# \u4e0b\u8f7d\u955c\u50cf\r\n# \u6b64\u955c\u50cfkubernetes\u7684\u4ed3\u5e93\u4e2d\uff0c\u7531\u4e8e\u7f51\u7edc\u539f\u56e0\uff0c\u65e0\u6cd5\u8fde\u63a5\uff0c\u4e0b\u9762\u63d0\u4f9b\u4e86\u4e00\u79cd\u66ff\u6362\u65b9\u6848\r\nimages=(\r\n\tkube-apiserver:v1.17.4\r\n\tkube-controller-manager:v1.17.4\r\n\tkube-scheduler:v1.17.4\r\n\tkube-proxy:v1.17.4\r\n\tpause:3.1\r\n\tetcd:3.4.3-0\r\n\tcoredns:1.6.5\r\n)\r\n\r\nfor imageName in ${images[@]};do\r\n\tdocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\r\n\tdocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName\r\n\tdocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName \r\ndone\r\n\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2612-\u96c6\u7fa4\u521d\u59cb\u5316",children:"2.6.12 \u96c6\u7fa4\u521d\u59cb\u5316"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u4e0b\u9762\u7684\u64cd\u4f5c\u53ea\u9700\u8981\u5728",(0,s.jsx)(n.strong,{children:"master"}),"\u8282\u70b9\u4e0a\u6267\u884c\u5373\u53ef"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u521b\u5efa\u96c6\u7fa4\r\n[root@master ~]# kubeadm init \\\r\n\t--apiserver-advertise-address=192.168.12.100 \\\r\n\t--image-repository registry.aliyuncs.com/google_containers \\\r\n\t--kubernetes-version=v1.17.4 \\\r\n\t--service-cidr=10.96.0.0/12 \\\r\n\t--pod-network-cidr=10.244.0.0/16\r\n\t\r\n[root@master ~]# kubeadm init \\\r\n\t--apiserver-advertise-address=192.168.12.100 \\\r\n\t--kubernetes-version=v1.17.4 \\\r\n\t--service-cidr=10.96.0.0/12 \\\r\n\t--pod-network-cidr=10.244.0.0/16\r\n\t\r\n# \u521b\u5efa\u5fc5\u8981\u6587\u4ef6\r\n[root@master ~]# mkdir -p $HOME/.kube\r\n[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\r\n[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u7684\u64cd\u4f5c\u53ea\u9700\u8981\u5728node\u8282\u70b9\u4e0a\u6267\u884c\u5373\u53ef"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubeadm join 192.168.0.100:6443 --token awk15p.t6bamck54w69u4s8 \\\r\n    --discovery-token-ca-cert-hash sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728master\u4e0a\u67e5\u770b\u8282\u70b9\u4fe1\u606f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"[root@master ~]# kubectl get nodes\r\nNAME    STATUS   ROLES     AGE   VERSION\r\nmaster  NotReady  master   6m    v1.17.4\r\nnode1   NotReady   <none>  22s   v1.17.4\r\nnode2   NotReady   <none>  19s   v1.17.4\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2613-\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\u53ea\u5728master\u8282\u70b9\u64cd\u4f5c\u5373\u53ef",children:"2.6.13 \u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ea\u5728master\u8282\u70b9\u64cd\u4f5c\u5373\u53ef"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u652f\u6301\u591a\u79cd\u7f51\u7edc\u63d2\u4ef6\uff0c\u6bd4\u5982flannel\u3001calico\u3001canal\u7b49\u7b49\uff0c\u4efb\u9009\u4e00\u79cd\u4f7f\u7528\u5373\u53ef\uff0c\u672c\u6b21\u9009\u62e9flannel"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u4e0b\u9762\u7684\u64cd\u4f5c\u4f9d\u65e7\u53ea\u5728",(0,s.jsx)(n.code,{children:"master"}),"\u8282\u70b9\u6267\u884c\u5373\u53ef\uff0c\u63d2\u4ef6\u4f7f\u7528\u7684\u662fDaemonSet\u7684\u63a7\u5236\u5668\uff0c\u5b83\u4f1a\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u8fd0\u884c\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u83b7\u53d6fannel\u7684\u914d\u7f6e\u6587\u4ef6\r\nwget https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml\r\nkubectl apply -f kube-flannel.yml\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2614-\u4f7f\u7528kubeadm-reset\u91cd\u7f6e\u96c6\u7fa4",children:"2.6.14 \u4f7f\u7528kubeadm reset\u91cd\u7f6e\u96c6\u7fa4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"#\u5728master\u8282\u70b9\u4e4b\u5916\u7684\u8282\u70b9\u8fdb\u884c\u64cd\u4f5c\r\nkubeadm reset -y\r\nsystemctl stop kubelet\r\nsystemctl stop docker\r\nrm -rf /var/lib/cni/\r\nrm -rf /var/lib/kubelet/*\r\nrm -rf /etc/cni/\r\nifconfig cni0 down\r\nifconfig flannel.1 down\r\nifconfig docker0 down\r\nip link delete cni0\r\nip link delete flannel.1\r\n##\u91cd\u542fkubelet\r\nsystemctl restart kubelet\r\n##\u91cd\u542fdocker\r\nsystemctl restart docker\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2615-\u91cd\u542fkubelet\u548cdocker",children:"2.6.15 \u91cd\u542fkubelet\u548cdocker"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u91cd\u542fkubelet\r\nsystemctl restart kubelet\r\n# \u91cd\u542fdocker\r\nsystemctl restart docker\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u542f\u52a8fannel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl apply -f kube-flannel.yml\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7b49\u5f85\u5b83\u5b89\u88c5\u5b8c\u6bd5 \u53d1\u73b0\u5df2\u7ecf\u662f \u96c6\u7fa4\u7684\u72b6\u6001\u5df2\u7ecf\u662fReady"}),"\n",(0,s.jsx)(n.h4,{id:"2616-kubeadm\u4e2d\u7684\u547d\u4ee4",children:"2.6.16 kubeadm\u4e2d\u7684\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"# \u751f\u6210 \u65b0\u7684token\r\n[root@master ~]# kubeadm token create --print-join-command\n"})}),"\n",(0,s.jsx)(n.h3,{id:"27-\u96c6\u7fa4\u6d4b\u8bd5",children:"2.7 \u96c6\u7fa4\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.h4,{id:"271-\u521b\u5efa\u4e00\u4e2anginx\u670d\u52a1",children:"2.7.1 \u521b\u5efa\u4e00\u4e2anginx\u670d\u52a1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl create deployment nginx  --image=nginx:1.14-alpine\n"})}),"\n",(0,s.jsx)(n.h4,{id:"272-\u66b4\u9732\u7aef\u53e3",children:"2.7.2 \u66b4\u9732\u7aef\u53e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl expose deploy nginx  --port=80 --target-port=80  --type=NodePort\n"})}),"\n",(0,s.jsx)(n.h4,{id:"273-\u67e5\u770b\u670d\u52a1",children:"2.7.3 \u67e5\u770b\u670d\u52a1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl get pod,svc\n"})}),"\n",(0,s.jsx)(n.h4,{id:"274-\u67e5\u770bpod",children:"2.7.4 \u67e5\u770bpod"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(7252).A+"",width:"1919",height:"560"})}),"\n",(0,s.jsx)(n.p,{children:"\u6d4f\u89c8\u5668\u6d4b\u8bd5\u7ed3\u679c\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(2759).A+"",width:"1920",height:"1542"})}),"\n",(0,s.jsx)(n.h2,{id:"3-\u8d44\u6e90\u7ba1\u7406",children:"3. \u8d44\u6e90\u7ba1\u7406"}),"\n",(0,s.jsx)(n.h3,{id:"31-\u8d44\u6e90\u7ba1\u7406\u4ecb\u7ecd",children:"3.1 \u8d44\u6e90\u7ba1\u7406\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\uff0c\u6240\u6709\u7684\u5185\u5bb9\u90fd\u62bd\u8c61\u4e3a\u8d44\u6e90\uff0c\u7528\u6237\u9700\u8981\u901a\u8fc7\u64cd\u4f5c\u8d44\u6e90\u6765\u7ba1\u7406kubernetes\u3002"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"kubernetes\u7684\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u96c6\u7fa4\u7cfb\u7edf\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u90e8\u7f72\u5404\u79cd\u670d\u52a1\uff0c\u6240\u8c13\u7684\u90e8\u7f72\u670d\u52a1\uff0c\u5176\u5b9e\u5c31\u662f\u5728kubernetes\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e00\u4e2a\u4e2a\u7684\u5bb9\u5668\uff0c\u5e76\u5c06\u6307\u5b9a\u7684\u7a0b\u5e8f\u8dd1\u5728\u5bb9\u5668\u4e2d\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["kubernetes\u7684\u6700\u5c0f\u7ba1\u7406\u5355\u5143\u662fpod\u800c\u4e0d\u662f\u5bb9\u5668\uff0c\u6240\u4ee5\u53ea\u80fd\u5c06\u5bb9\u5668\u653e\u5728",(0,s.jsx)(n.code,{children:"Pod"}),"\u4e2d\uff0c\u800ckubernetes\u4e00\u822c\u4e5f\u4e0d\u4f1a\u76f4\u63a5\u7ba1\u7406Pod\uff0c\u800c\u662f\u901a\u8fc7",(0,s.jsx)(n.code,{children:"Pod\u63a7\u5236\u5668"}),"\u6765\u7ba1\u7406Pod\u7684\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["Pod\u53ef\u4ee5\u63d0\u4f9b\u670d\u52a1\u4e4b\u540e\uff0c\u5c31\u8981\u8003\u8651\u5982\u4f55\u8bbf\u95eePod\u4e2d\u670d\u52a1\uff0ckubernetes\u63d0\u4f9b\u4e86",(0,s.jsx)(n.code,{children:"Service"}),"\u8d44\u6e90\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u7136\uff0c\u5982\u679cPod\u4e2d\u7a0b\u5e8f\u7684\u6570\u636e\u9700\u8981\u6301\u4e45\u5316\uff0ckubernetes\u8fd8\u63d0\u4f9b\u4e86\u5404\u79cd",(0,s.jsx)(n.code,{children:"\u5b58\u50a8"}),"\u7cfb\u7edf\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200406225334627",src:r(5528).A+"",width:"1211",height:"662"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5b66\u4e60kubernetes\u7684\u6838\u5fc3\uff0c\u5c31\u662f\u5b66\u4e60\u5982\u4f55\u5bf9\u96c6\u7fa4\u4e0a\u7684",(0,s.jsx)(n.code,{children:"Pod\u3001Pod\u63a7\u5236\u5668\u3001Service\u3001\u5b58\u50a8"}),"\u7b49\u5404\u79cd\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"32-yaml\u8bed\u8a00\u4ecb\u7ecd",children:"3.2 YAML\u8bed\u8a00\u4ecb\u7ecd"}),"\n",(0,s.jsxs)(n.p,{children:["YAML\u662f\u4e00\u4e2a\u7c7b\u4f3c XML\u3001JSON \u7684\u6807\u8bb0\u6027\u8bed\u8a00\u3002\u5b83\u5f3a\u8c03\u4ee5",(0,s.jsx)(n.strong,{children:"\u6570\u636e"}),'\u4e3a\u4e2d\u5fc3\uff0c\u5e76\u4e0d\u662f\u4ee5\u6807\u8bc6\u8bed\u8a00\u4e3a\u91cd\u70b9\u3002\u56e0\u800cYAML\u672c\u8eab\u7684\u5b9a\u4e49\u6bd4\u8f83\u7b80\u5355\uff0c\u53f7\u79f0"\u4e00\u79cd\u4eba\u6027\u5316\u7684\u6570\u636e\u683c\u5f0f\u8bed\u8a00"\u3002']}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"<heima>\r\n    <age>15</age>\r\n    <address>Beijing</address>\r\n</heima>\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"heima:\r\n  age: 15\r\n  address: Beijing\n"})}),"\n",(0,s.jsx)(n.p,{children:"YAML\u7684\u8bed\u6cd5\u6bd4\u8f83\u7b80\u5355\uff0c\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5927\u5c0f\u5199\u654f\u611f"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb"}),"\n",(0,s.jsx)(n.li,{children:"\u7f29\u8fdb\u4e0d\u5141\u8bb8\u4f7f\u7528tab\uff0c\u53ea\u5141\u8bb8\u7a7a\u683c( \u4f4e\u7248\u672c\u9650\u5236 )"}),"\n",(0,s.jsx)(n.li,{children:"\u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u4e0d\u91cd\u8981\uff0c\u53ea\u8981\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u5bf9\u9f50\u5373\u53ef"}),"\n",(0,s.jsx)(n.li,{children:"'#'\u8868\u793a\u6ce8\u91ca"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"YAML\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u6570\u636e\u7c7b\u578b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7eaf\u91cf\uff1a\u5355\u4e2a\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u503c"}),"\n",(0,s.jsx)(n.li,{children:"\u5bf9\u8c61\uff1a\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u53c8\u79f0\u4e3a\u6620\u5c04\uff08mapping\uff09/ \u54c8\u5e0c\uff08hash\uff09 / \u5b57\u5178\uff08dictionary\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u6570\u7ec4\uff1a\u4e00\u7ec4\u6309\u6b21\u5e8f\u6392\u5217\u7684\u503c\uff0c\u53c8\u79f0\u4e3a\u5e8f\u5217\uff08sequence\uff09 / \u5217\u8868\uff08list\uff09"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"# \u7eaf\u91cf, \u5c31\u662f\u6307\u7684\u4e00\u4e2a\u7b80\u5355\u7684\u503c\uff0c\u5b57\u7b26\u4e32\u3001\u5e03\u5c14\u503c\u3001\u6574\u6570\u3001\u6d6e\u70b9\u6570\u3001Null\u3001\u65f6\u95f4\u3001\u65e5\u671f\r\n# 1 \u5e03\u5c14\u7c7b\u578b\r\nc1: true (\u6216\u8005True)\r\n# 2 \u6574\u578b\r\nc2: 234\r\n# 3 \u6d6e\u70b9\u578b\r\nc3: 3.14\r\n# 4 null\u7c7b\u578b \r\nc4: ~  # \u4f7f\u7528~\u8868\u793anull\r\n# 5 \u65e5\u671f\u7c7b\u578b\r\nc5: 2018-02-17    # \u65e5\u671f\u5fc5\u987b\u4f7f\u7528ISO 8601\u683c\u5f0f\uff0c\u5373yyyy-MM-dd\r\n# 6 \u65f6\u95f4\u7c7b\u578b\r\nc6: 2018-02-17T15:02:31+08:00  # \u65f6\u95f4\u4f7f\u7528ISO 8601\u683c\u5f0f\uff0c\u65f6\u95f4\u548c\u65e5\u671f\u4e4b\u95f4\u4f7f\u7528T\u8fde\u63a5\uff0c\u6700\u540e\u4f7f\u7528+\u4ee3\u8868\u65f6\u533a\r\n# 7 \u5b57\u7b26\u4e32\u7c7b\u578b\r\nc7: heima     # \u7b80\u5355\u5199\u6cd5\uff0c\u76f4\u63a5\u5199\u503c , \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u95f4\u6709\u7279\u6b8a\u5b57\u7b26\uff0c\u5fc5\u987b\u4f7f\u7528\u53cc\u5f15\u53f7\u6216\u8005\u5355\u5f15\u53f7\u5305\u88f9 \r\nc8: line1\r\n    line2     # \u5b57\u7b26\u4e32\u8fc7\u591a\u7684\u60c5\u51b5\u53ef\u4ee5\u62c6\u6210\u591a\u884c\uff0c\u6bcf\u4e00\u884c\u4f1a\u88ab\u8f6c\u5316\u6210\u4e00\u4e2a\u7a7a\u683c\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# \u5bf9\u8c61\r\n# \u5f62\u5f0f\u4e00(\u63a8\u8350):\r\nheima:\r\n  age: 15\r\n  address: Beijing\r\n# \u5f62\u5f0f\u4e8c(\u4e86\u89e3):\r\nheima: {age: 15,address: Beijing}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# \u6570\u7ec4\r\n# \u5f62\u5f0f\u4e00(\u63a8\u8350):\r\naddress:\r\n  - \u987a\u4e49\r\n  - \u660c\u5e73  \r\n# \u5f62\u5f0f\u4e8c(\u4e86\u89e3):\r\naddress: [\u987a\u4e49,\u660c\u5e73]\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5c0f\u63d0\u793a\uff1a"}),"\n",(0,s.jsxs)(n.p,{children:["1 \u4e66\u5199yaml\u5207\u8bb0",(0,s.jsx)(n.code,{children:":"})," \u540e\u9762\u8981\u52a0\u4e00\u4e2a\u7a7a\u683c"]}),"\n",(0,s.jsxs)(n.p,{children:["2 \u5982\u679c\u9700\u8981\u5c06\u591a\u6bb5yaml\u914d\u7f6e\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4e2d\u95f4\u8981\u4f7f\u7528",(0,s.jsx)(n.code,{children:"---"}),"\u5206\u9694"]}),"\n",(0,s.jsx)(n.p,{children:"3 \u4e0b\u9762\u662f\u4e00\u4e2ayaml\u8f6cjson\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u9a8c\u8bc1yaml\u662f\u5426\u4e66\u5199\u6b63\u786e"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.json2yaml.com/convert-yaml-to-json",children:"https://www.json2yaml.com/convert-yaml-to-json"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"33-\u8d44\u6e90\u7ba1\u7406\u65b9\u5f0f",children:"3.3 \u8d44\u6e90\u7ba1\u7406\u65b9\u5f0f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406\uff1a\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u53bb\u64cd\u4f5ckubernetes\u8d44\u6e90"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl run nginx-pod --image=nginx:1.17.1 --port=80\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e\uff1a\u901a\u8fc7\u547d\u4ee4\u914d\u7f6e\u548c\u914d\u7f6e\u6587\u4ef6\u53bb\u64cd\u4f5ckubernetes\u8d44\u6e90"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl create/patch -f nginx-pod.yaml\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e\uff1a\u901a\u8fc7apply\u547d\u4ee4\u548c\u914d\u7f6e\u6587\u4ef6\u53bb\u64cd\u4f5ckubernetes\u8d44\u6e90"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl apply -f nginx-pod.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7c7b\u578b"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u64cd\u4f5c\u5bf9\u8c61"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u9002\u7528\u73af\u5883"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u4f18\u70b9"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7f3a\u70b9"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5bf9\u8c61"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6d4b\u8bd5"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7b80\u5355"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u53ea\u80fd\u64cd\u4f5c\u6d3b\u52a8\u5bf9\u8c61\uff0c\u65e0\u6cd5\u5ba1\u8ba1\u3001\u8ddf\u8e2a"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6587\u4ef6"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5f00\u53d1"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u53ef\u4ee5\u5ba1\u8ba1\u3001\u8ddf\u8e2a"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u9879\u76ee\u5927\u65f6\uff0c\u914d\u7f6e\u6587\u4ef6\u591a\uff0c\u64cd\u4f5c\u9ebb\u70e6"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u76ee\u5f55"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5f00\u53d1"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u652f\u6301\u76ee\u5f55\u64cd\u4f5c"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u610f\u5916\u60c5\u51b5\u4e0b\u96be\u4ee5\u8c03\u8bd5"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"331-\u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406",children:"3.3.1 \u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"kubectl\u547d\u4ee4"})}),"\n",(0,s.jsx)(n.p,{children:"kubectl\u662fkubernetes\u96c6\u7fa4\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u901a\u8fc7\u5b83\u80fd\u591f\u5bf9\u96c6\u7fa4\u672c\u8eab\u8fdb\u884c\u7ba1\u7406\uff0c\u5e76\u80fd\u591f\u5728\u96c6\u7fa4\u4e0a\u8fdb\u884c\u5bb9\u5668\u5316\u5e94\u7528\u7684\u5b89\u88c5\u90e8\u7f72\u3002kubectl\u547d\u4ee4\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl [command] [type] [name] [flags]\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"comand"}),"\uff1a\u6307\u5b9a\u8981\u5bf9\u8d44\u6e90\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982create\u3001get\u3001delete"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type"}),"\uff1a\u6307\u5b9a\u8d44\u6e90\u7c7b\u578b\uff0c\u6bd4\u5982deployment\u3001pod\u3001service"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"name"}),"\uff1a\u6307\u5b9a\u8d44\u6e90\u7684\u540d\u79f0\uff0c\u540d\u79f0\u5927\u5c0f\u5199\u654f\u611f"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"flags"}),"\uff1a\u6307\u5b9a\u989d\u5916\u7684\u53ef\u9009\u53c2\u6570"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u6240\u6709pod\r\nkubectl get pod \r\n\r\n# \u67e5\u770b\u67d0\u4e2apod\r\nkubectl get pod pod_name\r\n\r\n# \u67e5\u770b\u67d0\u4e2apod,\u4ee5yaml\u683c\u5f0f\u5c55\u793a\u7ed3\u679c\r\nkubectl get pod pod_name -o yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u7c7b\u578b"})}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u4e2d\u6240\u6709\u7684\u5185\u5bb9\u90fd\u62bd\u8c61\u4e3a\u8d44\u6e90\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u67e5\u770b:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl api-resources\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7ecf\u5e38\u4f7f\u7528\u7684\u8d44\u6e90\u6709\u4e0b\u9762\u8fd9\u4e9b\uff1a"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u8d44\u6e90\u5206\u7c7b"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u8d44\u6e90\u540d\u79f0"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7f29\u5199"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u8d44\u6e90\u4f5c\u7528"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u96c6\u7fa4\u7ea7\u522b\u8d44\u6e90"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"nodes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"no"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u96c6\u7fa4\u7ec4\u6210\u90e8\u5206"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"namespaces"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"ns"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u9694\u79bbPod"}),(0,s.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"pod\u8d44\u6e90"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"pods"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"po"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u88c5\u8f7d\u5bb9\u5668"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"pod\u8d44\u6e90\u63a7\u5236\u5668"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"replicationcontrollers"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"rc"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"replicasets"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"rs"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"deployments"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"deploy"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"daemonsets"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"ds"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"jobs"}),(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"cronjobs"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"cj"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"horizontalpodautoscalers"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"hpa"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"statefulsets"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"sts"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63a7\u5236pod\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u670d\u52a1\u53d1\u73b0\u8d44\u6e90"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"services"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"svc"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7edf\u4e00pod\u5bf9\u5916\u63a5\u53e3"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"ingress"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"ing"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7edf\u4e00pod\u5bf9\u5916\u63a5\u53e3"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5b58\u50a8\u8d44\u6e90"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"volumeattachments"}),(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5b58\u50a8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"persistentvolumes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"pv"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5b58\u50a8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"persistentvolumeclaims"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"pvc"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5b58\u50a8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u914d\u7f6e\u8d44\u6e90"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"configmaps"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"cm"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u914d\u7f6e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"secrets"}),(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u914d\u7f6e"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u64cd\u4f5c"})}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u5141\u8bb8\u5bf9\u8d44\u6e90\u8fdb\u884c\u591a\u79cd\u64cd\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7--help\u67e5\u770b\u8be6\u7ec6\u7684\u64cd\u4f5c\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl --help\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7ecf\u5e38\u4f7f\u7528\u7684\u64cd\u4f5c\u6709\u4e0b\u9762\u8fd9\u4e9b\uff1a"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u547d\u4ee4\u5206\u7c7b"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u547d\u4ee4"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ffb\u8bd1"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u547d\u4ee4\u4f5c\u7528"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u57fa\u672c\u547d\u4ee4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"create"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u521b\u5efa"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u521b\u5efa\u4e00\u4e2a\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"edit"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7f16\u8f91"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7f16\u8f91\u4e00\u4e2a\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"get"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u83b7\u53d6"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u83b7\u53d6\u4e00\u4e2a\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"patch"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u66f4\u65b0"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u66f4\u65b0\u4e00\u4e2a\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"delete"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5220\u9664"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5220\u9664\u4e00\u4e2a\u8d44\u6e90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"explain"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u89e3\u91ca"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5c55\u793a\u8d44\u6e90\u6587\u6863"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8fd0\u884c\u548c\u8c03\u8bd5"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"run"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8fd0\u884c"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e00\u4e2a\u6307\u5b9a\u7684\u955c\u50cf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"expose"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u66b4\u9732"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u66b4\u9732\u8d44\u6e90\u4e3aService"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"describe"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u63cf\u8ff0"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u663e\u793a\u8d44\u6e90\u5185\u90e8\u4fe1\u606f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"logs"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u65e5\u5fd7\u8f93\u51fa\u5bb9\u5668\u5728 pod \u4e2d\u7684\u65e5\u5fd7"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8f93\u51fa\u5bb9\u5668\u5728 pod \u4e2d\u7684\u65e5\u5fd7"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"attach"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7f20\u7ed5\u8fdb\u5165\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8fdb\u5165\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"exec"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6267\u884c\u5bb9\u5668\u4e2d\u7684\u4e00\u4e2a\u547d\u4ee4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6267\u884c\u5bb9\u5668\u4e2d\u7684\u4e00\u4e2a\u547d\u4ee4"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"cp"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u590d\u5236"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5728Pod\u5185\u5916\u590d\u5236\u6587\u4ef6"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"rollout"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u9996\u6b21\u5c55\u793a"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7ba1\u7406\u8d44\u6e90\u7684\u53d1\u5e03"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"scale"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u89c4\u6a21"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6269(\u7f29)\u5bb9Pod\u7684\u6570\u91cf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"autoscale"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u81ea\u52a8\u8c03\u6574"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u81ea\u52a8\u8c03\u6574Pod\u7684\u6570\u91cf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u9ad8\u7ea7\u547d\u4ee4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"apply"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"rc"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u901a\u8fc7\u6587\u4ef6\u5bf9\u8d44\u6e90\u8fdb\u884c\u914d\u7f6e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"label"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6807\u7b7e"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u66f4\u65b0\u8d44\u6e90\u4e0a\u7684\u6807\u7b7e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5176\u4ed6\u547d\u4ee4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"cluster-info"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u96c6\u7fa4\u4fe1\u606f"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u663e\u793a\u96c6\u7fa4\u4fe1\u606f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"version"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7248\u672c"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u663e\u793a\u5f53\u524dServer\u548cClient\u7684\u7248\u672c"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u4ee5\u4e00\u4e2anamespace / pod\u7684\u521b\u5efa\u548c\u5220\u9664\u7b80\u5355\u6f14\u793a\u4e0b\u547d\u4ee4\u7684\u4f7f\u7528\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efa\u4e00\u4e2anamespace\r\n[root@master ~]# kubectl create namespace dev\r\nnamespace/dev created\r\n\r\n# \u83b7\u53d6namespace\r\n[root@master ~]# kubectl get ns\r\nNAME              STATUS   AGE\r\ndefault           Active   21h\r\ndev               Active   21s\r\nkube-node-lease   Active   21h\r\nkube-public       Active   21h\r\nkube-system       Active   21h\r\n\r\n# \u5728\u6b64namespace\u4e0b\u521b\u5efa\u5e76\u8fd0\u884c\u4e00\u4e2anginx\u7684Pod\r\n[root@master ~]# kubectl run pod --image=nginx:latest -n dev\r\nkubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.\r\ndeployment.apps/pod created\r\n\r\n# \u67e5\u770b\u65b0\u521b\u5efa\u7684pod\r\n[root@master ~]# kubectl get pod -n dev\r\nNAME  READY   STATUS    RESTARTS   AGE\r\npod   1/1     Running   0          21s\r\n\r\n# \u5220\u9664\u6307\u5b9a\u7684pod\r\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\r\npod "pod" deleted\r\n\r\n# \u5220\u9664\u6307\u5b9a\u7684namespace\r\n[root@master ~]# kubectl delete ns dev\r\nnamespace "dev" deleted\n'})}),"\n",(0,s.jsx)(n.h4,{id:"332-\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e",children:"3.3.2 \u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e"}),"\n",(0,s.jsx)(n.p,{children:"\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e\u5c31\u662f\u4f7f\u7528\u547d\u4ee4\u914d\u5408\u914d\u7f6e\u6587\u4ef6\u4e00\u8d77\u6765\u64cd\u4f5ckubernetes\u8d44\u6e90\u3002"}),"\n",(0,s.jsx)(n.p,{children:"1\uff09 \u521b\u5efa\u4e00\u4e2anginxpod.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  name: dev\r\n\r\n---\r\n\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: nginxpod\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx-containers\r\n    image: nginx:latest\n"})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09\u6267\u884ccreate\u547d\u4ee4\uff0c\u521b\u5efa\u8d44\u6e90\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"[root@master ~]# kubectl create -f nginxpod.yaml\r\nnamespace/dev created\r\npod/nginxpod created\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u65f6\u53d1\u73b0\u521b\u5efa\u4e86\u4e24\u4e2a\u8d44\u6e90\u5bf9\u8c61\uff0c\u5206\u522b\u662fnamespace\u548cpod"}),"\n",(0,s.jsx)(n.p,{children:"3\uff09\u6267\u884cget\u547d\u4ee4\uff0c\u67e5\u770b\u8d44\u6e90\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@master ~]#  kubectl get -f nginxpod.yaml\r\nNAME            STATUS   AGE\r\nnamespace/dev   Active   18s\r\n\r\nNAME            READY   STATUS    RESTARTS   AGE\r\npod/nginxpod    1/1     Running   0          17s\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\u5c31\u663e\u793a\u4e86\u4e24\u4e2a\u8d44\u6e90\u5bf9\u8c61\u7684\u4fe1\u606f"}),"\n",(0,s.jsx)(n.p,{children:"4\uff09\u6267\u884cdelete\u547d\u4ee4\uff0c\u5220\u9664\u8d44\u6e90\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'[root@master ~]# kubectl delete -f nginxpod.yaml\r\nnamespace "dev" deleted\r\npod "nginxpod" deleted\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u65f6\u53d1\u73b0\u4e24\u4e2a\u8d44\u6e90\u5bf9\u8c61\u88ab\u5220\u9664\u4e86"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u603b\u7ed3:\r\n    \u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e\u7684\u65b9\u5f0f\u64cd\u4f5c\u8d44\u6e90\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u8ba4\u4e3a\uff1a\u547d\u4ee4  +  yaml\u914d\u7f6e\u6587\u4ef6\uff08\u91cc\u9762\u662f\u547d\u4ee4\u9700\u8981\u7684\u5404\u79cd\u53c2\u6570\uff09\n"})}),"\n",(0,s.jsx)(n.h4,{id:"333-\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e",children:"3.3.3 \u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e"}),"\n",(0,s.jsx)(n.p,{children:"\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e\u8ddf\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e\u5f88\u76f8\u4f3c\uff0c\u4f46\u662f\u5b83\u53ea\u6709\u4e00\u4e2a\u547d\u4ee4apply\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u9996\u5148\u6267\u884c\u4e00\u6b21kubectl apply -f yaml\u6587\u4ef6\uff0c\u53d1\u73b0\u521b\u5efa\u4e86\u8d44\u6e90\r\n[root@master ~]#  kubectl apply -f nginxpod.yaml\r\nnamespace/dev created\r\npod/nginxpod created\r\n\r\n# \u518d\u6b21\u6267\u884c\u4e00\u6b21kubectl apply -f yaml\u6587\u4ef6\uff0c\u53d1\u73b0\u8bf4\u8d44\u6e90\u6ca1\u6709\u53d8\u52a8\r\n[root@master ~]#  kubectl apply -f nginxpod.yaml\r\nnamespace/dev unchanged\r\npod/nginxpod unchanged\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"\u603b\u7ed3:\r\n    \u5176\u5b9e\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e\u5c31\u662f\u4f7f\u7528apply\u63cf\u8ff0\u4e00\u4e2a\u8d44\u6e90\u6700\u7ec8\u7684\u72b6\u6001\uff08\u5728yaml\u4e2d\u5b9a\u4e49\u72b6\u6001\uff09\r\n    \u4f7f\u7528apply\u64cd\u4f5c\u8d44\u6e90\uff1a\r\n        \u5982\u679c\u8d44\u6e90\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\uff0c\u76f8\u5f53\u4e8e kubectl create\r\n        \u5982\u679c\u8d44\u6e90\u5df2\u5b58\u5728\uff0c\u5c31\u66f4\u65b0\uff0c\u76f8\u5f53\u4e8e kubectl patch\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u6269\u5c55\uff1akubectl\u53ef\u4ee5\u5728node\u8282\u70b9\u4e0a\u8fd0\u884c\u5417 ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"kubectl\u7684\u8fd0\u884c\u662f\u9700\u8981\u8fdb\u884c\u914d\u7f6e\u7684\uff0c\u5b83\u7684\u914d\u7f6e\u6587\u4ef6\u662f$HOME/.kube\uff0c\u5982\u679c\u60f3\u8981\u5728node\u8282\u70b9\u8fd0\u884c\u6b64\u547d\u4ee4\uff0c\u9700\u8981\u5c06master\u4e0a\u7684.kube\u6587\u4ef6\u590d\u5236\u5230node\u8282\u70b9\u4e0a\uff0c\u5373\u5728master\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u9762\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"scp  -r  HOME/.kube   node1: HOME/\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u63a8\u8350: \u4e09\u79cd\u65b9\u5f0f\u5e94\u8be5\u600e\u4e48\u7528 ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa/\u66f4\u65b0\u8d44\u6e90 \t\u4f7f\u7528\u58f0\u660e\u5f0f\u5bf9\u8c61\u914d\u7f6e kubectl apply -f XXX.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u5220\u9664\u8d44\u6e90 \t\t\t \u4f7f\u7528\u547d\u4ee4\u5f0f\u5bf9\u8c61\u914d\u7f6e kubectl delete -f XXX.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u67e5\u8be2\u8d44\u6e90\t\t\t  \u4f7f\u7528\u547d\u4ee4\u5f0f\u5bf9\u8c61\u7ba1\u7406 kubectl get(describe) \u8d44\u6e90\u540d\u79f0"}),"\n",(0,s.jsx)(n.h2,{id:"4-\u5b9e\u6218\u5165\u95e8",children:"4. \u5b9e\u6218\u5165\u95e8"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u7ae0\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u5728kubernetes\u96c6\u7fa4\u4e2d\u90e8\u7f72\u4e00\u4e2anginx\u670d\u52a1\uff0c\u5e76\u4e14\u80fd\u591f\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"41-namespace",children:"4.1 Namespace"}),"\n",(0,s.jsxs)(n.p,{children:["Namespace\u662fkubernetes\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\u975e\u5e38\u91cd\u8981\u8d44\u6e90\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u7528\u6765\u5b9e\u73b0",(0,s.jsx)(n.strong,{children:"\u591a\u5957\u73af\u5883\u7684\u8d44\u6e90\u9694\u79bb"}),"\u6216\u8005",(0,s.jsx)(n.strong,{children:"\u591a\u79df\u6237\u7684\u8d44\u6e90\u9694\u79bb"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:'\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubernetes\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u7684Pod\u90fd\u662f\u53ef\u4ee5\u76f8\u4e92\u8bbf\u95ee\u7684\u3002\u4f46\u662f\u5728\u5b9e\u9645\u4e2d\uff0c\u53ef\u80fd\u4e0d\u60f3\u8ba9\u4e24\u4e2aPod\u4e4b\u95f4\u8fdb\u884c\u4e92\u76f8\u7684\u8bbf\u95ee\uff0c\u90a3\u6b64\u65f6\u5c31\u53ef\u4ee5\u5c06\u4e24\u4e2aPod\u5212\u5206\u5230\u4e0d\u540c\u7684namespace\u4e0b\u3002kubernetes\u901a\u8fc7\u5c06\u96c6\u7fa4\u5185\u90e8\u7684\u8d44\u6e90\u5206\u914d\u5230\u4e0d\u540c\u7684Namespace\u4e2d\uff0c\u53ef\u4ee5\u5f62\u6210\u903b\u8f91\u4e0a\u7684"\u7ec4"\uff0c\u4ee5\u65b9\u4fbf\u4e0d\u540c\u7684\u7ec4\u7684\u8d44\u6e90\u8fdb\u884c\u9694\u79bb\u4f7f\u7528\u548c\u7ba1\u7406\u3002'}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7kubernetes\u7684\u6388\u6743\u673a\u5236\uff0c\u5c06\u4e0d\u540c\u7684namespace\u4ea4\u7ed9\u4e0d\u540c\u79df\u6237\u8fdb\u884c\u7ba1\u7406\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u591a\u79df\u6237\u7684\u8d44\u6e90\u9694\u79bb\u3002\u6b64\u65f6\u8fd8\u80fd\u7ed3\u5408kubernetes\u7684\u8d44\u6e90\u914d\u989d\u673a\u5236\uff0c\u9650\u5b9a\u4e0d\u540c\u79df\u6237\u80fd\u5360\u7528\u7684\u8d44\u6e90\uff0c\u4f8b\u5982CPU\u4f7f\u7528\u91cf\u3001\u5185\u5b58\u4f7f\u7528\u91cf\u7b49\u7b49\uff0c\u6765\u5b9e\u73b0\u79df\u6237\u53ef\u7528\u8d44\u6e90\u7684\u7ba1\u7406\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200407100850484",src:r(8471).A+"",width:"1097",height:"572"})}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u5728\u96c6\u7fa4\u542f\u52a8\u4e4b\u540e\uff0c\u4f1a\u9ed8\u8ba4\u521b\u5efa\u51e0\u4e2anamespace"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@master ~]# kubectl  get namespace\r\nNAME              STATUS   AGE\r\ndefault           Active   45h     #  \u6240\u6709\u672a\u6307\u5b9aNamespace\u7684\u5bf9\u8c61\u90fd\u4f1a\u88ab\u5206\u914d\u5728default\u547d\u540d\u7a7a\u95f4\r\nkube-node-lease   Active   45h     #  \u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u7684\u5fc3\u8df3\u7ef4\u62a4\uff0cv1.13\u5f00\u59cb\u5f15\u5165\r\nkube-public       Active   45h     #  \u6b64\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u8d44\u6e90\u53ef\u4ee5\u88ab\u6240\u6709\u4eba\u8bbf\u95ee\uff08\u5305\u62ec\u672a\u8ba4\u8bc1\u7528\u6237\uff09\r\nkube-system       Active   45h     #  \u6240\u6709\u7531Kubernetes\u7cfb\u7edf\u521b\u5efa\u7684\u8d44\u6e90\u90fd\u5904\u4e8e\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u6765\u770bnamespace\u8d44\u6e90\u7684\u5177\u4f53\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsxs)(n.h4,{id:"411-\u67e5\u770b",children:["4.1.1 ",(0,s.jsx)(n.strong,{children:"\u67e5\u770b"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# 1 \u67e5\u770b\u6240\u6709\u7684ns  \u547d\u4ee4\uff1akubectl get ns\r\n[root@master ~]# kubectl get ns\r\nNAME              STATUS   AGE\r\ndefault           Active   45h\r\nkube-node-lease   Active   45h\r\nkube-public       Active   45h     \r\nkube-system       Active   45h     \r\n\r\n# 2 \u67e5\u770b\u6307\u5b9a\u7684ns   \u547d\u4ee4\uff1akubectl get ns ns\u540d\u79f0\r\n[root@master ~]# kubectl get ns default\r\nNAME      STATUS   AGE\r\ndefault   Active   45h\r\n\r\n# 3 \u6307\u5b9a\u8f93\u51fa\u683c\u5f0f  \u547d\u4ee4\uff1akubectl get ns ns\u540d\u79f0  -o \u683c\u5f0f\u53c2\u6570\r\n# kubernetes\u652f\u6301\u7684\u683c\u5f0f\u6709\u5f88\u591a\uff0c\u6bd4\u8f83\u5e38\u89c1\u7684\u662fwide\u3001json\u3001yaml\r\n[root@master ~]# kubectl get ns default -o yaml\r\napiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  creationTimestamp: "2021-05-08T04:44:16Z"\r\n  name: default\r\n  resourceVersion: "151"\r\n  selfLink: /api/v1/namespaces/default\r\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\r\nspec:\r\n  finalizers:\r\n  - kubernetes\r\nstatus:\r\n  phase: Active\r\n  \r\n# 4 \u67e5\u770bns\u8be6\u60c5  \u547d\u4ee4\uff1akubectl describe ns ns\u540d\u79f0\r\n[root@master ~]# kubectl describe ns default\r\nName:         default\r\nLabels:       <none>\r\nAnnotations:  <none>\r\nStatus:       Active  # Active \u547d\u540d\u7a7a\u95f4\u6b63\u5728\u4f7f\u7528\u4e2d  Terminating \u6b63\u5728\u5220\u9664\u547d\u540d\u7a7a\u95f4\r\n\r\n# ResourceQuota \u9488\u5bf9namespace\u505a\u7684\u8d44\u6e90\u9650\u5236\r\n# LimitRange\u9488\u5bf9namespace\u4e2d\u7684\u6bcf\u4e2a\u7ec4\u4ef6\u505a\u7684\u8d44\u6e90\u9650\u5236\r\nNo resource quota.\r\nNo LimitRange resource.\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"412-\u521b\u5efa",children:["4.1.2 ",(0,s.jsx)(n.strong,{children:"\u521b\u5efa"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efanamespace\r\n[root@master ~]# kubectl create ns dev\r\nnamespace/dev created\n"})}),"\n",(0,s.jsxs)(n.h4,{id:"413-\u5220\u9664",children:["4.1.3 ",(0,s.jsx)(n.strong,{children:"\u5220\u9664"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u5220\u9664namespace\r\n[root@master ~]# kubectl delete ns dev\r\nnamespace "dev" deleted\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"414-\u914d\u7f6e\u65b9\u5f0f",children:["4.1.4 ",(0,s.jsx)(n.strong,{children:"\u914d\u7f6e\u65b9\u5f0f"})]}),"\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\u51c6\u5907\u4e00\u4e2ayaml\u6587\u4ef6\uff1ans-dev.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  name: dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u5bf9\u5e94\u7684\u521b\u5efa\u548c\u5220\u9664\u547d\u4ee4\u4e86\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\uff1akubectl create[apply] -f ns-dev.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u5220\u9664\uff1akubectl delete -f ns-dev.yaml"}),"\n",(0,s.jsx)(n.h3,{id:"42-pod",children:"4.2 Pod"}),"\n",(0,s.jsx)(n.p,{children:"Pod\u662fkubernetes\u96c6\u7fa4\u8fdb\u884c\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u7a0b\u5e8f\u8981\u8fd0\u884c\u5fc5\u987b\u90e8\u7f72\u5728\u5bb9\u5668\u4e2d\uff0c\u800c\u5bb9\u5668\u5fc5\u987b\u5b58\u5728\u4e8ePod\u4e2d\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Pod\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5bb9\u5668\u7684\u5c01\u88c5\uff0c\u4e00\u4e2aPod\u4e2d\u53ef\u4ee5\u5b58\u5728\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5bb9\u5668\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200407121501907",src:r(3755).A+"",width:"633",height:"464"})}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u5728\u96c6\u7fa4\u542f\u52a8\u4e4b\u540e\uff0c\u96c6\u7fa4\u4e2d\u7684\u5404\u4e2a\u7ec4\u4ef6\u4e5f\u90fd\u662f\u4ee5Pod\u65b9\u5f0f\u8fd0\u884c\u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@master ~]# kubectl get pod -n kube-system\r\nNAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE\r\nkube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h\r\nkube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h\r\nkube-system   etcd-master                      1/1     Running   0          2d1h\r\nkube-system   kube-apiserver-master            1/1     Running   0          2d1h\r\nkube-system   kube-controller-manager-master   1/1     Running   0          2d1h\r\nkube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h\r\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h\r\nkube-system   kube-proxy-685tk                 1/1     Running   0          2d1h\r\nkube-system   kube-proxy-87spt                 1/1     Running   0          2d1h\r\nkube-system   kube-scheduler-master            1/1     Running   0          2d1h\n"})}),"\n",(0,s.jsx)(n.h4,{id:"421-\u521b\u5efa\u5e76\u8fd0\u884c",children:"4.2.1 \u521b\u5efa\u5e76\u8fd0\u884c"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u6ca1\u6709\u63d0\u4f9b\u5355\u72ec\u8fd0\u884cPod\u7684\u547d\u4ee4\uff0c\u90fd\u662f\u901a\u8fc7Pod\u63a7\u5236\u5668\u6765\u5b9e\u73b0\u7684"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u547d\u4ee4\u683c\u5f0f\uff1a kubectl run (pod\u63a7\u5236\u5668\u540d\u79f0) [\u53c2\u6570] \r\n# --image  \u6307\u5b9aPod\u7684\u955c\u50cf\r\n# --port   \u6307\u5b9a\u7aef\u53e3\r\n# --namespace  \u6307\u5b9anamespace\r\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \r\ndeployment.apps/nginx created\n"})}),"\n",(0,s.jsx)(n.h4,{id:"422-\u67e5\u770bpod\u4fe1\u606f",children:"4.2.2 \u67e5\u770bpod\u4fe1\u606f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u67e5\u770bPod\u57fa\u672c\u4fe1\u606f\r\n[root@master ~]# kubectl get pods -n dev\r\nNAME    READY   STATUS    RESTARTS   AGE\r\nnginx   1/1     Running   0          43s\r\n\r\n# \u67e5\u770bPod\u7684\u8be6\u7ec6\u4fe1\u606f\r\n[root@master ~]# kubectl describe pod nginx -n dev\r\nName:         nginx\r\nNamespace:    dev\r\nPriority:     0\r\nNode:         node1/192.168.5.4\r\nStart Time:   Wed, 08 May 2021 09:29:24 +0800\r\nLabels:       pod-template-hash=5ff7956ff6\r\n              run=nginx\r\nAnnotations:  <none>\r\nStatus:       Running\r\nIP:           10.244.1.23\r\nIPs:\r\n  IP:           10.244.1.23\r\nControlled By:  ReplicaSet/nginx\r\nContainers:\r\n  nginx:\r\n    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\r\n    Image:          nginx:latest\r\n    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\r\n    Port:           80/TCP\r\n    Host Port:      0/TCP\r\n    State:          Running\r\n      Started:      Wed, 08 May 2021 09:30:01 +0800\r\n    Ready:          True\r\n    Restart Count:  0\r\n    Environment:    <none>\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True\r\n  Ready             True\r\n  ContainersReady   True\r\n  PodScheduled      True\r\nVolumes:\r\n  default-token-hwvvw:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  default-token-hwvvw\r\n    Optional:    false\r\nQoS Class:       BestEffort\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type    Reason     Age        From               Message\r\n  ----    ------     ----       ----               -------\r\n  Normal  Scheduled  <unknown>  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1\r\n  Normal  Pulling    4m11s      kubelet, node1     Pulling image "nginx:latest"\r\n  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image "nginx:latest"\r\n  Normal  Created    3m36s      kubelet, node1     Created container nginx\r\n  Normal  Started    3m36s      kubelet, node1     Started container nginx\n'})}),"\n",(0,s.jsx)(n.h4,{id:"423-\u8bbf\u95eepod",children:"4.2.3 \u8bbf\u95eePod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u83b7\u53d6podIP\r\n[root@master ~]# kubectl get pods -n dev -o wide\r\nNAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... \r\nnginx   1/1     Running   0          190s   10.244.1.23   node1   ...\r\n\r\n#\u8bbf\u95eePOD\r\n[root@master ~]# curl http://10.244.1.23:80\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n\t<title>Welcome to nginx!</title>\r\n</head>\r\n<body>\r\n\t<p><em>Thank you for using nginx.</em></p>\r\n</body>\r\n</html>\n"})}),"\n",(0,s.jsx)(n.h4,{id:"424-\u5220\u9664\u6307\u5b9apod",children:"4.2.4 \u5220\u9664\u6307\u5b9aPod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u5220\u9664\u6307\u5b9aPod\r\n[root@master ~]# kubectl delete pod nginx -n dev\r\npod "nginx" deleted\r\n\r\n# \u6b64\u65f6\uff0c\u663e\u793a\u5220\u9664Pod\u6210\u529f\uff0c\u4f46\u662f\u518d\u67e5\u8be2\uff0c\u53d1\u73b0\u53c8\u65b0\u4ea7\u751f\u4e86\u4e00\u4e2a \r\n[root@master ~]# kubectl get pods -n dev\r\nNAME    READY   STATUS    RESTARTS   AGE\r\nnginx   1/1     Running   0          21s\r\n\r\n# \u8fd9\u662f\u56e0\u4e3a\u5f53\u524dPod\u662f\u7531Pod\u63a7\u5236\u5668\u521b\u5efa\u7684\uff0c\u63a7\u5236\u5668\u4f1a\u76d1\u63a7Pod\u72b6\u51b5\uff0c\u4e00\u65e6\u53d1\u73b0Pod\u6b7b\u4ea1\uff0c\u4f1a\u7acb\u5373\u91cd\u5efa\r\n# \u6b64\u65f6\u8981\u60f3\u5220\u9664Pod\uff0c\u5fc5\u987b\u5220\u9664Pod\u63a7\u5236\u5668\r\n\r\n# \u5148\u6765\u67e5\u8be2\u4e00\u4e0b\u5f53\u524dnamespace\u4e0b\u7684Pod\u63a7\u5236\u5668\r\n[root@master ~]# kubectl get deploy -n  dev\r\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\r\nnginx   1/1     1            1           9m7s\r\n\r\n# \u63a5\u4e0b\u6765\uff0c\u5220\u9664\u6b64PodPod\u63a7\u5236\u5668\r\n[root@master ~]# kubectl delete deploy nginx -n dev\r\ndeployment.apps "nginx" deleted\r\n\r\n# \u7a0d\u7b49\u7247\u523b\uff0c\u518d\u67e5\u8be2Pod\uff0c\u53d1\u73b0Pod\u88ab\u5220\u9664\u4e86\r\n[root@master ~]# kubectl get pods -n dev\r\nNo resources found in dev namespace.\n'})}),"\n",(0,s.jsx)(n.h4,{id:"425-\u914d\u7f6e\u64cd\u4f5c",children:"4.2.5 \u914d\u7f6e\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2apod-nginx.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: nginx\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - image: nginx:latest\r\n    name: pod\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n      protocol: TCP\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u5bf9\u5e94\u7684\u521b\u5efa\u548c\u5220\u9664\u547d\u4ee4\u4e86\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\uff1akubectl create[apply] -f pod-nginx.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u5220\u9664\uff1akubectl delete -f pod-nginx.yaml"}),"\n",(0,s.jsx)(n.h3,{id:"43-label",children:"4.3 Label"}),"\n",(0,s.jsx)(n.p,{children:"Label\u662fkubernetes\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\u3002\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u5728\u8d44\u6e90\u4e0a\u6dfb\u52a0\u6807\u8bc6\uff0c\u7528\u6765\u5bf9\u5b83\u4eec\u8fdb\u884c\u533a\u5206\u548c\u9009\u62e9\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Label\u7684\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e00\u4e2aLabel\u4f1a\u4ee5",(0,s.jsx)(n.code,{children:"key/value"}),"\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u9644\u52a0\u5230\u5404\u79cd\u5bf9\u8c61\u4e0a\uff0c\u5982Node\u3001Pod\u3001Service\u7b49\u7b49"]}),"\n",(0,s.jsx)(n.li,{children:"\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u6570\u91cf\u7684Label \uff0c\u540c\u4e00\u4e2aLabel\u4e5f\u53ef\u4ee5\u88ab\u6dfb\u52a0\u5230\u4efb\u610f\u6570\u91cf\u7684\u8d44\u6e90\u5bf9\u8c61\u4e0a\u53bb"}),"\n",(0,s.jsx)(n.li,{children:"Label\u901a\u5e38\u5728\u8d44\u6e90\u5bf9\u8c61\u5b9a\u4e49\u65f6\u786e\u5b9a\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u5bf9\u8c61\u521b\u5efa\u540e\u52a8\u6001\u6dfb\u52a0\u6216\u8005\u5220\u9664"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7Label\u5b9e\u73b0\u8d44\u6e90\u7684\u591a\u7ef4\u5ea6\u5206\u7ec4\uff0c\u4ee5\u4fbf\u7075\u6d3b\u3001\u65b9\u4fbf\u5730\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u3001\u8c03\u5ea6\u3001\u914d\u7f6e\u3001\u90e8\u7f72\u7b49\u7ba1\u7406\u5de5\u4f5c\u3002"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e9b\u5e38\u7528\u7684Label \u793a\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'\u7248\u672c\u6807\u7b7e\uff1a"version":"release", "version":"stable"......'}),"\n",(0,s.jsx)(n.li,{children:'\u73af\u5883\u6807\u7b7e\uff1a"environment":"dev"\uff0c"environment":"test"\uff0c"environment":"pro"'}),"\n",(0,s.jsx)(n.li,{children:'\u67b6\u6784\u6807\u7b7e\uff1a"tier":"frontend"\uff0c"tier":"backend"'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u6807\u7b7e\u5b9a\u4e49\u5b8c\u6bd5\u4e4b\u540e\uff0c\u8fd8\u8981\u8003\u8651\u5230\u6807\u7b7e\u7684\u9009\u62e9\uff0c\u8fd9\u5c31\u8981\u4f7f\u7528\u5230Label Selector\uff0c\u5373\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"Label\u7528\u4e8e\u7ed9\u67d0\u4e2a\u8d44\u6e90\u5bf9\u8c61\u5b9a\u4e49\u6807\u8bc6"}),"\n",(0,s.jsx)(n.p,{children:"Label Selector\u7528\u4e8e\u67e5\u8be2\u548c\u7b5b\u9009\u62e5\u6709\u67d0\u4e9b\u6807\u7b7e\u7684\u8d44\u6e90\u5bf9\u8c61"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u524d\u6709\u4e24\u79cdLabel Selector\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u57fa\u4e8e\u7b49\u5f0f\u7684Label Selector"}),"\n",(0,s.jsx)(n.p,{children:'name = slave: \u9009\u62e9\u6240\u6709\u5305\u542bLabel\u4e2dkey="name"\u4e14value="slave"\u7684\u5bf9\u8c61'}),"\n",(0,s.jsx)(n.p,{children:'env != production: \u9009\u62e9\u6240\u6709\u5305\u62ecLabel\u4e2d\u7684key="env"\u4e14value\u4e0d\u7b49\u4e8e"production"\u7684\u5bf9\u8c61'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u57fa\u4e8e\u96c6\u5408\u7684Label Selector"}),"\n",(0,s.jsx)(n.p,{children:'name in (master, slave): \u9009\u62e9\u6240\u6709\u5305\u542bLabel\u4e2d\u7684key="name"\u4e14value="master"\u6216"slave"\u7684\u5bf9\u8c61'}),"\n",(0,s.jsx)(n.p,{children:'name not in (frontend): \u9009\u62e9\u6240\u6709\u5305\u542bLabel\u4e2d\u7684key="name"\u4e14value\u4e0d\u7b49\u4e8e"frontend"\u7684\u5bf9\u8c61'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'\u6807\u7b7e\u7684\u9009\u62e9\u6761\u4ef6\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\uff0c\u6b64\u65f6\u5c06\u591a\u4e2aLabel Selector\u8fdb\u884c\u7ec4\u5408\uff0c\u4f7f\u7528\u9017\u53f7","\u8fdb\u884c\u5206\u9694\u5373\u53ef\u3002\u4f8b\u5982\uff1a'}),"\n",(0,s.jsx)(n.p,{children:"name=slave\uff0cenv!=production"}),"\n",(0,s.jsx)(n.p,{children:"name not in (frontend)\uff0cenv!=production"}),"\n",(0,s.jsx)(n.h4,{id:"431-\u547d\u4ee4\u65b9\u5f0f",children:"4.3.1 \u547d\u4ee4\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e3apod\u8d44\u6e90\u6253\u6807\u7b7e\r\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\r\npod/nginx-pod labeled\r\n\r\n# \u4e3apod\u8d44\u6e90\u66f4\u65b0\u6807\u7b7e\r\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\r\npod/nginx-pod labeled\r\n\r\n# \u67e5\u770b\u6807\u7b7e\r\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\r\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\r\nnginx-pod   1/1     Running   0          10m   version=2.0\r\n\r\n# \u7b5b\u9009\u6807\u7b7e\r\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\r\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\r\nnginx-pod   1/1     Running   0          17m   version=2.0\r\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\r\nNo resources found in dev namespace.\r\n\r\n#\u5220\u9664\u6807\u7b7e\r\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\r\npod/nginx-pod labeled\n"})}),"\n",(0,s.jsx)(n.h4,{id:"432-\u914d\u7f6e\u65b9\u5f0f",children:"4.3.2 \u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: nginx\r\n  namespace: dev\r\n  labels:\r\n    version: "3.0" \r\n    env: "test"\r\nspec:\r\n  containers:\r\n  - image: nginx:latest\r\n    name: pod\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n      protocol: TCP\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u5bf9\u5e94\u7684\u66f4\u65b0\u547d\u4ee4\u4e86\uff1akubectl apply -f pod-nginx.yaml"}),"\n",(0,s.jsx)(n.h3,{id:"44-deployment",children:"4.4 Deployment"}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\uff0cPod\u662f\u6700\u5c0f\u7684\u63a7\u5236\u5355\u5143\uff0c\u4f46\u662fkubernetes\u5f88\u5c11\u76f4\u63a5\u63a7\u5236Pod\uff0c\u4e00\u822c\u90fd\u662f\u901a\u8fc7Pod\u63a7\u5236\u5668\u6765\u5b8c\u6210\u7684\u3002Pod\u63a7\u5236\u5668\u7528\u4e8epod\u7684\u7ba1\u7406\uff0c\u786e\u4fddpod\u8d44\u6e90\u7b26\u5408\u9884\u671f\u7684\u72b6\u6001\uff0c\u5f53pod\u7684\u8d44\u6e90\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u8fdb\u884c\u91cd\u542f\u6216\u91cd\u5efapod\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2dPod\u63a7\u5236\u5668\u7684\u79cd\u7c7b\u6709\u5f88\u591a\uff0c\u672c\u7ae0\u8282\u53ea\u4ecb\u7ecd\u4e00\u79cd\uff1aDeployment\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200408193950807",src:r(8926).A+"",width:"765",height:"418"})}),"\n",(0,s.jsx)(n.h4,{id:"441-\u547d\u4ee4\u64cd\u4f5c",children:"4.4.1 \u547d\u4ee4\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u547d\u4ee4\u683c\u5f0f: kubectl create deployment \u540d\u79f0  [\u53c2\u6570] \r\n# --image  \u6307\u5b9apod\u7684\u955c\u50cf\r\n# --port   \u6307\u5b9a\u7aef\u53e3\r\n# --replicas  \u6307\u5b9a\u521b\u5efapod\u6570\u91cf\r\n# --namespace  \u6307\u5b9anamespace\r\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev\r\ndeployment.apps/nginx created\r\n\r\n# \u67e5\u770b\u521b\u5efa\u7684Pod\r\n[root@master ~]# kubectl get pods -n dev\r\nNAME                     READY   STATUS    RESTARTS   AGE\r\nnginx-5ff7956ff6-6k8cb   1/1     Running   0          19s\r\nnginx-5ff7956ff6-jxfjt   1/1     Running   0          19s\r\nnginx-5ff7956ff6-v6jqw   1/1     Running   0          19s\r\n\r\n# \u67e5\u770bdeployment\u7684\u4fe1\u606f\r\n[root@master ~]# kubectl get deploy -n dev\r\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\r\nnginx   3/3     3            3           2m42s\r\n\r\n# UP-TO-DATE\uff1a\u6210\u529f\u5347\u7ea7\u7684\u526f\u672c\u6570\u91cf\r\n# AVAILABLE\uff1a\u53ef\u7528\u526f\u672c\u7684\u6570\u91cf\r\n[root@master ~]# kubectl get deploy -n dev -o wide\r\nNAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR\r\nnginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx\r\n\r\n# \u67e5\u770bdeployment\u7684\u8be6\u7ec6\u4fe1\u606f\r\n[root@master ~]# kubectl describe deploy nginx -n dev\r\nName:                   nginx\r\nNamespace:              dev\r\nCreationTimestamp:      Wed, 08 May 2021 11:14:14 +0800\r\nLabels:                 run=nginx\r\nAnnotations:            deployment.kubernetes.io/revision: 1\r\nSelector:               run=nginx\r\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\r\nStrategyType:           RollingUpdate\r\nMinReadySeconds:        0\r\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\r\nPod Template:\r\n  Labels:  run=nginx\r\n  Containers:\r\n   nginx:\r\n    Image:        nginx:latest\r\n    Port:         80/TCP\r\n    Host Port:    0/TCP\r\n    Environment:  <none>\r\n    Mounts:       <none>\r\n  Volumes:        <none>\r\nConditions:\r\n  Type           Status  Reason\r\n  ----           ------  ------\r\n  Available      True    MinimumReplicasAvailable\r\n  Progressing    True    NewReplicaSetAvailable\r\nOldReplicaSets:  <none>\r\nNewReplicaSet:   nginx-5ff7956ff6 (3/3 replicas created)\r\nEvents:\r\n  Type    Reason             Age    From                   Message\r\n  ----    ------             ----   ----                   -------\r\n  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to 3\r\n  \r\n# \u5220\u9664 \r\n[root@master ~]# kubectl delete deploy nginx -n dev\r\ndeployment.apps "nginx" deleted\n'})}),"\n",(0,s.jsx)(n.h4,{id:"442-\u914d\u7f6e\u64cd\u4f5c",children:"4.4.2 \u914d\u7f6e\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2adeploy-nginx.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: nginx\r\n  namespace: dev\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      run: nginx\r\n  template:\r\n    metadata:\r\n      labels:\r\n        run: nginx\r\n    spec:\r\n      containers:\r\n      - image: nginx:latest\r\n        name: nginx\r\n        ports:\r\n        - containerPort: 80\r\n          protocol: TCP\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u5bf9\u5e94\u7684\u521b\u5efa\u548c\u5220\u9664\u547d\u4ee4\u4e86\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\uff1akubectl create -f deploy-nginx.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u5220\u9664\uff1akubectl delete -f deploy-nginx.yaml"}),"\n",(0,s.jsx)(n.h3,{id:"45-service",children:"4.5 Service"}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u8fc7\u4e0a\u8282\u8bfe\u7684\u5b66\u4e60\uff0c\u5df2\u7ecf\u80fd\u591f\u5229\u7528Deployment\u6765\u521b\u5efa\u4e00\u7ec4Pod\u6765\u63d0\u4f9b\u5177\u6709\u9ad8\u53ef\u7528\u6027\u7684\u670d\u52a1\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u867d\u7136\u6bcf\u4e2aPod\u90fd\u4f1a\u5206\u914d\u4e00\u4e2a\u5355\u72ec\u7684Pod IP\uff0c\u7136\u800c\u5374\u5b58\u5728\u5982\u4e0b\u4e24\u95ee\u9898\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pod IP \u4f1a\u968f\u7740Pod\u7684\u91cd\u5efa\u4ea7\u751f\u53d8\u5316"}),"\n",(0,s.jsx)(n.li,{children:"Pod IP \u4ec5\u4ec5\u662f\u96c6\u7fa4\u5185\u53ef\u89c1\u7684\u865a\u62dfIP\uff0c\u5916\u90e8\u65e0\u6cd5\u8bbf\u95ee"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\u5bf9\u4e8e\u8bbf\u95ee\u8fd9\u4e2a\u670d\u52a1\u5e26\u6765\u4e86\u96be\u5ea6\u3002\u56e0\u6b64\uff0ckubernetes\u8bbe\u8ba1\u4e86Service\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["Service\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u7ec4\u540c\u7c7bPod",(0,s.jsx)(n.strong,{children:"\u5bf9\u5916\u7684\u8bbf\u95ee\u63a5\u53e3"}),"\u3002\u501f\u52a9Service\uff0c\u5e94\u7528\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200408194716912",src:r(830).A+"",width:"1073",height:"497"})}),"\n",(0,s.jsx)(n.h4,{id:"451-\u521b\u5efa\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\u7684service",children:"4.5.1 \u521b\u5efa\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\u7684Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u66b4\u9732Service\r\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev\r\nservice/svc-nginx1 exposed\r\n\r\n# \u67e5\u770bservice\r\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\r\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR\r\nsvc-nginx1   ClusterIP   10.109.179.231   <none>        80/TCP    3m51s   run=nginx\r\n\r\n# \u8fd9\u91cc\u4ea7\u751f\u4e86\u4e00\u4e2aCLUSTER-IP\uff0c\u8fd9\u5c31\u662fservice\u7684IP\uff0c\u5728Service\u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u8fd9\u4e2a\u5730\u5740\u662f\u4e0d\u4f1a\u53d8\u52a8\u7684\r\n# \u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aIP\u8bbf\u95ee\u5f53\u524dservice\u5bf9\u5e94\u7684POD\r\n[root@master ~]# curl 10.109.179.231:80\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Welcome to nginx!</title>\r\n</head>\r\n<body>\r\n<h1>Welcome to nginx!</h1>\r\n.......\r\n</body>\r\n</html>\n"})}),"\n",(0,s.jsx)(n.h4,{id:"452-\u521b\u5efa\u96c6\u7fa4\u5916\u90e8\u4e5f\u53ef\u8bbf\u95ee\u7684service",children:"4.5.2 \u521b\u5efa\u96c6\u7fa4\u5916\u90e8\u4e5f\u53ef\u8bbf\u95ee\u7684Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e0a\u9762\u521b\u5efa\u7684Service\u7684type\u7c7b\u578b\u4e3aClusterIP\uff0c\u8fd9\u4e2aip\u5730\u5740\u53ea\u7528\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\r\n# \u5982\u679c\u9700\u8981\u521b\u5efa\u5916\u90e8\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u7684Service\uff0c\u9700\u8981\u4fee\u6539type\u4e3aNodePort\r\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev\r\nservice/svc-nginx2 exposed\r\n\r\n# \u6b64\u65f6\u67e5\u770b\uff0c\u4f1a\u53d1\u73b0\u51fa\u73b0\u4e86NodePort\u7c7b\u578b\u7684Service\uff0c\u800c\u4e14\u6709\u4e00\u5bf9Port\uff0880:31928/TC\uff09\r\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\r\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR\r\nsvc-nginx2    NodePort    10.100.94.0      <none>        80:31928/TCP   9s     run=nginx\r\n\r\n# \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u901a\u8fc7\u96c6\u7fa4\u5916\u7684\u4e3b\u673a\u8bbf\u95ee \u8282\u70b9IP:31928\u8bbf\u95ee\u670d\u52a1\u4e86\r\n# \u4f8b\u5982\u5728\u7684\u7535\u8111\u4e3b\u673a\u4e0a\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\u4e0b\u9762\u7684\u5730\u5740\r\nhttp://192.168.90.100:31928/\n"})}),"\n",(0,s.jsx)(n.h4,{id:"453-\u5220\u9664service",children:"4.5.3 \u5220\u9664Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'[root@master ~]# kubectl delete svc svc-nginx-1 -n dev \r\nservice "svc-nginx-1" deleted\n'})}),"\n",(0,s.jsx)(n.h4,{id:"454-\u914d\u7f6e\u65b9\u5f0f",children:"4.5.4 \u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2asvc-nginx.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: svc-nginx\r\n  namespace: dev\r\nspec:\r\n  clusterIP: 10.109.179.231 #\u56fa\u5b9asvc\u7684\u5185\u7f51ip\r\n  ports:\r\n  - port: 80\r\n    protocol: TCP\r\n    targetPort: 80\r\n  selector:\r\n    run: nginx\r\n  type: ClusterIP\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u5bf9\u5e94\u7684\u521b\u5efa\u548c\u5220\u9664\u547d\u4ee4\u4e86\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\uff1akubectl create -f svc-nginx.yaml"}),"\n",(0,s.jsx)(n.p,{children:"\u5220\u9664\uff1akubectl delete -f svc-nginx.yaml"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5c0f\u7ed3"})}),"\n",(0,s.jsx)(n.p,{children:"\u81f3\u6b64\uff0c\u5df2\u7ecf\u638c\u63e1\u4e86Namespace\u3001Pod\u3001Deployment\u3001Service\u8d44\u6e90\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6709\u4e86\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u5728kubernetes\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u4e00\u4e2a\u670d\u52a1\u7684\u7b80\u5355\u90e8\u7f72\u548c\u8bbf\u95ee\u4e86\uff0c\u4f46\u662f\u5982\u679c\u60f3\u8981\u66f4\u597d\u7684\u4f7f\u7528kubernetes\uff0c\u5c31\u9700\u8981\u6df1\u5165\u5b66\u4e60\u8fd9\u51e0\u79cd\u8d44\u6e90\u7684\u7ec6\u8282\u548c\u539f\u7406\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"5-pod\u8be6\u89e3",children:"5. Pod\u8be6\u89e3"}),"\n",(0,s.jsx)(n.h3,{id:"51-pod\u4ecb\u7ecd",children:"5.1 Pod\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.h4,{id:"511-pod\u7ed3\u6784",children:"5.1.1 Pod\u7ed3\u6784"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200407121501907",src:r(8323).A+"",width:"633",height:"464"})}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e2aPod\u4e2d\u90fd\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u7528\u6237\u5bb9\u5668\uff1a\u7528\u6237\u7a0b\u5e8f\u6240\u5728\u7684\u5bb9\u5668\uff0c\u6570\u91cf\u53ef\u591a\u53ef\u5c11"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u6839\u5bb9\u5668\uff1aPause\u5bb9\u5668\uff0c\u8fd9\u662f\u6bcf\u4e2aPod\u90fd\u4f1a\u6709\u7684\u4e00\u4e2a",(0,s.jsx)(n.strong,{children:"\u6839\u5bb9\u5668"}),"\uff0c\u5b83\u7684\u4f5c\u7528\u6709\u4e24\u4e2a\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u4ee5\u5b83\u4e3a\u4f9d\u636e\uff0c\u8bc4\u4f30\u6574\u4e2aPod\u7684\u5065\u5eb7\u72b6\u6001"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u5728\u6839\u5bb9\u5668\u4e0a\u8bbe\u7f6eIp\u5730\u5740\uff0c\u5176\u5b83\u5bb9\u5668\u90fd\u6b64Ip\uff08Pod IP\uff09\uff0c\u4ee5\u5b9e\u73b0Pod\u5185\u90e8\u7684\u7f51\u8def\u901a\u4fe1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u8fd9\u91cc\u662fPod\u5185\u90e8\u7684\u901a\u8baf\uff0cPod\u7684\u4e4b\u95f4\u7684\u901a\u8baf\u91c7\u7528\u865a\u62df\u4e8c\u5c42\u7f51\u7edc\u6280\u672f\u6765\u5b9e\u73b0\uff0c\u6211\u4eec\u5f53\u524d\u73af\u5883\u7528\u7684\u662fFlannel\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"512-pod\u5b9a\u4e49",children:"5.1.2 Pod\u5b9a\u4e49"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u662fPod\u7684\u8d44\u6e90\u6e05\u5355\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'apiVersion: v1     #\u5fc5\u9009\uff0c\u7248\u672c\u53f7\uff0c\u4f8b\u5982v1\r\nkind: Pod       \u3000 #\u5fc5\u9009\uff0c\u8d44\u6e90\u7c7b\u578b\uff0c\u4f8b\u5982 Pod\r\nmetadata:       \u3000 #\u5fc5\u9009\uff0c\u5143\u6570\u636e\r\n  name: string     #\u5fc5\u9009\uff0cPod\u540d\u79f0\r\n  namespace: string  #Pod\u6240\u5c5e\u7684\u547d\u540d\u7a7a\u95f4,\u9ed8\u8ba4\u4e3a"default"\r\n  labels:       \u3000\u3000  #\u81ea\u5b9a\u4e49\u6807\u7b7e\u5217\u8868\r\n    - name: string      \u3000          \r\nspec:  #\u5fc5\u9009\uff0cPod\u4e2d\u5bb9\u5668\u7684\u8be6\u7ec6\u5b9a\u4e49\r\n  containers:  #\u5fc5\u9009\uff0cPod\u4e2d\u5bb9\u5668\u5217\u8868\r\n  - name: string   #\u5fc5\u9009\uff0c\u5bb9\u5668\u540d\u79f0\r\n    image: string  #\u5fc5\u9009\uff0c\u5bb9\u5668\u7684\u955c\u50cf\u540d\u79f0\r\n    imagePullPolicy: [ Always|Never|IfNotPresent ]  #\u83b7\u53d6\u955c\u50cf\u7684\u7b56\u7565 \r\n    command: [string]   #\u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\u5217\u8868\uff0c\u5982\u4e0d\u6307\u5b9a\uff0c\u4f7f\u7528\u6253\u5305\u65f6\u4f7f\u7528\u7684\u542f\u52a8\u547d\u4ee4\r\n    args: [string]      #\u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\u53c2\u6570\u5217\u8868\r\n    workingDir: string  #\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\r\n    volumeMounts:       #\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u90e8\u7684\u5b58\u50a8\u5377\u914d\u7f6e\r\n    - name: string      #\u5f15\u7528pod\u5b9a\u4e49\u7684\u5171\u4eab\u5b58\u50a8\u5377\u7684\u540d\u79f0\uff0c\u9700\u7528volumes[]\u90e8\u5206\u5b9a\u4e49\u7684\u7684\u5377\u540d\r\n      mountPath: string #\u5b58\u50a8\u5377\u5728\u5bb9\u5668\u5185mount\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u5e94\u5c11\u4e8e512\u5b57\u7b26\r\n      readOnly: boolean #\u662f\u5426\u4e3a\u53ea\u8bfb\u6a21\u5f0f\r\n    ports: #\u9700\u8981\u66b4\u9732\u7684\u7aef\u53e3\u5e93\u53f7\u5217\u8868\r\n    - name: string        #\u7aef\u53e3\u7684\u540d\u79f0\r\n      containerPort: int  #\u5bb9\u5668\u9700\u8981\u76d1\u542c\u7684\u7aef\u53e3\u53f7\r\n      hostPort: int       #\u5bb9\u5668\u6240\u5728\u4e3b\u673a\u9700\u8981\u76d1\u542c\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4e0eContainer\u76f8\u540c\r\n      protocol: string    #\u7aef\u53e3\u534f\u8bae\uff0c\u652f\u6301TCP\u548cUDP\uff0c\u9ed8\u8ba4TCP\r\n    env:   #\u5bb9\u5668\u8fd0\u884c\u524d\u9700\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u5217\u8868\r\n    - name: string  #\u73af\u5883\u53d8\u91cf\u540d\u79f0\r\n      value: string #\u73af\u5883\u53d8\u91cf\u7684\u503c\r\n    resources: #\u8d44\u6e90\u9650\u5236\u548c\u8bf7\u6c42\u7684\u8bbe\u7f6e\r\n      limits:  #\u8d44\u6e90\u9650\u5236\u7684\u8bbe\u7f6e\r\n        cpu: string     #Cpu\u7684\u9650\u5236\uff0c\u5355\u4f4d\u4e3acore\u6570\uff0c\u5c06\u7528\u4e8edocker run --cpu-shares\u53c2\u6570\r\n        memory: string  #\u5185\u5b58\u9650\u5236\uff0c\u5355\u4f4d\u53ef\u4ee5\u4e3aMib/Gib\uff0c\u5c06\u7528\u4e8edocker run --memory\u53c2\u6570\r\n      requests: #\u8d44\u6e90\u8bf7\u6c42\u7684\u8bbe\u7f6e\r\n        cpu: string    #Cpu\u8bf7\u6c42\uff0c\u5bb9\u5668\u542f\u52a8\u7684\u521d\u59cb\u53ef\u7528\u6570\u91cf\r\n        memory: string #\u5185\u5b58\u8bf7\u6c42,\u5bb9\u5668\u542f\u52a8\u7684\u521d\u59cb\u53ef\u7528\u6570\u91cf\r\n    lifecycle: #\u751f\u547d\u5468\u671f\u94a9\u5b50\r\n        postStart: #\u5bb9\u5668\u542f\u52a8\u540e\u7acb\u5373\u6267\u884c\u6b64\u94a9\u5b50,\u5982\u679c\u6267\u884c\u5931\u8d25,\u4f1a\u6839\u636e\u91cd\u542f\u7b56\u7565\u8fdb\u884c\u91cd\u542f\r\n        preStop: #\u5bb9\u5668\u7ec8\u6b62\u524d\u6267\u884c\u6b64\u94a9\u5b50,\u65e0\u8bba\u7ed3\u679c\u5982\u4f55,\u5bb9\u5668\u90fd\u4f1a\u7ec8\u6b62\r\n    livenessProbe:  #\u5bf9Pod\u5185\u5404\u5bb9\u5668\u5065\u5eb7\u68c0\u67e5\u7684\u8bbe\u7f6e\uff0c\u5f53\u63a2\u6d4b\u65e0\u54cd\u5e94\u51e0\u6b21\u540e\u5c06\u81ea\u52a8\u91cd\u542f\u8be5\u5bb9\u5668\r\n      exec:       \u3000 #\u5bf9Pod\u5bb9\u5668\u5185\u68c0\u67e5\u65b9\u5f0f\u8bbe\u7f6e\u4e3aexec\u65b9\u5f0f\r\n        command: [string]  #exec\u65b9\u5f0f\u9700\u8981\u5236\u5b9a\u7684\u547d\u4ee4\u6216\u811a\u672c\r\n      httpGet:       #\u5bf9Pod\u5185\u4e2a\u5bb9\u5668\u5065\u5eb7\u68c0\u67e5\u65b9\u6cd5\u8bbe\u7f6e\u4e3aHttpGet\uff0c\u9700\u8981\u5236\u5b9aPath\u3001port\r\n        path: string\r\n        port: number\r\n        host: string\r\n        scheme: string\r\n        HttpHeaders:\r\n        - name: string\r\n          value: string\r\n      tcpSocket:     #\u5bf9Pod\u5185\u4e2a\u5bb9\u5668\u5065\u5eb7\u68c0\u67e5\u65b9\u5f0f\u8bbe\u7f6e\u4e3atcpSocket\u65b9\u5f0f\r\n         port: number\r\n       initialDelaySeconds: 0       #\u5bb9\u5668\u542f\u52a8\u5b8c\u6210\u540e\u9996\u6b21\u63a2\u6d4b\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\r\n       timeoutSeconds: 0    \u3000\u3000    #\u5bf9\u5bb9\u5668\u5065\u5eb7\u68c0\u67e5\u63a2\u6d4b\u7b49\u5f85\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba41\u79d2\r\n       periodSeconds: 0     \u3000\u3000    #\u5bf9\u5bb9\u5668\u76d1\u63a7\u68c0\u67e5\u7684\u5b9a\u671f\u63a2\u6d4b\u65f6\u95f4\u8bbe\u7f6e\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba410\u79d2\u4e00\u6b21\r\n       successThreshold: 0\r\n       failureThreshold: 0\r\n       securityContext:\r\n         privileged: false\r\n  restartPolicy: [Always | Never | OnFailure]  #Pod\u7684\u91cd\u542f\u7b56\u7565\r\n  nodeName: <string> #\u8bbe\u7f6eNodeName\u8868\u793a\u5c06\u8be5Pod\u8c03\u5ea6\u5230\u6307\u5b9a\u5230\u540d\u79f0\u7684node\u8282\u70b9\u4e0a\r\n  nodeSelector: obeject #\u8bbe\u7f6eNodeSelector\u8868\u793a\u5c06\u8be5Pod\u8c03\u5ea6\u5230\u5305\u542b\u8fd9\u4e2alabel\u7684node\u4e0a\r\n  imagePullSecrets: #Pull\u955c\u50cf\u65f6\u4f7f\u7528\u7684secret\u540d\u79f0\uff0c\u4ee5key\uff1asecretkey\u683c\u5f0f\u6307\u5b9a\r\n  - name: string\r\n  hostNetwork: false   #\u662f\u5426\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3afalse\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u8868\u793a\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\r\n  volumes:   #\u5728\u8be5pod\u4e0a\u5b9a\u4e49\u5171\u4eab\u5b58\u50a8\u5377\u5217\u8868\r\n  - name: string    #\u5171\u4eab\u5b58\u50a8\u5377\u540d\u79f0 \uff08volumes\u7c7b\u578b\u6709\u5f88\u591a\u79cd\uff09\r\n    emptyDir: {}       #\u7c7b\u578b\u4e3aemtyDir\u7684\u5b58\u50a8\u5377\uff0c\u4e0ePod\u540c\u751f\u547d\u5468\u671f\u7684\u4e00\u4e2a\u4e34\u65f6\u76ee\u5f55\u3002\u4e3a\u7a7a\u503c\r\n    hostPath: string   #\u7c7b\u578b\u4e3ahostPath\u7684\u5b58\u50a8\u5377\uff0c\u8868\u793a\u6302\u8f7dPod\u6240\u5728\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\r\n      path: string      \u3000\u3000        #Pod\u6240\u5728\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\uff0c\u5c06\u88ab\u7528\u4e8e\u540c\u671f\u4e2dmount\u7684\u76ee\u5f55\r\n    secret:       \u3000\u3000\u3000#\u7c7b\u578b\u4e3asecret\u7684\u5b58\u50a8\u5377\uff0c\u6302\u8f7d\u96c6\u7fa4\u4e0e\u5b9a\u4e49\u7684secret\u5bf9\u8c61\u5230\u5bb9\u5668\u5185\u90e8\r\n      scretname: string  \r\n      items:     \r\n      - key: string\r\n        path: string\r\n    configMap:         #\u7c7b\u578b\u4e3aconfigMap\u7684\u5b58\u50a8\u5377\uff0c\u6302\u8f7d\u9884\u5b9a\u4e49\u7684configMap\u5bf9\u8c61\u5230\u5bb9\u5668\u5185\u90e8\r\n      name: string\r\n      items:\r\n      - key: string\r\n        path: string\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"#\u5c0f\u63d0\u793a\uff1a\r\n#   \u5728\u8fd9\u91cc\uff0c\u53ef\u901a\u8fc7\u4e00\u4e2a\u547d\u4ee4\u6765\u67e5\u770b\u6bcf\u79cd\u8d44\u6e90\u7684\u53ef\u914d\u7f6e\u9879\r\n#   kubectl explain \u8d44\u6e90\u7c7b\u578b         \u67e5\u770b\u67d0\u79cd\u8d44\u6e90\u53ef\u4ee5\u914d\u7f6e\u7684\u4e00\u7ea7\u5c5e\u6027\r\n#   kubectl explain \u8d44\u6e90\u7c7b\u578b.\u5c5e\u6027     \u67e5\u770b\u5c5e\u6027\u7684\u5b50\u5c5e\u6027\r\n[root@k8s-master01 ~]# kubectl explain pod\r\nKIND:     Pod\r\nVERSION:  v1\r\nFIELDS:\r\n   apiVersion   <string>\r\n   kind <string>\r\n   metadata     <Object>\r\n   spec <Object>\r\n   status       <Object>\r\n\r\n[root@k8s-master01 ~]# kubectl explain pod.metadata\r\nKIND:     Pod\r\nVERSION:  v1\r\nRESOURCE: metadata <Object>\r\nFIELDS:\r\n   annotations  <map[string]string>\r\n   clusterName  <string>\r\n   creationTimestamp    <string>\r\n   deletionGracePeriodSeconds   <integer>\r\n   deletionTimestamp    <string>\r\n   finalizers   <[]string>\r\n   generateName <string>\r\n   generation   <integer>\r\n   labels       <map[string]string>\r\n   managedFields        <[]Object>\r\n   name <string>\r\n   namespace    <string>\r\n   ownerReferences      <[]Object>\r\n   resourceVersion      <string>\r\n   selfLink     <string>\r\n   uid  <string>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\u57fa\u672c\u6240\u6709\u8d44\u6e90\u7684\u4e00\u7ea7\u5c5e\u6027\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e3b\u8981\u5305\u542b5\u90e8\u5206\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["apiVersion  \u7248\u672c\uff0c\u7531k8s\u5185\u90e8\u5b9a\u4e49\uff0c\u7248\u672c\u53f7\u5fc5\u987b\u53ef\u4ee5\u7528 ",(0,s.jsx)(n.code,{children:"kubectl api-versions"})," \u67e5\u8be2\u5230"]}),"\n",(0,s.jsxs)(n.li,{children:["kind  \u7c7b\u578b\uff0c\u7531k8s\u5185\u90e8\u5b9a\u4e49\uff0c\u7248\u672c\u53f7\u5fc5\u987b\u53ef\u4ee5\u7528 ",(0,s.jsx)(n.code,{children:"kubectl api-resources"})," \u67e5\u8be2\u5230"]}),"\n",(0,s.jsxs)(n.li,{children:["metadata  \u5143\u6570\u636e\uff0c\u4e3b\u8981\u662f\u8d44\u6e90\u6807\u8bc6\u548c\u8bf4\u660e\uff0c\u5e38\u7528\u7684\u6709",(0,s.jsx)(n.code,{children:"name\u3001namespace\u3001labels"}),"\u7b49"]}),"\n",(0,s.jsx)(n.li,{children:"spec  \u63cf\u8ff0\uff0c\u8fd9\u662f\u914d\u7f6e\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u91cc\u9762\u662f\u5bf9\u5404\u79cd\u8d44\u6e90\u914d\u7f6e\u7684\u8be6\u7ec6\u63cf\u8ff0"}),"\n",(0,s.jsx)(n.li,{children:"status  \u72b6\u6001\u4fe1\u606f\uff0c\u91cc\u9762\u7684\u5185\u5bb9\u4e0d\u9700\u8981\u5b9a\u4e49\uff0c\u7531k8s\u81ea\u52a8\u751f\u6210"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4e0a\u9762\u7684\u5c5e\u6027\u4e2d\uff0cspec\u662f\u63a5\u4e0b\u6765\u7814\u7a76\u7684\u91cd\u70b9\uff0c\u7ee7\u7eed\u770b\u4e0b\u5b83\u7684\u5e38\u89c1\u5b50\u5c5e\u6027:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["containers ",(0,s.jsx)(n.code,{children:"<[]Object>"})," \u5bb9\u5668\u5217\u8868\uff0c\u7528\u4e8e\u5b9a\u4e49\u5bb9\u5668\u7684\u8be6\u7ec6\u4fe1\u606f"]}),"\n",(0,s.jsx)(n.li,{children:"nodeName  \u6839\u636enodeName\u7684\u503c\u5c06pod\u8c03\u5ea6\u5230\u6307\u5b9a\u7684Node\u8282\u70b9\u4e0a"}),"\n",(0,s.jsxs)(n.li,{children:["nodeSelector ",(0,s.jsx)(n.code,{children:"<map[]>"})," \u6839\u636eNodeSelector\u4e2d\u5b9a\u4e49\u7684\u4fe1\u606f\u9009\u62e9\u5c06\u8be5Pod\u8c03\u5ea6\u5230\u5305\u542b\u8fd9\u4e9blabel\u7684Node \u4e0a"]}),"\n",(0,s.jsx)(n.li,{children:"hostNetwork  \u662f\u5426\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3afalse\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u8868\u793a\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc"}),"\n",(0,s.jsxs)(n.li,{children:["volumes ",(0,s.jsx)(n.code,{children:"<[]Object>"})," \u5b58\u50a8\u5377\uff0c\u7528\u4e8e\u5b9a\u4e49Pod\u4e0a\u9762\u6302\u5728\u7684\u5b58\u50a8\u4fe1\u606f"]}),"\n",(0,s.jsx)(n.li,{children:"restartPolicy  \u91cd\u542f\u7b56\u7565\uff0c\u8868\u793aPod\u5728\u9047\u5230\u6545\u969c\u7684\u65f6\u5019\u7684\u5904\u7406\u7b56\u7565"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"52-pod\u914d\u7f6e",children:"5.2 Pod\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:["\u672c\u5c0f\u8282\u4e3b\u8981\u6765\u7814\u7a76",(0,s.jsx)(n.code,{children:"pod.spec.containers"}),"\u5c5e\u6027\uff0c\u8fd9\u4e5f\u662fpod\u914d\u7f6e\u4e2d\u6700\u4e3a\u5173\u952e\u7684\u4e00\u9879\u914d\u7f6e\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl explain pod.spec.containers\r\nKIND:     Pod\r\nVERSION:  v1\r\nRESOURCE: containers <[]Object>   # \u6570\u7ec4\uff0c\u4ee3\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u5bb9\u5668\r\nFIELDS:\r\n   name  <string>     # \u5bb9\u5668\u540d\u79f0\r\n   image <string>     # \u5bb9\u5668\u9700\u8981\u7684\u955c\u50cf\u5730\u5740\r\n   imagePullPolicy  <string> # \u955c\u50cf\u62c9\u53d6\u7b56\u7565 \r\n   command  <[]string> # \u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\u5217\u8868\uff0c\u5982\u4e0d\u6307\u5b9a\uff0c\u4f7f\u7528\u6253\u5305\u65f6\u4f7f\u7528\u7684\u542f\u52a8\u547d\u4ee4\r\n   args     <[]string> # \u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\u9700\u8981\u7684\u53c2\u6570\u5217\u8868\r\n   env      <[]Object> # \u5bb9\u5668\u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e\r\n   ports    <[]Object>     # \u5bb9\u5668\u9700\u8981\u66b4\u9732\u7684\u7aef\u53e3\u53f7\u5217\u8868\r\n   resources <Object>      # \u8d44\u6e90\u9650\u5236\u548c\u8d44\u6e90\u8bf7\u6c42\u7684\u8bbe\u7f6e\n"})}),"\n",(0,s.jsx)(n.h4,{id:"521-\u57fa\u672c\u914d\u7f6e",children:"5.2.1 \u57fa\u672c\u914d\u7f6e"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-base.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-base\r\n  namespace: dev\r\n  labels:\r\n    user: heima\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  - name: busybox\r\n    image: busybox:1.30\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20210617223823675",src:r(713).A+"",width:"429",height:"66"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355Pod\u7684\u914d\u7f6e\uff0c\u91cc\u9762\u6709\u4e24\u4e2a\u5bb9\u5668\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"nginx\uff1a\u75281.17.1\u7248\u672c\u7684nginx\u955c\u50cf\u521b\u5efa\uff0c\uff08nginx\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7web\u5bb9\u5668\uff09"}),"\n",(0,s.jsx)(n.li,{children:"busybox\uff1a\u75281.30\u7248\u672c\u7684busybox\u955c\u50cf\u521b\u5efa\uff0c\uff08busybox\u662f\u4e00\u4e2a\u5c0f\u5de7\u7684linux\u547d\u4ee4\u96c6\u5408\uff09"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\r\npod/pod-base created\r\n\r\n# \u67e5\u770bPod\u72b6\u51b5\r\n# READY 1/2 : \u8868\u793a\u5f53\u524dPod\u4e2d\u67092\u4e2a\u5bb9\u5668\uff0c\u5176\u4e2d1\u4e2a\u51c6\u5907\u5c31\u7eea\uff0c1\u4e2a\u672a\u5c31\u7eea\r\n# RESTARTS  : \u91cd\u542f\u6b21\u6570\uff0c\u56e0\u4e3a\u67091\u4e2a\u5bb9\u5668\u6545\u969c\u4e86\uff0cPod\u4e00\u76f4\u5728\u91cd\u542f\u8bd5\u56fe\u6062\u590d\u5b83\r\n[root@k8s-master01 pod]# kubectl get pod -n dev\r\nNAME       READY   STATUS    RESTARTS   AGE\r\npod-base   1/2     Running   4          95s\r\n\r\n# \u53ef\u4ee5\u901a\u8fc7describe\u67e5\u770b\u5185\u90e8\u7684\u8be6\u60c5\r\n# \u6b64\u65f6\u5df2\u7ecf\u8fd0\u884c\u8d77\u6765\u4e86\u4e00\u4e2a\u57fa\u672c\u7684Pod\uff0c\u867d\u7136\u5b83\u6682\u65f6\u6709\u95ee\u9898\r\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n"})}),"\n",(0,s.jsx)(n.h4,{id:"522-\u955c\u50cf\u62c9\u53d6",children:"5.2.2 \u955c\u50cf\u62c9\u53d6"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-imagepullpolicy.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-imagepullpolicy\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    imagePullPolicy: Always # \u7528\u4e8e\u8bbe\u7f6e\u955c\u50cf\u62c9\u53d6\u7b56\u7565\r\n  - name: busybox\r\n    image: busybox:1.30\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20210617223923659",src:r(9788).A+"",width:"495",height:"79"})}),"\n",(0,s.jsx)(n.p,{children:"imagePullPolicy\uff0c\u7528\u4e8e\u8bbe\u7f6e\u955c\u50cf\u62c9\u53d6\u7b56\u7565\uff0ckubernetes\u652f\u6301\u914d\u7f6e\u4e09\u79cd\u62c9\u53d6\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Always\uff1a\u603b\u662f\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf\uff08\u4e00\u76f4\u8fdc\u7a0b\u4e0b\u8f7d\uff09"}),"\n",(0,s.jsx)(n.li,{children:"IfNotPresent\uff1a\u672c\u5730\u6709\u5219\u4f7f\u7528\u672c\u5730\u955c\u50cf\uff0c\u672c\u5730\u6ca1\u6709\u5219\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf\uff08\u672c\u5730\u6709\u5c31\u672c\u5730 \u672c\u5730\u6ca1\u8fdc\u7a0b\u4e0b\u8f7d\uff09"}),"\n",(0,s.jsx)(n.li,{children:"Never\uff1a\u53ea\u4f7f\u7528\u672c\u5730\u955c\u50cf\uff0c\u4ece\u4e0d\u53bb\u8fdc\u7a0b\u4ed3\u5e93\u62c9\u53d6\uff0c\u672c\u5730\u6ca1\u6709\u5c31\u62a5\u9519 \uff08\u4e00\u76f4\u4f7f\u7528\u672c\u5730\uff09"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u9ed8\u8ba4\u503c\u8bf4\u660e\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u955c\u50cftag\u4e3a\u5177\u4f53\u7248\u672c\u53f7\uff0c \u9ed8\u8ba4\u7b56\u7565\u662f\uff1aIfNotPresent"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u955c\u50cftag\u4e3a\uff1alatest\uff08\u6700\u7ec8\u7248\u672c\uff09 \uff0c\u9ed8\u8ba4\u7b56\u7565\u662falways"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efaPod\r\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\r\npod/pod-imagepullpolicy created\r\n\r\n# \u67e5\u770bPod\u8be6\u60c5\r\n# \u6b64\u65f6\u660e\u663e\u53ef\u4ee5\u770b\u5230nginx\u955c\u50cf\u6709\u4e00\u6b65Pulling image "nginx:1.17.1"\u7684\u8fc7\u7a0b\r\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\r\n......\r\nEvents:\r\n  Type     Reason     Age               From               Message\r\n  ----     ------     ----              ----               -------\r\n  Normal   Scheduled  <unknown>         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1\r\n  Normal   Pulling    32s               kubelet, node1     Pulling image "nginx:1.17.1"\r\n  Normal   Pulled     26s               kubelet, node1     Successfully pulled image "nginx:1.17.1"\r\n  Normal   Created    26s               kubelet, node1     Created container nginx\r\n  Normal   Started    25s               kubelet, node1     Started container nginx\r\n  Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image "busybox:1.30" already present on machine\r\n  Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox\r\n  Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox\n'})}),"\n",(0,s.jsx)(n.h4,{id:"523-\u542f\u52a8\u547d\u4ee4",children:"5.2.3 \u542f\u52a8\u547d\u4ee4"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u524d\u9762\u7684\u6848\u4f8b\u4e2d\uff0c\u4e00\u76f4\u6709\u4e00\u4e2a\u95ee\u9898\u6ca1\u6709\u89e3\u51b3\uff0c\u5c31\u662f\u7684busybox\u5bb9\u5668\u4e00\u76f4\u6ca1\u6709\u6210\u529f\u8fd0\u884c\uff0c\u90a3\u4e48\u5230\u5e95\u662f\u4ec0\u4e48\u539f\u56e0\u5bfc\u81f4\u8fd9\u4e2a\u5bb9\u5668\u7684\u6545\u969c\u5462\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u539f\u6765busybox\u5e76\u4e0d\u662f\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u800c\u662f\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5de5\u5177\u7c7b\u7684\u96c6\u5408\uff0ckubernetes\u96c6\u7fa4\u542f\u52a8\u7ba1\u7406\u540e\uff0c\u5b83\u4f1a\u81ea\u52a8\u5173\u95ed\u3002\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u8ba9\u5176\u4e00\u76f4\u5728\u8fd0\u884c\uff0c\u8fd9\u5c31\u7528\u5230\u4e86command\u914d\u7f6e\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-command.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-command\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) >> /tmp/hello.txt; sleep 3; done;"]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20210617224457945",src:r(2527).A+"",width:"497",height:"97"})}),"\n",(0,s.jsx)(n.p,{children:"command\uff0c\u7528\u4e8e\u5728pod\u4e2d\u7684\u5bb9\u5668\u521d\u59cb\u5316\u5b8c\u6bd5\u4e4b\u540e\u8fd0\u884c\u4e00\u4e2a\u547d\u4ee4\u3002"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u7a0d\u5fae\u89e3\u91ca\u4e0b\u4e0a\u9762\u547d\u4ee4\u7684\u610f\u601d\uff1a"}),"\n",(0,s.jsx)(n.p,{children:'"/bin/sh","-c", \u4f7f\u7528sh\u6267\u884c\u547d\u4ee4'}),"\n",(0,s.jsx)(n.p,{children:"touch /tmp/hello.txt; \u521b\u5efa\u4e00\u4e2a/tmp/hello.txt \u6587\u4ef6"}),"\n",(0,s.jsx)(n.p,{children:"while true;do /bin/echo $(date +%T) >> /tmp/hello.txt; sleep 3; done; \u6bcf\u96943\u79d2\u5411\u6587\u4ef6\u4e2d\u5199\u5165\u5f53\u524d\u65f6\u95f4"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\r\npod/pod-command created\r\n\r\n# \u67e5\u770bPod\u72b6\u6001\r\n# \u6b64\u65f6\u53d1\u73b0\u4e24\u4e2apod\u90fd\u6b63\u5e38\u8fd0\u884c\u4e86\r\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\r\nNAME          READY   STATUS   RESTARTS   AGE\r\npod-command   2/2     Runing   0          2s\r\n\r\n# \u8fdb\u5165pod\u4e2d\u7684busybox\u5bb9\u5668\uff0c\u67e5\u770b\u6587\u4ef6\u5185\u5bb9\r\n# \u8865\u5145\u4e00\u4e2a\u547d\u4ee4: kubectl exec  pod\u540d\u79f0 -n \u547d\u540d\u7a7a\u95f4 -it -c \u5bb9\u5668\u540d\u79f0 /bin/sh  \u5728\u5bb9\u5668\u5185\u90e8\u6267\u884c\u547d\u4ee4\r\n# \u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u5c31\u53ef\u4ee5\u8fdb\u5165\u67d0\u4e2a\u5bb9\u5668\u7684\u5185\u90e8\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u4e86\r\n# \u6bd4\u5982\uff0c\u53ef\u4ee5\u67e5\u770btxt\u6587\u4ef6\u7684\u5185\u5bb9\r\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh\r\n/ # tail -f /tmp/hello.txt\r\n14:44:19\r\n14:44:22\r\n14:44:25\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"\u7279\u522b\u8bf4\u660e\uff1a\r\n    \u901a\u8fc7\u4e0a\u9762\u53d1\u73b0command\u5df2\u7ecf\u53ef\u4ee5\u5b8c\u6210\u542f\u52a8\u547d\u4ee4\u548c\u4f20\u9012\u53c2\u6570\u7684\u529f\u80fd\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u8fd8\u8981\u63d0\u4f9b\u4e00\u4e2aargs\u9009\u9879\uff0c\u7528\u4e8e\u4f20\u9012\u53c2\u6570\u5462?\u8fd9\u5176\u5b9e\u8ddfdocker\u6709\u70b9\u5173\u7cfb\uff0ckubernetes\u4e2d\u7684command\u3001args\u4e24\u9879\u5176\u5b9e\u662f\u5b9e\u73b0\u8986\u76d6Dockerfile\u4e2dENTRYPOINT\u7684\u529f\u80fd\u3002\r\n 1 \u5982\u679ccommand\u548cargs\u5747\u6ca1\u6709\u5199\uff0c\u90a3\u4e48\u7528Dockerfile\u7684\u914d\u7f6e\u3002\r\n 2 \u5982\u679ccommand\u5199\u4e86\uff0c\u4f46args\u6ca1\u6709\u5199\uff0c\u90a3\u4e48Dockerfile\u9ed8\u8ba4\u7684\u914d\u7f6e\u4f1a\u88ab\u5ffd\u7565\uff0c\u6267\u884c\u8f93\u5165\u7684command\r\n 3 \u5982\u679ccommand\u6ca1\u5199\uff0c\u4f46args\u5199\u4e86\uff0c\u90a3\u4e48Dockerfile\u4e2d\u914d\u7f6e\u7684ENTRYPOINT\u7684\u547d\u4ee4\u4f1a\u88ab\u6267\u884c\uff0c\u4f7f\u7528\u5f53\u524dargs\u7684\u53c2\u6570\r\n 4 \u5982\u679ccommand\u548cargs\u90fd\u5199\u4e86\uff0c\u90a3\u4e48Dockerfile\u7684\u914d\u7f6e\u88ab\u5ffd\u7565\uff0c\u6267\u884ccommand\u5e76\u8ffd\u52a0\u4e0aargs\u53c2\u6570\n"})}),"\n",(0,s.jsx)(n.h4,{id:"524-\u73af\u5883\u53d8\u91cf",children:"5.2.4 \u73af\u5883\u53d8\u91cf"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-env.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-env\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","while true;do /bin/echo $(date +%T);sleep 60; done;"]\r\n    env: # \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u5217\u8868\r\n    - name: "username"\r\n      value: "admin"\r\n    - name: "password"\r\n      value: "123456"\n'})}),"\n",(0,s.jsx)(n.p,{children:"env\uff0c\u73af\u5883\u53d8\u91cf\uff0c\u7528\u4e8e\u5728pod\u4e2d\u7684\u5bb9\u5668\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\r\npod/pod-env created\r\n\r\n# \u8fdb\u5165\u5bb9\u5668\uff0c\u8f93\u51fa\u73af\u5883\u53d8\u91cf\r\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh\r\n/ # echo $username\r\nadmin\r\n/ # echo $password\r\n123456\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u662f\u5f88\u63a8\u8350\uff0c\u63a8\u8350\u5c06\u8fd9\u4e9b\u914d\u7f6e\u5355\u72ec\u5b58\u50a8\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c06\u5728\u540e\u9762\u4ecb\u7ecd\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"525-\u7aef\u53e3\u8bbe\u7f6e",children:"5.2.5 \u7aef\u53e3\u8bbe\u7f6e"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u5c0f\u8282\u6765\u4ecb\u7ecd\u5bb9\u5668\u7684\u7aef\u53e3\u8bbe\u7f6e\uff0c\u4e5f\u5c31\u662fcontainers\u7684ports\u9009\u9879\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\u770b\u4e0bports\u652f\u6301\u7684\u5b50\u9009\u9879\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\r\nKIND:     Pod\r\nVERSION:  v1\r\nRESOURCE: ports <[]Object>\r\nFIELDS:\r\n   name         <string>  # \u7aef\u53e3\u540d\u79f0\uff0c\u5982\u679c\u6307\u5b9a\uff0c\u5fc5\u987b\u4fdd\u8bc1name\u5728pod\u4e2d\u662f\u552f\u4e00\u7684\t\t\r\n   containerPort<integer> # \u5bb9\u5668\u8981\u76d1\u542c\u7684\u7aef\u53e3(0<x<65536)\r\n   hostPort     <integer> # \u5bb9\u5668\u8981\u5728\u4e3b\u673a\u4e0a\u516c\u5f00\u7684\u7aef\u53e3\uff0c\u5982\u679c\u8bbe\u7f6e\uff0c\u4e3b\u673a\u4e0a\u53ea\u80fd\u8fd0\u884c\u5bb9\u5668\u7684\u4e00\u4e2a\u526f\u672c(\u4e00\u822c\u7701\u7565) \r\n   hostIP       <string>  # \u8981\u5c06\u5916\u90e8\u7aef\u53e3\u7ed1\u5b9a\u5230\u7684\u4e3b\u673aIP(\u4e00\u822c\u7701\u7565)\r\n   protocol     <string>  # \u7aef\u53e3\u534f\u8bae\u3002\u5fc5\u987b\u662fUDP\u3001TCP\u6216SCTP\u3002\u9ed8\u8ba4\u4e3a\u201cTCP\u201d\u3002\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5\u6848\u4f8b\uff0c\u521b\u5efapod-ports.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-ports\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports: # \u8bbe\u7f6e\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3\u5217\u8868\r\n    - name: nginx-port\r\n      containerPort: 80\r\n      protocol: TCP\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\r\npod/pod-ports created\r\n\r\n# \u67e5\u770bpod\r\n# \u5728\u4e0b\u9762\u53ef\u4ee5\u660e\u663e\u770b\u5230\u914d\u7f6e\u4fe1\u606f\r\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\r\n......\r\nspec:\r\n  containers:\r\n  - image: nginx:1.17.1\r\n    imagePullPolicy: IfNotPresent\r\n    name: nginx\r\n    ports:\r\n    - containerPort: 80\r\n      name: nginx-port\r\n      protocol: TCP\r\n......\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u9700\u8981\u4f7f\u7528\u7684\u662f",(0,s.jsx)(n.code,{children:"Podip:containerPort"})]}),"\n",(0,s.jsx)(n.h4,{id:"526-\u8d44\u6e90\u914d\u989d",children:"5.2.6 \u8d44\u6e90\u914d\u989d"}),"\n",(0,s.jsx)(n.p,{children:"\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u8981\u8fd0\u884c\uff0c\u80af\u5b9a\u662f\u8981\u5360\u7528\u4e00\u5b9a\u8d44\u6e90\u7684\uff0c\u6bd4\u5982cpu\u548c\u5185\u5b58\u7b49\uff0c\u5982\u679c\u4e0d\u5bf9\u67d0\u4e2a\u5bb9\u5668\u7684\u8d44\u6e90\u505a\u9650\u5236\uff0c\u90a3\u4e48\u5b83\u5c31\u53ef\u80fd\u5403\u6389\u5927\u91cf\u8d44\u6e90\uff0c\u5bfc\u81f4\u5176\u5b83\u5bb9\u5668\u65e0\u6cd5\u8fd0\u884c\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0ckubernetes\u63d0\u4f9b\u4e86\u5bf9\u5185\u5b58\u548ccpu\u7684\u8d44\u6e90\u8fdb\u884c\u914d\u989d\u7684\u673a\u5236\uff0c\u8fd9\u79cd\u673a\u5236\u4e3b\u8981\u901a\u8fc7resources\u9009\u9879\u5b9e\u73b0\uff0c\u4ed6\u6709\u4e24\u4e2a\u5b50\u9009\u9879\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"limits\uff1a\u7528\u4e8e\u9650\u5236\u8fd0\u884c\u65f6\u5bb9\u5668\u7684\u6700\u5927\u5360\u7528\u8d44\u6e90\uff0c\u5f53\u5bb9\u5668\u5360\u7528\u8d44\u6e90\u8d85\u8fc7limits\u65f6\u4f1a\u88ab\u7ec8\u6b62\uff0c\u5e76\u8fdb\u884c\u91cd\u542f"}),"\n",(0,s.jsx)(n.li,{children:"requests \uff1a\u7528\u4e8e\u8bbe\u7f6e\u5bb9\u5668\u9700\u8981\u7684\u6700\u5c0f\u8d44\u6e90\uff0c\u5982\u679c\u73af\u5883\u8d44\u6e90\u4e0d\u591f\uff0c\u5bb9\u5668\u5c06\u65e0\u6cd5\u542f\u52a8"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u4e24\u4e2a\u9009\u9879\u8bbe\u7f6e\u8d44\u6e90\u7684\u4e0a\u4e0b\u9650\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5\u6848\u4f8b\uff0c\u521b\u5efapod-resources.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-resources\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    resources: # \u8d44\u6e90\u914d\u989d\r\n      limits:  # \u9650\u5236\u8d44\u6e90\uff08\u4e0a\u9650\uff09\r\n        cpu: "2" # CPU\u9650\u5236\uff0c\u5355\u4f4d\u662fcore\u6570\r\n        memory: "10Gi" # \u5185\u5b58\u9650\u5236\r\n      requests: # \u8bf7\u6c42\u8d44\u6e90\uff08\u4e0b\u9650\uff09\r\n        cpu: "1"  # CPU\u9650\u5236\uff0c\u5355\u4f4d\u662fcore\u6570\r\n        memory: "10Mi"  # \u5185\u5b58\u9650\u5236\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u8fd9\u5bf9cpu\u548cmemory\u7684\u5355\u4f4d\u505a\u4e00\u4e2a\u8bf4\u660e\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"cpu\uff1acore\u6570\uff0c\u53ef\u4ee5\u4e3a\u6574\u6570\u6216\u5c0f\u6570"}),"\n",(0,s.jsx)(n.li,{children:"memory\uff1a \u5185\u5b58\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528Gi\u3001Mi\u3001G\u3001M\u7b49\u5f62\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u8fd0\u884cPod\r\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\r\npod/pod-resources created\r\n\r\n# \u67e5\u770b\u53d1\u73b0pod\u8fd0\u884c\u6b63\u5e38\r\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\r\nNAME            READY   STATUS    RESTARTS   AGE  \r\npod-resources   1/1     Running   0          39s   \r\n\r\n# \u63a5\u4e0b\u6765\uff0c\u505c\u6b62Pod\r\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\r\npod "pod-resources" deleted\r\n\r\n# \u7f16\u8f91pod\uff0c\u4fee\u6539resources.requests.memory\u7684\u503c\u4e3a10Gi\r\n[root@k8s-master01 ~]# vim pod-resources.yaml\r\n\r\n# \u518d\u6b21\u542f\u52a8pod\r\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\r\npod/pod-resources created\r\n\r\n# \u67e5\u770bPod\u72b6\u6001\uff0c\u53d1\u73b0Pod\u542f\u52a8\u5931\u8d25\r\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\r\nNAME            READY   STATUS    RESTARTS   AGE          \r\npod-resources   0/1     Pending   0          20s    \r\n\r\n# \u67e5\u770bpod\u8be6\u60c5\u4f1a\u53d1\u73b0\uff0c\u5982\u4e0b\u63d0\u793a\r\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\r\n......\r\nWarning  FailedScheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn\'t tolerate, 2 Insufficient memory.(\u5185\u5b58\u4e0d\u8db3)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"53-pod\u751f\u547d\u5468\u671f",children:"5.3 Pod\u751f\u547d\u5468\u671f"}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u4e00\u822c\u5c06pod\u5bf9\u8c61\u4ece\u521b\u5efa\u81f3\u7ec8\u7684\u8fd9\u6bb5\u65f6\u95f4\u8303\u56f4\u79f0\u4e3apod\u7684\u751f\u547d\u5468\u671f\uff0c\u5b83\u4e3b\u8981\u5305\u542b\u4e0b\u9762\u7684\u8fc7\u7a0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"pod\u521b\u5efa\u8fc7\u7a0b"}),"\n",(0,s.jsx)(n.li,{children:"\u8fd0\u884c\u521d\u59cb\u5316\u5bb9\u5668\uff08init container\uff09\u8fc7\u7a0b"}),"\n",(0,s.jsxs)(n.li,{children:["\u8fd0\u884c\u4e3b\u5bb9\u5668\uff08main container\uff09","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5bb9\u5668\u542f\u52a8\u540e\u94a9\u5b50\uff08post start\uff09\u3001\u5bb9\u5668\u7ec8\u6b62\u524d\u94a9\u5b50\uff08pre stop\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u5bb9\u5668\u7684\u5b58\u6d3b\u6027\u63a2\u6d4b\uff08liveness probe\uff09\u3001\u5c31\u7eea\u6027\u63a2\u6d4b\uff08readiness probe\uff09"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"pod\u7ec8\u6b62\u8fc7\u7a0b"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200412111402706",src:r(914).A+"",width:"1053",height:"548"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u6574\u4e2a\u751f\u547d\u5468\u671f\u4e2d\uff0cPod\u4f1a\u51fa\u73b05\u79cd",(0,s.jsx)(n.strong,{children:"\u72b6\u6001"}),"\uff08",(0,s.jsx)(n.strong,{children:"\u76f8\u4f4d"}),"\uff09\uff0c\u5206\u522b\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6302\u8d77\uff08Pending\uff09\uff1aapiserver\u5df2\u7ecf\u521b\u5efa\u4e86pod\u8d44\u6e90\u5bf9\u8c61\uff0c\u4f46\u5b83\u5c1a\u672a\u88ab\u8c03\u5ea6\u5b8c\u6210\u6216\u8005\u4ecd\u5904\u4e8e\u4e0b\u8f7d\u955c\u50cf\u7684\u8fc7\u7a0b\u4e2d"}),"\n",(0,s.jsx)(n.li,{children:"\u8fd0\u884c\u4e2d\uff08Running\uff09\uff1apod\u5df2\u7ecf\u88ab\u8c03\u5ea6\u81f3\u67d0\u8282\u70b9\uff0c\u5e76\u4e14\u6240\u6709\u5bb9\u5668\u90fd\u5df2\u7ecf\u88abkubelet\u521b\u5efa\u5b8c\u6210"}),"\n",(0,s.jsx)(n.li,{children:"\u6210\u529f\uff08Succeeded\uff09\uff1apod\u4e2d\u7684\u6240\u6709\u5bb9\u5668\u90fd\u5df2\u7ecf\u6210\u529f\u7ec8\u6b62\u5e76\u4e14\u4e0d\u4f1a\u88ab\u91cd\u542f"}),"\n",(0,s.jsx)(n.li,{children:"\u5931\u8d25\uff08Failed\uff09\uff1a\u6240\u6709\u5bb9\u5668\u90fd\u5df2\u7ecf\u7ec8\u6b62\uff0c\u4f46\u81f3\u5c11\u6709\u4e00\u4e2a\u5bb9\u5668\u7ec8\u6b62\u5931\u8d25\uff0c\u5373\u5bb9\u5668\u8fd4\u56de\u4e86\u975e0\u503c\u7684\u9000\u51fa\u72b6\u6001"}),"\n",(0,s.jsx)(n.li,{children:"\u672a\u77e5\uff08Unknown\uff09\uff1aapiserver\u65e0\u6cd5\u6b63\u5e38\u83b7\u53d6\u5230pod\u5bf9\u8c61\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u901a\u5e38\u7531\u7f51\u7edc\u901a\u4fe1\u5931\u8d25\u6240\u5bfc\u81f4"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"531-\u521b\u5efa\u548c\u7ec8\u6b62",children:"5.3.1 \u521b\u5efa\u548c\u7ec8\u6b62"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"pod\u7684\u521b\u5efa\u8fc7\u7a0b"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u7528\u6237\u901a\u8fc7kubectl\u6216\u5176\u4ed6api\u5ba2\u6237\u7aef\u63d0\u4ea4\u9700\u8981\u521b\u5efa\u7684pod\u4fe1\u606f\u7ed9apiServer"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiServer\u5f00\u59cb\u751f\u6210pod\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u5e76\u5c06\u4fe1\u606f\u5b58\u5165etcd\uff0c\u7136\u540e\u8fd4\u56de\u786e\u8ba4\u4fe1\u606f\u81f3\u5ba2\u6237\u7aef"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiServer\u5f00\u59cb\u53cd\u6620etcd\u4e2d\u7684pod\u5bf9\u8c61\u7684\u53d8\u5316\uff0c\u5176\u5b83\u7ec4\u4ef6\u4f7f\u7528watch\u673a\u5236\u6765\u8ddf\u8e2a\u68c0\u67e5apiServer\u4e0a\u7684\u53d8\u52a8"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"scheduler\u53d1\u73b0\u6709\u65b0\u7684pod\u5bf9\u8c61\u8981\u521b\u5efa\uff0c\u5f00\u59cb\u4e3aPod\u5206\u914d\u4e3b\u673a\u5e76\u5c06\u7ed3\u679c\u4fe1\u606f\u66f4\u65b0\u81f3apiServer"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"node\u8282\u70b9\u4e0a\u7684kubelet\u53d1\u73b0\u6709pod\u8c03\u5ea6\u8fc7\u6765\uff0c\u5c1d\u8bd5\u8c03\u7528docker\u542f\u52a8\u5bb9\u5668\uff0c\u5e76\u5c06\u7ed3\u679c\u56de\u9001\u81f3apiServer"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiServer\u5c06\u63a5\u6536\u5230\u7684pod\u72b6\u6001\u4fe1\u606f\u5b58\u5165etcd\u4e2d"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200406184656917",src:r(6429).A+"",width:"1436",height:"745"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"pod\u7684\u7ec8\u6b62\u8fc7\u7a0b"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u7528\u6237\u5411apiServer\u53d1\u9001\u5220\u9664pod\u5bf9\u8c61\u7684\u547d\u4ee4"}),"\n",(0,s.jsx)(n.li,{children:"apiServcer\u4e2d\u7684pod\u5bf9\u8c61\u4fe1\u606f\u4f1a\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u800c\u66f4\u65b0\uff0c\u5728\u5bbd\u9650\u671f\u5185\uff08\u9ed8\u8ba430s\uff09\uff0cpod\u88ab\u89c6\u4e3adead"}),"\n",(0,s.jsx)(n.li,{children:"\u5c06pod\u6807\u8bb0\u4e3aterminating\u72b6\u6001"}),"\n",(0,s.jsx)(n.li,{children:"kubelet\u5728\u76d1\u63a7\u5230pod\u5bf9\u8c61\u8f6c\u4e3aterminating\u72b6\u6001\u7684\u540c\u65f6\u542f\u52a8pod\u5173\u95ed\u8fc7\u7a0b"}),"\n",(0,s.jsx)(n.li,{children:"\u7aef\u70b9\u63a7\u5236\u5668\u76d1\u63a7\u5230pod\u5bf9\u8c61\u7684\u5173\u95ed\u884c\u4e3a\u65f6\u5c06\u5176\u4ece\u6240\u6709\u5339\u914d\u5230\u6b64\u7aef\u70b9\u7684service\u8d44\u6e90\u7684\u7aef\u70b9\u5217\u8868\u4e2d\u79fb\u9664"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u5f53\u524dpod\u5bf9\u8c61\u5b9a\u4e49\u4e86preStop\u94a9\u5b50\u5904\u7406\u5668\uff0c\u5219\u5728\u5176\u6807\u8bb0\u4e3aterminating\u540e\u5373\u4f1a\u4ee5\u540c\u6b65\u7684\u65b9\u5f0f\u542f\u52a8\u6267\u884c"}),"\n",(0,s.jsx)(n.li,{children:"pod\u5bf9\u8c61\u4e2d\u7684\u5bb9\u5668\u8fdb\u7a0b\u6536\u5230\u505c\u6b62\u4fe1\u53f7"}),"\n",(0,s.jsx)(n.li,{children:"\u5bbd\u9650\u671f\u7ed3\u675f\u540e\uff0c\u82e5pod\u4e2d\u8fd8\u5b58\u5728\u4ecd\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u90a3\u4e48pod\u5bf9\u8c61\u4f1a\u6536\u5230\u7acb\u5373\u7ec8\u6b62\u7684\u4fe1\u53f7"}),"\n",(0,s.jsx)(n.li,{children:"kubelet\u8bf7\u6c42apiServer\u5c06\u6b64pod\u8d44\u6e90\u7684\u5bbd\u9650\u671f\u8bbe\u7f6e\u4e3a0\u4ece\u800c\u5b8c\u6210\u5220\u9664\u64cd\u4f5c\uff0c\u6b64\u65f6pod\u5bf9\u4e8e\u7528\u6237\u5df2\u4e0d\u53ef\u89c1"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"532-\u521d\u59cb\u5316\u5bb9\u5668",children:"5.3.2 \u521d\u59cb\u5316\u5bb9\u5668"}),"\n",(0,s.jsx)(n.p,{children:"\u521d\u59cb\u5316\u5bb9\u5668\u662f\u5728pod\u7684\u4e3b\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8981\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u4e3b\u8981\u662f\u505a\u4e00\u4e9b\u4e3b\u5bb9\u5668\u7684\u524d\u7f6e\u5de5\u4f5c\uff0c\u5b83\u5177\u6709\u4e24\u5927\u7279\u5f81\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u521d\u59cb\u5316\u5bb9\u5668\u5fc5\u987b\u8fd0\u884c\u5b8c\u6210\u76f4\u81f3\u7ed3\u675f\uff0c\u82e5\u67d0\u521d\u59cb\u5316\u5bb9\u5668\u8fd0\u884c\u5931\u8d25\uff0c\u90a3\u4e48kubernetes\u9700\u8981\u91cd\u542f\u5b83\u76f4\u5230\u6210\u529f\u5b8c\u6210"}),"\n",(0,s.jsx)(n.li,{children:"\u521d\u59cb\u5316\u5bb9\u5668\u5fc5\u987b\u6309\u7167\u5b9a\u4e49\u7684\u987a\u5e8f\u6267\u884c\uff0c\u5f53\u4e14\u4ec5\u5f53\u524d\u4e00\u4e2a\u6210\u529f\u4e4b\u540e\uff0c\u540e\u9762\u7684\u4e00\u4e2a\u624d\u80fd\u8fd0\u884c"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u521d\u59cb\u5316\u5bb9\u5668\u6709\u5f88\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u4e0b\u9762\u5217\u51fa\u7684\u662f\u6700\u5e38\u89c1\u7684\u51e0\u4e2a\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u63d0\u4f9b\u4e3b\u5bb9\u5668\u955c\u50cf\u4e2d\u4e0d\u5177\u5907\u7684\u5de5\u5177\u7a0b\u5e8f\u6216\u81ea\u5b9a\u4e49\u4ee3\u7801"}),"\n",(0,s.jsx)(n.li,{children:"\u521d\u59cb\u5316\u5bb9\u5668\u8981\u5148\u4e8e\u5e94\u7528\u5bb9\u5668\u4e32\u884c\u542f\u52a8\u5e76\u8fd0\u884c\u5b8c\u6210\uff0c\u56e0\u6b64\u53ef\u7528\u4e8e\u5ef6\u540e\u5e94\u7528\u5bb9\u5668\u7684\u542f\u52a8\u76f4\u81f3\u5176\u4f9d\u8d56\u7684\u6761\u4ef6\u5f97\u5230\u6ee1\u8db3"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u505a\u4e00\u4e2a\u6848\u4f8b\uff0c\u6a21\u62df\u4e0b\u9762\u8fd9\u4e2a\u9700\u6c42\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u5047\u8bbe\u8981\u4ee5\u4e3b\u5bb9\u5668\u6765\u8fd0\u884cnginx\uff0c\u4f46\u662f\u8981\u6c42\u5728\u8fd0\u884cnginx\u4e4b\u524d\u5148\u8981\u80fd\u591f\u8fde\u63a5\u4e0amysql\u548credis\u6240\u5728\u670d\u52a1\u5668"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u7b80\u5316\u6d4b\u8bd5\uff0c\u4e8b\u5148\u89c4\u5b9a\u597dmysql",(0,s.jsx)(n.code,{children:"(192.168.90.14)"}),"\u548credis",(0,s.jsx)(n.code,{children:"(192.168.90.15)"}),"\u670d\u52a1\u5668\u7684\u5730\u5740"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-initcontainer.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-initcontainer\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: main-container\r\n    image: nginx:1.17.1\r\n    ports: \r\n    - name: nginx-port\r\n      containerPort: 80\r\n  initContainers:\r\n  - name: test-mysql\r\n    image: busybox:1.30\r\n    command: ['sh', '-c', 'until ping 192.168.90.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;']\r\n  - name: test-redis\r\n    image: busybox:1.30\r\n    command: ['sh', '-c', 'until ping 192.168.90.15 -c 1 ; do echo waiting for reids...; sleep 2; done;']\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\r\npod/pod-initcontainer created\r\n\r\n# \u67e5\u770bpod\u72b6\u6001\r\n# \u53d1\u73b0pod\u5361\u5728\u542f\u52a8\u7b2c\u4e00\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\u8fc7\u7a0b\u4e2d\uff0c\u540e\u9762\u7684\u5bb9\u5668\u4e0d\u4f1a\u8fd0\u884c\r\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\r\n........\r\nEvents:\r\n  Type    Reason     Age   From               Message\r\n  ----    ------     ----  ----               -------\r\n  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1\r\n  Normal  Pulled     48s   kubelet, node1     Container image "busybox:1.30" already present on machine\r\n  Normal  Created    48s   kubelet, node1     Created container test-mysql\r\n  Normal  Started    48s   kubelet, node1     Started container test-mysql\r\n\r\n# \u52a8\u6001\u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\r\nNAME                             READY   STATUS     RESTARTS   AGE\r\npod-initcontainer                0/1     Init:0/2   0          15s\r\npod-initcontainer                0/1     Init:1/2   0          52s\r\npod-initcontainer                0/1     Init:1/2   0          53s\r\npod-initcontainer                0/1     PodInitializing   0          89s\r\npod-initcontainer                1/1     Running           0          90s\r\n\r\n# \u63a5\u4e0b\u6765\u65b0\u5f00\u4e00\u4e2ashell\uff0c\u4e3a\u5f53\u524d\u670d\u52a1\u5668\u65b0\u589e\u4e24\u4e2aip\uff0c\u89c2\u5bdfpod\u7684\u53d8\u5316\r\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.90.14 netmask 255.255.255.0 up\r\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.90.15 netmask 255.255.255.0 up\n'})}),"\n",(0,s.jsx)(n.h4,{id:"533-\u94a9\u5b50\u51fd\u6570",children:"5.3.3 \u94a9\u5b50\u51fd\u6570"}),"\n",(0,s.jsx)(n.p,{children:"\u94a9\u5b50\u51fd\u6570\u80fd\u591f\u611f\u77e5\u81ea\u8eab\u751f\u547d\u5468\u671f\u4e2d\u7684\u4e8b\u4ef6\uff0c\u5e76\u5728\u76f8\u5e94\u7684\u65f6\u523b\u5230\u6765\u65f6\u8fd0\u884c\u7528\u6237\u6307\u5b9a\u7684\u7a0b\u5e8f\u4ee3\u7801\u3002"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u5728\u4e3b\u5bb9\u5668\u7684\u542f\u52a8\u4e4b\u540e\u548c\u505c\u6b62\u4e4b\u524d\u63d0\u4f9b\u4e86\u4e24\u4e2a\u94a9\u5b50\u51fd\u6570\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"post start\uff1a\u5bb9\u5668\u521b\u5efa\u4e4b\u540e\u6267\u884c\uff0c\u5982\u679c\u5931\u8d25\u4e86\u4f1a\u91cd\u542f\u5bb9\u5668"}),"\n",(0,s.jsx)(n.li,{children:"pre stop \uff1a\u5bb9\u5668\u7ec8\u6b62\u4e4b\u524d\u6267\u884c\uff0c\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u5bb9\u5668\u5c06\u6210\u529f\u7ec8\u6b62\uff0c\u5728\u5176\u5b8c\u6210\u4e4b\u524d\u4f1a\u963b\u585e\u5220\u9664\u5bb9\u5668\u7684\u64cd\u4f5c"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u94a9\u5b50\u5904\u7406\u5668\u652f\u6301\u4f7f\u7528\u4e0b\u9762\u4e09\u79cd\u65b9\u5f0f\u5b9a\u4e49\u52a8\u4f5c\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Exec\u547d\u4ee4\uff1a\u5728\u5bb9\u5668\u5185\u6267\u884c\u4e00\u6b21\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026\r\n  lifecycle:\r\n    postStart: \r\n      exec:\r\n        command:\r\n        - cat\r\n        - /tmp/healthy\r\n\u2026\u2026\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"TCPSocket\uff1a\u5728\u5f53\u524d\u5bb9\u5668\u5c1d\u8bd5\u8bbf\u95ee\u6307\u5b9a\u7684socket"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026      \r\n  lifecycle:\r\n    postStart:\r\n      tcpSocket:\r\n        port: 8080\r\n\u2026\u2026\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HTTPGet\uff1a\u5728\u5f53\u524d\u5bb9\u5668\u4e2d\u5411\u67d0url\u53d1\u8d77http\u8bf7\u6c42"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026\r\n  lifecycle:\r\n    postStart:\r\n      httpGet:\r\n        path: / #URI\u5730\u5740\r\n        port: 80 #\u7aef\u53e3\u53f7\r\n        host: 192.168.5.3 #\u4e3b\u673a\u5730\u5740\r\n        scheme: HTTP #\u652f\u6301\u7684\u534f\u8bae\uff0chttp\u6216\u8005https\r\n\u2026\u2026\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u4ee5exec\u65b9\u5f0f\u4e3a\u4f8b\uff0c\u6f14\u793a\u4e0b\u94a9\u5b50\u51fd\u6570\u7684\u4f7f\u7528\uff0c\u521b\u5efapod-hook-exec.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-hook-exec\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: main-container\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n    lifecycle:\r\n      postStart: \r\n        exec: # \u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\uff0c\u4fee\u6539\u6389nginx\u7684\u9ed8\u8ba4\u9996\u9875\u5185\u5bb9\r\n          command: ["/bin/sh", "-c", "echo postStart... > /usr/share/nginx/html/index.html"]\r\n      preStop:\r\n        exec: # \u5728\u5bb9\u5668\u505c\u6b62\u4e4b\u524d\u505c\u6b62nginx\u670d\u52a1\r\n          command: ["/usr/sbin/nginx","-s","quit"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\r\npod/pod-hook-exec created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\r\nNAME           READY   STATUS     RESTARTS   AGE    IP            NODE    \r\npod-hook-exec  1/1     Running    0          29s    10.244.2.48   node2   \r\n\r\n# \u8bbf\u95eepod\r\n[root@k8s-master01 ~]# curl 10.244.2.48\r\npostStart...\n"})}),"\n",(0,s.jsx)(n.h4,{id:"534-\u5bb9\u5668\u63a2\u6d4b",children:"5.3.4 \u5bb9\u5668\u63a2\u6d4b"}),"\n",(0,s.jsx)(n.p,{children:'\u5bb9\u5668\u63a2\u6d4b\u7528\u4e8e\u68c0\u6d4b\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u5b9e\u4f8b\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u662f\u4fdd\u969c\u4e1a\u52a1\u53ef\u7528\u6027\u7684\u4e00\u79cd\u4f20\u7edf\u673a\u5236\u3002\u5982\u679c\u7ecf\u8fc7\u63a2\u6d4b\uff0c\u5b9e\u4f8b\u7684\u72b6\u6001\u4e0d\u7b26\u5408\u9884\u671f\uff0c\u90a3\u4e48kubernetes\u5c31\u4f1a\u628a\u8be5\u95ee\u9898\u5b9e\u4f8b" \u6458\u9664 "\uff0c\u4e0d\u627f\u62c5\u4e1a\u52a1\u6d41\u91cf\u3002kubernetes\u63d0\u4f9b\u4e86\u4e24\u79cd\u63a2\u9488\u6765\u5b9e\u73b0\u5bb9\u5668\u63a2\u6d4b\uff0c\u5206\u522b\u662f\uff1a'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"liveness probes\uff1a\u5b58\u6d3b\u6027\u63a2\u9488\uff0c\u7528\u4e8e\u68c0\u6d4b\u5e94\u7528\u5b9e\u4f8b\u5f53\u524d\u662f\u5426\u5904\u4e8e\u6b63\u5e38\u8fd0\u884c\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u662f\uff0ck8s\u4f1a\u91cd\u542f\u5bb9\u5668"}),"\n",(0,s.jsx)(n.li,{children:"readiness probes\uff1a\u5c31\u7eea\u6027\u63a2\u9488\uff0c\u7528\u4e8e\u68c0\u6d4b\u5e94\u7528\u5b9e\u4f8b\u5f53\u524d\u662f\u5426\u53ef\u4ee5\u63a5\u6536\u8bf7\u6c42\uff0c\u5982\u679c\u4e0d\u80fd\uff0ck8s\u4e0d\u4f1a\u8f6c\u53d1\u6d41\u91cf"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"livenessProbe \u51b3\u5b9a\u662f\u5426\u91cd\u542f\u5bb9\u5668\uff0creadinessProbe \u51b3\u5b9a\u662f\u5426\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5bb9\u5668\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u4e24\u79cd\u63a2\u9488\u76ee\u524d\u5747\u652f\u6301\u4e09\u79cd\u63a2\u6d4b\u65b9\u5f0f\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Exec\u547d\u4ee4\uff1a\u5728\u5bb9\u5668\u5185\u6267\u884c\u4e00\u6b21\u547d\u4ee4\uff0c\u5982\u679c\u547d\u4ee4\u6267\u884c\u7684\u9000\u51fa\u7801\u4e3a0\uff0c\u5219\u8ba4\u4e3a\u7a0b\u5e8f\u6b63\u5e38\uff0c\u5426\u5219\u4e0d\u6b63\u5e38"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026\r\n  livenessProbe:\r\n    exec:\r\n      command:\r\n      - cat\r\n      - /tmp/healthy\r\n\u2026\u2026\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"TCPSocket\uff1a\u5c06\u4f1a\u5c1d\u8bd5\u8bbf\u95ee\u4e00\u4e2a\u7528\u6237\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u5982\u679c\u80fd\u591f\u5efa\u7acb\u8fd9\u6761\u8fde\u63a5\uff0c\u5219\u8ba4\u4e3a\u7a0b\u5e8f\u6b63\u5e38\uff0c\u5426\u5219\u4e0d\u6b63\u5e38"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026      \r\n  livenessProbe:\r\n    tcpSocket:\r\n      port: 8080\r\n\u2026\u2026\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HTTPGet\uff1a\u8c03\u7528\u5bb9\u5668\u5185Web\u5e94\u7528\u7684URL\uff0c\u5982\u679c\u8fd4\u56de\u7684\u72b6\u6001\u7801\u5728200\u548c399\u4e4b\u95f4\uff0c\u5219\u8ba4\u4e3a\u7a0b\u5e8f\u6b63\u5e38\uff0c\u5426\u5219\u4e0d\u6b63\u5e38"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"\u2026\u2026\r\n  livenessProbe:\r\n    httpGet:\r\n      path: / #URI\u5730\u5740\r\n      port: 80 #\u7aef\u53e3\u53f7\r\n      host: 127.0.0.1 #\u4e3b\u673a\u5730\u5740\r\n      scheme: HTTP #\u652f\u6301\u7684\u534f\u8bae\uff0chttp\u6216\u8005https\r\n\u2026\u2026\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u4ee5liveness probes\u4e3a\u4f8b\uff0c\u505a\u51e0\u4e2a\u6f14\u793a\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e00\uff1aExec"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-liveness-exec.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-liveness-exec\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports: \r\n    - name: nginx-port\r\n      containerPort: 80\r\n    livenessProbe:\r\n      exec:\r\n        command: ["/bin/cat","/tmp/hello.txt"] # \u6267\u884c\u4e00\u4e2a\u67e5\u770b\u6587\u4ef6\u7684\u547d\u4ee4\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod\uff0c\u89c2\u5bdf\u6548\u679c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\r\npod/pod-liveness-exec created\r\n\r\n# \u67e5\u770bPod\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\r\n......\r\n  Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx\r\n  Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx\r\n  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted\r\n  Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed: cat: can't open '/tmp/hello11.txt': No such file or directory\r\n  \r\n# \u89c2\u5bdf\u4e0a\u9762\u7684\u4fe1\u606f\u5c31\u4f1a\u53d1\u73b0nginx\u5bb9\u5668\u542f\u52a8\u4e4b\u540e\u5c31\u8fdb\u884c\u4e86\u5065\u5eb7\u68c0\u67e5\r\n# \u68c0\u67e5\u5931\u8d25\u4e4b\u540e\uff0c\u5bb9\u5668\u88abkill\u6389\uff0c\u7136\u540e\u5c1d\u8bd5\u8fdb\u884c\u91cd\u542f\uff08\u8fd9\u662f\u91cd\u542f\u7b56\u7565\u7684\u4f5c\u7528\uff0c\u540e\u9762\u8bb2\u89e3\uff09\r\n# \u7a0d\u7b49\u4e00\u4f1a\u4e4b\u540e\uff0c\u518d\u89c2\u5bdfpod\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u770b\u5230RESTARTS\u4e0d\u518d\u662f0\uff0c\u800c\u662f\u4e00\u76f4\u589e\u957f\r\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\r\nNAME                READY   STATUS             RESTARTS   AGE\r\npod-liveness-exec   0/1     CrashLoopBackOff   2          3m19s\r\n\r\n# \u5f53\u7136\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u4fee\u6539\u6210\u4e00\u4e2a\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u6bd4\u5982/tmp/hello.txt\uff0c\u518d\u8bd5\uff0c\u7ed3\u679c\u5c31\u6b63\u5e38\u4e86......\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e8c\uff1aTCPSocket"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-liveness-tcpsocket.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-liveness-tcpsocket\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports: \r\n    - name: nginx-port\r\n      containerPort: 80\r\n    livenessProbe:\r\n      tcpSocket:\r\n        port: 8080 # \u5c1d\u8bd5\u8bbf\u95ee8080\u7aef\u53e3\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod\uff0c\u89c2\u5bdf\u6548\u679c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\r\npod/pod-liveness-tcpsocket created\r\n\r\n# \u67e5\u770bPod\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\r\n......\r\n  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2\r\n  Normal   Pulled     <invalid>                      kubelet, node2     Container image "nginx:1.17.1" already present on machine\r\n  Normal   Created    <invalid>                      kubelet, node2     Created container nginx\r\n  Normal   Started    <invalid>                      kubelet, node2     Started container nginx\r\n  Warning  Unhealthy  <invalid> (x2 over <invalid>)  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\r\n  \r\n# \u89c2\u5bdf\u4e0a\u9762\u7684\u4fe1\u606f\uff0c\u53d1\u73b0\u5c1d\u8bd5\u8bbf\u95ee8080\u7aef\u53e3,\u4f46\u662f\u5931\u8d25\u4e86\r\n# \u7a0d\u7b49\u4e00\u4f1a\u4e4b\u540e\uff0c\u518d\u89c2\u5bdfpod\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u770b\u5230RESTARTS\u4e0d\u518d\u662f0\uff0c\u800c\u662f\u4e00\u76f4\u589e\u957f\r\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\r\nNAME                     READY   STATUS             RESTARTS   AGE\r\npod-liveness-tcpsocket   0/1     CrashLoopBackOff   2          3m19s\r\n\r\n# \u5f53\u7136\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u4fee\u6539\u6210\u4e00\u4e2a\u53ef\u4ee5\u8bbf\u95ee\u7684\u7aef\u53e3\uff0c\u6bd4\u598280\uff0c\u518d\u8bd5\uff0c\u7ed3\u679c\u5c31\u6b63\u5e38\u4e86......\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e09\uff1aHTTPGet"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-liveness-httpget.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-liveness-httpget\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n    livenessProbe:\r\n      httpGet:  # \u5176\u5b9e\u5c31\u662f\u8bbf\u95eehttp://127.0.0.1:80/hello  \r\n        scheme: HTTP #\u652f\u6301\u7684\u534f\u8bae\uff0chttp\u6216\u8005https\r\n        port: 80 #\u7aef\u53e3\u53f7\r\n        path: /hello #URI\u5730\u5740\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod\uff0c\u89c2\u5bdf\u6548\u679c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\r\npod/pod-liveness-httpget created\r\n\r\n# \u67e5\u770bPod\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\r\n.......\r\n  Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image "nginx:1.17.1" already present on machine\r\n  Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx\r\n  Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx\r\n  Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\r\n  Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted\r\n  \r\n# \u89c2\u5bdf\u4e0a\u9762\u4fe1\u606f\uff0c\u5c1d\u8bd5\u8bbf\u95ee\u8def\u5f84\uff0c\u4f46\u662f\u672a\u627e\u5230,\u51fa\u73b0404\u9519\u8bef\r\n# \u7a0d\u7b49\u4e00\u4f1a\u4e4b\u540e\uff0c\u518d\u89c2\u5bdfpod\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u770b\u5230RESTARTS\u4e0d\u518d\u662f0\uff0c\u800c\u662f\u4e00\u76f4\u589e\u957f\r\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\r\nNAME                   READY   STATUS    RESTARTS   AGE\r\npod-liveness-httpget   1/1     Running   5          3m17s\r\n\r\n# \u5f53\u7136\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u4fee\u6539\u6210\u4e00\u4e2a\u53ef\u4ee5\u8bbf\u95ee\u7684\u8def\u5f84path\uff0c\u6bd4\u5982/\uff0c\u518d\u8bd5\uff0c\u7ed3\u679c\u5c31\u6b63\u5e38\u4e86......\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u81f3\u6b64\uff0c\u5df2\u7ecf\u4f7f\u7528liveness Probe\u6f14\u793a\u4e86\u4e09\u79cd\u63a2\u6d4b\u65b9\u5f0f\uff0c\u4f46\u662f\u67e5\u770blivenessProbe\u7684\u5b50\u5c5e\u6027\uff0c\u4f1a\u53d1\u73b0\u9664\u4e86\u8fd9\u4e09\u79cd\u65b9\u5f0f\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u914d\u7f6e\uff0c\u5728\u8fd9\u91cc\u4e00\u5e76\u89e3\u91ca\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbe\r\nFIELDS:\r\n   exec <Object>  \r\n   tcpSocket    <Object>\r\n   httpGet      <Object>\r\n   initialDelaySeconds  <integer>  # \u5bb9\u5668\u542f\u52a8\u540e\u7b49\u5f85\u591a\u5c11\u79d2\u6267\u884c\u7b2c\u4e00\u6b21\u63a2\u6d4b\r\n   timeoutSeconds       <integer>  # \u63a2\u6d4b\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba41\u79d2\uff0c\u6700\u5c0f1\u79d2\r\n   periodSeconds        <integer>  # \u6267\u884c\u63a2\u6d4b\u7684\u9891\u7387\u3002\u9ed8\u8ba4\u662f10\u79d2\uff0c\u6700\u5c0f1\u79d2\r\n   failureThreshold     <integer>  # \u8fde\u7eed\u63a2\u6d4b\u5931\u8d25\u591a\u5c11\u6b21\u624d\u88ab\u8ba4\u5b9a\u4e3a\u5931\u8d25\u3002\u9ed8\u8ba4\u662f3\u3002\u6700\u5c0f\u503c\u662f1\r\n   successThreshold     <integer>  # \u8fde\u7eed\u63a2\u6d4b\u6210\u529f\u591a\u5c11\u6b21\u624d\u88ab\u8ba4\u5b9a\u4e3a\u6210\u529f\u3002\u9ed8\u8ba4\u662f1\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u7a0d\u5fae\u914d\u7f6e\u4e24\u4e2a\uff0c\u6f14\u793a\u4e0b\u6548\u679c\u5373\u53ef\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-liveness-httpget\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n    livenessProbe:\r\n      httpGet:\r\n        scheme: HTTP\r\n        port: 80 \r\n        path: /\r\n      initialDelaySeconds: 30 # \u5bb9\u5668\u542f\u52a8\u540e30s\u5f00\u59cb\u63a2\u6d4b\r\n      timeoutSeconds: 5 # \u63a2\u6d4b\u8d85\u65f6\u65f6\u95f4\u4e3a5s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"535-\u91cd\u542f\u7b56\u7565",children:"5.3.5 \u91cd\u542f\u7b56\u7565"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4e0a\u4e00\u8282\u4e2d\uff0c\u4e00\u65e6\u5bb9\u5668\u63a2\u6d4b\u51fa\u73b0\u4e86\u95ee\u9898\uff0ckubernetes\u5c31\u4f1a\u5bf9\u5bb9\u5668\u6240\u5728\u7684Pod\u8fdb\u884c\u91cd\u542f\uff0c\u5176\u5b9e\u8fd9\u662f\u7531pod\u7684\u91cd\u542f\u7b56\u7565\u51b3\u5b9a\u7684\uff0cpod\u7684\u91cd\u542f\u7b56\u7565\u6709 3 \u79cd\uff0c\u5206\u522b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Always \uff1a\u5bb9\u5668\u5931\u6548\u65f6\uff0c\u81ea\u52a8\u91cd\u542f\u8be5\u5bb9\u5668\uff0c\u8fd9\u4e5f\u662f\u9ed8\u8ba4\u503c\u3002"}),"\n",(0,s.jsx)(n.li,{children:"OnFailure \uff1a \u5bb9\u5668\u7ec8\u6b62\u8fd0\u884c\u4e14\u9000\u51fa\u7801\u4e0d\u4e3a0\u65f6\u91cd\u542f"}),"\n",(0,s.jsx)(n.li,{children:"Never \uff1a \u4e0d\u8bba\u72b6\u6001\u4e3a\u4f55\uff0c\u90fd\u4e0d\u91cd\u542f\u8be5\u5bb9\u5668"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u542f\u7b56\u7565\u9002\u7528\u4e8epod\u5bf9\u8c61\u4e2d\u7684\u6240\u6709\u5bb9\u5668\uff0c\u9996\u6b21\u9700\u8981\u91cd\u542f\u7684\u5bb9\u5668\uff0c\u5c06\u5728\u5176\u9700\u8981\u65f6\u7acb\u5373\u8fdb\u884c\u91cd\u542f\uff0c\u968f\u540e\u518d\u6b21\u9700\u8981\u91cd\u542f\u7684\u64cd\u4f5c\u5c06\u7531kubelet\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u540e\u8fdb\u884c\uff0c\u4e14\u53cd\u590d\u7684\u91cd\u542f\u64cd\u4f5c\u7684\u5ef6\u8fdf\u65f6\u957f\u4ee5\u6b64\u4e3a10s\u300120s\u300140s\u300180s\u3001160s\u548c300s\uff0c300s\u662f\u6700\u5927\u5ef6\u8fdf\u65f6\u957f\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-restartpolicy.yaml\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-restartpolicy\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - name: nginx-port\r\n      containerPort: 80\r\n    livenessProbe:\r\n      httpGet:\r\n        scheme: HTTP\r\n        port: 80\r\n        path: /hello\r\n  restartPolicy: Never # \u8bbe\u7f6e\u91cd\u542f\u7b56\u7565\u4e3aNever\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd0\u884cPod\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\r\npod/pod-restartpolicy created\r\n\r\n# \u67e5\u770bPod\u8be6\u60c5\uff0c\u53d1\u73b0nginx\u5bb9\u5668\u5931\u8d25\r\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\r\n......\r\n  Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\r\n  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe\r\n  \r\n# \u591a\u7b49\u4e00\u4f1a\uff0c\u518d\u89c2\u5bdfpod\u7684\u91cd\u542f\u6b21\u6570\uff0c\u53d1\u73b0\u4e00\u76f4\u662f0\uff0c\u5e76\u672a\u91cd\u542f   \r\n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\r\nNAME                   READY   STATUS    RESTARTS   AGE\r\npod-restartpolicy      0/1     Running   0          5min42s\n"})}),"\n",(0,s.jsx)(n.h3,{id:"54-pod\u8c03\u5ea6",children:"5.4 Pod\u8c03\u5ea6"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2aPod\u5728\u54ea\u4e2aNode\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u662f\u7531Scheduler\u7ec4\u4ef6\u91c7\u7528\u76f8\u5e94\u7684\u7b97\u6cd5\u8ba1\u7b97\u51fa\u6765\u7684\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4e0d\u53d7\u4eba\u5de5\u63a7\u5236\u7684\u3002\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u8fd9\u5e76\u4e0d\u6ee1\u8db3\u7684\u9700\u6c42\uff0c\u56e0\u4e3a\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u60f3\u63a7\u5236\u67d0\u4e9bPod\u5230\u8fbe\u67d0\u4e9b\u8282\u70b9\u4e0a\uff0c\u90a3\u4e48\u5e94\u8be5\u600e\u4e48\u505a\u5462\uff1f\u8fd9\u5c31\u8981\u6c42\u4e86\u89e3kubernetes\u5bf9Pod\u7684\u8c03\u5ea6\u89c4\u5219\uff0ckubernetes\u63d0\u4f9b\u4e86\u56db\u5927\u7c7b\u8c03\u5ea6\u65b9\u5f0f\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u81ea\u52a8\u8c03\u5ea6\uff1a\u8fd0\u884c\u5728\u54ea\u4e2a\u8282\u70b9\u4e0a\u5b8c\u5168\u7531Scheduler\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u7b97\u6cd5\u8ba1\u7b97\u5f97\u51fa"}),"\n",(0,s.jsx)(n.li,{children:"\u5b9a\u5411\u8c03\u5ea6\uff1aNodeName\u3001NodeSelector"}),"\n",(0,s.jsx)(n.li,{children:"\u4eb2\u548c\u6027\u8c03\u5ea6\uff1aNodeAffinity\u3001PodAffinity\u3001PodAntiAffinity"}),"\n",(0,s.jsx)(n.li,{children:"\u6c61\u70b9\uff08\u5bb9\u5fcd\uff09\u8c03\u5ea6\uff1aTaints\u3001Toleration"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"541-\u5b9a\u5411\u8c03\u5ea6",children:"5.4.1 \u5b9a\u5411\u8c03\u5ea6"}),"\n",(0,s.jsxs)(n.p,{children:["\u5b9a\u5411\u8c03\u5ea6\uff0c\u6307\u7684\u662f\u5229\u7528\u5728pod\u4e0a\u58f0\u660e",(0,s.jsx)(n.code,{children:"nodeNam"}),"\u6216\u8005",(0,s.jsx)(n.code,{children:"nodeSelector"}),"\uff0c\u4ee5\u6b64\u5c06Pod\u8c03\u5ea6\u5230\u671f\u671b\u7684node\u8282\u70b9\u4e0a\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u8c03\u5ea6\u662f\u5f3a\u5236\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5373\u4f7f\u8981\u8c03\u5ea6\u7684\u76ee\u6807Node\u4e0d\u5b58\u5728\uff0c\u4e5f\u4f1a\u5411\u4e0a\u9762\u8fdb\u884c\u8c03\u5ea6\uff0c\u53ea\u4e0d\u8fc7pod\u8fd0\u884c\u5931\u8d25\u800c\u5df2\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NodeName"})}),"\n",(0,s.jsx)(n.p,{children:"NodeName\u7528\u4e8e\u5f3a\u5236\u7ea6\u675f\u5c06Pod\u8c03\u5ea6\u5230\u6307\u5b9a\u7684Name\u7684Node\u8282\u70b9\u4e0a\u3002\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5176\u5b9e\u662f\u76f4\u63a5\u8df3\u8fc7Scheduler\u7684\u8c03\u5ea6\u903b\u8f91\uff0c\u76f4\u63a5\u5c06Pod\u8c03\u5ea6\u5230\u6307\u5b9a\u540d\u79f0\u7684\u8282\u70b9\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u5b9e\u9a8c\u4e00\u4e0b\uff1a\u521b\u5efa\u4e00\u4e2apod-nodename.yaml\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-nodename\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  nodeName: node1 # \u6307\u5b9a\u8c03\u5ea6\u5230node1\u8282\u70b9\u4e0a\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#\u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\r\npod/pod-nodename created\r\n\r\n#\u67e5\u770bPod\u8c03\u5ea6\u5230NODE\u5c5e\u6027\uff0c\u786e\u5b9e\u662f\u8c03\u5ea6\u5230\u4e86node1\u8282\u70b9\u4e0a\r\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\r\nNAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......\r\npod-nodename   1/1     Running   0          56s   10.244.1.87   node1     ......   \r\n\r\n# \u63a5\u4e0b\u6765\uff0c\u5220\u9664pod\uff0c\u4fee\u6539nodeName\u7684\u503c\u4e3anode3\uff08\u5e76\u6ca1\u6709node3\u8282\u70b9\uff09\r\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\r\npod "pod-nodename" deleted\r\n[root@k8s-master01 ~]# vim pod-nodename.yaml\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\r\npod/pod-nodename created\r\n\r\n#\u518d\u6b21\u67e5\u770b\uff0c\u53d1\u73b0\u5df2\u7ecf\u5411Node3\u8282\u70b9\u8c03\u5ea6\uff0c\u4f46\u662f\u7531\u4e8e\u4e0d\u5b58\u5728node3\u8282\u70b9\uff0c\u6240\u4ee5pod\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\r\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\r\nNAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......\r\npod-nodename   0/1     Pending   0          6s    <none>   node3   ......           \n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NodeSelector"})}),"\n",(0,s.jsx)(n.p,{children:"NodeSelector\u7528\u4e8e\u5c06pod\u8c03\u5ea6\u5230\u6dfb\u52a0\u4e86\u6307\u5b9a\u6807\u7b7e\u7684node\u8282\u70b9\u4e0a\u3002\u5b83\u662f\u901a\u8fc7kubernetes\u7684label-selector\u673a\u5236\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728pod\u521b\u5efa\u4e4b\u524d\uff0c\u4f1a\u7531scheduler\u4f7f\u7528MatchNodeSelector\u8c03\u5ea6\u7b56\u7565\u8fdb\u884clabel\u5339\u914d\uff0c\u627e\u51fa\u76ee\u6807node\uff0c\u7136\u540e\u5c06pod\u8c03\u5ea6\u5230\u76ee\u6807\u8282\u70b9\uff0c\u8be5\u5339\u914d\u89c4\u5219\u662f\u5f3a\u5236\u7ea6\u675f\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u5b9e\u9a8c\u4e00\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"1 \u9996\u5148\u5206\u522b\u4e3anode\u8282\u70b9\u6dfb\u52a0\u6807\u7b7e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro\r\nnode/node2 labeled\r\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test\r\nnode/node2 labeled\n"})}),"\n",(0,s.jsx)(n.p,{children:"2 \u521b\u5efa\u4e00\u4e2apod-nodeselector.yaml\u6587\u4ef6\uff0c\u5e76\u4f7f\u7528\u5b83\u521b\u5efaPod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-nodeselector\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  nodeSelector: \r\n    nodeenv: pro # \u6307\u5b9a\u8c03\u5ea6\u5230\u5177\u6709nodeenv=pro\u6807\u7b7e\u7684\u8282\u70b9\u4e0a\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#\u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\r\npod/pod-nodeselector created\r\n\r\n#\u67e5\u770bPod\u8c03\u5ea6\u5230NODE\u5c5e\u6027\uff0c\u786e\u5b9e\u662f\u8c03\u5ea6\u5230\u4e86node1\u8282\u70b9\u4e0a\r\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\r\nNAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......\r\npod-nodeselector   1/1     Running   0          47s   10.244.1.87   node1   ......\r\n\r\n# \u63a5\u4e0b\u6765\uff0c\u5220\u9664pod\uff0c\u4fee\u6539nodeSelector\u7684\u503c\u4e3anodeenv: xxxx\uff08\u4e0d\u5b58\u5728\u6253\u6709\u6b64\u6807\u7b7e\u7684\u8282\u70b9\uff09\r\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\r\npod "pod-nodeselector" deleted\r\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\r\npod/pod-nodeselector created\r\n\r\n#\u518d\u6b21\u67e5\u770b\uff0c\u53d1\u73b0pod\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c,Node\u7684\u503c\u4e3anone\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME               READY   STATUS    RESTARTS   AGE     IP       NODE    \r\npod-nodeselector   0/1     Pending   0          2m20s   <none>   <none>\r\n\r\n# \u67e5\u770b\u8be6\u60c5,\u53d1\u73b0node selector\u5339\u914d\u5931\u8d25\u7684\u63d0\u793a\r\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\r\n.......\r\nEvents:\r\n  Type     Reason            Age        From               Message\r\n  ----     ------            ----       ----               -------\r\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n'})}),"\n",(0,s.jsx)(n.h4,{id:"542-\u4eb2\u548c\u6027\u8c03\u5ea6",children:"5.4.2 \u4eb2\u548c\u6027\u8c03\u5ea6"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u4e00\u8282\uff0c\u4ecb\u7ecd\u4e86\u4e24\u79cd\u5b9a\u5411\u8c03\u5ea6\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u5b9a\u7684\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u5982\u679c\u6ca1\u6709\u6ee1\u8db3\u6761\u4ef6\u7684Node\uff0c\u90a3\u4e48Pod\u5c06\u4e0d\u4f1a\u88ab\u8fd0\u884c\uff0c\u5373\u4f7f\u5728\u96c6\u7fa4\u4e2d\u8fd8\u6709\u53ef\u7528Node\u5217\u8868\u4e5f\u4e0d\u884c\uff0c\u8fd9\u5c31\u9650\u5236\u4e86\u5b83\u7684\u4f7f\u7528\u573a\u666f\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u57fa\u4e8e\u4e0a\u9762\u7684\u95ee\u9898\uff0ckubernetes\u8fd8\u63d0\u4f9b\u4e86\u4e00\u79cd\u4eb2\u548c\u6027\u8c03\u5ea6\uff08Affinity\uff09\u3002\u5b83\u5728NodeSelector\u7684\u57fa\u7840\u4e4b\u4e0a\u7684\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u7684\u5f62\u5f0f\uff0c\u5b9e\u73b0\u4f18\u5148\u9009\u62e9\u6ee1\u8db3\u6761\u4ef6\u7684Node\u8fdb\u884c\u8c03\u5ea6\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e5f\u53ef\u4ee5\u8c03\u5ea6\u5230\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9\u4e0a\uff0c\u4f7f\u8c03\u5ea6\u66f4\u52a0\u7075\u6d3b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Affinity\u4e3b\u8981\u5206\u4e3a\u4e09\u7c7b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"nodeAffinity(node\u4eb2\u548c\u6027\uff09: \u4ee5node\u4e3a\u76ee\u6807\uff0c\u89e3\u51b3pod\u53ef\u4ee5\u8c03\u5ea6\u5230\u54ea\u4e9bnode\u7684\u95ee\u9898"}),"\n",(0,s.jsx)(n.li,{children:"podAffinity(pod\u4eb2\u548c\u6027) : \u4ee5pod\u4e3a\u76ee\u6807\uff0c\u89e3\u51b3pod\u53ef\u4ee5\u548c\u54ea\u4e9b\u5df2\u5b58\u5728\u7684pod\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u62d3\u6251\u57df\u4e2d\u7684\u95ee\u9898"}),"\n",(0,s.jsx)(n.li,{children:"podAntiAffinity(pod\u53cd\u4eb2\u548c\u6027) : \u4ee5pod\u4e3a\u76ee\u6807\uff0c\u89e3\u51b3pod\u4e0d\u80fd\u548c\u54ea\u4e9b\u5df2\u5b58\u5728pod\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u62d3\u6251\u57df\u4e2d\u7684\u95ee\u9898"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5173\u4e8e\u4eb2\u548c\u6027(\u53cd\u4eb2\u548c\u6027)\u4f7f\u7528\u573a\u666f\u7684\u8bf4\u660e\uff1a"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u4eb2\u548c\u6027"}),"\uff1a\u5982\u679c\u4e24\u4e2a\u5e94\u7528\u9891\u7e41\u4ea4\u4e92\uff0c\u90a3\u5c31\u6709\u5fc5\u8981\u5229\u7528\u4eb2\u548c\u6027\u8ba9\u4e24\u4e2a\u5e94\u7528\u7684\u5c3d\u53ef\u80fd\u7684\u9760\u8fd1\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u56e0\u7f51\u7edc\u901a\u4fe1\u800c\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u53cd\u4eb2\u548c\u6027"}),"\uff1a\u5f53\u5e94\u7528\u7684\u91c7\u7528\u591a\u526f\u672c\u90e8\u7f72\u65f6\uff0c\u6709\u5fc5\u8981\u91c7\u7528\u53cd\u4eb2\u548c\u6027\u8ba9\u5404\u4e2a\u5e94\u7528\u5b9e\u4f8b\u6253\u6563\u5206\u5e03\u5728\u5404\u4e2anode\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u670d\u52a1\u7684\u9ad8\u53ef\u7528\u6027\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NodeAffinity"})}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\u6765\u770b\u4e00\u4e0b",(0,s.jsx)(n.code,{children:"NodeAffinity"}),"\u7684\u53ef\u914d\u7f6e\u9879\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"pod.spec.affinity.nodeAffinity\r\n  requiredDuringSchedulingIgnoredDuringExecution  Node\u8282\u70b9\u5fc5\u987b\u6ee1\u8db3\u6307\u5b9a\u7684\u6240\u6709\u89c4\u5219\u624d\u53ef\u4ee5\uff0c\u76f8\u5f53\u4e8e\u786c\u9650\u5236\r\n    nodeSelectorTerms  \u8282\u70b9\u9009\u62e9\u5217\u8868\r\n      matchFields   \u6309\u8282\u70b9\u5b57\u6bb5\u5217\u51fa\u7684\u8282\u70b9\u9009\u62e9\u5668\u8981\u6c42\u5217\u8868\r\n      matchExpressions   \u6309\u8282\u70b9\u6807\u7b7e\u5217\u51fa\u7684\u8282\u70b9\u9009\u62e9\u5668\u8981\u6c42\u5217\u8868(\u63a8\u8350)\r\n        key    \u952e\r\n        values \u503c\r\n        operat or \u5173\u7cfb\u7b26 \u652f\u6301Exists, DoesNotExist, In, NotIn, Gt, Lt\r\n  preferredDuringSchedulingIgnoredDuringExecution \u4f18\u5148\u8c03\u5ea6\u5230\u6ee1\u8db3\u6307\u5b9a\u7684\u89c4\u5219\u7684Node\uff0c\u76f8\u5f53\u4e8e\u8f6f\u9650\u5236 (\u503e\u5411)\r\n    preference   \u4e00\u4e2a\u8282\u70b9\u9009\u62e9\u5668\u9879\uff0c\u4e0e\u76f8\u5e94\u7684\u6743\u91cd\u76f8\u5173\u8054\r\n      matchFields   \u6309\u8282\u70b9\u5b57\u6bb5\u5217\u51fa\u7684\u8282\u70b9\u9009\u62e9\u5668\u8981\u6c42\u5217\u8868\r\n      matchExpressions   \u6309\u8282\u70b9\u6807\u7b7e\u5217\u51fa\u7684\u8282\u70b9\u9009\u62e9\u5668\u8981\u6c42\u5217\u8868(\u63a8\u8350)\r\n        key    \u952e\r\n        values \u503c\r\n        operator \u5173\u7cfb\u7b26 \u652f\u6301In, NotIn, Exists, DoesNotExist, Gt, Lt\r\n\tweight \u503e\u5411\u6743\u91cd\uff0c\u5728\u8303\u56f41-100\u3002\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'\u5173\u7cfb\u7b26\u7684\u4f7f\u7528\u8bf4\u660e:\r\n\r\n- matchExpressions:\r\n  - key: nodeenv              # \u5339\u914d\u5b58\u5728\u6807\u7b7e\u7684key\u4e3anodeenv\u7684\u8282\u70b9\r\n    operator: Exists\r\n  - key: nodeenv              # \u5339\u914d\u6807\u7b7e\u7684key\u4e3anodeenv,\u4e14value\u662f"xxx"\u6216"yyy"\u7684\u8282\u70b9\r\n    operator: In\r\n    values: ["xxx","yyy"]\r\n  - key: nodeenv              # \u5339\u914d\u6807\u7b7e\u7684key\u4e3anodeenv,\u4e14value\u5927\u4e8e"xxx"\u7684\u8282\u70b9\r\n    operator: Gt\r\n    values: "xxx"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u9996\u5148\u6f14\u793a\u4e00\u4e0b",(0,s.jsx)(n.code,{children:"requiredDuringSchedulingIgnoredDuringExecution"})," ,"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-nodeaffinity-required.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-nodeaffinity-required\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  affinity:  #\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    nodeAffinity: #\u8bbe\u7f6enode\u4eb2\u548c\u6027\r\n      requiredDuringSchedulingIgnoredDuringExecution: # \u786c\u9650\u5236\r\n        nodeSelectorTerms:\r\n        - matchExpressions: # \u5339\u914denv\u7684\u503c\u5728["xxx","yyy"]\u4e2d\u7684\u6807\u7b7e\r\n          - key: nodeenv\r\n            operator: In\r\n            values: ["xxx","yyy"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\r\npod/pod-nodeaffinity-required created\r\n\r\n# \u67e5\u770bpod\u72b6\u6001 \uff08\u8fd0\u884c\u5931\u8d25\uff09\r\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\r\nNAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... \r\npod-nodeaffinity-required   0/1     Pending   0          16s   <none>   <none>  ......\r\n\r\n# \u67e5\u770bPod\u7684\u8be6\u60c5\r\n# \u53d1\u73b0\u8c03\u5ea6\u5931\u8d25\uff0c\u63d0\u793anode\u9009\u62e9\u5931\u8d25\r\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\r\n......\r\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\r\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\r\n\r\n#\u63a5\u4e0b\u6765\uff0c\u505c\u6b62pod\r\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\r\npod "pod-nodeaffinity-required" deleted\r\n\r\n# \u4fee\u6539\u6587\u4ef6\uff0c\u5c06values: ["xxx","yyy"]------\x3e ["pro","yyy"]\r\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\r\n\r\n# \u518d\u6b21\u542f\u52a8\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\r\npod/pod-nodeaffinity-required created\r\n\r\n# \u6b64\u65f6\u67e5\u770b\uff0c\u53d1\u73b0\u8c03\u5ea6\u6210\u529f\uff0c\u5df2\u7ecf\u5c06pod\u8c03\u5ea6\u5230\u4e86node1\u4e0a\r\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\r\nNAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... \r\npod-nodeaffinity-required   1/1     Running   0          11s   10.244.1.89   node1 ......\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u518d\u6f14\u793a\u4e00\u4e0b",(0,s.jsx)(n.code,{children:"requiredDuringSchedulingIgnoredDuringExecution"})," ,"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-nodeaffinity-preferred.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-nodeaffinity-preferred\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  affinity:  #\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    nodeAffinity: #\u8bbe\u7f6enode\u4eb2\u548c\u6027\r\n      preferredDuringSchedulingIgnoredDuringExecution: # \u8f6f\u9650\u5236\r\n      - weight: 1\r\n        preference:\r\n          matchExpressions: # \u5339\u914denv\u7684\u503c\u5728["xxx","yyy"]\u4e2d\u7684\u6807\u7b7e(\u5f53\u524d\u73af\u5883\u6ca1\u6709)\r\n          - key: nodeenv\r\n            operator: In\r\n            values: ["xxx","yyy"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\r\npod/pod-nodeaffinity-preferred created\r\n\r\n# \u67e5\u770bpod\u72b6\u6001 \uff08\u8fd0\u884c\u6210\u529f\uff09\r\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\r\nNAME                         READY   STATUS    RESTARTS   AGE\r\npod-nodeaffinity-preferred   1/1     Running   0          40s\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"NodeAffinity\u89c4\u5219\u8bbe\u7f6e\u7684\u6ce8\u610f\u4e8b\u9879\uff1a\r\n    1 \u5982\u679c\u540c\u65f6\u5b9a\u4e49\u4e86nodeSelector\u548cnodeAffinity\uff0c\u90a3\u4e48\u5fc5\u987b\u4e24\u4e2a\u6761\u4ef6\u90fd\u5f97\u5230\u6ee1\u8db3\uff0cPod\u624d\u80fd\u8fd0\u884c\u5728\u6307\u5b9a\u7684Node\u4e0a\r\n    2 \u5982\u679cnodeAffinity\u6307\u5b9a\u4e86\u591a\u4e2anodeSelectorTerms\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5176\u4e2d\u4e00\u4e2a\u80fd\u591f\u5339\u914d\u6210\u529f\u5373\u53ef\r\n    3 \u5982\u679c\u4e00\u4e2anodeSelectorTerms\u4e2d\u6709\u591a\u4e2amatchExpressions \uff0c\u5219\u4e00\u4e2a\u8282\u70b9\u5fc5\u987b\u6ee1\u8db3\u6240\u6709\u7684\u624d\u80fd\u5339\u914d\u6210\u529f\r\n    4 \u5982\u679c\u4e00\u4e2apod\u6240\u5728\u7684Node\u5728Pod\u8fd0\u884c\u671f\u95f4\u5176\u6807\u7b7e\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u4e0d\u518d\u7b26\u5408\u8be5Pod\u7684\u8282\u70b9\u4eb2\u548c\u6027\u9700\u6c42\uff0c\u5219\u7cfb\u7edf\u5c06\u5ffd\u7565\u6b64\u53d8\u5316\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"PodAffinity"})}),"\n",(0,s.jsx)(n.p,{children:"PodAffinity\u4e3b\u8981\u5b9e\u73b0\u4ee5\u8fd0\u884c\u7684Pod\u4e3a\u53c2\u7167\uff0c\u5b9e\u73b0\u8ba9\u65b0\u521b\u5efa\u7684Pod\u8ddf\u53c2\u7167pod\u5728\u4e00\u4e2a\u533a\u57df\u7684\u529f\u80fd\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\u6765\u770b\u4e00\u4e0b",(0,s.jsx)(n.code,{children:"PodAffinity"}),"\u7684\u53ef\u914d\u7f6e\u9879\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"pod.spec.affinity.podAffinity\r\n  requiredDuringSchedulingIgnoredDuringExecution  \u786c\u9650\u5236\r\n    namespaces       \u6307\u5b9a\u53c2\u7167pod\u7684namespace\r\n    topologyKey      \u6307\u5b9a\u8c03\u5ea6\u4f5c\u7528\u57df\r\n    labelSelector    \u6807\u7b7e\u9009\u62e9\u5668\r\n      matchExpressions  \u6309\u8282\u70b9\u6807\u7b7e\u5217\u51fa\u7684\u8282\u70b9\u9009\u62e9\u5668\u8981\u6c42\u5217\u8868(\u63a8\u8350)\r\n        key    \u952e\r\n        values \u503c\r\n        operator \u5173\u7cfb\u7b26 \u652f\u6301In, NotIn, Exists, DoesNotExist.\r\n      matchLabels    \u6307\u591a\u4e2amatchExpressions\u6620\u5c04\u7684\u5185\u5bb9\r\n  preferredDuringSchedulingIgnoredDuringExecution \u8f6f\u9650\u5236\r\n    podAffinityTerm  \u9009\u9879\r\n      namespaces      \r\n      topologyKey\r\n      labelSelector\r\n        matchExpressions  \r\n          key    \u952e\r\n          values \u503c\r\n          operator\r\n        matchLabels \r\n    weight \u503e\u5411\u6743\u91cd\uff0c\u5728\u8303\u56f41-100\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"topologyKey\u7528\u4e8e\u6307\u5b9a\u8c03\u5ea6\u65f6\u4f5c\u7528\u57df,\u4f8b\u5982:\r\n    \u5982\u679c\u6307\u5b9a\u4e3akubernetes.io/hostname\uff0c\u90a3\u5c31\u662f\u4ee5Node\u8282\u70b9\u4e3a\u533a\u5206\u8303\u56f4\r\n\t\u5982\u679c\u6307\u5b9a\u4e3abeta.kubernetes.io/os,\u5219\u4ee5Node\u8282\u70b9\u7684\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\u6765\u533a\u5206\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\uff0c\u6f14\u793a\u4e0b",(0,s.jsx)(n.code,{children:"requiredDuringSchedulingIgnoredDuringExecution"}),","]}),"\n",(0,s.jsx)(n.p,{children:"1\uff09\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u53c2\u7167Pod\uff0cpod-podaffinity-target.yaml\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-podaffinity-target\r\n  namespace: dev\r\n  labels:\r\n    podenv: pro #\u8bbe\u7f6e\u6807\u7b7e\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  nodeName: node1 # \u5c06\u76ee\u6807pod\u540d\u786e\u6307\u5b9a\u5230node1\u4e0a\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8\u76ee\u6807pod\r\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\r\npod/pod-podaffinity-target created\r\n\r\n# \u67e5\u770bpod\u72b6\u51b5\r\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\r\nNAME                     READY   STATUS    RESTARTS   AGE\r\npod-podaffinity-target   1/1     Running   0          4s\n"})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09\u521b\u5efapod-podaffinity-required.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-podaffinity-required\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  affinity:  #\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    podAffinity: #\u8bbe\u7f6epod\u4eb2\u548c\u6027\r\n      requiredDuringSchedulingIgnoredDuringExecution: # \u786c\u9650\u5236\r\n      - labelSelector:\r\n          matchExpressions: # \u5339\u914denv\u7684\u503c\u5728["xxx","yyy"]\u4e2d\u7684\u6807\u7b7e\r\n          - key: podenv\r\n            operator: In\r\n            values: ["xxx","yyy"]\r\n        topologyKey: kubernetes.io/hostname\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u914d\u7f6e\u8868\u8fbe\u7684\u610f\u601d\u662f\uff1a\u65b0Pod\u5fc5\u987b\u8981\u4e0e\u62e5\u6709\u6807\u7b7enodeenv=xxx\u6216\u8005nodeenv=yyy\u7684pod\u5728\u540c\u4e00Node\u4e0a\uff0c\u663e\u7136\u73b0\u5728\u6ca1\u6709\u8fd9\u6837pod\uff0c\u63a5\u4e0b\u6765\uff0c\u8fd0\u884c\u6d4b\u8bd5\u4e00\u4e0b\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u542f\u52a8pod\r\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\r\npod/pod-podaffinity-required created\r\n\r\n# \u67e5\u770bpod\u72b6\u6001\uff0c\u53d1\u73b0\u672a\u8fd0\u884c\r\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\r\nNAME                       READY   STATUS    RESTARTS   AGE\r\npod-podaffinity-required   0/1     Pending   0          9s\r\n\r\n# \u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\r\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\r\n......\r\nEvents:\r\n  Type     Reason            Age        From               Message\r\n  ----     ------            ----       ----               -------\r\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 2 node(s) didn\'t match pod affinity rules, 1 node(s) had taints that the pod didn\'t tolerate.\r\n\r\n# \u63a5\u4e0b\u6765\u4fee\u6539  values: ["xxx","yyy"]-----\x3evalues:["pro","yyy"]\r\n# \u610f\u601d\u662f\uff1a\u65b0Pod\u5fc5\u987b\u8981\u4e0e\u62e5\u6709\u6807\u7b7enodeenv=xxx\u6216\u8005nodeenv=yyy\u7684pod\u5728\u540c\u4e00Node\u4e0a\r\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\r\n\r\n# \u7136\u540e\u91cd\u65b0\u521b\u5efapod\uff0c\u67e5\u770b\u6548\u679c\r\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\r\npod "pod-podaffinity-required" de leted\r\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\r\npod/pod-podaffinity-required created\r\n\r\n# \u53d1\u73b0\u6b64\u65f6Pod\u8fd0\u884c\u6b63\u5e38\r\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\r\nNAME                       READY   STATUS    RESTARTS   AGE   LABELS\r\npod-podaffinity-required   1/1     Running   0          6s    <none>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5173\u4e8e",(0,s.jsx)(n.code,{children:"PodAffinity"}),"\u7684 ",(0,s.jsx)(n.code,{children:"preferredDuringSchedulingIgnoredDuringExecution"}),"\uff0c\u8fd9\u91cc\u4e0d\u518d\u6f14\u793a\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"PodAntiAffinity"})}),"\n",(0,s.jsx)(n.p,{children:"PodAntiAffinity\u4e3b\u8981\u5b9e\u73b0\u4ee5\u8fd0\u884c\u7684Pod\u4e3a\u53c2\u7167\uff0c\u8ba9\u65b0\u521b\u5efa\u7684Pod\u8ddf\u53c2\u7167pod\u4e0d\u5728\u4e00\u4e2a\u533a\u57df\u4e2d\u7684\u529f\u80fd\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5b83\u7684\u914d\u7f6e\u65b9\u5f0f\u548c\u9009\u9879\u8ddfPodAffinty\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u91cc\u4e0d\u518d\u505a\u8be6\u7ec6\u89e3\u91ca\uff0c\u76f4\u63a5\u505a\u4e00\u4e2a\u6d4b\u8bd5\u6848\u4f8b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"1\uff09\u7ee7\u7eed\u4f7f\u7528\u4e0a\u4e2a\u6848\u4f8b\u4e2d\u76ee\u6807pod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\r\nNAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS\r\npod-podaffinity-required 1/1     Running   0          3m29s   10.244.1.38   node1   <none>     \r\npod-podaffinity-target   1/1     Running   0          9m25s   10.244.1.37   node1   podenv=pro\n"})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09\u521b\u5efapod-podantiaffinity-required.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-podantiaffinity-required\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  affinity:  #\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    podAntiAffinity: #\u8bbe\u7f6epod\u4eb2\u548c\u6027\r\n      requiredDuringSchedulingIgnoredDuringExecution: # \u786c\u9650\u5236\r\n      - labelSelector:\r\n          matchExpressions: # \u5339\u914dpodenv\u7684\u503c\u5728["pro"]\u4e2d\u7684\u6807\u7b7e\r\n          - key: podenv\r\n            operator: In\r\n            values: ["pro"]\r\n        topologyKey: kubernetes.io/hostname\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u914d\u7f6e\u8868\u8fbe\u7684\u610f\u601d\u662f\uff1a\u65b0Pod\u5fc5\u987b\u8981\u4e0e\u62e5\u6709\u6807\u7b7enodeenv=pro\u7684pod\u4e0d\u5728\u540c\u4e00Node\u4e0a\uff0c\u8fd0\u884c\u6d4b\u8bd5\u4e00\u4e0b\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\r\npod/pod-podantiaffinity-required created\r\n\r\n# \u67e5\u770bpod\r\n# \u53d1\u73b0\u8c03\u5ea6\u5230\u4e86node2\u4e0a\r\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\r\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. \r\npod-podantiaffinity-required   1/1     Running   0          30s   10.244.1.96   node2  ..\n"})}),"\n",(0,s.jsx)(n.h4,{id:"543-\u6c61\u70b9\u548c\u5bb9\u5fcd",children:"5.4.3 \u6c61\u70b9\u548c\u5bb9\u5fcd"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6c61\u70b9\uff08Taints\uff09"})}),"\n",(0,s.jsxs)(n.p,{children:["\u524d\u9762\u7684\u8c03\u5ea6\u65b9\u5f0f\u90fd\u662f\u7ad9\u5728Pod\u7684\u89d2\u5ea6\u4e0a\uff0c\u901a\u8fc7\u5728Pod\u4e0a\u6dfb\u52a0\u5c5e\u6027\uff0c\u6765\u786e\u5b9aPod\u662f\u5426\u8981\u8c03\u5ea6\u5230\u6307\u5b9a\u7684Node\u4e0a\uff0c\u5176\u5b9e\u6211\u4eec\u4e5f\u53ef\u4ee5\u7ad9\u5728Node\u7684\u89d2\u5ea6\u4e0a\uff0c\u901a\u8fc7\u5728Node\u4e0a\u6dfb\u52a0",(0,s.jsx)(n.strong,{children:"\u6c61\u70b9"}),"\u5c5e\u6027\uff0c\u6765\u51b3\u5b9a\u662f\u5426\u5141\u8bb8Pod\u8c03\u5ea6\u8fc7\u6765\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"Node\u88ab\u8bbe\u7f6e\u4e0a\u6c61\u70b9\u4e4b\u540e\u5c31\u548cPod\u4e4b\u95f4\u5b58\u5728\u4e86\u4e00\u79cd\u76f8\u65a5\u7684\u5173\u7cfb\uff0c\u8fdb\u800c\u62d2\u7eddPod\u8c03\u5ea6\u8fdb\u6765\uff0c\u751a\u81f3\u53ef\u4ee5\u5c06\u5df2\u7ecf\u5b58\u5728\u7684Pod\u9a71\u9010\u51fa\u53bb\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u6c61\u70b9\u7684\u683c\u5f0f\u4e3a\uff1a",(0,s.jsx)(n.code,{children:"key=value:effect"}),", key\u548cvalue\u662f\u6c61\u70b9\u7684\u6807\u7b7e\uff0ceffect\u63cf\u8ff0\u6c61\u70b9\u7684\u4f5c\u7528\uff0c\u652f\u6301\u5982\u4e0b\u4e09\u4e2a\u9009\u9879\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PreferNoSchedule\uff1akubernetes\u5c06\u5c3d\u91cf\u907f\u514d\u628aPod\u8c03\u5ea6\u5230\u5177\u6709\u8be5\u6c61\u70b9\u7684Node\u4e0a\uff0c\u9664\u975e\u6ca1\u6709\u5176\u4ed6\u8282\u70b9\u53ef\u8c03\u5ea6"}),"\n",(0,s.jsx)(n.li,{children:"NoSchedule\uff1akubernetes\u5c06\u4e0d\u4f1a\u628aPod\u8c03\u5ea6\u5230\u5177\u6709\u8be5\u6c61\u70b9\u7684Node\u4e0a\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u5f53\u524dNode\u4e0a\u5df2\u5b58\u5728\u7684Pod"}),"\n",(0,s.jsx)(n.li,{children:"NoExecute\uff1akubernetes\u5c06\u4e0d\u4f1a\u628aPod\u8c03\u5ea6\u5230\u5177\u6709\u8be5\u6c61\u70b9\u7684Node\u4e0a\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06Node\u4e0a\u5df2\u5b58\u5728\u7684Pod\u9a71\u79bb"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200605021606508",src:r(144).A+"",width:"692",height:"147"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528kubectl\u8bbe\u7f6e\u548c\u53bb\u9664\u6c61\u70b9\u7684\u547d\u4ee4\u793a\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u8bbe\u7f6e\u6c61\u70b9\r\nkubectl taint nodes node1 key=value:effect\r\n\r\n# \u53bb\u9664\u6c61\u70b9\r\nkubectl taint nodes node1 key:effect-\r\n\r\n# \u53bb\u9664\u6240\u6709\u6c61\u70b9\r\nkubectl taint nodes node1 key-\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6f14\u793a\u4e0b\u6c61\u70b9\u7684\u6548\u679c\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u51c6\u5907\u8282\u70b9node1\uff08\u4e3a\u4e86\u6f14\u793a\u6548\u679c\u66f4\u52a0\u660e\u663e\uff0c\u6682\u65f6\u505c\u6b62node2\u8282\u70b9\uff09"}),"\n",(0,s.jsxs)(n.li,{children:["\u4e3anode1\u8282\u70b9\u8bbe\u7f6e\u4e00\u4e2a\u6c61\u70b9: ",(0,s.jsx)(n.code,{children:"tag=heima:PreferNoSchedule"}),"\uff1b\u7136\u540e\u521b\u5efapod1( pod1 \u53ef\u4ee5 )"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4fee\u6539\u4e3anode1\u8282\u70b9\u8bbe\u7f6e\u4e00\u4e2a\u6c61\u70b9: ",(0,s.jsx)(n.code,{children:"tag=heima:NoSchedule"}),"\uff1b\u7136\u540e\u521b\u5efapod2( pod1 \u6b63\u5e38 pod2 \u5931\u8d25 )"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4fee\u6539\u4e3anode1\u8282\u70b9\u8bbe\u7f6e\u4e00\u4e2a\u6c61\u70b9: ",(0,s.jsx)(n.code,{children:"tag=heima:NoExecute"}),"\uff1b\u7136\u540e\u521b\u5efapod3 ( 3\u4e2apod\u90fd\u5931\u8d25 )"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e3anode1\u8bbe\u7f6e\u6c61\u70b9(PreferNoSchedule)\r\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:PreferNoSchedule\r\n\r\n# \u521b\u5efapod1\r\n[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   \r\ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1    \r\n\r\n# \u4e3anode1\u8bbe\u7f6e\u6c61\u70b9(\u53d6\u6d88PreferNoSchedule\uff0c\u8bbe\u7f6eNoSchedule)\r\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-\r\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoSchedule\r\n\r\n# \u521b\u5efapod2\r\n[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev\r\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\r\nNAME                      READY   STATUS    RESTARTS   AGE     IP            NODE\r\ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1 \r\ntaint2-544694789-6zmlf    0/1     Pending   0          21s     <none>        <none>   \r\n\r\n# \u4e3anode1\u8bbe\u7f6e\u6c61\u70b9(\u53d6\u6d88NoSchedule\uff0c\u8bbe\u7f6eNoExecute)\r\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-\r\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoExecute\r\n\r\n# \u521b\u5efapod3\r\n[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \r\ntaint1-7665f7fd85-htkmp   0/1     Pending   0          35s   <none>   <none>   <none>    \r\ntaint2-544694789-bn7wb    0/1     Pending   0          35s   <none>   <none>   <none>     \r\ntaint3-6d78dbd749-tktkq   0/1     Pending   0          6s    <none>   <none>   <none>     \n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u5c0f\u63d0\u793a\uff1a\r\n    \u4f7f\u7528kubeadm\u642d\u5efa\u7684\u96c6\u7fa4\uff0c\u9ed8\u8ba4\u5c31\u4f1a\u7ed9master\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2a\u6c61\u70b9\u6807\u8bb0,\u6240\u4ee5pod\u5c31\u4e0d\u4f1a\u8c03\u5ea6\u5230master\u8282\u70b9\u4e0a.\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5bb9\u5fcd\uff08Toleration\uff09"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0a\u9762\u4ecb\u7ecd\u4e86\u6c61\u70b9\u7684\u4f5c\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5728node\u4e0a\u6dfb\u52a0\u6c61\u70b9\u7528\u4e8e\u62d2\u7eddpod\u8c03\u5ea6\u4e0a\u6765\uff0c\u4f46\u662f\u5982\u679c\u5c31\u662f\u60f3\u5c06\u4e00\u4e2apod\u8c03\u5ea6\u5230\u4e00\u4e2a\u6709\u6c61\u70b9\u7684node\u4e0a\u53bb\uff0c\u8fd9\u65f6\u5019\u5e94\u8be5\u600e\u4e48\u505a\u5462\uff1f\u8fd9\u5c31\u8981\u4f7f\u7528\u5230",(0,s.jsx)(n.strong,{children:"\u5bb9\u5fcd"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200514095913741",src:r(7131).A+"",width:"1019",height:"336"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u6c61\u70b9\u5c31\u662f\u62d2\u7edd\uff0c\u5bb9\u5fcd\u5c31\u662f\u5ffd\u7565\uff0cNode\u901a\u8fc7\u6c61\u70b9\u62d2\u7eddpod\u8c03\u5ea6\u4e0a\u53bb\uff0cPod\u901a\u8fc7\u5bb9\u5fcd\u5ffd\u7565\u62d2\u7edd"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u5148\u901a\u8fc7\u4e00\u4e2a\u6848\u4f8b\u770b\u4e0b\u6548\u679c\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e0a\u4e00\u5c0f\u8282\uff0c\u5df2\u7ecf\u5728node1\u8282\u70b9\u4e0a\u6253\u4e0a\u4e86",(0,s.jsx)(n.code,{children:"NoExecute"}),"\u7684\u6c61\u70b9\uff0c\u6b64\u65f6pod\u662f\u8c03\u5ea6\u4e0d\u4e0a\u53bb\u7684"]}),"\n",(0,s.jsx)(n.li,{children:"\u672c\u5c0f\u8282\uff0c\u53ef\u4ee5\u901a\u8fc7\u7ed9pod\u6dfb\u52a0\u5bb9\u5fcd\uff0c\u7136\u540e\u5c06\u5176\u8c03\u5ea6\u4e0a\u53bb"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod-toleration.yaml,\u5185\u5bb9\u5982\u4e0b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-toleration\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n  tolerations:      # \u6dfb\u52a0\u5bb9\u5fcd\r\n  - key: "tag"        # \u8981\u5bb9\u5fcd\u7684\u6c61\u70b9\u7684key\r\n    operator: "Equal" # \u64cd\u4f5c\u7b26\r\n    value: "heima"    # \u5bb9\u5fcd\u7684\u6c61\u70b9\u7684value\r\n    effect: "NoExecute"   # \u6dfb\u52a0\u5bb9\u5fcd\u7684\u89c4\u5219\uff0c\u8fd9\u91cc\u5fc5\u987b\u548c\u6807\u8bb0\u7684\u6c61\u70b9\u89c4\u5219\u76f8\u540c\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u6dfb\u52a0\u5bb9\u5fcd\u4e4b\u524d\u7684pod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \r\npod-toleration   0/1     Pending   0          3s    <none>   <none>   <none>           \r\n\r\n# \u6dfb\u52a0\u5bb9\u5fcd\u4e4b\u540e\u7684pod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED\r\npod-toleration   1/1     Running   0          3s    10.244.1.62   node1   <none>        \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u770b\u4e00\u4e0b\u5bb9\u5fcd\u7684\u8be6\u7ec6\u914d\u7f6e:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\r\n......\r\nFIELDS:\r\n   key       # \u5bf9\u5e94\u7740\u8981\u5bb9\u5fcd\u7684\u6c61\u70b9\u7684\u952e\uff0c\u7a7a\u610f\u5473\u7740\u5339\u914d\u6240\u6709\u7684\u952e\r\n   value     # \u5bf9\u5e94\u7740\u8981\u5bb9\u5fcd\u7684\u6c61\u70b9\u7684\u503c\r\n   operator  # key-value\u7684\u8fd0\u7b97\u7b26\uff0c\u652f\u6301Equal\u548cExists\uff08\u9ed8\u8ba4\uff09\r\n   effect    # \u5bf9\u5e94\u6c61\u70b9\u7684effect\uff0c\u7a7a\u610f\u5473\u7740\u5339\u914d\u6240\u6709\u5f71\u54cd\r\n   tolerationSeconds   # \u5bb9\u5fcd\u65f6\u95f4, \u5f53effect\u4e3aNoExecute\u65f6\u751f\u6548\uff0c\u8868\u793apod\u5728Node\u4e0a\u7684\u505c\u7559\u65f6\u95f4\n"})}),"\n",(0,s.jsx)(n.h2,{id:"6-pod\u63a7\u5236\u5668\u8be6\u89e3",children:"6. Pod\u63a7\u5236\u5668\u8be6\u89e3"}),"\n",(0,s.jsx)(n.h3,{id:"61-pod\u63a7\u5236\u5668\u4ecb\u7ecd",children:"6.1 Pod\u63a7\u5236\u5668\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"Pod\u662fkubernetes\u7684\u6700\u5c0f\u7ba1\u7406\u5355\u5143\uff0c\u5728kubernetes\u4e2d\uff0c\u6309\u7167pod\u7684\u521b\u5efa\u65b9\u5f0f\u53ef\u4ee5\u5c06\u5176\u5206\u4e3a\u4e24\u7c7b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u81ea\u4e3b\u5f0fpod\uff1akubernetes\u76f4\u63a5\u521b\u5efa\u51fa\u6765\u7684Pod\uff0c\u8fd9\u79cdpod\u5220\u9664\u540e\u5c31\u6ca1\u6709\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u91cd\u5efa"}),"\n",(0,s.jsx)(n.li,{children:"\u63a7\u5236\u5668\u521b\u5efa\u7684pod\uff1akubernetes\u901a\u8fc7\u63a7\u5236\u5668\u521b\u5efa\u7684pod\uff0c\u8fd9\u79cdpod\u5220\u9664\u4e86\u4e4b\u540e\u8fd8\u4f1a\u81ea\u52a8\u91cd\u5efa"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"\u4ec0\u4e48\u662fPod\u63a7\u5236\u5668"})})}),"\n",(0,s.jsx)(n.p,{children:"Pod\u63a7\u5236\u5668\u662f\u7ba1\u7406pod\u7684\u4e2d\u95f4\u5c42\uff0c\u4f7f\u7528Pod\u63a7\u5236\u5668\u4e4b\u540e\uff0c\u53ea\u9700\u8981\u544a\u8bc9Pod\u63a7\u5236\u5668\uff0c\u60f3\u8981\u591a\u5c11\u4e2a\u4ec0\u4e48\u6837\u7684Pod\u5c31\u53ef\u4ee5\u4e86\uff0c\u5b83\u4f1a\u521b\u5efa\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684Pod\u5e76\u786e\u4fdd\u6bcf\u4e00\u4e2aPod\u8d44\u6e90\u5904\u4e8e\u7528\u6237\u671f\u671b\u7684\u76ee\u6807\u72b6\u6001\u3002\u5982\u679cPod\u8d44\u6e90\u5728\u8fd0\u884c\u4e2d\u51fa\u73b0\u6545\u969c\uff0c\u5b83\u4f1a\u57fa\u4e8e\u6307\u5b9a\u7b56\u7565\u91cd\u65b0\u7f16\u6392Pod\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\uff0c\u6709\u5f88\u591a\u7c7b\u578b\u7684pod\u63a7\u5236\u5668\uff0c\u6bcf\u79cd\u90fd\u6709\u81ea\u5df1\u7684\u9002\u5408\u7684\u573a\u666f\uff0c\u5e38\u89c1\u7684\u6709\u4e0b\u9762\u8fd9\u4e9b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.del,{children:"ReplicationController"}),"\uff1a\u6bd4\u8f83\u539f\u59cb\u7684pod\u63a7\u5236\u5668\uff0c\u5df2\u7ecf\u88ab\u5e9f\u5f03\uff0c\u7531ReplicaSet\u66ff\u4ee3"]}),"\n",(0,s.jsx)(n.li,{children:"ReplicaSet\uff1a\u4fdd\u8bc1\u526f\u672c\u6570\u91cf\u4e00\u76f4\u7ef4\u6301\u5728\u671f\u671b\u503c\uff0c\u5e76\u652f\u6301pod\u6570\u91cf\u6269\u7f29\u5bb9\uff0c\u955c\u50cf\u7248\u672c\u5347\u7ea7"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deployment"}),"\uff1a\u901a\u8fc7\u63a7\u5236ReplicaSet\u6765\u63a7\u5236Pod\uff0c\u5e76\u652f\u6301\u6eda\u52a8\u5347\u7ea7\u3001\u56de\u9000\u7248\u672c"]}),"\n",(0,s.jsx)(n.li,{children:"Horizontal Pod Autoscaler\uff1a\u53ef\u4ee5\u6839\u636e\u96c6\u7fa4\u8d1f\u8f7d\u81ea\u52a8\u6c34\u5e73\u8c03\u6574Pod\u7684\u6570\u91cf\uff0c\u5b9e\u73b0\u524a\u5cf0\u586b\u8c37"}),"\n",(0,s.jsx)(n.li,{children:"DaemonSet\uff1a\u5728\u96c6\u7fa4\u4e2d\u7684\u6307\u5b9aNode\u4e0a\u8fd0\u884c\u4e14\u4ec5\u8fd0\u884c\u4e00\u4e2a\u526f\u672c\uff0c\u4e00\u822c\u7528\u4e8e\u5b88\u62a4\u8fdb\u7a0b\u7c7b\u7684\u4efb\u52a1"}),"\n",(0,s.jsx)(n.li,{children:"Job\uff1a\u5b83\u521b\u5efa\u51fa\u6765\u7684pod\u53ea\u8981\u5b8c\u6210\u4efb\u52a1\u5c31\u7acb\u5373\u9000\u51fa\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u6216\u91cd\u5efa\uff0c\u7528\u4e8e\u6267\u884c\u4e00\u6b21\u6027\u4efb\u52a1"}),"\n",(0,s.jsx)(n.li,{children:"Cronjob\uff1a\u5b83\u521b\u5efa\u7684Pod\u8d1f\u8d23\u5468\u671f\u6027\u4efb\u52a1\u63a7\u5236\uff0c\u4e0d\u9700\u8981\u6301\u7eed\u540e\u53f0\u8fd0\u884c"}),"\n",(0,s.jsx)(n.li,{children:"StatefulSet\uff1a\u7ba1\u7406\u6709\u72b6\u6001\u5e94\u7528"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"62-replicasetrs",children:"6.2 ReplicaSet(RS)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ReplicaSet"}),"\u7684\u4e3b\u8981\u4f5c\u7528\u662f",(0,s.jsx)(n.strong,{children:"\u4fdd\u8bc1\u4e00\u5b9a\u6570\u91cf\u7684pod\u6b63\u5e38\u8fd0\u884c"}),"\uff0c\u5b83\u4f1a\u6301\u7eed\u76d1\u542c\u8fd9\u4e9bPod\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u4e00\u65e6Pod\u53d1\u751f\u6545\u969c\uff0c\u5c31\u4f1a\u91cd\u542f\u6216\u91cd\u5efa\u3002\u540c\u65f6\u5b83\u8fd8\u652f\u6301\u5bf9pod\u6570\u91cf\u7684",(0,s.jsx)(n.strong,{children:"\u6269\u7f29\u5bb9"}),"\u548c\u955c\u50cf\u7248\u672c\u7684",(0,s.jsx)(n.strong,{children:"\u5347\u964d\u7ea7"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(1171).A+"",width:"600",height:"185"})}),"\n",(0,s.jsx)(n.p,{children:"ReplicaSet\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1 # \u7248\u672c\u53f7\r\nkind: ReplicaSet # \u7c7b\u578b       \r\nmetadata: # \u5143\u6570\u636e\r\n  name: # rs\u540d\u79f0 \r\n  namespace: # \u6240\u5c5e\u547d\u540d\u7a7a\u95f4 \r\n  labels: #\u6807\u7b7e\r\n    controller: rs\r\nspec: # \u8be6\u60c5\u63cf\u8ff0\r\n  replicas: 3 # \u526f\u672c\u6570\u91cf\r\n  selector: # \u9009\u62e9\u5668\uff0c\u901a\u8fc7\u5b83\u6307\u5b9a\u8be5\u63a7\u5236\u5668\u7ba1\u7406\u54ea\u4e9bpod\r\n    matchLabels:      # Labels\u5339\u914d\u89c4\u5219\r\n      app: nginx-pod\r\n    matchExpressions: # Expressions\u5339\u914d\u89c4\u5219\r\n      - {key: app, operator: In, values: [nginx-pod]}\r\n  template: # \u6a21\u677f\uff0c\u5f53\u526f\u672c\u6570\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f1a\u6839\u636e\u4e0b\u9762\u7684\u6a21\u677f\u521b\u5efapod\u526f\u672c\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        ports:\r\n        - containerPort: 80\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u8fd9\u91cc\u9762\uff0c\u9700\u8981\u65b0\u4e86\u89e3\u7684\u914d\u7f6e\u9879\u5c31\u662f",(0,s.jsx)(n.code,{children:"spec"}),"\u4e0b\u9762\u51e0\u4e2a\u9009\u9879\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"replicas\uff1a\u6307\u5b9a\u526f\u672c\u6570\u91cf\uff0c\u5176\u5b9e\u5c31\u662f\u5f53\u524drs\u521b\u5efa\u51fa\u6765\u7684pod\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a1"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"selector\uff1a\u9009\u62e9\u5668\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5efa\u7acbpod\u63a7\u5236\u5668\u548cpod\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u91c7\u7528\u7684Label Selector\u673a\u5236"}),"\n",(0,s.jsx)(n.p,{children:"\u5728pod\u6a21\u677f\u4e0a\u5b9a\u4e49label\uff0c\u5728\u63a7\u5236\u5668\u4e0a\u5b9a\u4e49\u9009\u62e9\u5668\uff0c\u5c31\u53ef\u4ee5\u8868\u660e\u5f53\u524d\u63a7\u5236\u5668\u80fd\u7ba1\u7406\u54ea\u4e9bpod\u4e86"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"template\uff1a\u6a21\u677f\uff0c\u5c31\u662f\u5f53\u524d\u63a7\u5236\u5668\u521b\u5efapod\u6240\u4f7f\u7528\u7684\u6a21\u677f\u677f\uff0c\u91cc\u9762\u5176\u5b9e\u5c31\u662f\u524d\u4e00\u7ae0\u5b66\u8fc7\u7684pod\u7684\u5b9a\u4e49"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u521b\u5efaReplicaSet"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-replicaset.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: ReplicaSet   \r\nmetadata:\r\n  name: pc-replicaset\r\n  namespace: dev\r\nspec:\r\n  replicas: 3\r\n  selector: \r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efars\r\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\r\nreplicaset.apps/pc-replicaset created\r\n\r\n# \u67e5\u770brs\r\n# DESIRED:\u671f\u671b\u526f\u672c\u6570\u91cf  \r\n# CURRENT:\u5f53\u524d\u526f\u672c\u6570\u91cf  \r\n# READY:\u5df2\u7ecf\u51c6\u5907\u597d\u63d0\u4f9b\u670d\u52a1\u7684\u526f\u672c\u6570\u91cf\r\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\r\nNAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR\r\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod\r\n\r\n# \u67e5\u770b\u5f53\u524d\u63a7\u5236\u5668\u521b\u5efa\u51fa\u6765\u7684pod\r\n# \u8fd9\u91cc\u53d1\u73b0\u63a7\u5236\u5668\u521b\u5efa\u51fa\u6765\u7684pod\u7684\u540d\u79f0\u662f\u5728\u63a7\u5236\u5668\u540d\u79f0\u540e\u9762\u62fc\u63a5\u4e86-xxxxx\u968f\u673a\u7801\r\n[root@k8s-master01 ~]# kubectl get pod -n dev\r\nNAME                          READY   STATUS    RESTARTS   AGE\r\npc-replicaset-6vmvt   1/1     Running   0          54s\r\npc-replicaset-fmb8f   1/1     Running   0          54s\r\npc-replicaset-snrk2   1/1     Running   0          54s\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6269\u7f29\u5bb9"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u7f16\u8f91rs\u7684\u526f\u672c\u6570\u91cf\uff0c\u4fee\u6539spec:replicas: 6\u5373\u53ef\r\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\r\nreplicaset.apps/pc-replicaset edited\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                          READY   STATUS    RESTARTS   AGE\r\npc-replicaset-6vmvt   1/1     Running   0          114m\r\npc-replicaset-cftnp   1/1     Running   0          10s\r\npc-replicaset-fjlm6   1/1     Running   0          10s\r\npc-replicaset-fmb8f   1/1     Running   0          114m\r\npc-replicaset-s2whj   1/1     Running   0          10s\r\npc-replicaset-snrk2   1/1     Running   0          114m\r\n\r\n# \u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u5b9e\u73b0\r\n# \u4f7f\u7528scale\u547d\u4ee4\u5b9e\u73b0\u6269\u7f29\u5bb9\uff0c \u540e\u9762--replicas=n\u76f4\u63a5\u6307\u5b9a\u76ee\u6807\u6570\u91cf\u5373\u53ef\r\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev\r\nreplicaset.apps/pc-replicaset scaled\r\n\r\n# \u547d\u4ee4\u8fd0\u884c\u5b8c\u6bd5\uff0c\u7acb\u5373\u67e5\u770b\uff0c\u53d1\u73b0\u5df2\u7ecf\u67094\u4e2a\u5f00\u59cb\u51c6\u5907\u9000\u51fa\u4e86\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                       READY   STATUS        RESTARTS   AGE\r\npc-replicaset-6vmvt   0/1     Terminating   0          118m\r\npc-replicaset-cftnp   0/1     Terminating   0          4m17s\r\npc-replicaset-fjlm6   0/1     Terminating   0          4m17s\r\npc-replicaset-fmb8f   1/1     Running       0          118m\r\npc-replicaset-s2whj   0/1     Terminating   0          4m17s\r\npc-replicaset-snrk2   1/1     Running       0          118m\r\n\r\n#\u7a0d\u7b49\u7247\u523b\uff0c\u5c31\u53ea\u5269\u4e0b2\u4e2a\u4e86\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                       READY   STATUS    RESTARTS   AGE\r\npc-replicaset-fmb8f   1/1     Running   0          119m\r\npc-replicaset-snrk2   1/1     Running   0          119m\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u955c\u50cf\u5347\u7ea7"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u7f16\u8f91rs\u7684\u5bb9\u5668\u955c\u50cf - image: nginx:1.17.2\r\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\r\nreplicaset.apps/pc-replicaset edited\r\n\r\n# \u518d\u6b21\u67e5\u770b\uff0c\u53d1\u73b0\u955c\u50cf\u7248\u672c\u5df2\u7ecf\u53d8\u66f4\u4e86\r\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\r\nNAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...\r\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\r\n\r\n# \u540c\u6837\u7684\u9053\u7406\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u5b8c\u6210\u8fd9\u4e2a\u5de5\u4f5c\r\n# kubectl set image rs rs\u540d\u79f0 \u5bb9\u5668=\u955c\u50cf\u7248\u672c -n namespace\r\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev\r\nreplicaset.apps/pc-replicaset image updated\r\n\r\n# \u518d\u6b21\u67e5\u770b\uff0c\u53d1\u73b0\u955c\u50cf\u7248\u672c\u5df2\u7ecf\u53d8\u66f4\u4e86\r\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\r\nNAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...\r\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5220\u9664ReplicaSet"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u4f7f\u7528kubectl delete\u547d\u4ee4\u4f1a\u5220\u9664\u6b64RS\u4ee5\u53ca\u5b83\u7ba1\u7406\u7684Pod\r\n# \u5728kubernetes\u5220\u9664RS\u524d\uff0c\u4f1a\u5c06RS\u7684replicasclear\u8c03\u6574\u4e3a0\uff0c\u7b49\u5f85\u6240\u6709\u7684Pod\u88ab\u5220\u9664\u540e\uff0c\u5728\u6267\u884cRS\u5bf9\u8c61\u7684\u5220\u9664\r\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\r\nreplicaset.apps "pc-replicaset" deleted\r\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\r\nNo resources found in dev namespace.\r\n\r\n# \u5982\u679c\u5e0c\u671b\u4ec5\u4ec5\u5220\u9664RS\u5bf9\u8c61\uff08\u4fdd\u7559Pod\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528kubectl delete\u547d\u4ee4\u65f6\u6dfb\u52a0--cascade=false\u9009\u9879\uff08\u4e0d\u63a8\u8350\uff09\u3002\r\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false\r\nreplicaset.apps "pc-replicaset" deleted\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                  READY   STATUS    RESTARTS   AGE\r\npc-replicaset-cl82j   1/1     Running   0          75s\r\npc-replicaset-dslhb   1/1     Running   0          75s\r\n\r\n# \u4e5f\u53ef\u4ee5\u4f7f\u7528yaml\u76f4\u63a5\u5220\u9664(\u63a8\u8350)\r\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\r\nreplicaset.apps "pc-replicaset" deleted\n'})}),"\n",(0,s.jsx)(n.h3,{id:"63-deploymentdeploy",children:"6.3 Deployment(Deploy)"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u66f4\u597d\u7684\u89e3\u51b3\u670d\u52a1\u7f16\u6392\u7684\u95ee\u9898\uff0ckubernetes\u5728V1.2\u7248\u672c\u5f00\u59cb\uff0c\u5f15\u5165\u4e86Deployment\u63a7\u5236\u5668\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u8fd9\u79cd\u63a7\u5236\u5668\u5e76\u4e0d\u76f4\u63a5\u7ba1\u7406pod\uff0c\u800c\u662f\u901a\u8fc7\u7ba1\u7406ReplicaSet\u6765\u7b80\u4ecb\u7ba1\u7406Pod\uff0c\u5373\uff1aDeployment\u7ba1\u7406ReplicaSet\uff0cReplicaSet\u7ba1\u7406Pod\u3002\u6240\u4ee5Deployment\u6bd4ReplicaSet\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(6597).A+"",width:"608",height:"206"})}),"\n",(0,s.jsx)(n.p,{children:"Deployment\u4e3b\u8981\u529f\u80fd\u6709\u4e0b\u9762\u51e0\u4e2a\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u652f\u6301ReplicaSet\u7684\u6240\u6709\u529f\u80fd"}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301\u53d1\u5e03\u7684\u505c\u6b62\u3001\u7ee7\u7eed"}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301\u6eda\u52a8\u5347\u7ea7\u548c\u56de\u6eda\u7248\u672c"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Deployment\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1 # \u7248\u672c\u53f7\r\nkind: Deployment # \u7c7b\u578b       \r\nmetadata: # \u5143\u6570\u636e\r\n  name: # rs\u540d\u79f0 \r\n  namespace: # \u6240\u5c5e\u547d\u540d\u7a7a\u95f4 \r\n  labels: #\u6807\u7b7e\r\n    controller: deploy\r\nspec: # \u8be6\u60c5\u63cf\u8ff0\r\n  replicas: 3 # \u526f\u672c\u6570\u91cf\r\n  revisionHistoryLimit: 3 # \u4fdd\u7559\u5386\u53f2\u7248\u672c\r\n  paused: false # \u6682\u505c\u90e8\u7f72\uff0c\u9ed8\u8ba4\u662ffalse\r\n  progressDeadlineSeconds: 600 # \u90e8\u7f72\u8d85\u65f6\u65f6\u95f4\uff08s\uff09\uff0c\u9ed8\u8ba4\u662f600\r\n  strategy: # \u7b56\u7565\r\n    type: RollingUpdate # \u6eda\u52a8\u66f4\u65b0\u7b56\u7565\r\n    rollingUpdate: # \u6eda\u52a8\u66f4\u65b0\r\n      maxSurge: 30% # \u6700\u5927\u989d\u5916\u53ef\u4ee5\u5b58\u5728\u7684\u526f\u672c\u6570\uff0c\u53ef\u4ee5\u4e3a\u767e\u5206\u6bd4\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u6574\u6570\r\n      maxUnavailable: 30% # \u6700\u5927\u4e0d\u53ef\u7528\u72b6\u6001\u7684 Pod \u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u4e3a\u767e\u5206\u6bd4\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u6574\u6570\r\n  selector: # \u9009\u62e9\u5668\uff0c\u901a\u8fc7\u5b83\u6307\u5b9a\u8be5\u63a7\u5236\u5668\u7ba1\u7406\u54ea\u4e9bpod\r\n    matchLabels:      # Labels\u5339\u914d\u89c4\u5219\r\n      app: nginx-pod\r\n    matchExpressions: # Expressions\u5339\u914d\u89c4\u5219\r\n      - {key: app, operator: In, values: [nginx-pod]}\r\n  template: # \u6a21\u677f\uff0c\u5f53\u526f\u672c\u6570\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f1a\u6839\u636e\u4e0b\u9762\u7684\u6a21\u677f\u521b\u5efapod\u526f\u672c\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        ports:\r\n        - containerPort: 80\n"})}),"\n",(0,s.jsx)(n.h4,{id:"631-\u521b\u5efadeployment",children:"6.3.1 \u521b\u5efadeployment"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-deployment.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment      \r\nmetadata:\r\n  name: pc-deployment\r\n  namespace: dev\r\nspec: \r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efadeployment\r\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true\r\ndeployment.apps/pc-deployment created\r\n\r\n# \u67e5\u770bdeployment\r\n# UP-TO-DATE \u6700\u65b0\u7248\u672c\u7684pod\u7684\u6570\u91cf\r\n# AVAILABLE  \u5f53\u524d\u53ef\u7528\u7684pod\u7684\u6570\u91cf\r\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\r\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\r\npc-deployment   3/3     3            3           15s\r\n\r\n# \u67e5\u770brs\r\n# \u53d1\u73b0rs\u7684\u540d\u79f0\u662f\u5728\u539f\u6765deployment\u7684\u540d\u5b57\u540e\u9762\u6dfb\u52a0\u4e86\u4e00\u4e2a10\u4f4d\u6570\u7684\u968f\u673a\u4e32\r\n[root@k8s-master01 ~]# kubectl get rs -n dev\r\nNAME                       DESIRED   CURRENT   READY   AGE\r\npc-deployment-6696798b78   3         3         3       23s\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-6696798b78-d2c8n   1/1     Running   0          107s\r\npc-deployment-6696798b78-smpvp   1/1     Running   0          107s\r\npc-deployment-6696798b78-wvjd8   1/1     Running   0          107s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"632-\u6269\u7f29\u5bb9",children:"6.3.2 \u6269\u7f29\u5bb9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u53d8\u66f4\u526f\u672c\u6570\u91cf\u4e3a5\u4e2a\r\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev\r\ndeployment.apps/pc-deployment scaled\r\n\r\n# \u67e5\u770bdeployment\r\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\r\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\r\npc-deployment   5/5     5            5           2m\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]#  kubectl get pods -n dev\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s\r\npc-deployment-6696798b78-jxmdq   1/1     Running   0          94s\r\npc-deployment-6696798b78-mktqv   1/1     Running   0          93s\r\npc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s\r\npc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s\r\n\r\n# \u7f16\u8f91deployment\u7684\u526f\u672c\u6570\u91cf\uff0c\u4fee\u6539spec:replicas: 4\u5373\u53ef\r\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\r\ndeployment.apps/pc-deployment edited\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s\r\npc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s\r\npc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s\r\npc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u955c\u50cf\u66f4\u65b0"})}),"\n",(0,s.jsxs)(n.p,{children:["deployment\u652f\u6301\u4e24\u79cd\u66f4\u65b0\u7b56\u7565:",(0,s.jsx)(n.code,{children:"\u91cd\u5efa\u66f4\u65b0"}),"\u548c",(0,s.jsx)(n.code,{children:"\u6eda\u52a8\u66f4\u65b0"}),",\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"strategy"}),"\u6307\u5b9a\u7b56\u7565\u7c7b\u578b,\u652f\u6301\u4e24\u4e2a\u5c5e\u6027:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"strategy\uff1a\u6307\u5b9a\u65b0\u7684Pod\u66ff\u6362\u65e7\u7684Pod\u7684\u7b56\u7565\uff0c \u652f\u6301\u4e24\u4e2a\u5c5e\u6027\uff1a\r\n  type\uff1a\u6307\u5b9a\u7b56\u7565\u7c7b\u578b\uff0c\u652f\u6301\u4e24\u79cd\u7b56\u7565\r\n    Recreate\uff1a\u5728\u521b\u5efa\u51fa\u65b0\u7684Pod\u4e4b\u524d\u4f1a\u5148\u6740\u6389\u6240\u6709\u5df2\u5b58\u5728\u7684Pod\r\n    RollingUpdate\uff1a\u6eda\u52a8\u66f4\u65b0\uff0c\u5c31\u662f\u6740\u6b7b\u4e00\u90e8\u5206\uff0c\u5c31\u542f\u52a8\u4e00\u90e8\u5206\uff0c\u5728\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728\u4e24\u4e2a\u7248\u672cPod\r\n  rollingUpdate\uff1a\u5f53type\u4e3aRollingUpdate\u65f6\u751f\u6548\uff0c\u7528\u4e8e\u4e3aRollingUpdate\u8bbe\u7f6e\u53c2\u6570\uff0c\u652f\u6301\u4e24\u4e2a\u5c5e\u6027\uff1a\r\n    maxUnavailable\uff1a\u7528\u6765\u6307\u5b9a\u5728\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u4e0d\u53ef\u7528Pod\u7684\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a25%\u3002\r\n    maxSurge\uff1a \u7528\u6765\u6307\u5b9a\u5728\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u8d85\u8fc7\u671f\u671b\u7684Pod\u7684\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a25%\u3002\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u5efa\u66f4\u65b0"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u7f16\u8f91pc-deployment.yaml,\u5728spec\u8282\u70b9\u4e0b\u6dfb\u52a0\u66f4\u65b0\u7b56\u7565"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spec:\r\n  strategy: # \u7b56\u7565\r\n    type: Recreate # \u91cd\u5efa\u66f4\u65b0\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efadeploy\u8fdb\u884c\u9a8c\u8bc1"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u53d8\u66f4\u955c\u50cf\r\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev\r\ndeployment.apps/pc-deployment image updated\r\n\r\n# \u89c2\u5bdf\u5347\u7ea7\u8fc7\u7a0b\r\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s\r\npc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s\r\npc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s\r\n\r\npc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s\r\npc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s\r\npc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s\r\n\r\npc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s\r\npc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s\r\npc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s\r\n\r\npc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s\r\npc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s\r\npc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s\r\n\r\npc-deployment-675d469f8b-grn8z   1/1     Running             0          1s\r\npc-deployment-675d469f8b-67nz2   1/1     Running             0          1s\r\npc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6eda\u52a8\u66f4\u65b0"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u7f16\u8f91pc-deployment.yaml,\u5728spec\u8282\u70b9\u4e0b\u6dfb\u52a0\u66f4\u65b0\u7b56\u7565"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spec:\r\n  strategy: # \u7b56\u7565\r\n    type: RollingUpdate # \u6eda\u52a8\u66f4\u65b0\u7b56\u7565\r\n    rollingUpdate:\r\n      maxSurge: 25% \r\n      maxUnavailable: 25%\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efadeploy\u8fdb\u884c\u9a8c\u8bc1"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u53d8\u66f4\u955c\u50cf\r\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev \r\ndeployment.apps/pc-deployment image updated\r\n\r\n# \u89c2\u5bdf\u5347\u7ea7\u8fc7\u7a0b\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\r\nNAME                           READY   STATUS    RESTARTS   AGE\r\npc-deployment-c848d767-8rbzt   1/1     Running   0          31m\r\npc-deployment-c848d767-h4p68   1/1     Running   0          31m\r\npc-deployment-c848d767-hlmz4   1/1     Running   0          31m\r\npc-deployment-c848d767-rrqcn   1/1     Running   0          31m\r\n\r\npc-deployment-966bf7f44-226rx   0/1     Pending             0          0s\r\npc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s\r\npc-deployment-966bf7f44-226rx   1/1     Running             0          1s\r\npc-deployment-c848d767-h4p68    0/1     Terminating         0          34m\r\n\r\npc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s\r\npc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s\r\npc-deployment-966bf7f44-cnd44   1/1     Running             0          2s\r\npc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m\r\n\r\npc-deployment-966bf7f44-px48p   0/1     Pending             0          0s\r\npc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s\r\npc-deployment-966bf7f44-px48p   1/1     Running             0          0s\r\npc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m\r\n\r\npc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s\r\npc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s\r\npc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s\r\npc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m\r\n\r\n# \u81f3\u6b64\uff0c\u65b0\u7248\u672c\u7684pod\u521b\u5efa\u5b8c\u6bd5\uff0c\u5c31\u7248\u672c\u7684pod\u9500\u6bc1\u5b8c\u6bd5\r\n# \u4e2d\u95f4\u8fc7\u7a0b\u662f\u6eda\u52a8\u8fdb\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u8fb9\u9500\u6bc1\u8fb9\u521b\u5efa\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6eda\u52a8\u66f4\u65b0\u7684\u8fc7\u7a0b\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(322).A+"",width:"1118",height:"527"})}),"\n",(0,s.jsx)(n.p,{children:"\u955c\u50cf\u66f4\u65b0\u4e2drs\u7684\u53d8\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770brs,\u53d1\u73b0\u539f\u6765\u7684rs\u7684\u4f9d\u65e7\u5b58\u5728\uff0c\u53ea\u662fpod\u6570\u91cf\u53d8\u4e3a\u4e860\uff0c\u800c\u540e\u53c8\u65b0\u4ea7\u751f\u4e86\u4e00\u4e2ars\uff0cpod\u6570\u91cf\u4e3a4\r\n# \u5176\u5b9e\u8fd9\u5c31\u662fdeployment\u80fd\u591f\u8fdb\u884c\u7248\u672c\u56de\u9000\u7684\u5965\u5999\u6240\u5728\uff0c\u540e\u9762\u4f1a\u8be6\u7ec6\u89e3\u91ca\r\n[root@k8s-master01 ~]# kubectl get rs -n dev\r\nNAME                       DESIRED   CURRENT   READY   AGE\r\npc-deployment-6696798b78   0         0         0       7m37s\r\npc-deployment-6696798b11   0         0         0       5m37s\r\npc-deployment-c848d76789   4         4         4       72s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"633-\u7248\u672c\u56de\u9000",children:"6.3.3 \u7248\u672c\u56de\u9000"}),"\n",(0,s.jsx)(n.p,{children:"deployment\u652f\u6301\u7248\u672c\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u7684\u6682\u505c\u3001\u7ee7\u7eed\u529f\u80fd\u4ee5\u53ca\u7248\u672c\u56de\u9000\u7b49\u8bf8\u591a\u529f\u80fd\uff0c\u4e0b\u9762\u5177\u4f53\u6765\u770b."}),"\n",(0,s.jsx)(n.p,{children:"kubectl rollout\uff1a \u7248\u672c\u5347\u7ea7\u76f8\u5173\u529f\u80fd\uff0c\u652f\u6301\u4e0b\u9762\u7684\u9009\u9879\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"status\t\u663e\u793a\u5f53\u524d\u5347\u7ea7\u72b6\u6001"}),"\n",(0,s.jsx)(n.li,{children:"history   \u663e\u793a \u5347\u7ea7\u5386\u53f2\u8bb0\u5f55"}),"\n",(0,s.jsx)(n.li,{children:"pause    \u6682\u505c\u7248\u672c\u5347\u7ea7\u8fc7\u7a0b"}),"\n",(0,s.jsx)(n.li,{children:"resume   \u7ee7\u7eed\u5df2\u7ecf\u6682\u505c\u7684\u7248\u672c\u5347\u7ea7\u8fc7\u7a0b"}),"\n",(0,s.jsx)(n.li,{children:"restart    \u91cd\u542f\u7248\u672c\u5347\u7ea7\u8fc7\u7a0b"}),"\n",(0,s.jsx)(n.li,{children:"undo \u56de\u6eda\u5230\u4e0a\u4e00\u7ea7\u7248\u672c\uff08\u53ef\u4ee5\u4f7f\u7528--to-revision\u56de\u6eda\u5230\u6307\u5b9a\u7248\u672c\uff09"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u67e5\u770b\u5f53\u524d\u5347\u7ea7\u7248\u672c\u7684\u72b6\u6001\r\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\r\ndeployment "pc-deployment" successfully rolled out\r\n\r\n# \u67e5\u770b\u5347\u7ea7\u5386\u53f2\u8bb0\u5f55\r\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\r\ndeployment.apps/pc-deployment\r\nREVISION  CHANGE-CAUSE\r\n1         kubectl create --filename=pc-deployment.yaml --record=true\r\n2         kubectl create --filename=pc-deployment.yaml --record=true\r\n3         kubectl create --filename=pc-deployment.yaml --record=true\r\n# \u53ef\u4ee5\u53d1\u73b0\u6709\u4e09\u6b21\u7248\u672c\u8bb0\u5f55\uff0c\u8bf4\u660e\u5b8c\u6210\u8fc7\u4e24\u6b21\u5347\u7ea7\r\n\r\n# \u7248\u672c\u56de\u6eda\r\n# \u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528--to-revision=1\u56de\u6eda\u5230\u4e861\u7248\u672c\uff0c \u5982\u679c\u7701\u7565\u8fd9\u4e2a\u9009\u9879\uff0c\u5c31\u662f\u56de\u9000\u5230\u4e0a\u4e2a\u7248\u672c\uff0c\u5c31\u662f2\u7248\u672c\r\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev\r\ndeployment.apps/pc-deployment rolled back\r\n\r\n# \u67e5\u770b\u53d1\u73b0\uff0c\u901a\u8fc7nginx\u955c\u50cf\u7248\u672c\u53ef\u4ee5\u53d1\u73b0\u5230\u4e86\u7b2c\u4e00\u7248\r\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\r\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         \r\npc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   \r\n\r\n# \u67e5\u770brs\uff0c\u53d1\u73b0\u7b2c\u4e00\u4e2ars\u4e2d\u67094\u4e2apod\u8fd0\u884c\uff0c\u540e\u9762\u4e24\u4e2a\u7248\u672c\u7684rs\u4e2dpod\u4e3a\u8fd0\u884c\r\n# \u5176\u5b9edeployment\u4e4b\u6240\u4ee5\u53ef\u662f\u5b9e\u73b0\u7248\u672c\u7684\u56de\u6eda\uff0c\u5c31\u662f\u901a\u8fc7\u8bb0\u5f55\u4e0b\u5386\u53f2rs\u6765\u5b9e\u73b0\u7684\uff0c\r\n# \u4e00\u65e6\u60f3\u56de\u6eda\u5230\u54ea\u4e2a\u7248\u672c\uff0c\u53ea\u9700\u8981\u5c06\u5f53\u524d\u7248\u672cpod\u6570\u91cf\u964d\u4e3a0\uff0c\u7136\u540e\u5c06\u56de\u6eda\u7248\u672c\u7684pod\u63d0\u5347\u4e3a\u76ee\u6807\u6570\u91cf\u5c31\u53ef\u4ee5\u4e86\r\n[root@k8s-master01 ~]# kubectl get rs -n dev\r\nNAME                       DESIRED   CURRENT   READY   AGE\r\npc-deployment-6696798b78   4         4         4       78m\r\npc-deployment-966bf7f44    0         0         0       37m\r\npc-deployment-c848d767     0         0         0       71m\n'})}),"\n",(0,s.jsx)(n.h4,{id:"634-\u91d1\u4e1d\u96c0\u53d1\u5e03",children:"6.3.4 \u91d1\u4e1d\u96c0\u53d1\u5e03"}),"\n",(0,s.jsx)(n.p,{children:"Deployment\u63a7\u5236\u5668\u652f\u6301\u63a7\u5236\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u7684\u63a7\u5236\uff0c\u5982\u201c\u6682\u505c(pause)\u201d\u6216\u201c\u7ee7\u7eed(resume)\u201d\u66f4\u65b0\u64cd\u4f5c\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u6709\u4e00\u6279\u65b0\u7684Pod\u8d44\u6e90\u521b\u5efa\u5b8c\u6210\u540e\u7acb\u5373\u6682\u505c\u66f4\u65b0\u8fc7\u7a0b\uff0c\u6b64\u65f6\uff0c\u4ec5\u5b58\u5728\u4e00\u90e8\u5206\u65b0\u7248\u672c\u7684\u5e94\u7528\uff0c\u4e3b\u4f53\u90e8\u5206\u8fd8\u662f\u65e7\u7684\u7248\u672c\u3002\u7136\u540e\uff0c\u518d\u7b5b\u9009\u4e00\u5c0f\u90e8\u5206\u7684\u7528\u6237\u8bf7\u6c42\u8def\u7531\u5230\u65b0\u7248\u672c\u7684Pod\u5e94\u7528\uff0c\u7ee7\u7eed\u89c2\u5bdf\u80fd\u5426\u7a33\u5b9a\u5730\u6309\u671f\u671b\u7684\u65b9\u5f0f\u8fd0\u884c\u3002\u786e\u5b9a\u6ca1\u95ee\u9898\u4e4b\u540e\u518d\u7ee7\u7eed\u5b8c\u6210\u4f59\u4e0b\u7684Pod\u8d44\u6e90\u6eda\u52a8\u66f4\u65b0\uff0c\u5426\u5219\u7acb\u5373\u56de\u6eda\u66f4\u65b0\u64cd\u4f5c\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u66f4\u65b0deployment\u7684\u7248\u672c\uff0c\u5e76\u914d\u7f6e\u6682\u505cdeployment\r\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev && kubectl rollout pause deployment pc-deployment  -n dev\r\ndeployment.apps/pc-deployment image updated\r\ndeployment.apps/pc-deployment paused\r\n\r\n#\u89c2\u5bdf\u66f4\u65b0\u72b6\u6001\r\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\u3000\r\nWaiting for deployment "pc-deployment" rollout to finish: 2 out of 4 new replicas have been updated...\r\n\r\n# \u76d1\u63a7\u66f4\u65b0\u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u65b0\u589e\u4e86\u4e00\u4e2a\u8d44\u6e90\uff0c\u4f46\u662f\u5e76\u672a\u6309\u7167\u9884\u671f\u7684\u72b6\u6001\u53bb\u5220\u9664\u4e00\u4e2a\u65e7\u7684\u8d44\u6e90\uff0c\u5c31\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86pause\u6682\u505c\u547d\u4ee4\r\n\r\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\r\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \r\npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \r\npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \r\npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s\r\npc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s\r\npc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s\r\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s\r\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s\r\n\r\n# \u786e\u4fdd\u66f4\u65b0\u7684pod\u6ca1\u95ee\u9898\u4e86\uff0c\u7ee7\u7eed\u66f4\u65b0\r\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\r\ndeployment.apps/pc-deployment resumed\r\n\r\n# \u67e5\u770b\u6700\u540e\u7684\u66f4\u65b0\u60c5\u51b5\r\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\r\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \r\npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \r\npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \r\npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \r\n\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\nNAME                             READY   STATUS    RESTARTS   AGE\r\npc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s\r\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s\r\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s\r\npc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5220\u9664Deployment"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u5220\u9664deployment\uff0c\u5176\u4e0b\u7684rs\u548cpod\u4e5f\u5c06\u88ab\u5220\u9664\r\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\r\ndeployment.apps "pc-deployment" deleted\n'})}),"\n",(0,s.jsx)(n.h3,{id:"64-horizontal-pod-autoscalerhpa",children:"6.4 Horizontal Pod Autoscaler(HPA)"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u524d\u9762\u7684\u8bfe\u7a0b\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u5b9e\u73b0\u901a\u8fc7\u624b\u5de5\u6267\u884c",(0,s.jsx)(n.code,{children:"kubectl scale"}),"\u547d\u4ee4\u5b9e\u73b0Pod\u6269\u5bb9\u6216\u7f29\u5bb9\uff0c\u4f46\u662f\u8fd9\u663e\u7136\u4e0d\u7b26\u5408Kubernetes\u7684\u5b9a\u4f4d\u76ee\u6807--\u81ea\u52a8\u5316\u3001\u667a\u80fd\u5316\u3002 Kubernetes\u671f\u671b\u53ef\u4ee5\u5b9e\u73b0\u901a\u8fc7\u76d1\u6d4bPod\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5b9e\u73b0pod\u6570\u91cf\u7684\u81ea\u52a8\u8c03\u6574\uff0c\u4e8e\u662f\u5c31\u4ea7\u751f\u4e86Horizontal Pod Autoscaler\uff08HPA\uff09\u8fd9\u79cd\u63a7\u5236\u5668\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"HPA\u53ef\u4ee5\u83b7\u53d6\u6bcf\u4e2aPod\u5229\u7528\u7387\uff0c\u7136\u540e\u548cHPA\u4e2d\u5b9a\u4e49\u7684\u6307\u6807\u8fdb\u884c\u5bf9\u6bd4\uff0c\u540c\u65f6\u8ba1\u7b97\u51fa\u9700\u8981\u4f38\u7f29\u7684\u5177\u4f53\u503c\uff0c\u6700\u540e\u5b9e\u73b0Pod\u7684\u6570\u91cf\u7684\u8c03\u6574\u3002\u5176\u5b9eHPA\u4e0e\u4e4b\u524d\u7684Deployment\u4e00\u6837\uff0c\u4e5f\u5c5e\u4e8e\u4e00\u79cdKubernetes\u8d44\u6e90\u5bf9\u8c61\uff0c\u5b83\u901a\u8fc7\u8ffd\u8e2a\u5206\u6790RC\u63a7\u5236\u7684\u6240\u6709\u76ee\u6807Pod\u7684\u8d1f\u8f7d\u53d8\u5316\u60c5\u51b5\uff0c\u6765\u786e\u5b9a\u662f\u5426\u9700\u8981\u9488\u5bf9\u6027\u5730\u8c03\u6574\u76ee\u6807Pod\u7684\u526f\u672c\u6570\uff0c\u8fd9\u662fHPA\u7684\u5b9e\u73b0\u539f\u7406\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(4756).A+"",width:"622",height:"374"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u505a\u4e00\u4e2a\u5b9e\u9a8c"}),"\n",(0,s.jsx)(n.h4,{id:"641-\u5b89\u88c5metrics-server",children:"6.4.1 \u5b89\u88c5metrics-server"}),"\n",(0,s.jsx)(n.p,{children:"metrics-server\u53ef\u4ee5\u7528\u6765\u6536\u96c6\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5git\r\n[root@k8s-master01 ~]# yum install git -y\r\n# \u83b7\u53d6metrics-server, \u6ce8\u610f\u4f7f\u7528\u7684\u7248\u672c\r\n[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server\r\n# \u4fee\u6539deployment, \u6ce8\u610f\u4fee\u6539\u7684\u662f\u955c\u50cf\u548c\u521d\u59cb\u5316\u53c2\u6570\r\n[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/\r\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\r\n\u6309\u56fe\u4e2d\u6dfb\u52a0\u4e0b\u9762\u9009\u9879\r\nhostNetwork: true\r\nimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\r\nargs:\r\n- --kubelet-insecure-tls\r\n- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200608163326496",src:r(5780).A+"",width:"1458",height:"418"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5metrics-server\r\n[root@k8s-master01 1.8+]# kubectl apply -f ./\r\n\r\n# \u67e5\u770bpod\u8fd0\u884c\u60c5\u51b5\r\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\r\nmetrics-server-6b976979db-2xwbj   1/1     Running   0          90s\r\n\r\n# \u4f7f\u7528kubectl top node \u67e5\u770b\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\r\n[root@k8s-master01 1.8+]# kubectl top node\r\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\r\nk8s-master01   289m         14%    1582Mi          54%       \r\nk8s-node01     81m          4%     1195Mi          40%       \r\nk8s-node02     72m          3%     1211Mi          41%  \r\n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\r\nNAME                              CPU(cores)   MEMORY(bytes)\r\ncoredns-6955765f44-7ptsb          3m           9Mi\r\ncoredns-6955765f44-vcwr5          3m           8Mi\r\netcd-master                       14m          145Mi\r\n...\r\n# \u81f3\u6b64,metrics-server\u5b89\u88c5\u5b8c\u6210\n"})}),"\n",(0,s.jsx)(n.h4,{id:"642-\u51c6\u5907deployment\u548cservie",children:"6.4.2 \u51c6\u5907deployment\u548cservie"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-hpa-pod.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: nginx\r\n  namespace: dev\r\nspec:\r\n  strategy: # \u7b56\u7565\r\n    type: RollingUpdate # \u6eda\u52a8\u66f4\u65b0\u7b56\u7565\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        resources: # \u8d44\u6e90\u914d\u989d\r\n          limits:  # \u9650\u5236\u8d44\u6e90\uff08\u4e0a\u9650\uff09\r\n            cpu: "1" # CPU\u9650\u5236\uff0c\u5355\u4f4d\u662fcore\u6570\r\n          requests: # \u8bf7\u6c42\u8d44\u6e90\uff08\u4e0b\u9650\uff09\r\n            cpu: "100m"  # CPU\u9650\u5236\uff0c\u5355\u4f4d\u662fcore\u6570\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efadeployment\r\n[root@k8s-master01 1.8+]# kubectl run nginx --image=nginx:1.17.1 --requests=cpu=100m -n dev\r\n# \u521b\u5efaservice\r\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\r\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\r\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\r\ndeployment.apps/nginx   1/1     1            1           47s\r\n\r\nNAME                         READY   STATUS    RESTARTS   AGE\r\npod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s\r\n\r\nNAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\r\nservice/nginx   NodePort   10.101.18.29   <none>        80:31830/TCP   35s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"643-\u90e8\u7f72hpa",children:"6.4.3 \u90e8\u7f72HPA"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-hpa.yaml\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v1\r\nkind: HorizontalPodAutoscaler\r\nmetadata:\r\n  name: pc-hpa\r\n  namespace: dev\r\nspec:\r\n  minReplicas: 1  #\u6700\u5c0fpod\u6570\u91cf\r\n  maxReplicas: 10 #\u6700\u5927pod\u6570\u91cf\r\n  targetCPUUtilizationPercentage: 3 # CPU\u4f7f\u7528\u7387\u6307\u6807\r\n  scaleTargetRef:   # \u6307\u5b9a\u8981\u63a7\u5236\u7684nginx\u4fe1\u606f\r\n    apiVersion:  /v1\r\n    kind: Deployment\r\n    name: nginx\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efahpa\r\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\r\nhorizontalpodautoscaler.autoscaling/pc-hpa created\r\n\r\n# \u67e5\u770bhpa\r\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\r\nNAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\r\npc-hpa   Deployment/nginx   0%/3%     1         10        1          62s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"644-\u6d4b\u8bd5",children:"6.4.4 \u6d4b\u8bd5"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\u5bf9service\u5730\u5740",(0,s.jsx)(n.code,{children:"192.168.5.4:31830"}),"\u8fdb\u884c\u538b\u6d4b\uff0c\u7136\u540e\u901a\u8fc7\u63a7\u5236\u53f0\u67e5\u770bhpa\u548cpod\u7684\u53d8\u5316"]}),"\n",(0,s.jsx)(n.p,{children:"hpa\u53d8\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl get hpa -n dev -w\r\nNAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE\r\npc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s\r\npc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s\r\npc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s\r\npc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s\r\npc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s\r\npc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s\r\npc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s\r\npc-hpa  Deployment/nginx  0%/3%   1     10     8      13m\r\npc-hpa  Deployment/nginx  0%/3%   1     10     1      14m\n"})}),"\n",(0,s.jsx)(n.p,{children:"deployment\u53d8\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# kubectl get deployment -n dev -w\r\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\r\nnginx   1/1     1            1           11m\r\nnginx   1/4     1            1           13m\r\nnginx   1/4     1            1           13m\r\nnginx   1/4     1            1           13m\r\nnginx   1/4     4            1           13m\r\nnginx   1/8     4            1           14m\r\nnginx   1/8     4            1           14m\r\nnginx   1/8     4            1           14m\r\nnginx   1/8     8            1           14m\r\nnginx   2/8     8            2           14m\r\nnginx   3/8     8            3           14m\r\nnginx   4/8     8            4           14m\r\nnginx   5/8     8            5           14m\r\nnginx   6/8     8            6           14m\r\nnginx   7/8     8            7           14m\r\nnginx   8/8     8            8           15m\r\nnginx   8/1     8            8           20m\r\nnginx   8/1     8            8           20m\r\nnginx   1/1     1            1           20m\n"})}),"\n",(0,s.jsx)(n.p,{children:"pod\u53d8\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[root@k8s-master01 ~]# kubectl get pods -n dev -w\r\nNAME                     READY   STATUS    RESTARTS   AGE\r\nnginx-7df9756ccc-bh8dr   1/1     Running   0          11m\r\nnginx-7df9756ccc-cpgrv   0/1     Pending   0          0s\r\nnginx-7df9756ccc-8zhwk   0/1     Pending   0          0s\r\nnginx-7df9756ccc-rr9bn   0/1     Pending   0          0s\r\nnginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-m9gsj   0/1     Pending             0          0s\r\nnginx-7df9756ccc-g56qb   0/1     Pending             0          0s\r\nnginx-7df9756ccc-sl9c6   0/1     Pending             0          0s\r\nnginx-7df9756ccc-fgst7   0/1     Pending             0          0s\r\nnginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s\r\nnginx-7df9756ccc-8zhwk   1/1     Running             0          19s\r\nnginx-7df9756ccc-rr9bn   1/1     Running             0          30s\r\nnginx-7df9756ccc-m9gsj   1/1     Running             0          21s\r\nnginx-7df9756ccc-cpgrv   1/1     Running             0          47s\r\nnginx-7df9756ccc-sl9c6   1/1     Running             0          33s\r\nnginx-7df9756ccc-g56qb   1/1     Running             0          48s\r\nnginx-7df9756ccc-fgst7   1/1     Running             0          66s\r\nnginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s\r\nnginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s\r\nnginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s\r\nnginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s\r\nnginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s\r\nnginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s\r\nnginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s\n"})}),"\n",(0,s.jsx)(n.h3,{id:"65-daemonsetds",children:"6.5 DaemonSet(DS)"}),"\n",(0,s.jsx)(n.p,{children:"DaemonSet\u7c7b\u578b\u7684\u63a7\u5236\u5668\u53ef\u4ee5\u4fdd\u8bc1\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u53f0\uff08\u6216\u6307\u5b9a\uff09\u8282\u70b9\u4e0a\u90fd\u8fd0\u884c\u4e00\u4e2a\u526f\u672c\u3002\u4e00\u822c\u9002\u7528\u4e8e\u65e5\u5fd7\u6536\u96c6\u3001\u8282\u70b9\u76d1\u63a7\u7b49\u573a\u666f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4e00\u4e2aPod\u63d0\u4f9b\u7684\u529f\u80fd\u662f\u8282\u70b9\u7ea7\u522b\u7684\uff08\u6bcf\u4e2a\u8282\u70b9\u90fd\u9700\u8981\u4e14\u53ea\u9700\u8981\u4e00\u4e2a\uff09\uff0c\u90a3\u4e48\u8fd9\u7c7bPod\u5c31\u9002\u5408\u4f7f\u7528DaemonSet\u7c7b\u578b\u7684\u63a7\u5236\u5668\u521b\u5efa\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(8530).A+"",width:"685",height:"267"})}),"\n",(0,s.jsx)(n.p,{children:"DaemonSet\u63a7\u5236\u5668\u7684\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6bcf\u5f53\u5411\u96c6\u7fa4\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u6307\u5b9a\u7684 Pod \u526f\u672c\u4e5f\u5c06\u6dfb\u52a0\u5230\u8be5\u8282\u70b9\u4e0a"}),"\n",(0,s.jsx)(n.li,{children:"\u5f53\u8282\u70b9\u4ece\u96c6\u7fa4\u4e2d\u79fb\u9664\u65f6\uff0cPod \u4e5f\u5c31\u88ab\u5783\u573e\u56de\u6536\u4e86"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u5148\u6765\u770b\u4e0bDaemonSet\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1 # \u7248\u672c\u53f7\r\nkind: DaemonSet # \u7c7b\u578b       \r\nmetadata: # \u5143\u6570\u636e\r\n  name: # rs\u540d\u79f0 \r\n  namespace: # \u6240\u5c5e\u547d\u540d\u7a7a\u95f4 \r\n  labels: #\u6807\u7b7e\r\n    controller: daemonset\r\nspec: # \u8be6\u60c5\u63cf\u8ff0\r\n  revisionHistoryLimit: 3 # \u4fdd\u7559\u5386\u53f2\u7248\u672c\r\n  updateStrategy: # \u66f4\u65b0\u7b56\u7565\r\n    type: RollingUpdate # \u6eda\u52a8\u66f4\u65b0\u7b56\u7565\r\n    rollingUpdate: # \u6eda\u52a8\u66f4\u65b0\r\n      maxUnavailable: 1 # \u6700\u5927\u4e0d\u53ef\u7528\u72b6\u6001\u7684 Pod \u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u4e3a\u767e\u5206\u6bd4\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u6574\u6570\r\n  selector: # \u9009\u62e9\u5668\uff0c\u901a\u8fc7\u5b83\u6307\u5b9a\u8be5\u63a7\u5236\u5668\u7ba1\u7406\u54ea\u4e9bpod\r\n    matchLabels:      # Labels\u5339\u914d\u89c4\u5219\r\n      app: nginx-pod\r\n    matchExpressions: # Expressions\u5339\u914d\u89c4\u5219\r\n      - {key: app, operator: In, values: [nginx-pod]}\r\n  template: # \u6a21\u677f\uff0c\u5f53\u526f\u672c\u6570\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f1a\u6839\u636e\u4e0b\u9762\u7684\u6a21\u677f\u521b\u5efapod\u526f\u672c\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        ports:\r\n        - containerPort: 80\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-daemonset.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: DaemonSet      \r\nmetadata:\r\n  name: pc-daemonset\r\n  namespace: dev\r\nspec: \r\n  selector:\r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efadaemonset\r\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\r\ndaemonset.apps/pc-daemonset created\r\n\r\n# \u67e5\u770bdaemonset\r\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\r\nNAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         \r\npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \r\n\r\n# \u67e5\u770bpod,\u53d1\u73b0\u5728\u6bcf\u4e2aNode\u4e0a\u90fd\u8fd0\u884c\u4e00\u4e2apod\r\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\r\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    \r\npc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     \r\npc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      \r\n\r\n# \u5220\u9664daemonset\r\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\r\ndaemonset.apps "pc-daemonset" deleted\n'})}),"\n",(0,s.jsx)(n.h3,{id:"66-job",children:"6.6 Job"}),"\n",(0,s.jsxs)(n.p,{children:["Job\uff0c\u4e3b\u8981\u7528\u4e8e\u8d1f\u8d23**\u6279\u91cf\u5904\u7406(\u4e00\u6b21\u8981\u5904\u7406\u6307\u5b9a\u6570\u91cf\u4efb\u52a1)",(0,s.jsx)(n.strong,{children:"\u77ed\u6682\u7684"}),"\u4e00\u6b21\u6027(\u6bcf\u4e2a\u4efb\u52a1\u4ec5\u8fd0\u884c\u4e00\u6b21\u5c31\u7ed3\u675f)**\u4efb\u52a1\u3002Job\u7279\u70b9\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5f53Job\u521b\u5efa\u7684pod\u6267\u884c\u6210\u529f\u7ed3\u675f\u65f6\uff0cJob\u5c06\u8bb0\u5f55\u6210\u529f\u7ed3\u675f\u7684pod\u6570\u91cf"}),"\n",(0,s.jsx)(n.li,{children:"\u5f53\u6210\u529f\u7ed3\u675f\u7684pod\u8fbe\u5230\u6307\u5b9a\u7684\u6570\u91cf\u65f6\uff0cJob\u5c06\u5b8c\u6210\u6267\u884c"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(3695).A+"",width:"801",height:"254"})}),"\n",(0,s.jsx)(n.p,{children:"Job\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1 # \u7248\u672c\u53f7\r\nkind: Job # \u7c7b\u578b       \r\nmetadata: # \u5143\u6570\u636e\r\n  name: # rs\u540d\u79f0 \r\n  namespace: # \u6240\u5c5e\u547d\u540d\u7a7a\u95f4 \r\n  labels: #\u6807\u7b7e\r\n    controller: job\r\nspec: # \u8be6\u60c5\u63cf\u8ff0\r\n  completions: 1 # \u6307\u5b9ajob\u9700\u8981\u6210\u529f\u8fd0\u884cPods\u7684\u6b21\u6570\u3002\u9ed8\u8ba4\u503c: 1\r\n  parallelism: 1 # \u6307\u5b9ajob\u5728\u4efb\u4e00\u65f6\u523b\u5e94\u8be5\u5e76\u53d1\u8fd0\u884cPods\u7684\u6570\u91cf\u3002\u9ed8\u8ba4\u503c: 1\r\n  activeDeadlineSeconds: 30 # \u6307\u5b9ajob\u53ef\u8fd0\u884c\u7684\u65f6\u95f4\u671f\u9650\uff0c\u8d85\u8fc7\u65f6\u95f4\u8fd8\u672a\u7ed3\u675f\uff0c\u7cfb\u7edf\u5c06\u4f1a\u5c1d\u8bd5\u8fdb\u884c\u7ec8\u6b62\u3002\r\n  backoffLimit: 6 # \u6307\u5b9ajob\u5931\u8d25\u540e\u8fdb\u884c\u91cd\u8bd5\u7684\u6b21\u6570\u3002\u9ed8\u8ba4\u662f6\r\n  manualSelector: true # \u662f\u5426\u53ef\u4ee5\u4f7f\u7528selector\u9009\u62e9\u5668\u9009\u62e9pod\uff0c\u9ed8\u8ba4\u662ffalse\r\n  selector: # \u9009\u62e9\u5668\uff0c\u901a\u8fc7\u5b83\u6307\u5b9a\u8be5\u63a7\u5236\u5668\u7ba1\u7406\u54ea\u4e9bpod\r\n    matchLabels:      # Labels\u5339\u914d\u89c4\u5219\r\n      app: counter-pod\r\n    matchExpressions: # Expressions\u5339\u914d\u89c4\u5219\r\n      - {key: app, operator: In, values: [counter-pod]}\r\n  template: # \u6a21\u677f\uff0c\u5f53\u526f\u672c\u6570\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f1a\u6839\u636e\u4e0b\u9762\u7684\u6a21\u677f\u521b\u5efapod\u526f\u672c\r\n    metadata:\r\n      labels:\r\n        app: counter-pod\r\n    spec:\r\n      restartPolicy: Never # \u91cd\u542f\u7b56\u7565\u53ea\u80fd\u8bbe\u7f6e\u4e3aNever\u6216\u8005OnFailure\r\n      containers:\r\n      - name: counter\r\n        image: busybox:1.30\r\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"\u5173\u4e8e\u91cd\u542f\u7b56\u7565\u8bbe\u7f6e\u7684\u8bf4\u660e\uff1a\r\n    \u5982\u679c\u6307\u5b9a\u4e3aOnFailure\uff0c\u5219job\u4f1a\u5728pod\u51fa\u73b0\u6545\u969c\u65f6\u91cd\u542f\u5bb9\u5668\uff0c\u800c\u4e0d\u662f\u521b\u5efapod\uff0cfailed\u6b21\u6570\u4e0d\u53d8\r\n    \u5982\u679c\u6307\u5b9a\u4e3aNever\uff0c\u5219job\u4f1a\u5728pod\u51fa\u73b0\u6545\u969c\u65f6\u521b\u5efa\u65b0\u7684pod\uff0c\u5e76\u4e14\u6545\u969cpod\u4e0d\u4f1a\u6d88\u5931\uff0c\u4e5f\u4e0d\u4f1a\u91cd\u542f\uff0cfailed\u6b21\u6570\u52a01\r\n    \u5982\u679c\u6307\u5b9a\u4e3aAlways\u7684\u8bdd\uff0c\u5c31\u610f\u5473\u7740\u4e00\u76f4\u91cd\u542f\uff0c\u610f\u5473\u7740job\u4efb\u52a1\u4f1a\u91cd\u590d\u53bb\u6267\u884c\u4e86\uff0c\u5f53\u7136\u4e0d\u5bf9\uff0c\u6240\u4ee5\u4e0d\u80fd\u8bbe\u7f6e\u4e3aAlways\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-job.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1\r\nkind: Job      \r\nmetadata:\r\n  name: pc-job\r\n  namespace: dev\r\nspec:\r\n  manualSelector: true\r\n  selector:\r\n    matchLabels:\r\n      app: counter-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: counter-pod\r\n    spec:\r\n      restartPolicy: Never\r\n      containers:\r\n      - name: counter\r\n        image: busybox:1.30\r\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efajob\r\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\r\njob.batch/pc-job created\r\n\r\n# \u67e5\u770bjob\r\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\r\nNAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR\r\npc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod\r\npc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod\r\n\r\n# \u901a\u8fc7\u89c2\u5bdfpod\u72b6\u6001\u53ef\u4ee5\u770b\u5230\uff0cpod\u5728\u8fd0\u884c\u5b8c\u6bd5\u4efb\u52a1\u540e\uff0c\u5c31\u4f1a\u53d8\u6210Completed\u72b6\u6001\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\r\nNAME           READY   STATUS     RESTARTS      AGE\r\npc-job-rxg96   1/1     Running     0            29s\r\npc-job-rxg96   0/1     Completed   0            33s\r\n\r\n# \u63a5\u4e0b\u6765\uff0c\u8c03\u6574\u4e0bpod\u8fd0\u884c\u7684\u603b\u6570\u91cf\u548c\u5e76\u884c\u6570\u91cf \u5373\uff1a\u5728spec\u4e0b\u8bbe\u7f6e\u4e0b\u9762\u4e24\u4e2a\u9009\u9879\r\n#  completions: 6 # \u6307\u5b9ajob\u9700\u8981\u6210\u529f\u8fd0\u884cPods\u7684\u6b21\u6570\u4e3a6\r\n#  parallelism: 3 # \u6307\u5b9ajob\u5e76\u53d1\u8fd0\u884cPods\u7684\u6570\u91cf\u4e3a3\r\n#  \u7136\u540e\u91cd\u65b0\u8fd0\u884cjob\uff0c\u89c2\u5bdf\u6548\u679c\uff0c\u6b64\u65f6\u4f1a\u53d1\u73b0\uff0cjob\u4f1a\u6bcf\u6b21\u8fd0\u884c3\u4e2apod\uff0c\u603b\u5171\u6267\u884c\u4e866\u4e2apod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\r\nNAME           READY   STATUS    RESTARTS   AGE\r\npc-job-684ft   1/1     Running   0          5s\r\npc-job-jhj49   1/1     Running   0          5s\r\npc-job-pfcvh   1/1     Running   0          5s\r\npc-job-684ft   0/1     Completed   0          11s\r\npc-job-v7rhr   0/1     Pending     0          0s\r\npc-job-v7rhr   0/1     Pending     0          0s\r\npc-job-v7rhr   0/1     ContainerCreating   0          0s\r\npc-job-jhj49   0/1     Completed           0          11s\r\npc-job-fhwf7   0/1     Pending             0          0s\r\npc-job-fhwf7   0/1     Pending             0          0s\r\npc-job-pfcvh   0/1     Completed           0          11s\r\npc-job-5vg2j   0/1     Pending             0          0s\r\npc-job-fhwf7   0/1     ContainerCreating   0          0s\r\npc-job-5vg2j   0/1     Pending             0          0s\r\npc-job-5vg2j   0/1     ContainerCreating   0          0s\r\npc-job-fhwf7   1/1     Running             0          2s\r\npc-job-v7rhr   1/1     Running             0          2s\r\npc-job-5vg2j   1/1     Running             0          3s\r\npc-job-fhwf7   0/1     Completed           0          12s\r\npc-job-v7rhr   0/1     Completed           0          12s\r\npc-job-5vg2j   0/1     Completed           0          12s\r\n\r\n# \u5220\u9664job\r\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\r\njob.batch "pc-job" deleted\n'})}),"\n",(0,s.jsx)(n.h3,{id:"67-cronjobcj",children:"6.7 CronJob(CJ)"}),"\n",(0,s.jsxs)(n.p,{children:["CronJob\u63a7\u5236\u5668\u4ee5 Job\u63a7\u5236\u5668\u8d44\u6e90\u4e3a\u5176\u7ba1\u63a7\u5bf9\u8c61\uff0c\u5e76\u501f\u52a9\u5b83\u7ba1\u7406pod\u8d44\u6e90\u5bf9\u8c61\uff0cJob\u63a7\u5236\u5668\u5b9a\u4e49\u7684\u4f5c\u4e1a\u4efb\u52a1\u5728\u5176\u63a7\u5236\u5668\u8d44\u6e90\u521b\u5efa\u4e4b\u540e\u4fbf\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u4f46CronJob\u53ef\u4ee5\u4ee5\u7c7b\u4f3c\u4e8eLinux\u64cd\u4f5c\u7cfb\u7edf\u7684\u5468\u671f\u6027\u4efb\u52a1\u4f5c\u4e1a\u8ba1\u5212\u7684\u65b9\u5f0f\u63a7\u5236\u5176\u8fd0\u884c",(0,s.jsx)(n.strong,{children:"\u65f6\u95f4\u70b9"}),"\u53ca",(0,s.jsx)(n.strong,{children:"\u91cd\u590d\u8fd0\u884c"}),"\u7684\u65b9\u5f0f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c",(0,s.jsx)(n.strong,{children:"CronJob\u53ef\u4ee5\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u70b9(\u53cd\u590d\u7684)\u53bb\u8fd0\u884cjob\u4efb\u52a1"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(3046).A+"",width:"830",height:"301"})}),"\n",(0,s.jsx)(n.p,{children:"CronJob\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1beta1 # \u7248\u672c\u53f7\r\nkind: CronJob # \u7c7b\u578b       \r\nmetadata: # \u5143\u6570\u636e\r\n  name: # rs\u540d\u79f0 \r\n  namespace: # \u6240\u5c5e\u547d\u540d\u7a7a\u95f4 \r\n  labels: #\u6807\u7b7e\r\n    controller: cronjob\r\nspec: # \u8be6\u60c5\u63cf\u8ff0\r\n  schedule: # cron\u683c\u5f0f\u7684\u4f5c\u4e1a\u8c03\u5ea6\u8fd0\u884c\u65f6\u95f4\u70b9,\u7528\u4e8e\u63a7\u5236\u4efb\u52a1\u5728\u4ec0\u4e48\u65f6\u95f4\u6267\u884c\r\n  concurrencyPolicy: # \u5e76\u53d1\u6267\u884c\u7b56\u7565\uff0c\u7528\u4e8e\u5b9a\u4e49\u524d\u4e00\u6b21\u4f5c\u4e1a\u8fd0\u884c\u5c1a\u672a\u5b8c\u6210\u65f6\u662f\u5426\u4ee5\u53ca\u5982\u4f55\u8fd0\u884c\u540e\u4e00\u6b21\u7684\u4f5c\u4e1a\r\n  failedJobHistoryLimit: # \u4e3a\u5931\u8d25\u7684\u4efb\u52a1\u6267\u884c\u4fdd\u7559\u7684\u5386\u53f2\u8bb0\u5f55\u6570\uff0c\u9ed8\u8ba4\u4e3a1\r\n  successfulJobHistoryLimit: # \u4e3a\u6210\u529f\u7684\u4efb\u52a1\u6267\u884c\u4fdd\u7559\u7684\u5386\u53f2\u8bb0\u5f55\u6570\uff0c\u9ed8\u8ba4\u4e3a3\r\n  startingDeadlineSeconds: # \u542f\u52a8\u4f5c\u4e1a\u9519\u8bef\u7684\u8d85\u65f6\u65f6\u957f\r\n  jobTemplate: # job\u63a7\u5236\u5668\u6a21\u677f\uff0c\u7528\u4e8e\u4e3acronjob\u63a7\u5236\u5668\u751f\u6210job\u5bf9\u8c61;\u4e0b\u9762\u5176\u5b9e\u5c31\u662fjob\u7684\u5b9a\u4e49\r\n    metadata:\r\n    spec:\r\n      completions: 1\r\n      parallelism: 1\r\n      activeDeadlineSeconds: 30\r\n      backoffLimit: 6\r\n      manualSelector: true\r\n      selector:\r\n        matchLabels:\r\n          app: counter-pod\r\n        matchExpressions: \u89c4\u5219\r\n          - {key: app, operator: In, values: [counter-pod]}\r\n      template:\r\n        metadata:\r\n          labels:\r\n            app: counter-pod\r\n        spec:\r\n          restartPolicy: Never \r\n          containers:\r\n          - name: counter\r\n            image: busybox:1.30\r\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"\u9700\u8981\u91cd\u70b9\u89e3\u91ca\u7684\u51e0\u4e2a\u9009\u9879\uff1a\r\nschedule: cron\u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u6307\u5b9a\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4\r\n    */1    *      *    *     *\r\n    <\u5206\u949f> <\u5c0f\u65f6> <\u65e5> <\u6708\u4efd> <\u661f\u671f>\r\n\r\n    \u5206\u949f \u503c\u4ece 0 \u5230 59.\r\n    \u5c0f\u65f6 \u503c\u4ece 0 \u5230 23.\r\n    \u65e5 \u503c\u4ece 1 \u5230 31.\r\n    \u6708 \u503c\u4ece 1 \u5230 12.\r\n    \u661f\u671f \u503c\u4ece 0 \u5230 6, 0 \u4ee3\u8868\u661f\u671f\u65e5\r\n    \u591a\u4e2a\u65f6\u95f4\u53ef\u4ee5\u7528\u9017\u53f7\u9694\u5f00\uff1b \u8303\u56f4\u53ef\u4ee5\u7528\u8fde\u5b57\u7b26\u7ed9\u51fa\uff1b*\u53ef\u4ee5\u4f5c\u4e3a\u901a\u914d\u7b26\uff1b /\u8868\u793a\u6bcf...\r\nconcurrencyPolicy:\r\n    Allow:   \u5141\u8bb8Jobs\u5e76\u53d1\u8fd0\u884c(\u9ed8\u8ba4)\r\n    Forbid:  \u7981\u6b62\u5e76\u53d1\u8fd0\u884c\uff0c\u5982\u679c\u4e0a\u4e00\u6b21\u8fd0\u884c\u5c1a\u672a\u5b8c\u6210\uff0c\u5219\u8df3\u8fc7\u4e0b\u4e00\u6b21\u8fd0\u884c\r\n    Replace: \u66ff\u6362\uff0c\u53d6\u6d88\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4f5c\u4e1a\u5e76\u7528\u65b0\u4f5c\u4e1a\u66ff\u6362\u5b83\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapc-cronjob.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1beta1\r\nkind: CronJob\r\nmetadata:\r\n  name: pc-cronjob\r\n  namespace: dev\r\n  labels:\r\n    controller: cronjob\r\nspec:\r\n  schedule: "*/1 * * * *"\r\n  jobTemplate:\r\n    metadata:\r\n    spec:\r\n      template:\r\n        spec:\r\n          restartPolicy: Never\r\n          containers:\r\n          - name: counter\r\n            image: busybox:1.30\r\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efacronjob\r\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\r\ncronjob.batch/pc-cronjob created\r\n\r\n# \u67e5\u770bcronjob\r\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\r\nNAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\r\npc-cronjob   */1 * * * *   False     0        <none>          6s\r\n\r\n# \u67e5\u770bjob\r\n[root@k8s-master01 ~]# kubectl get jobs -n dev\r\nNAME                    COMPLETIONS   DURATION   AGE\r\npc-cronjob-1592587800   1/1           28s        3m26s\r\npc-cronjob-1592587860   1/1           28s        2m26s\r\npc-cronjob-1592587920   1/1           28s        86s\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev\r\npc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s\r\npc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s\r\npc-cronjob-1592587920-9dxxq   1/1     Running     0          24s\r\n\r\n\r\n# \u5220\u9664cronjob\r\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\r\ncronjob.batch "pc-cronjob" deleted\n'})}),"\n",(0,s.jsx)(n.h2,{id:"7-service\u8be6\u89e3",children:"7. Service\u8be6\u89e3"}),"\n",(0,s.jsx)(n.h3,{id:"71-service\u4ecb\u7ecd",children:"7.1 Service\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\uff0cpod\u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u8f7d\u4f53\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7pod\u7684ip\u6765\u8bbf\u95ee\u5e94\u7528\u7a0b\u5e8f\uff0c\u4f46\u662fpod\u7684ip\u5730\u5740\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u4e0d\u65b9\u4fbf\u76f4\u63a5\u91c7\u7528pod\u7684ip\u5bf9\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0ckubernetes\u63d0\u4f9b\u4e86Service\u8d44\u6e90\uff0cService\u4f1a\u5bf9\u63d0\u4f9b\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u591a\u4e2apod\u8fdb\u884c\u805a\u5408\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u5165\u53e3\u5730\u5740\u3002\u901a\u8fc7\u8bbf\u95eeService\u7684\u5165\u53e3\u5730\u5740\u5c31\u80fd\u8bbf\u95ee\u5230\u540e\u9762\u7684pod\u670d\u52a1\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(9881).A+"",width:"1073",height:"497"})}),"\n",(0,s.jsxs)(n.p,{children:["Service\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u53ea\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u771f\u6b63\u8d77\u4f5c\u7528\u7684\u5176\u5b9e\u662fkube-proxy\u670d\u52a1\u8fdb\u7a0b\uff0c\u6bcf\u4e2aNode\u8282\u70b9\u4e0a\u90fd\u8fd0\u884c\u7740\u4e00\u4e2akube-proxy\u670d\u52a1\u8fdb\u7a0b\u3002\u5f53\u521b\u5efaService\u7684\u65f6\u5019\u4f1a\u901a\u8fc7api-server\u5411etcd\u5199\u5165\u521b\u5efa\u7684service\u7684\u4fe1\u606f\uff0c\u800ckube-proxy\u4f1a\u57fa\u4e8e\u76d1\u542c\u7684\u673a\u5236\u53d1\u73b0\u8fd9\u79cdService\u7684\u53d8\u52a8\uff0c\u7136\u540e",(0,s.jsx)(n.strong,{children:"\u5b83\u4f1a\u5c06\u6700\u65b0\u7684Service\u4fe1\u606f\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u8bbf\u95ee\u89c4\u5219"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(5044).A+"",width:"1048",height:"350"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# 10.97.97.97:80 \u662fservice\u63d0\u4f9b\u7684\u8bbf\u95ee\u5165\u53e3\r\n# \u5f53\u8bbf\u95ee\u8fd9\u4e2a\u5165\u53e3\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u53d1\u73b0\u540e\u9762\u6709\u4e09\u4e2apod\u7684\u670d\u52a1\u5728\u7b49\u5f85\u8c03\u7528\uff0c\r\n# kube-proxy\u4f1a\u57fa\u4e8err\uff08\u8f6e\u8be2\uff09\u7684\u7b56\u7565\uff0c\u5c06\u8bf7\u6c42\u5206\u53d1\u5230\u5176\u4e2d\u4e00\u4e2apod\u4e0a\u53bb\r\n# \u8fd9\u4e2a\u89c4\u5219\u4f1a\u540c\u65f6\u5728\u96c6\u7fa4\u5185\u7684\u6240\u6709\u8282\u70b9\u4e0a\u90fd\u751f\u6210\uff0c\u6240\u4ee5\u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u4e0a\u8bbf\u95ee\u90fd\u53ef\u4ee5\u3002\r\n[root@node1 ~]# ipvsadm -Ln\r\nIP Virtual Server version 1.2.1 (size=4096)\r\nProt LocalAddress:Port Scheduler Flags\r\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\r\nTCP  10.97.97.97:80 rr\r\n  -> 10.244.1.39:80               Masq    1      0          0\r\n  -> 10.244.1.40:80               Masq    1      0          0\r\n  -> 10.244.2.33:80               Masq    1      0          0\n"})}),"\n",(0,s.jsx)(n.p,{children:"kube-proxy\u76ee\u524d\u652f\u6301\u4e09\u79cd\u5de5\u4f5c\u6a21\u5f0f:"}),"\n",(0,s.jsx)(n.h4,{id:"711-userspace-\u6a21\u5f0f",children:"7.1.1 userspace \u6a21\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"userspace\u6a21\u5f0f\u4e0b\uff0ckube-proxy\u4f1a\u4e3a\u6bcf\u4e00\u4e2aService\u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u7aef\u53e3\uff0c\u53d1\u5411Cluster IP\u7684\u8bf7\u6c42\u88abIptables\u89c4\u5219\u91cd\u5b9a\u5411\u5230kube-proxy\u76d1\u542c\u7684\u7aef\u53e3\u4e0a\uff0ckube-proxy\u6839\u636eLB\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u63d0\u4f9b\u670d\u52a1\u7684Pod\u5e76\u548c\u5176\u5efa\u7acb\u94fe\u63a5\uff0c\u4ee5\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230Pod\u4e0a\u3002  \u8be5\u6a21\u5f0f\u4e0b\uff0ckube-proxy\u5145\u5f53\u4e86\u4e00\u4e2a\u56db\u5c42\u8d1f\u8d23\u5747\u8861\u5668\u7684\u89d2\u8272\u3002\u7531\u4e8ekube-proxy\u8fd0\u884c\u5728userspace\u4e2d\uff0c\u5728\u8fdb\u884c\u8f6c\u53d1\u5904\u7406\u65f6\u4f1a\u589e\u52a0\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u867d\u7136\u6bd4\u8f83\u7a33\u5b9a\uff0c\u4f46\u662f\u6548\u7387\u6bd4\u8f83\u4f4e\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(2105).A+"",width:"851",height:"524"})}),"\n",(0,s.jsx)(n.h4,{id:"712-iptables-\u6a21\u5f0f",children:"7.1.2 iptables \u6a21\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"iptables\u6a21\u5f0f\u4e0b\uff0ckube-proxy\u4e3aservice\u540e\u7aef\u7684\u6bcf\u4e2aPod\u521b\u5efa\u5bf9\u5e94\u7684iptables\u89c4\u5219\uff0c\u76f4\u63a5\u5c06\u53d1\u5411Cluster IP\u7684\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230\u4e00\u4e2aPod IP\u3002  \u8be5\u6a21\u5f0f\u4e0bkube-proxy\u4e0d\u627f\u62c5\u56db\u5c42\u8d1f\u8d23\u5747\u8861\u5668\u7684\u89d2\u8272\uff0c\u53ea\u8d1f\u8d23\u521b\u5efaiptables\u89c4\u5219\u3002\u8be5\u6a21\u5f0f\u7684\u4f18\u70b9\u662f\u8f83userspace\u6a21\u5f0f\u6548\u7387\u66f4\u9ad8\uff0c\u4f46\u4e0d\u80fd\u63d0\u4f9b\u7075\u6d3b\u7684LB\u7b56\u7565\uff0c\u5f53\u540e\u7aefPod\u4e0d\u53ef\u7528\u65f6\u4e5f\u65e0\u6cd5\u8fdb\u884c\u91cd\u8bd5\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(7096).A+"",width:"837",height:"642"})}),"\n",(0,s.jsx)(n.h4,{id:"713-ipvs-\u6a21\u5f0f",children:"7.1.3 ipvs \u6a21\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"ipvs\u6a21\u5f0f\u548ciptables\u7c7b\u4f3c\uff0ckube-proxy\u76d1\u63a7Pod\u7684\u53d8\u5316\u5e76\u521b\u5efa\u76f8\u5e94\u7684ipvs\u89c4\u5219\u3002ipvs\u76f8\u5bf9iptables\u8f6c\u53d1\u6548\u7387\u66f4\u9ad8\u3002\u9664\u6b64\u4ee5\u5916\uff0cipvs\u652f\u6301\u66f4\u591a\u7684LB\u7b97\u6cd5\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(5e3).A+"",width:"820",height:"633"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u6b64\u6a21\u5f0f\u5fc5\u987b\u5b89\u88c5ipvs\u5185\u6838\u6a21\u5757\uff0c\u5426\u5219\u4f1a\u964d\u7ea7\u4e3aiptables\r\n# \u5f00\u542fipvs\r\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\r\n# \u4fee\u6539mode: "ipvs"\r\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system\r\n[root@node1 ~]# ipvsadm -Ln\r\nIP Virtual Server version 1.2.1 (size=4096)\r\nProt LocalAddress:Port Scheduler Flags\r\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\r\nTCP  10.97.97.97:80 rr\r\n  -> 10.244.1.39:80               Masq    1      0          0\r\n  -> 10.244.1.40:80               Masq    1      0          0\r\n  -> 10.244.2.33:80               Masq    1      0          0\n'})}),"\n",(0,s.jsx)(n.h3,{id:"72-service\u7c7b\u578b",children:"7.2 Service\u7c7b\u578b"}),"\n",(0,s.jsx)(n.p,{children:"Service\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"kind: Service  # \u8d44\u6e90\u7c7b\u578b\r\napiVersion: v1  # \u8d44\u6e90\u7248\u672c\r\nmetadata: # \u5143\u6570\u636e\r\n  name: service # \u8d44\u6e90\u540d\u79f0\r\n  namespace: dev # \u547d\u540d\u7a7a\u95f4\r\nspec: # \u63cf\u8ff0\r\n  selector: # \u6807\u7b7e\u9009\u62e9\u5668\uff0c\u7528\u4e8e\u786e\u5b9a\u5f53\u524dservice\u4ee3\u7406\u54ea\u4e9bpod\r\n    app: nginx\r\n  type: # Service\u7c7b\u578b\uff0c\u6307\u5b9aservice\u7684\u8bbf\u95ee\u65b9\u5f0f\r\n  clusterIP:  # \u865a\u62df\u670d\u52a1\u7684ip\u5730\u5740\r\n  sessionAffinity: # session\u4eb2\u548c\u6027\uff0c\u652f\u6301ClientIP\u3001None\u4e24\u4e2a\u9009\u9879\r\n  ports: # \u7aef\u53e3\u4fe1\u606f\r\n    - protocol: TCP \r\n      port: 3017  # service\u7aef\u53e3\r\n      targetPort: 5003 # pod\u7aef\u53e3\r\n      nodePort: 31122 # \u4e3b\u673a\u7aef\u53e3\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ClusterIP\uff1a\u9ed8\u8ba4\u503c\uff0c\u5b83\u662fKubernetes\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u7684\u865a\u62dfIP\uff0c\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee"}),"\n",(0,s.jsx)(n.li,{children:"NodePort\uff1a\u5c06Service\u901a\u8fc7\u6307\u5b9a\u7684Node\u4e0a\u7684\u7aef\u53e3\u66b4\u9732\u7ed9\u5916\u90e8\uff0c\u901a\u8fc7\u6b64\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5728\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\u670d\u52a1"}),"\n",(0,s.jsx)(n.li,{children:"LoadBalancer\uff1a\u4f7f\u7528\u5916\u63a5\u8d1f\u8f7d\u5747\u8861\u5668\u5b8c\u6210\u5230\u670d\u52a1\u7684\u8d1f\u8f7d\u5206\u53d1\uff0c\u6ce8\u610f\u6b64\u6a21\u5f0f\u9700\u8981\u5916\u90e8\u4e91\u73af\u5883\u652f\u6301"}),"\n",(0,s.jsx)(n.li,{children:"ExternalName\uff1a \u628a\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u5f15\u5165\u96c6\u7fa4\u5185\u90e8\uff0c\u76f4\u63a5\u4f7f\u7528"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"73-service\u4f7f\u7528",children:"7.3 Service\u4f7f\u7528"}),"\n",(0,s.jsx)(n.h4,{id:"731-\u5b9e\u9a8c\u73af\u5883\u51c6\u5907",children:"7.3.1 \u5b9e\u9a8c\u73af\u5883\u51c6\u5907"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4f7f\u7528service\u4e4b\u524d\uff0c\u9996\u5148\u5229\u7528Deployment\u521b\u5efa\u51fa3\u4e2apod\uff0c\u6ce8\u610f\u8981\u4e3apod\u8bbe\u7f6e",(0,s.jsx)(n.code,{children:"app=nginx-pod"}),"\u7684\u6807\u7b7e"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efadeployment.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment      \r\nmetadata:\r\n  name: pc-deployment\r\n  namespace: dev\r\nspec: \r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        ports:\r\n        - containerPort: 80\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'[root@k8s-master01 ~]# kubectl create -f deployment.yaml\r\ndeployment.apps/pc-deployment created\r\n\r\n# \u67e5\u770bpod\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\r\nNAME                             READY   STATUS     IP            NODE     LABELS\r\npc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod\r\npc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod\r\npc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod\r\n\r\n# \u4e3a\u4e86\u65b9\u4fbf\u540e\u9762\u7684\u6d4b\u8bd5\uff0c\u4fee\u6539\u4e0b\u4e09\u53f0nginx\u7684index.html\u9875\u9762\uff08\u4e09\u53f0\u4fee\u6539\u7684IP\u5730\u5740\u4e0d\u4e00\u81f4\uff09\r\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\r\n# echo "10.244.1.39" > /usr/share/nginx/html/index.html\r\n\r\n#\u4fee\u6539\u5b8c\u6bd5\u4e4b\u540e\uff0c\u8bbf\u95ee\u6d4b\u8bd5\r\n[root@k8s-master01 ~]# curl 10.244.1.39\r\n10.244.1.39\r\n[root@k8s-master01 ~]# curl 10.244.2.33\r\n10.244.2.33\r\n[root@k8s-master01 ~]# curl 10.244.1.40\r\n10.244.1.40\n'})}),"\n",(0,s.jsx)(n.h4,{id:"732-clusterip\u7c7b\u578b\u7684service",children:"7.3.2 ClusterIP\u7c7b\u578b\u7684Service"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaservice-clusterip.yaml\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: service-clusterip\r\n  namespace: dev\r\nspec:\r\n  selector:\r\n    app: nginx-pod\r\n  clusterIP: 10.97.97.97 # service\u7684ip\u5730\u5740\uff0c\u5982\u679c\u4e0d\u5199\uff0c\u9ed8\u8ba4\u4f1a\u751f\u6210\u4e00\u4e2a\r\n  type: ClusterIP\r\n  ports:\r\n  - port: 80  # Service\u7aef\u53e3       \r\n    targetPort: 80 # pod\u7aef\u53e3\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaservice\r\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\r\nservice/service-clusterip created\r\n\r\n# \u67e5\u770bservice\r\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\r\nNAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR\r\nservice-clusterip   ClusterIP   10.97.97.97   <none>        80/TCP    13s   app=nginx-pod\r\n\r\n# \u67e5\u770bservice\u7684\u8be6\u7ec6\u4fe1\u606f\r\n# \u5728\u8fd9\u91cc\u6709\u4e00\u4e2aEndpoints\u5217\u8868\uff0c\u91cc\u9762\u5c31\u662f\u5f53\u524dservice\u53ef\u4ee5\u8d1f\u8f7d\u5230\u7684\u670d\u52a1\u5165\u53e3\r\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\r\nName:              service-clusterip\r\nNamespace:         dev\r\nLabels:            <none>\r\nAnnotations:       <none>\r\nSelector:          app=nginx-pod\r\nType:              ClusterIP\r\nIP:                10.97.97.97\r\nPort:              <unset>  80/TCP\r\nTargetPort:        80/TCP\r\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\r\nSession Affinity:  None\r\nEvents:            <none>\r\n\r\n# \u67e5\u770bipvs\u7684\u6620\u5c04\u89c4\u5219\r\n[root@k8s-master01 ~]# ipvsadm -Ln\r\nTCP  10.97.97.97:80 rr\r\n  -> 10.244.1.39:80               Masq    1      0          0\r\n  -> 10.244.1.40:80               Masq    1      0          0\r\n  -> 10.244.2.33:80               Masq    1      0          0\r\n\r\n# \u8bbf\u95ee10.97.97.97:80\u89c2\u5bdf\u6548\u679c\r\n[root@k8s-master01 ~]# curl 10.97.97.97:80\r\n10.244.2.33\n"})}),"\n",(0,s.jsx)(n.h4,{id:"733-endpoint",children:"7.3.3 Endpoint"}),"\n",(0,s.jsx)(n.p,{children:"Endpoint\u662fkubernetes\u4e2d\u7684\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\uff0c\u5b58\u50a8\u5728etcd\u4e2d\uff0c\u7528\u6765\u8bb0\u5f55\u4e00\u4e2aservice\u5bf9\u5e94\u7684\u6240\u6709pod\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u5b83\u662f\u6839\u636eservice\u914d\u7f6e\u6587\u4ef6\u4e2dselector\u63cf\u8ff0\u4ea7\u751f\u7684\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u4e2aService\u7531\u4e00\u7ec4Pod\u7ec4\u6210\uff0c\u8fd9\u4e9bPod\u901a\u8fc7Endpoints\u66b4\u9732\u51fa\u6765\uff0c",(0,s.jsx)(n.strong,{children:"Endpoints\u662f\u5b9e\u73b0\u5b9e\u9645\u670d\u52a1\u7684\u7aef\u70b9\u96c6\u5408"}),"\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cservice\u548cpod\u4e4b\u95f4\u7684\u8054\u7cfb\u662f\u901a\u8fc7endpoints\u5b9e\u73b0\u7684\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200509191917069",src:r(9745).A+"",width:"1087",height:"432"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8d1f\u8f7d\u5206\u53d1\u7b56\u7565"})}),"\n",(0,s.jsx)(n.p,{children:"\u5bf9Service\u7684\u8bbf\u95ee\u88ab\u5206\u53d1\u5230\u4e86\u540e\u7aef\u7684Pod\u4e0a\u53bb\uff0c\u76ee\u524dkubernetes\u63d0\u4f9b\u4e86\u4e24\u79cd\u8d1f\u8f7d\u5206\u53d1\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4e0d\u5b9a\u4e49\uff0c\u9ed8\u8ba4\u4f7f\u7528kube-proxy\u7684\u7b56\u7565\uff0c\u6bd4\u5982\u968f\u673a\u3001\u8f6e\u8be2"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u57fa\u4e8e\u5ba2\u6237\u7aef\u5730\u5740\u7684\u4f1a\u8bdd\u4fdd\u6301\u6a21\u5f0f\uff0c\u5373\u6765\u81ea\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u8f6c\u53d1\u5230\u56fa\u5b9a\u7684\u4e00\u4e2aPod\u4e0a"}),"\n",(0,s.jsxs)(n.p,{children:["\u6b64\u6a21\u5f0f\u53ef\u4ee5\u4f7f\u5728spec\u4e2d\u6dfb\u52a0",(0,s.jsx)(n.code,{children:"sessionAffinity:ClientIP"}),"\u9009\u9879"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u67e5\u770bipvs\u7684\u6620\u5c04\u89c4\u5219\u3010rr \u8f6e\u8be2\u3011\r\n[root@k8s-master01 ~]# ipvsadm -Ln\r\nTCP  10.97.97.97:80 rr\r\n  -> 10.244.1.39:80               Masq    1      0          0\r\n  -> 10.244.1.40:80               Masq    1      0          0\r\n  -> 10.244.2.33:80               Masq    1      0          0\r\n\r\n# \u5faa\u73af\u8bbf\u95ee\u6d4b\u8bd5\r\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\r\n10.244.1.40\r\n10.244.1.39\r\n10.244.2.33\r\n10.244.1.40\r\n10.244.1.39\r\n10.244.2.33\r\n\r\n# \u4fee\u6539\u5206\u53d1\u7b56\u7565----sessionAffinity:ClientIP\r\n\r\n# \u67e5\u770bipvs\u89c4\u5219\u3010persistent \u4ee3\u8868\u6301\u4e45\u3011\r\n[root@k8s-master01 ~]# ipvsadm -Ln\r\nTCP  10.97.97.97:80 rr persistent 10800\r\n  -> 10.244.1.39:80               Masq    1      0          0\r\n  -> 10.244.1.40:80               Masq    1      0          0\r\n  -> 10.244.2.33:80               Masq    1      0          0\r\n\r\n# \u5faa\u73af\u8bbf\u95ee\u6d4b\u8bd5\r\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\r\n10.244.2.33\r\n10.244.2.33\r\n10.244.2.33\r\n  \r\n# \u5220\u9664service\r\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\r\nservice "service-clusterip" deleted\n'})}),"\n",(0,s.jsx)(n.h4,{id:"734-headliness\u7c7b\u578b\u7684service",children:"7.3.4 HeadLiness\u7c7b\u578b\u7684Service"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u67d0\u4e9b\u573a\u666f\u4e2d\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u80fd\u4e0d\u60f3\u4f7f\u7528Service\u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\uff0c\u800c\u5e0c\u671b\u81ea\u5df1\u6765\u63a7\u5236\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0ckubernetes\u63d0\u4f9b\u4e86HeadLiness Service\uff0c\u8fd9\u7c7bService\u4e0d\u4f1a\u5206\u914dCluster IP\uff0c\u5982\u679c\u60f3\u8981\u8bbf\u95eeservice\uff0c\u53ea\u80fd\u901a\u8fc7service\u7684\u57df\u540d\u8fdb\u884c\u67e5\u8be2\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaservice-headliness.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: service-headliness\r\n  namespace: dev\r\nspec:\r\n  selector:\r\n    app: nginx-pod\r\n  clusterIP: None # \u5c06clusterIP\u8bbe\u7f6e\u4e3aNone\uff0c\u5373\u53ef\u521b\u5efaheadliness Service\r\n  type: ClusterIP\r\n  ports:\r\n  - port: 80    \r\n    targetPort: 80\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaservice\r\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\r\nservice/service-headliness created\r\n\r\n# \u83b7\u53d6service\uff0c \u53d1\u73b0CLUSTER-IP\u672a\u5206\u914d\r\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\r\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR\r\nservice-headliness   ClusterIP   None         <none>        80/TCP    11s   app=nginx-pod\r\n\r\n# \u67e5\u770bservice\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\r\nName:              service-headliness\r\nNamespace:         dev\r\nLabels:            <none>\r\nAnnotations:       <none>\r\nSelector:          app=nginx-pod\r\nType:              ClusterIP\r\nIP:                None\r\nPort:              <unset>  80/TCP\r\nTargetPort:        80/TCP\r\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\r\nSession Affinity:  None\r\nEvents:            <none>\r\n\r\n# \u67e5\u770b\u57df\u540d\u7684\u89e3\u6790\u60c5\u51b5\r\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\r\n/ # cat /etc/resolv.conf\r\nnameserver 10.96.0.10\r\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\r\n\r\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\r\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40\r\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39\r\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33\n"})}),"\n",(0,s.jsx)(n.h4,{id:"735-nodeport\u7c7b\u578b\u7684service",children:"7.3.5 NodePort\u7c7b\u578b\u7684Service"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4e4b\u524d\u7684\u6837\u4f8b\u4e2d\uff0c\u521b\u5efa\u7684Service\u7684ip\u5730\u5740\u53ea\u6709\u96c6\u7fa4\u5185\u90e8\u624d\u53ef\u4ee5\u8bbf\u95ee\uff0c\u5982\u679c\u5e0c\u671b\u5c06Service\u66b4\u9732\u7ed9\u96c6\u7fa4\u5916\u90e8\u4f7f\u7528\uff0c\u90a3\u4e48\u5c31\u8981\u4f7f\u7528\u5230\u53e6\u5916\u4e00\u79cd\u7c7b\u578b\u7684Service\uff0c\u79f0\u4e3aNodePort\u7c7b\u578b\u3002NodePort\u7684\u5de5\u4f5c\u539f\u7406\u5176\u5b9e\u5c31\u662f",(0,s.jsx)(n.strong,{children:"\u5c06service\u7684\u7aef\u53e3\u6620\u5c04\u5230Node\u7684\u4e00\u4e2a\u7aef\u53e3\u4e0a"}),"\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"NodeIp:NodePort"}),"\u6765\u8bbf\u95eeservice\u4e86\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(3192).A+"",width:"543",height:"262"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaservice-nodeport.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: service-nodeport\r\n  namespace: dev\r\nspec:\r\n  selector:\r\n    app: nginx-pod\r\n  type: NodePort # service\u7c7b\u578b\r\n  ports:\r\n  - port: 80\r\n    nodePort: 30002 # \u6307\u5b9a\u7ed1\u5b9a\u7684node\u7684\u7aef\u53e3(\u9ed8\u8ba4\u7684\u53d6\u503c\u8303\u56f4\u662f\uff1a30000-32767), \u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u4f1a\u9ed8\u8ba4\u5206\u914d\r\n    targetPort: 80\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaservice\r\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\r\nservice/service-nodeport created\r\n\r\n# \u67e5\u770bservice\r\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\r\nNAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR\r\nservice-nodeport   NodePort   10.105.64.191   <none>        80:30002/TCP  app=nginx-pod\r\n\r\n# \u63a5\u4e0b\u6765\u53ef\u4ee5\u901a\u8fc7\u7535\u8111\u4e3b\u673a\u7684\u6d4f\u89c8\u5668\u53bb\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2anodeip\u768430002\u7aef\u53e3\uff0c\u5373\u53ef\u8bbf\u95ee\u5230pod\n"})}),"\n",(0,s.jsx)(n.h4,{id:"736-loadbalancer\u7c7b\u578b\u7684service",children:"7.3.6 LoadBalancer\u7c7b\u578b\u7684Service"}),"\n",(0,s.jsx)(n.p,{children:"LoadBalancer\u548cNodePort\u5f88\u76f8\u4f3c\uff0c\u76ee\u7684\u90fd\u662f\u5411\u5916\u90e8\u66b4\u9732\u4e00\u4e2a\u7aef\u53e3\uff0c\u533a\u522b\u5728\u4e8eLoadBalancer\u4f1a\u5728\u96c6\u7fa4\u7684\u5916\u90e8\u518d\u6765\u505a\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u8bbe\u5907\uff0c\u800c\u8fd9\u4e2a\u8bbe\u5907\u9700\u8981\u5916\u90e8\u73af\u5883\u652f\u6301\u7684\uff0c\u5916\u90e8\u670d\u52a1\u53d1\u9001\u5230\u8fd9\u4e2a\u8bbe\u5907\u4e0a\u7684\u8bf7\u6c42\uff0c\u4f1a\u88ab\u8bbe\u5907\u8d1f\u8f7d\u4e4b\u540e\u8f6c\u53d1\u5230\u96c6\u7fa4\u4e2d\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(8101).A+"",width:"1101",height:"419"})}),"\n",(0,s.jsx)(n.h4,{id:"737-externalname\u7c7b\u578b\u7684service",children:"7.3.7 ExternalName\u7c7b\u578b\u7684Service"}),"\n",(0,s.jsxs)(n.p,{children:["ExternalName\u7c7b\u578b\u7684Service\u7528\u4e8e\u5f15\u5165\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\uff0c\u5b83\u901a\u8fc7",(0,s.jsx)(n.code,{children:"externalName"}),"\u5c5e\u6027\u6307\u5b9a\u5916\u90e8\u4e00\u4e2a\u670d\u52a1\u7684\u5730\u5740\uff0c\u7136\u540e\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u6b64service\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u5916\u90e8\u7684\u670d\u52a1\u4e86\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(7829).A+"",width:"779",height:"304"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: service-externalname\r\n  namespace: dev\r\nspec:\r\n  type: ExternalName # service\u7c7b\u578b\r\n  externalName: www.baidu.com  #\u6539\u6210ip\u5730\u5740\u4e5f\u53ef\u4ee5\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaservice\r\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\r\nservice/service-externalname created\r\n\r\n# \u57df\u540d\u89e3\u6790\r\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\r\nservice-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.\r\nwww.baidu.com.          30      IN      CNAME   www.a.shifen.com.\r\nwww.a.shifen.com.       30      IN      A       39.156.66.18\r\nwww.a.shifen.com.       30      IN      A       39.156.66.14\n"})}),"\n",(0,s.jsx)(n.h3,{id:"74-ingress\u4ecb\u7ecd",children:"7.4 Ingress\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u524d\u9762\u8bfe\u7a0b\u4e2d\u5df2\u7ecf\u63d0\u5230\uff0cService\u5bf9\u96c6\u7fa4\u4e4b\u5916\u66b4\u9732\u670d\u52a1\u7684\u4e3b\u8981\u65b9\u5f0f\u6709\u4e24\u79cd\uff1aNotePort\u548cLoadBalancer\uff0c\u4f46\u662f\u8fd9\u4e24\u79cd\u65b9\u5f0f\uff0c\u90fd\u6709\u4e00\u5b9a\u7684\u7f3a\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NodePort\u65b9\u5f0f\u7684\u7f3a\u70b9\u662f\u4f1a\u5360\u7528\u5f88\u591a\u96c6\u7fa4\u673a\u5668\u7684\u7aef\u53e3\uff0c\u90a3\u4e48\u5f53\u96c6\u7fa4\u670d\u52a1\u53d8\u591a\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u7f3a\u70b9\u5c31\u6108\u53d1\u660e\u663e"}),"\n",(0,s.jsx)(n.li,{children:"LB\u65b9\u5f0f\u7684\u7f3a\u70b9\u662f\u6bcf\u4e2aservice\u9700\u8981\u4e00\u4e2aLB\uff0c\u6d6a\u8d39\u3001\u9ebb\u70e6\uff0c\u5e76\u4e14\u9700\u8981kubernetes\u4e4b\u5916\u8bbe\u5907\u7684\u652f\u6301"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u57fa\u4e8e\u8fd9\u79cd\u73b0\u72b6\uff0ckubernetes\u63d0\u4f9b\u4e86Ingress\u8d44\u6e90\u5bf9\u8c61\uff0cIngress\u53ea\u9700\u8981\u4e00\u4e2aNodePort\u6216\u8005\u4e00\u4e2aLB\u5c31\u53ef\u4ee5\u6ee1\u8db3\u66b4\u9732\u591a\u4e2aService\u7684\u9700\u6c42\u3002\u5de5\u4f5c\u673a\u5236\u5927\u81f4\u5982\u4e0b\u56fe\u8868\u793a\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(179).A+"",width:"992",height:"422"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5b9e\u9645\u4e0a\uff0cIngress\u76f8\u5f53\u4e8e\u4e00\u4e2a7\u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u662fkubernetes\u5bf9\u53cd\u5411\u4ee3\u7406\u7684\u4e00\u4e2a\u62bd\u8c61\uff0c\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u7c7b\u4f3c\u4e8eNginx\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u5728",(0,s.jsx)(n.strong,{children:"Ingress\u91cc\u5efa\u7acb\u8bf8\u591a\u6620\u5c04\u89c4\u5219\uff0cIngress Controller\u901a\u8fc7\u76d1\u542c\u8fd9\u4e9b\u914d\u7f6e\u89c4\u5219\u5e76\u8f6c\u5316\u6210Nginx\u7684\u53cd\u5411\u4ee3\u7406\u914d\u7f6e , \u7136\u540e\u5bf9\u5916\u90e8\u63d0\u4f9b\u670d\u52a1"}),"\u3002\u5728\u8fd9\u91cc\u6709\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ingress\uff1akubernetes\u4e2d\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f5c\u7528\u662f\u5b9a\u4e49\u8bf7\u6c42\u5982\u4f55\u8f6c\u53d1\u5230service\u7684\u89c4\u5219"}),"\n",(0,s.jsx)(n.li,{children:"ingress controller\uff1a\u5177\u4f53\u5b9e\u73b0\u53cd\u5411\u4ee3\u7406\u53ca\u8d1f\u8f7d\u5747\u8861\u7684\u7a0b\u5e8f\uff0c\u5bf9ingress\u5b9a\u4e49\u7684\u89c4\u5219\u8fdb\u884c\u89e3\u6790\uff0c\u6839\u636e\u914d\u7f6e\u7684\u89c4\u5219\u6765\u5b9e\u73b0\u8bf7\u6c42\u8f6c\u53d1\uff0c\u5b9e\u73b0\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u6bd4\u5982Nginx, Contour, Haproxy\u7b49\u7b49"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Ingress\uff08\u4ee5Nginx\u4e3a\u4f8b\uff09\u7684\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u7528\u6237\u7f16\u5199Ingress\u89c4\u5219\uff0c\u8bf4\u660e\u54ea\u4e2a\u57df\u540d\u5bf9\u5e94kubernetes\u96c6\u7fa4\u4e2d\u7684\u54ea\u4e2aService"}),"\n",(0,s.jsx)(n.li,{children:"Ingress\u63a7\u5236\u5668\u52a8\u6001\u611f\u77e5Ingress\u670d\u52a1\u89c4\u5219\u7684\u53d8\u5316\uff0c\u7136\u540e\u751f\u6210\u4e00\u6bb5\u5bf9\u5e94\u7684Nginx\u53cd\u5411\u4ee3\u7406\u914d\u7f6e"}),"\n",(0,s.jsx)(n.li,{children:"Ingress\u63a7\u5236\u5668\u4f1a\u5c06\u751f\u6210\u7684Nginx\u914d\u7f6e\u5199\u5165\u5230\u4e00\u4e2a\u8fd0\u884c\u7740\u7684Nginx\u670d\u52a1\u4e2d\uff0c\u5e76\u52a8\u6001\u66f4\u65b0"}),"\n",(0,s.jsx)(n.li,{children:"\u5230\u6b64\u4e3a\u6b62\uff0c\u5176\u5b9e\u771f\u6b63\u5728\u5de5\u4f5c\u7684\u5c31\u662f\u4e00\u4e2aNginx\u4e86\uff0c\u5185\u90e8\u914d\u7f6e\u4e86\u7528\u6237\u5b9a\u4e49\u7684\u8bf7\u6c42\u8f6c\u53d1\u89c4\u5219"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(5898).A+"",width:"906",height:"433"})}),"\n",(0,s.jsx)(n.h3,{id:"75-ingress\u4f7f\u7528",children:"7.5 Ingress\u4f7f\u7528"}),"\n",(0,s.jsx)(n.h4,{id:"751-\u73af\u5883\u51c6\u5907-\u642d\u5efaingress\u73af\u5883",children:"7.5.1 \u73af\u5883\u51c6\u5907 \u642d\u5efaingress\u73af\u5883"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-makefile",children:"# \u521b\u5efa\u6587\u4ef6\u5939\r\n[root@k8s-master01 ~]# mkdir ingress-controller\r\n[root@k8s-master01 ~]# cd ingress-controller/\r\n\r\n# \u83b7\u53d6ingress-nginx\uff0c\u672c\u6b21\u6848\u4f8b\u4f7f\u7528\u7684\u662f0.30\u7248\u672c\r\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml\r\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\r\n\r\n# \u4fee\u6539mandatory.yaml\u6587\u4ef6\u4e2d\u7684\u4ed3\u5e93\r\n# \u4fee\u6539quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\r\n# \u4e3aquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\r\n# \u521b\u5efaingress-nginx\r\n[root@k8s-master01 ingress-controller]# kubectl apply -f ./\r\n\r\n# \u67e5\u770bingress-nginx\r\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\r\nNAME                                           READY   STATUS    RESTARTS   AGE\r\npod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     Running   0          12h\r\n\r\n# \u67e5\u770bservice\r\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\r\nNAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\r\ningress-nginx   NodePort   10.98.75.163   <none>        80:32240/TCP,443:31335/TCP   11h\n"})}),"\n",(0,s.jsx)(n.h4,{id:"752-\u51c6\u5907service\u548cpod",children:"7.5.2 \u51c6\u5907service\u548cpod"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u540e\u9762\u7684\u5b9e\u9a8c\u6bd4\u8f83\u65b9\u4fbf\uff0c\u521b\u5efa\u5982\u4e0b\u56fe\u6240\u793a\u7684\u6a21\u578b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(3357).A+"",width:"910",height:"358"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efatomcat-nginx.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: nginx-deployment\r\n  namespace: dev\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: nginx-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-pod\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx:1.17.1\r\n        ports:\r\n        - containerPort: 80\r\n\r\n---\r\n\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: tomcat-deployment\r\n  namespace: dev\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: tomcat-pod\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: tomcat-pod\r\n    spec:\r\n      containers:\r\n      - name: tomcat\r\n        image: tomcat:8.5-jre10-slim\r\n        ports:\r\n        - containerPort: 8080\r\n\r\n---\r\n\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: nginx-service\r\n  namespace: dev\r\nspec:\r\n  selector:\r\n    app: nginx-pod\r\n  clusterIP: None\r\n  type: ClusterIP\r\n  ports:\r\n  - port: 80\r\n    targetPort: 80\r\n\r\n---\r\n\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: tomcat-service\r\n  namespace: dev\r\nspec:\r\n  selector:\r\n    app: tomcat-pod\r\n  clusterIP: None\r\n  type: ClusterIP\r\n  ports:\r\n  - port: 8080\r\n    targetPort: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\r\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\r\n\r\n# \u67e5\u770b\r\n[root@k8s-master01 ~]# kubectl get svc -n dev\r\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\r\nnginx-service    ClusterIP   None         <none>        80/TCP     48s\r\ntomcat-service   ClusterIP   None         <none>        8080/TCP   48s\n"})}),"\n",(0,s.jsx)(n.h4,{id:"753-http\u4ee3\u7406",children:"7.5.3 Http\u4ee3\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaingress-http.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: extensions/v1beta1\r\nkind: Ingress\r\nmetadata:\r\n  name: ingress-http\r\n  namespace: dev\r\nspec:\r\n  rules:\r\n  - host: nginx.itheima.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        backend:\r\n          serviceName: nginx-service\r\n          servicePort: 80\r\n  - host: tomcat.itheima.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        backend:\r\n          serviceName: tomcat-service\r\n          servicePort: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\r\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\r\ningress.extensions/ingress-http created\r\n\r\n# \u67e5\u770b\r\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\r\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\r\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\r\n\r\n# \u67e5\u770b\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\r\n...\r\nRules:\r\nHost                Path  Backends\r\n----                ----  --------\r\nnginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\r\ntomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\r\n...\r\n\r\n# \u63a5\u4e0b\u6765,\u5728\u672c\u5730\u7535\u8111\u4e0a\u914d\u7f6ehost\u6587\u4ef6,\u89e3\u6790\u4e0a\u9762\u7684\u4e24\u4e2a\u57df\u540d\u5230192.168.109.100(master)\u4e0a\r\n# \u7136\u540e,\u5c31\u53ef\u4ee5\u5206\u522b\u8bbf\u95eetomcat.itheima.com:32240  \u548c  nginx.itheima.com:32240 \u67e5\u770b\u6548\u679c\u4e86\n"})}),"\n",(0,s.jsx)(n.h4,{id:"754-https\u4ee3\u7406",children:"7.5.4 Https\u4ee3\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u8bc1\u4e66"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u751f\u6210\u8bc1\u4e66\r\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com"\r\n\r\n# \u521b\u5efa\u5bc6\u94a5\r\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaingress-https.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: extensions/v1beta1\r\nkind: Ingress\r\nmetadata:\r\n  name: ingress-https\r\n  namespace: dev\r\nspec:\r\n  tls:\r\n    - hosts:\r\n      - nginx.itheima.com\r\n      - tomcat.itheima.com\r\n      secretName: tls-secret # \u6307\u5b9a\u79d8\u94a5\r\n  rules:\r\n  - host: nginx.itheima.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        backend:\r\n          serviceName: nginx-service\r\n          servicePort: 80\r\n  - host: tomcat.itheima.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        backend:\r\n          serviceName: tomcat-service\r\n          servicePort: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\r\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\r\ningress.extensions/ingress-https created\r\n\r\n# \u67e5\u770b\r\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\r\nNAME            HOSTS                                  ADDRESS         PORTS     AGE\r\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\r\n\r\n# \u67e5\u770b\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\r\n...\r\nTLS:\r\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\r\nRules:\r\nHost              Path Backends\r\n----              ---- --------\r\nnginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\r\ntomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\r\n...\r\n\r\n# \u4e0b\u9762\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95eehttps://nginx.itheima.com:31335 \u548c https://tomcat.itheima.com:31335\u6765\u67e5\u770b\u4e86\n"})}),"\n",(0,s.jsx)(n.h2,{id:"8-\u6570\u636e\u5b58\u50a8",children:"8. \u6570\u636e\u5b58\u50a8"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u524d\u9762\u5df2\u7ecf\u63d0\u5230\uff0c\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u53ef\u80fd\u5f88\u77ed\uff0c\u4f1a\u88ab\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1\u3002\u90a3\u4e48\u5bb9\u5668\u5728\u9500\u6bc1\u65f6\uff0c\u4fdd\u5b58\u5728\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u6e05\u9664\u3002\u8fd9\u79cd\u7ed3\u679c\u5bf9\u7528\u6237\u6765\u8bf4\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u662f\u4e0d\u4e50\u610f\u770b\u5230\u7684\u3002\u4e3a\u4e86\u6301\u4e45\u5316\u4fdd\u5b58\u5bb9\u5668\u7684\u6570\u636e\uff0ckubernetes\u5f15\u5165\u4e86Volume\u7684\u6982\u5ff5\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Volume\u662fPod\u4e2d\u80fd\u591f\u88ab\u591a\u4e2a\u5bb9\u5668\u8bbf\u95ee\u7684\u5171\u4eab\u76ee\u5f55\uff0c\u5b83\u88ab\u5b9a\u4e49\u5728Pod\u4e0a\uff0c\u7136\u540e\u88ab\u4e00\u4e2aPod\u91cc\u7684\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u5230\u5177\u4f53\u7684\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0ckubernetes\u901a\u8fc7Volume\u5b9e\u73b0\u540c\u4e00\u4e2aPod\u4e2d\u4e0d\u540c\u5bb9\u5668\u4e4b\u95f4\u7684\u6570\u636e\u5171\u4eab\u4ee5\u53ca\u6570\u636e\u7684\u6301\u4e45\u5316\u5b58\u50a8\u3002Volume\u7684\u751f\u547d\u5bb9\u5668\u4e0d\u4e0ePod\u4e2d\u5355\u4e2a\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u76f8\u5173\uff0c\u5f53\u5bb9\u5668\u7ec8\u6b62\u6216\u8005\u91cd\u542f\u65f6\uff0cVolume\u4e2d\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002"}),"\n",(0,s.jsx)(n.p,{children:"kubernetes\u7684Volume\u652f\u6301\u591a\u79cd\u7c7b\u578b\uff0c\u6bd4\u8f83\u5e38\u89c1\u7684\u6709\u4e0b\u9762\u51e0\u4e2a\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7b80\u5355\u5b58\u50a8\uff1aEmptyDir\u3001HostPath\u3001NFS"}),"\n",(0,s.jsx)(n.li,{children:"\u9ad8\u7ea7\u5b58\u50a8\uff1aPV\u3001PVC"}),"\n",(0,s.jsx)(n.li,{children:"\u914d\u7f6e\u5b58\u50a8\uff1aConfigMap\u3001Secret"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"81-\u57fa\u672c\u5b58\u50a8",children:"8.1 \u57fa\u672c\u5b58\u50a8"}),"\n",(0,s.jsx)(n.h4,{id:"811-emptydir",children:"8.1.1 EmptyDir"}),"\n",(0,s.jsx)(n.p,{children:"EmptyDir\u662f\u6700\u57fa\u7840\u7684Volume\u7c7b\u578b\uff0c\u4e00\u4e2aEmptyDir\u5c31\u662fHost\u4e0a\u7684\u4e00\u4e2a\u7a7a\u76ee\u5f55\u3002"}),"\n",(0,s.jsx)(n.p,{children:"EmptyDir\u662f\u5728Pod\u88ab\u5206\u914d\u5230Node\u65f6\u521b\u5efa\u7684\uff0c\u5b83\u7684\u521d\u59cb\u5185\u5bb9\u4e3a\u7a7a\uff0c\u5e76\u4e14\u65e0\u987b\u6307\u5b9a\u5bbf\u4e3b\u673a\u4e0a\u5bf9\u5e94\u7684\u76ee\u5f55\u6587\u4ef6\uff0c\u56e0\u4e3akubernetes\u4f1a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a\u76ee\u5f55\uff0c\u5f53Pod\u9500\u6bc1\u65f6\uff0c EmptyDir\u4e2d\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u6c38\u4e45\u5220\u9664\u3002 EmptyDir\u7528\u9014\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e34\u65f6\u7a7a\u95f4\uff0c\u4f8b\u5982\u7528\u4e8e\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6240\u9700\u7684\u4e34\u65f6\u76ee\u5f55\uff0c\u4e14\u65e0\u987b\u6c38\u4e45\u4fdd\u7559"}),"\n",(0,s.jsx)(n.li,{children:"\u4e00\u4e2a\u5bb9\u5668\u9700\u8981\u4ece\u53e6\u4e00\u4e2a\u5bb9\u5668\u4e2d\u83b7\u53d6\u6570\u636e\u7684\u76ee\u5f55\uff08\u591a\u5bb9\u5668\u5171\u4eab\u76ee\u5f55\uff09"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e00\u4e2a\u5bb9\u5668\u4e4b\u95f4\u6587\u4ef6\u5171\u4eab\u7684\u6848\u4f8b\u6765\u4f7f\u7528\u4e00\u4e0bEmptyDir\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4e00\u4e2aPod\u4e2d\u51c6\u5907\u4e24\u4e2a\u5bb9\u5668nginx\u548cbusybox\uff0c\u7136\u540e\u58f0\u660e\u4e00\u4e2aVolume\u5206\u522b\u6302\u5728\u5230\u4e24\u4e2a\u5bb9\u5668\u7684\u76ee\u5f55\u4e2d\uff0c\u7136\u540enginx\u5bb9\u5668\u8d1f\u8d23\u5411Volume\u4e2d\u5199\u65e5\u5fd7\uff0cbusybox\u4e2d\u901a\u8fc7\u547d\u4ee4\u5c06\u65e5\u5fd7\u5185\u5bb9\u8bfb\u5230\u63a7\u5236\u53f0\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(9886).A+"",width:"971",height:"418"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2avolume-emptydir.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: volume-emptydir\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - containerPort: 80\r\n    volumeMounts:  # \u5c06logs-volume\u6302\u5728\u5230nginx\u5bb9\u5668\u4e2d\uff0c\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a /var/log/nginx\r\n    - name: logs-volume\r\n      mountPath: /var/log/nginx\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] # \u521d\u59cb\u547d\u4ee4\uff0c\u52a8\u6001\u8bfb\u53d6\u6307\u5b9a\u6587\u4ef6\u4e2d\u5185\u5bb9\r\n    volumeMounts:  # \u5c06logs-volume \u6302\u5728\u5230busybox\u5bb9\u5668\u4e2d\uff0c\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a /logs\r\n    - name: logs-volume\r\n      mountPath: /logs\r\n  volumes: # \u58f0\u660evolume\uff0c name\u4e3alogs-volume\uff0c\u7c7b\u578b\u4e3aemptyDir\r\n  - name: logs-volume\r\n    emptyDir: {}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\r\npod/volume-emptydir created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\r\nNAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... \r\nvolume-emptydir       2/2     Running   0          97s   10.42.2.9   node1  ......\r\n\r\n# \u901a\u8fc7podIp\u8bbf\u95eenginx\r\n[root@k8s-master01 ~]# curl 10.42.2.9\r\n......\r\n\r\n# \u901a\u8fc7kubectl logs\u547d\u4ee4\u67e5\u770b\u6307\u5b9a\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u51fa\r\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\r\n10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] "GET / HTTP/1.1" 200 612 "-" "curl/7.29.0" "-"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"812-hostpath",children:"8.1.2 HostPath"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u8282\u8bfe\u63d0\u5230\uff0cEmptyDir\u4e2d\u6570\u636e\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\uff0c\u5b83\u4f1a\u968f\u7740Pod\u7684\u7ed3\u675f\u800c\u9500\u6bc1\uff0c\u5982\u679c\u60f3\u7b80\u5355\u7684\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u4e3b\u673a\u4e2d\uff0c\u53ef\u4ee5\u9009\u62e9HostPath\u3002"}),"\n",(0,s.jsx)(n.p,{children:"HostPath\u5c31\u662f\u5c06Node\u4e3b\u673a\u4e2d\u4e00\u4e2a\u5b9e\u9645\u76ee\u5f55\u6302\u5728\u5230Pod\u4e2d\uff0c\u4ee5\u4f9b\u5bb9\u5668\u4f7f\u7528\uff0c\u8fd9\u6837\u7684\u8bbe\u8ba1\u5c31\u53ef\u4ee5\u4fdd\u8bc1Pod\u9500\u6bc1\u4e86\uff0c\u4f46\u662f\u6570\u636e\u4f9d\u636e\u53ef\u4ee5\u5b58\u5728\u4e8eNode\u4e3b\u673a\u4e0a\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(9644).A+"",width:"1130",height:"523"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2avolume-hostpath.yaml\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: volume-hostpath\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - containerPort: 80\r\n    volumeMounts:\r\n    - name: logs-volume\r\n      mountPath: /var/log/nginx\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","tail -f /logs/access.log"]\r\n    volumeMounts:\r\n    - name: logs-volume\r\n      mountPath: /logs\r\n  volumes:\r\n  - name: logs-volume\r\n    hostPath: \r\n      path: /root/logs\r\n      type: DirectoryOrCreate  # \u76ee\u5f55\u5b58\u5728\u5c31\u4f7f\u7528\uff0c\u4e0d\u5b58\u5728\u5c31\u5148\u521b\u5efa\u540e\u4f7f\u7528\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u5173\u4e8etype\u7684\u503c\u7684\u4e00\u70b9\u8bf4\u660e\uff1a\r\n    DirectoryOrCreate \u76ee\u5f55\u5b58\u5728\u5c31\u4f7f\u7528\uff0c\u4e0d\u5b58\u5728\u5c31\u5148\u521b\u5efa\u540e\u4f7f\u7528\r\n    Directory   \u76ee\u5f55\u5fc5\u987b\u5b58\u5728\r\n    FileOrCreate  \u6587\u4ef6\u5b58\u5728\u5c31\u4f7f\u7528\uff0c\u4e0d\u5b58\u5728\u5c31\u5148\u521b\u5efa\u540e\u4f7f\u7528\r\n    File \u6587\u4ef6\u5fc5\u987b\u5b58\u5728 \r\n    Socket  unix\u5957\u63a5\u5b57\u5fc5\u987b\u5b58\u5728\r\n    CharDevice  \u5b57\u7b26\u8bbe\u5907\u5fc5\u987b\u5b58\u5728\r\n    BlockDevice \u5757\u8bbe\u5907\u5fc5\u987b\u5b58\u5728\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaPod\r\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\r\npod/volume-hostpath created\r\n\r\n# \u67e5\u770bPod\r\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\r\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......\r\npod-volume-hostpath   2/2     Running   0          16s   10.42.2.10     node1  ......\r\n\r\n#\u8bbf\u95eenginx\r\n[root@k8s-master01 ~]# curl 10.42.2.10\r\n\r\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\r\n\r\n# \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u53bbhost\u7684/root/logs\u76ee\u5f55\u4e0b\u67e5\u770b\u5b58\u50a8\u7684\u6587\u4ef6\u4e86\r\n###  \u6ce8\u610f: \u4e0b\u9762\u7684\u64cd\u4f5c\u9700\u8981\u5230Pod\u6240\u5728\u7684\u8282\u70b9\u8fd0\u884c\uff08\u6848\u4f8b\u4e2d\u662fnode1\uff09\r\n[root@node1 ~]# ls /root/logs/\r\naccess.log  error.log\r\n\r\n# \u540c\u6837\u7684\u9053\u7406\uff0c\u5982\u679c\u5728\u6b64\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u5230\u5bb9\u5668\u4e2d\u4e5f\u662f\u53ef\u4ee5\u770b\u5230\u7684\n"})}),"\n",(0,s.jsx)(n.h4,{id:"813-nfs",children:"8.1.3 NFS"}),"\n",(0,s.jsx)(n.p,{children:"HostPath\u53ef\u4ee5\u89e3\u51b3\u6570\u636e\u6301\u4e45\u5316\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e00\u65e6Node\u8282\u70b9\u6545\u969c\u4e86\uff0cPod\u5982\u679c\u8f6c\u79fb\u5230\u4e86\u522b\u7684\u8282\u70b9\uff0c\u53c8\u4f1a\u51fa\u73b0\u95ee\u9898\u4e86\uff0c\u6b64\u65f6\u9700\u8981\u51c6\u5907\u5355\u72ec\u7684\u7f51\u7edc\u5b58\u50a8\u7cfb\u7edf\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u7528NFS\u3001CIFS\u3002"}),"\n",(0,s.jsx)(n.p,{children:"NFS\u662f\u4e00\u4e2a\u7f51\u7edc\u6587\u4ef6\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u642d\u5efa\u4e00\u53f0NFS\u670d\u52a1\u5668\uff0c\u7136\u540e\u5c06Pod\u4e2d\u7684\u5b58\u50a8\u76f4\u63a5\u8fde\u63a5\u5230NFS\u7cfb\u7edf\u4e0a\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u65e0\u8bbaPod\u5728\u8282\u70b9\u4e0a\u600e\u4e48\u8f6c\u79fb\uff0c\u53ea\u8981Node\u8ddfNFS\u7684\u5bf9\u63a5\u6ca1\u95ee\u9898\uff0c\u6570\u636e\u5c31\u53ef\u4ee5\u6210\u529f\u8bbf\u95ee\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(9e3).A+"",width:"1296",height:"389"})}),"\n",(0,s.jsx)(n.p,{children:"1\uff09\u9996\u5148\u8981\u51c6\u5907nfs\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u91cc\u4e3a\u4e86\u7b80\u5355\uff0c\u76f4\u63a5\u662fmaster\u8282\u70b9\u505anfs\u670d\u52a1\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u5728nfs\u4e0a\u5b89\u88c5nfs\u670d\u52a1\r\n[root@nfs ~]# yum install nfs-utils -y\r\n\r\n# \u51c6\u5907\u4e00\u4e2a\u5171\u4eab\u76ee\u5f55\r\n[root@nfs ~]# mkdir /root/data/nfs -pv\r\n\r\n# \u5c06\u5171\u4eab\u76ee\u5f55\u4ee5\u8bfb\u5199\u6743\u9650\u66b4\u9732\u7ed9192.168.5.0/24\u7f51\u6bb5\u4e2d\u7684\u6240\u6709\u4e3b\u673a\r\n[root@nfs ~]# vim /etc/exports\r\n[root@nfs ~]# more /etc/exports\r\n/root/data/nfs     192.168.5.0/24(rw,no_root_squash)\r\n\r\n# \u542f\u52a8nfs\u670d\u52a1\r\n[root@nfs ~]# systemctl restart nfs\n"})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09\u63a5\u4e0b\u6765\uff0c\u8981\u5728\u7684\u6bcf\u4e2anode\u8282\u70b9\u4e0a\u90fd\u5b89\u88c5\u4e0bnfs\uff0c\u8fd9\u6837\u7684\u76ee\u7684\u662f\u4e3a\u4e86node\u8282\u70b9\u53ef\u4ee5\u9a71\u52a8nfs\u8bbe\u5907"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u5728node\u4e0a\u5b89\u88c5nfs\u670d\u52a1\uff0c\u6ce8\u610f\u4e0d\u9700\u8981\u542f\u52a8\r\n[root@k8s-master01 ~]# yum install nfs-utils -y\n"})}),"\n",(0,s.jsx)(n.p,{children:"3\uff09\u63a5\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u7f16\u5199pod\u7684\u914d\u7f6e\u6587\u4ef6\u4e86\uff0c\u521b\u5efavolume-nfs.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: volume-nfs\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    ports:\r\n    - containerPort: 80\r\n    volumeMounts:\r\n    - name: logs-volume\r\n      mountPath: /var/log/nginx\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] \r\n    volumeMounts:\r\n    - name: logs-volume\r\n      mountPath: /logs\r\n  volumes:\r\n  - name: logs-volume\r\n    nfs:\r\n      server: 192.168.5.6  #nfs\u670d\u52a1\u5668\u5730\u5740\r\n      path: /root/data/nfs #\u5171\u4eab\u6587\u4ef6\u8def\u5f84\n'})}),"\n",(0,s.jsx)(n.p,{children:"4\uff09\u6700\u540e\uff0c\u8fd0\u884c\u4e0bpod\uff0c\u89c2\u5bdf\u7ed3\u679c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\r\npod/volume-nfs created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\r\nNAME                  READY   STATUS    RESTARTS   AGE\r\nvolume-nfs        2/2     Running   0          2m9s\r\n\r\n# \u67e5\u770bnfs\u670d\u52a1\u5668\u4e0a\u7684\u5171\u4eab\u76ee\u5f55\uff0c\u53d1\u73b0\u5df2\u7ecf\u6709\u6587\u4ef6\u4e86\r\n[root@k8s-master01 ~]# ls /root/data/\r\naccess.log  error.log\n"})}),"\n",(0,s.jsx)(n.h3,{id:"82-\u9ad8\u7ea7\u5b58\u50a8",children:"8.2 \u9ad8\u7ea7\u5b58\u50a8"}),"\n",(0,s.jsx)(n.p,{children:"\u524d\u9762\u5df2\u7ecf\u5b66\u4e60\u4e86\u4f7f\u7528NFS\u63d0\u4f9b\u5b58\u50a8\uff0c\u6b64\u65f6\u5c31\u8981\u6c42\u7528\u6237\u4f1a\u642d\u5efaNFS\u7cfb\u7edf\uff0c\u5e76\u4e14\u4f1a\u5728yaml\u914d\u7f6enfs\u3002\u7531\u4e8ekubernetes\u652f\u6301\u7684\u5b58\u50a8\u7cfb\u7edf\u6709\u5f88\u591a\uff0c\u8981\u6c42\u5ba2\u6237\u5168\u90fd\u638c\u63e1\uff0c\u663e\u7136\u4e0d\u73b0\u5b9e\u3002\u4e3a\u4e86\u80fd\u591f\u5c4f\u853d\u5e95\u5c42\u5b58\u50a8\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u65b9\u4fbf\u7528\u6237\u4f7f\u7528\uff0c kubernetes\u5f15\u5165PV\u548cPVC\u4e24\u79cd\u8d44\u6e90\u5bf9\u8c61\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"PV\uff08Persistent Volume\uff09\u662f\u6301\u4e45\u5316\u5377\u7684\u610f\u601d\uff0c\u662f\u5bf9\u5e95\u5c42\u7684\u5171\u4eab\u5b58\u50a8\u7684\u4e00\u79cd\u62bd\u8c61\u3002\u4e00\u822c\u60c5\u51b5\u4e0bPV\u7531kubernetes\u7ba1\u7406\u5458\u8fdb\u884c\u521b\u5efa\u548c\u914d\u7f6e\uff0c\u5b83\u4e0e\u5e95\u5c42\u5177\u4f53\u7684\u5171\u4eab\u5b58\u50a8\u6280\u672f\u6709\u5173\uff0c\u5e76\u901a\u8fc7\u63d2\u4ef6\u5b8c\u6210\u4e0e\u5171\u4eab\u5b58\u50a8\u7684\u5bf9\u63a5\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"PVC\uff08Persistent Volume Claim\uff09\u662f\u6301\u4e45\u5377\u58f0\u660e\u7684\u610f\u601d\uff0c\u662f\u7528\u6237\u5bf9\u4e8e\u5b58\u50a8\u9700\u6c42\u7684\u4e00\u79cd\u58f0\u660e\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cPVC\u5176\u5b9e\u5c31\u662f\u7528\u6237\u5411kubernetes\u7cfb\u7edf\u53d1\u51fa\u7684\u4e00\u79cd\u8d44\u6e90\u9700\u6c42\u7533\u8bf7\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(3679).A+"",width:"1099",height:"642"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u4e86PV\u548cPVC\u4e4b\u540e\uff0c\u5de5\u4f5c\u53ef\u4ee5\u5f97\u5230\u8fdb\u4e00\u6b65\u7684\u7ec6\u5206\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b58\u50a8\uff1a\u5b58\u50a8\u5de5\u7a0b\u5e08\u7ef4\u62a4"}),"\n",(0,s.jsx)(n.li,{children:"PV\uff1a kubernetes\u7ba1\u7406\u5458\u7ef4\u62a4"}),"\n",(0,s.jsx)(n.li,{children:"PVC\uff1akubernetes\u7528\u6237\u7ef4\u62a4"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"821-pv",children:"8.2.1 PV"}),"\n",(0,s.jsx)(n.p,{children:"PV\u662f\u5b58\u50a8\u8d44\u6e90\u7684\u62bd\u8c61\uff0c\u4e0b\u9762\u662f\u8d44\u6e90\u6e05\u5355\u6587\u4ef6:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1  \r\nkind: PersistentVolume\r\nmetadata:\r\n  name: pv2\r\nspec:\r\n  nfs: # \u5b58\u50a8\u7c7b\u578b\uff0c\u4e0e\u5e95\u5c42\u771f\u6b63\u5b58\u50a8\u5bf9\u5e94\r\n  capacity:  # \u5b58\u50a8\u80fd\u529b\uff0c\u76ee\u524d\u53ea\u652f\u6301\u5b58\u50a8\u7a7a\u95f4\u7684\u8bbe\u7f6e\r\n    storage: 2Gi\r\n  accessModes:  # \u8bbf\u95ee\u6a21\u5f0f\r\n  storageClassName: # \u5b58\u50a8\u7c7b\u522b\r\n  persistentVolumeReclaimPolicy: # \u56de\u6536\u7b56\u7565\n"})}),"\n",(0,s.jsx)(n.p,{children:"PV \u7684\u5173\u952e\u914d\u7f6e\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b58\u50a8\u7c7b\u578b"})}),"\n",(0,s.jsx)(n.p,{children:"\u5e95\u5c42\u5b9e\u9645\u5b58\u50a8\u7684\u7c7b\u578b\uff0ckubernetes\u652f\u6301\u591a\u79cd\u5b58\u50a8\u7c7b\u578b\uff0c\u6bcf\u79cd\u5b58\u50a8\u7c7b\u578b\u7684\u914d\u7f6e\u90fd\u6709\u6240\u5dee\u5f02"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b58\u50a8\u80fd\u529b\uff08capacity\uff09"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u76ee\u524d\u53ea\u652f\u6301\u5b58\u50a8\u7a7a\u95f4\u7684\u8bbe\u7f6e( storage=1Gi )\uff0c\u4e0d\u8fc7\u672a\u6765\u53ef\u80fd\u4f1a\u52a0\u5165IOPS\u3001\u541e\u5410\u91cf\u7b49\u6307\u6807\u7684\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8bbf\u95ee\u6a21\u5f0f\uff08accessModes\uff09"})}),"\n",(0,s.jsx)(n.p,{children:"\u7528\u4e8e\u63cf\u8ff0\u7528\u6237\u5e94\u7528\u5bf9\u5b58\u50a8\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u8bbf\u95ee\u6743\u9650\u5305\u62ec\u4e0b\u9762\u51e0\u79cd\u65b9\u5f0f\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ReadWriteOnce\uff08RWO\uff09\uff1a\u8bfb\u5199\u6743\u9650\uff0c\u4f46\u662f\u53ea\u80fd\u88ab\u5355\u4e2a\u8282\u70b9\u6302\u8f7d"}),"\n",(0,s.jsx)(n.li,{children:"ReadOnlyMany\uff08ROX\uff09\uff1a \u53ea\u8bfb\u6743\u9650\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u8282\u70b9\u6302\u8f7d"}),"\n",(0,s.jsx)(n.li,{children:"ReadWriteMany\uff08RWX\uff09\uff1a\u8bfb\u5199\u6743\u9650\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u8282\u70b9\u6302\u8f7d"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5e95\u5c42\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u578b\u53ef\u80fd\u652f\u6301\u7684\u8bbf\u95ee\u6a21\u5f0f\u4e0d\u540c"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u56de\u6536\u7b56\u7565\uff08persistentVolumeReclaimPolicy\uff09"})}),"\n",(0,s.jsx)(n.p,{children:"\u5f53PV\u4e0d\u518d\u88ab\u4f7f\u7528\u4e86\u4e4b\u540e\uff0c\u5bf9\u5176\u7684\u5904\u7406\u65b9\u5f0f\u3002\u76ee\u524d\u652f\u6301\u4e09\u79cd\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Retain \uff08\u4fdd\u7559\uff09 \u4fdd\u7559\u6570\u636e\uff0c\u9700\u8981\u7ba1\u7406\u5458\u624b\u5de5\u6e05\u7406\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"Recycle\uff08\u56de\u6536\uff09 \u6e05\u9664 PV \u4e2d\u7684\u6570\u636e\uff0c\u6548\u679c\u76f8\u5f53\u4e8e\u6267\u884c rm -rf /thevolume/*"}),"\n",(0,s.jsx)(n.li,{children:"Delete \uff08\u5220\u9664\uff09 \u4e0e PV \u76f8\u8fde\u7684\u540e\u7aef\u5b58\u50a8\u5b8c\u6210 volume \u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5f53\u7136\u8fd9\u5e38\u89c1\u4e8e\u4e91\u670d\u52a1\u5546\u7684\u5b58\u50a8\u670d\u52a1"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5e95\u5c42\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u578b\u53ef\u80fd\u652f\u6301\u7684\u56de\u6536\u7b56\u7565\u4e0d\u540c"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b58\u50a8\u7c7b\u522b"})}),"\n",(0,s.jsx)(n.p,{children:"PV\u53ef\u4ee5\u901a\u8fc7storageClassName\u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u5b58\u50a8\u7c7b\u522b"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5177\u6709\u7279\u5b9a\u7c7b\u522b\u7684PV\u53ea\u80fd\u4e0e\u8bf7\u6c42\u4e86\u8be5\u7c7b\u522b\u7684PVC\u8fdb\u884c\u7ed1\u5b9a"}),"\n",(0,s.jsx)(n.li,{children:"\u672a\u8bbe\u5b9a\u7c7b\u522b\u7684PV\u5219\u53ea\u80fd\u4e0e\u4e0d\u8bf7\u6c42\u4efb\u4f55\u7c7b\u522b\u7684PVC\u8fdb\u884c\u7ed1\u5b9a"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u72b6\u6001\uff08status\uff09"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e2a PV \u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5904\u4e8e4\u4e2d\u4e0d\u540c\u7684\u9636\u6bb5\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Available\uff08\u53ef\u7528\uff09\uff1a \u8868\u793a\u53ef\u7528\u72b6\u6001\uff0c\u8fd8\u672a\u88ab\u4efb\u4f55 PVC \u7ed1\u5b9a"}),"\n",(0,s.jsx)(n.li,{children:"Bound\uff08\u5df2\u7ed1\u5b9a\uff09\uff1a \u8868\u793a PV \u5df2\u7ecf\u88ab PVC \u7ed1\u5b9a"}),"\n",(0,s.jsx)(n.li,{children:"Released\uff08\u5df2\u91ca\u653e\uff09\uff1a \u8868\u793a PVC \u88ab\u5220\u9664\uff0c\u4f46\u662f\u8d44\u6e90\u8fd8\u672a\u88ab\u96c6\u7fa4\u91cd\u65b0\u58f0\u660e"}),"\n",(0,s.jsx)(n.li,{children:"Failed\uff08\u5931\u8d25\uff09\uff1a \u8868\u793a\u8be5 PV \u7684\u81ea\u52a8\u56de\u6536\u5931\u8d25"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b9e\u9a8c"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528NFS\u4f5c\u4e3a\u5b58\u50a8\uff0c\u6765\u6f14\u793aPV\u7684\u4f7f\u7528\uff0c\u521b\u5efa3\u4e2aPV\uff0c\u5bf9\u5e94NFS\u4e2d\u76843\u4e2a\u66b4\u9732\u7684\u8def\u5f84\u3002"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u51c6\u5907NFS\u73af\u5883"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u76ee\u5f55\r\n[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv\r\n\r\n# \u66b4\u9732\u670d\u52a1\r\n[root@nfs ~]# more /etc/exports\r\n/root/data/pv1     192.168.5.0/24(rw,no_root_squash)\r\n/root/data/pv2     192.168.5.0/24(rw,no_root_squash)\r\n/root/data/pv3     192.168.5.0/24(rw,no_root_squash)\r\n\r\n# \u91cd\u542f\u670d\u52a1\r\n[root@nfs ~]#  systemctl restart nfs\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efapv.yaml"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  name:  pv1\r\nspec:\r\n  capacity: \r\n    storage: 1Gi\r\n  accessModes:\r\n  - ReadWriteMany\r\n  persistentVolumeReclaimPolicy: Retain\r\n  nfs:\r\n    path: /root/data/pv1\r\n    server: 192.168.5.6\r\n\r\n---\r\n\r\napiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  name:  pv2\r\nspec:\r\n  capacity: \r\n    storage: 2Gi\r\n  accessModes:\r\n  - ReadWriteMany\r\n  persistentVolumeReclaimPolicy: Retain\r\n  nfs:\r\n    path: /root/data/pv2\r\n    server: 192.168.5.6\r\n    \r\n---\r\n\r\napiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  name:  pv3\r\nspec:\r\n  capacity: \r\n    storage: 3Gi\r\n  accessModes:\r\n  - ReadWriteMany\r\n  persistentVolumeReclaimPolicy: Retain\r\n  nfs:\r\n    path: /root/data/pv3\r\n    server: 192.168.5.6\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa pv\r\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\r\npersistentvolume/pv1 created\r\npersistentvolume/pv2 created\r\npersistentvolume/pv3 created\r\n\r\n# \u67e5\u770bpv\r\n[root@k8s-master01 ~]# kubectl get pv -o wide\r\nNAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE\r\npv1    1Gi        RWX            Retain        Available    10s   Filesystem\r\npv2    2Gi        RWX            Retain        Available    10s   Filesystem\r\npv3    3Gi        RWX            Retain        Available    9s    Filesystem\n"})}),"\n",(0,s.jsx)(n.h4,{id:"822-pvc",children:"8.2.2 PVC"}),"\n",(0,s.jsx)(n.p,{children:"PVC\u662f\u8d44\u6e90\u7684\u7533\u8bf7\uff0c\u7528\u6765\u58f0\u660e\u5bf9\u5b58\u50a8\u7a7a\u95f4\u3001\u8bbf\u95ee\u6a21\u5f0f\u3001\u5b58\u50a8\u7c7b\u522b\u9700\u6c42\u4fe1\u606f\u3002\u4e0b\u9762\u662f\u8d44\u6e90\u6e05\u5355\u6587\u4ef6:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pvc\r\n  namespace: dev\r\nspec:\r\n  accessModes: # \u8bbf\u95ee\u6a21\u5f0f\r\n  selector: # \u91c7\u7528\u6807\u7b7e\u5bf9PV\u9009\u62e9\r\n  storageClassName: # \u5b58\u50a8\u7c7b\u522b\r\n  resources: # \u8bf7\u6c42\u7a7a\u95f4\r\n    requests:\r\n      storage: 5Gi\n"})}),"\n",(0,s.jsx)(n.p,{children:"PVC \u7684\u5173\u952e\u914d\u7f6e\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"\u8bbf\u95ee\u6a21\u5f0f\uff08accessModes\uff09"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u7528\u4e8e\u63cf\u8ff0\u7528\u6237\u5e94\u7528\u5bf9\u5b58\u50a8\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u9009\u62e9\u6761\u4ef6\uff08selector\uff09"})}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u8fc7Label Selector\u7684\u8bbe\u7f6e\uff0c\u53ef\u4f7fPVC\u5bf9\u4e8e\u7cfb\u7edf\u4e2d\u5df1\u5b58\u5728\u7684PV\u8fdb\u884c\u7b5b\u9009"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b58\u50a8\u7c7b\u522b\uff08storageClassName\uff09"})}),"\n",(0,s.jsx)(n.p,{children:"PVC\u5728\u5b9a\u4e49\u65f6\u53ef\u4ee5\u8bbe\u5b9a\u9700\u8981\u7684\u540e\u7aef\u5b58\u50a8\u7684\u7c7b\u522b\uff0c\u53ea\u6709\u8bbe\u7f6e\u4e86\u8be5class\u7684pv\u624d\u80fd\u88ab\u7cfb\u7edf\u9009\u51fa"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u8bf7\u6c42\uff08Resources \uff09"})}),"\n",(0,s.jsx)(n.p,{children:"\u63cf\u8ff0\u5bf9\u5b58\u50a8\u8d44\u6e90\u7684\u8bf7\u6c42"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b9e\u9a8c"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efapvc.yaml\uff0c\u7533\u8bf7pv"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pvc1\r\n  namespace: dev\r\nspec:\r\n  accessModes: \r\n  - ReadWriteMany\r\n  resources:\r\n    requests:\r\n      storage: 1Gi\r\n---\r\napiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pvc2\r\n  namespace: dev\r\nspec:\r\n  accessModes: \r\n  - ReadWriteMany\r\n  resources:\r\n    requests:\r\n      storage: 1Gi\r\n---\r\napiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pvc3\r\n  namespace: dev\r\nspec:\r\n  accessModes: \r\n  - ReadWriteMany\r\n  resources:\r\n    requests:\r\n      storage: 1Gi\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapvc\r\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\r\npersistentvolumeclaim/pvc1 created\r\npersistentvolumeclaim/pvc2 created\r\npersistentvolumeclaim/pvc3 created\r\n\r\n# \u67e5\u770bpvc\r\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\r\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE\r\npvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem\r\npvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem\r\npvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem\r\n\r\n# \u67e5\u770bpv\r\n[root@k8s-master01 ~]# kubectl get pv -o wide\r\nNAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE\r\npv1    1Gi        RWx        Retain          Bound    dev/pvc1    3h37m    Filesystem\r\npv2    2Gi        RWX        Retain          Bound    dev/pvc2    3h37m    Filesystem\r\npv3    3Gi        RWX        Retain          Bound    dev/pvc3    3h37m    Filesystem   \n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efapods.yaml, \u4f7f\u7528pv"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod1\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","while true;do echo pod1 >> /root/out.txt; sleep 10; done;"]\r\n    volumeMounts:\r\n    - name: volume\r\n      mountPath: /root/\r\n  volumes:\r\n    - name: volume\r\n      persistentVolumeClaim:\r\n        claimName: pvc1\r\n        readOnly: false\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod2\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: busybox\r\n    image: busybox:1.30\r\n    command: ["/bin/sh","-c","while true;do echo pod2 >> /root/out.txt; sleep 10; done;"]\r\n    volumeMounts:\r\n    - name: volume\r\n      mountPath: /root/\r\n  volumes:\r\n    - name: volume\r\n      persistentVolumeClaim:\r\n        claimName: pvc2\r\n        readOnly: false\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\r\npod/pod1 created\r\npod/pod2 created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\r\nNAME   READY   STATUS    RESTARTS   AGE   IP            NODE   \r\npod1   1/1     Running   0          14s   10.244.1.69   node1   \r\npod2   1/1     Running   0          14s   10.244.1.70   node1  \r\n\r\n# \u67e5\u770bpvc\r\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\r\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE\r\npvc1   Bound    pv1      1Gi        RWX               94m   Filesystem\r\npvc2   Bound    pv2      2Gi        RWX               94m   Filesystem\r\npvc3   Bound    pv3      3Gi        RWX               94m   Filesystem\r\n\r\n# \u67e5\u770bpv\r\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\r\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE\r\npv1    1Gi        RWX            Retain           Bound    dev/pvc1    5h11m   Filesystem\r\npv2    2Gi        RWX            Retain           Bound    dev/pvc2    5h11m   Filesystem\r\npv3    3Gi        RWX            Retain           Bound    dev/pvc3    5h11m   Filesystem\r\n\r\n# \u67e5\u770bnfs\u4e2d\u7684\u6587\u4ef6\u5b58\u50a8\r\n[root@nfs ~]# more /root/data/pv1/out.txt\r\nnode1\r\nnode1\r\n[root@nfs ~]# more /root/data/pv2/out.txt\r\nnode2\r\nnode2\n"})}),"\n",(0,s.jsx)(n.h4,{id:"823-\u751f\u547d\u5468\u671f",children:"8.2.3 \u751f\u547d\u5468\u671f"}),"\n",(0,s.jsx)(n.p,{children:"PVC\u548cPV\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0cPV\u548cPVC\u4e4b\u95f4\u7684\u76f8\u4e92\u4f5c\u7528\u9075\u5faa\u4ee5\u4e0b\u751f\u547d\u5468\u671f\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u4f9b\u5e94"}),"\uff1a\u7ba1\u7406\u5458\u624b\u52a8\u521b\u5efa\u5e95\u5c42\u5b58\u50a8\u548cPV"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u7ed1\u5b9a"}),"\uff1a\u7528\u6237\u521b\u5efaPVC\uff0ckubernetes\u8d1f\u8d23\u6839\u636ePVC\u7684\u58f0\u660e\u53bb\u5bfb\u627ePV\uff0c\u5e76\u7ed1\u5b9a"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u7528\u6237\u5b9a\u4e49\u597dPVC\u4e4b\u540e\uff0c\u7cfb\u7edf\u5c06\u6839\u636ePVC\u5bf9\u5b58\u50a8\u8d44\u6e90\u7684\u8bf7\u6c42\u5728\u5df2\u5b58\u5728\u7684PV\u4e2d\u9009\u62e9\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e00\u65e6\u627e\u5230\uff0c\u5c31\u5c06\u8be5PV\u4e0e\u7528\u6237\u5b9a\u4e49\u7684PVC\u8fdb\u884c\u7ed1\u5b9a\uff0c\u7528\u6237\u7684\u5e94\u7528\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2aPVC\u4e86"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u627e\u4e0d\u5230\uff0cPVC\u5219\u4f1a\u65e0\u9650\u671f\u5904\u4e8ePending\u72b6\u6001\uff0c\u76f4\u5230\u7b49\u5230\u7cfb\u7edf\u7ba1\u7406\u5458\u521b\u5efa\u4e86\u4e00\u4e2a\u7b26\u5408\u5176\u8981\u6c42\u7684PV"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"PV\u4e00\u65e6\u7ed1\u5b9a\u5230\u67d0\u4e2aPVC\u4e0a\uff0c\u5c31\u4f1a\u88ab\u8fd9\u4e2aPVC\u72ec\u5360\uff0c\u4e0d\u80fd\u518d\u4e0e\u5176\u4ed6PVC\u8fdb\u884c\u7ed1\u5b9a\u4e86"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u4f7f\u7528"}),"\uff1a\u7528\u6237\u53ef\u5728pod\u4e2d\u50cfvolume\u4e00\u6837\u4f7f\u7528pvc"]}),"\n",(0,s.jsx)(n.p,{children:"Pod\u4f7f\u7528Volume\u7684\u5b9a\u4e49\uff0c\u5c06PVC\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u7684\u67d0\u4e2a\u8def\u5f84\u8fdb\u884c\u4f7f\u7528\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u91ca\u653e"}),"\uff1a\u7528\u6237\u5220\u9664pvc\u6765\u91ca\u653epv"]}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u5b58\u50a8\u8d44\u6e90\u4f7f\u7528\u5b8c\u6bd5\u540e\uff0c\u7528\u6237\u53ef\u4ee5\u5220\u9664PVC\uff0c\u4e0e\u8be5PVC\u7ed1\u5b9a\u7684PV\u5c06\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5df2\u91ca\u653e\u201d\uff0c\u4f46\u8fd8\u4e0d\u80fd\u7acb\u523b\u4e0e\u5176\u4ed6PVC\u8fdb\u884c\u7ed1\u5b9a\u3002\u901a\u8fc7\u4e4b\u524dPVC\u5199\u5165\u7684\u6570\u636e\u53ef\u80fd\u8fd8\u88ab\u7559\u5728\u5b58\u50a8\u8bbe\u5907\u4e0a\uff0c\u53ea\u6709\u5728\u6e05\u9664\u4e4b\u540e\u8be5PV\u624d\u80fd\u518d\u6b21\u4f7f\u7528\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u56de\u6536"}),"\uff1akubernetes\u6839\u636epv\u8bbe\u7f6e\u7684\u56de\u6536\u7b56\u7565\u8fdb\u884c\u8d44\u6e90\u7684\u56de\u6536"]}),"\n",(0,s.jsx)(n.p,{children:"\u5bf9\u4e8ePV\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u8bbe\u5b9a\u56de\u6536\u7b56\u7565\uff0c\u7528\u4e8e\u8bbe\u7f6e\u4e0e\u4e4b\u7ed1\u5b9a\u7684PVC\u91ca\u653e\u8d44\u6e90\u4e4b\u540e\u5982\u4f55\u5904\u7406\u9057\u7559\u6570\u636e\u7684\u95ee\u9898\u3002\u53ea\u6709PV\u7684\u5b58\u50a8\u7a7a\u95f4\u5b8c\u6210\u56de\u6536\uff0c\u624d\u80fd\u4f9b\u65b0\u7684PVC\u7ed1\u5b9a\u548c\u4f7f\u7528"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(8276).A+"",width:"1219",height:"542"})}),"\n",(0,s.jsx)(n.h3,{id:"83-\u914d\u7f6e\u5b58\u50a8",children:"8.3 \u914d\u7f6e\u5b58\u50a8"}),"\n",(0,s.jsx)(n.h4,{id:"831-configmap",children:"8.3.1 ConfigMap"}),"\n",(0,s.jsx)(n.p,{children:"ConfigMap\u662f\u4e00\u79cd\u6bd4\u8f83\u7279\u6b8a\u7684\u5b58\u50a8\u5377\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u7528\u6765\u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\u7684\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efaconfigmap.yaml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: configmap\r\n  namespace: dev\r\ndata:\r\n  info: |\r\n    username:admin\r\n    password:123456\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528\u6b64\u914d\u7f6e\u6587\u4ef6\u521b\u5efaconfigmap"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaconfigmap\r\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\r\nconfigmap/configmap created\r\n\r\n# \u67e5\u770bconfigmap\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\r\nName:         configmap\r\nNamespace:    dev\r\nLabels:       <none>\r\nAnnotations:  <none>\r\n\r\nData\r\n====\r\ninfo:\r\n----\r\nusername:admin\r\npassword:123456\r\n\r\nEvents:  <none>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2apod-configmap.yaml\uff0c\u5c06\u4e0a\u9762\u521b\u5efa\u7684configmap\u6302\u8f7d\u8fdb\u53bb"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-configmap\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    volumeMounts: # \u5c06configmap\u6302\u8f7d\u5230\u76ee\u5f55\r\n    - name: config\r\n      mountPath: /configmap/config\r\n  volumes: # \u5f15\u7528configmap\r\n  - name: config\r\n    configMap:\r\n      name: configmap\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\r\npod/pod-configmap created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\r\nNAME            READY   STATUS    RESTARTS   AGE\r\npod-configmap   1/1     Running   0          6s\r\n\r\n#\u8fdb\u5165\u5bb9\u5668\r\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\r\n# cd /configmap/config/\r\n# ls\r\ninfo\r\n# more info\r\nusername:admin\r\npassword:123456\r\n\r\n# \u53ef\u4ee5\u770b\u5230\u6620\u5c04\u5df2\u7ecf\u6210\u529f\uff0c\u6bcf\u4e2aconfigmap\u90fd\u6620\u5c04\u6210\u4e86\u4e00\u4e2a\u76ee\u5f55\r\n# key---\x3e\u6587\u4ef6     value----\x3e\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\r\n# \u6b64\u65f6\u5982\u679c\u66f4\u65b0configmap\u7684\u5185\u5bb9, \u5bb9\u5668\u4e2d\u7684\u503c\u4e5f\u4f1a\u52a8\u6001\u66f4\u65b0\n"})}),"\n",(0,s.jsx)(n.h4,{id:"832-secret",children:"8.3.2 Secret"}),"\n",(0,s.jsx)(n.p,{children:"\u5728kubernetes\u4e2d\uff0c\u8fd8\u5b58\u5728\u4e00\u79cd\u548cConfigMap\u975e\u5e38\u7c7b\u4f3c\u7684\u5bf9\u8c61\uff0c\u79f0\u4e3aSecret\u5bf9\u8c61\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u654f\u611f\u4fe1\u606f\uff0c\u4f8b\u5982\u5bc6\u7801\u3001\u79d8\u94a5\u3001\u8bc1\u4e66\u7b49\u7b49\u3002"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u9996\u5148\u4f7f\u7528base64\u5bf9\u6570\u636e\u8fdb\u884c\u7f16\u7801"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 ~]# echo -n 'admin' | base64 #\u51c6\u5907username\r\nYWRtaW4=\r\n[root@k8s-master01 ~]# echo -n '123456' | base64 #\u51c6\u5907password\r\nMTIzNDU2\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u63a5\u4e0b\u6765\u7f16\u5199secret.yaml\uff0c\u5e76\u521b\u5efaSecret"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: secret\r\n  namespace: dev\r\ntype: Opaque\r\ndata:\r\n  username: YWRtaW4=\r\n  password: MTIzNDU2\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efasecret\r\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\r\nsecret/secret created\r\n\r\n# \u67e5\u770bsecret\u8be6\u60c5\r\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\r\nName:         secret\r\nNamespace:    dev\r\nLabels:       <none>\r\nAnnotations:  <none>\r\nType:  Opaque\r\nData\r\n====\r\npassword:  6 bytes\r\nusername:  5 bytes\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efapod-secret.yaml\uff0c\u5c06\u4e0a\u9762\u521b\u5efa\u7684secret\u6302\u8f7d\u8fdb\u53bb\uff1a"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-secret\r\n  namespace: dev\r\nspec:\r\n  containers:\r\n  - name: nginx\r\n    image: nginx:1.17.1\r\n    volumeMounts: # \u5c06secret\u6302\u8f7d\u5230\u76ee\u5f55\r\n    - name: config\r\n      mountPath: /secret/config\r\n  volumes:\r\n  - name: config\r\n    secret:\r\n      secretName: secret\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efapod\r\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\r\npod/pod-secret created\r\n\r\n# \u67e5\u770bpod\r\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\r\nNAME            READY   STATUS    RESTARTS   AGE\r\npod-secret      1/1     Running   0          2m28s\r\n\r\n# \u8fdb\u5165\u5bb9\u5668\uff0c\u67e5\u770bsecret\u4fe1\u606f\uff0c\u53d1\u73b0\u5df2\u7ecf\u81ea\u52a8\u89e3\u7801\u4e86\r\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\r\n/ # ls /secret/config/\r\npassword  username\r\n/ # more /secret/config/username\r\nadmin\r\n/ # more /secret/config/password\r\n123456\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u81f3\u6b64\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5229\u7528secret\u5b9e\u73b0\u4e86\u4fe1\u606f\u7684\u7f16\u7801\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"9-\u5b89\u5168\u8ba4\u8bc1",children:"9. \u5b89\u5168\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.h3,{id:"91-\u8bbf\u95ee\u63a7\u5236\u6982\u8ff0",children:"9.1 \u8bbf\u95ee\u63a7\u5236\u6982\u8ff0"}),"\n",(0,s.jsxs)(n.p,{children:["Kubernetes\u4f5c\u4e3a\u4e00\u4e2a\u5206\u5e03\u5f0f\u96c6\u7fa4\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4fdd\u8bc1\u96c6\u7fa4\u7684\u5b89\u5168\u6027\u662f\u5176\u4e00\u4e2a\u91cd\u8981\u7684\u4efb\u52a1\u3002\u6240\u8c13\u7684\u5b89\u5168\u6027\u5176\u5b9e\u5c31\u662f\u4fdd\u8bc1\u5bf9Kubernetes\u7684\u5404\u79cd",(0,s.jsx)(n.strong,{children:"\u5ba2\u6237\u7aef"}),"\u8fdb\u884c",(0,s.jsx)(n.strong,{children:"\u8ba4\u8bc1\u548c\u9274\u6743"}),"\u64cd\u4f5c\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5ba2\u6237\u7aef"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u5ba2\u6237\u7aef\u901a\u5e38\u6709\u4e24\u7c7b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User Account"}),"\uff1a\u4e00\u822c\u662f\u72ec\u7acb\u4e8ekubernetes\u4e4b\u5916\u7684\u5176\u4ed6\u670d\u52a1\u7ba1\u7406\u7684\u7528\u6237\u8d26\u53f7\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service Account"}),"\uff1akubernetes\u7ba1\u7406\u7684\u8d26\u53f7\uff0c\u7528\u4e8e\u4e3aPod\u4e2d\u7684\u670d\u52a1\u8fdb\u7a0b\u5728\u8bbf\u95eeKubernetes\u65f6\u63d0\u4f9b\u8eab\u4efd\u6807\u8bc6\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(1660).A+"",width:"857",height:"287"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8ba4\u8bc1\u3001\u6388\u6743\u4e0e\u51c6\u5165\u63a7\u5236"})}),"\n",(0,s.jsx)(n.p,{children:"ApiServer\u662f\u8bbf\u95ee\u53ca\u7ba1\u7406\u8d44\u6e90\u5bf9\u8c61\u7684\u552f\u4e00\u5165\u53e3\u3002\u4efb\u4f55\u4e00\u4e2a\u8bf7\u6c42\u8bbf\u95eeApiServer\uff0c\u90fd\u8981\u7ecf\u8fc7\u4e0b\u9762\u4e09\u4e2a\u6d41\u7a0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Authentication\uff08\u8ba4\u8bc1\uff09\uff1a\u8eab\u4efd\u9274\u522b\uff0c\u53ea\u6709\u6b63\u786e\u7684\u8d26\u53f7\u624d\u80fd\u591f\u901a\u8fc7\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.li,{children:"Authorization\uff08\u6388\u6743\uff09\uff1a \u5224\u65ad\u7528\u6237\u662f\u5426\u6709\u6743\u9650\u5bf9\u8bbf\u95ee\u7684\u8d44\u6e90\u6267\u884c\u7279\u5b9a\u7684\u52a8\u4f5c"}),"\n",(0,s.jsx)(n.li,{children:"Admission Control\uff08\u51c6\u5165\u63a7\u5236\uff09\uff1a\u7528\u4e8e\u8865\u5145\u6388\u6743\u673a\u5236\u4ee5\u5b9e\u73b0\u66f4\u52a0\u7cbe\u7ec6\u7684\u8bbf\u95ee\u63a7\u5236\u529f\u80fd\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(2677).A+"",width:"1017",height:"214"})}),"\n",(0,s.jsx)(n.h3,{id:"92-\u8ba4\u8bc1\u7ba1\u7406",children:"9.2 \u8ba4\u8bc1\u7ba1\u7406"}),"\n",(0,s.jsx)(n.p,{children:"Kubernetes\u96c6\u7fa4\u5b89\u5168\u7684\u6700\u5173\u952e\u70b9\u5728\u4e8e\u5982\u4f55\u8bc6\u522b\u5e76\u8ba4\u8bc1\u5ba2\u6237\u7aef\u8eab\u4efd\uff0c\u5b83\u63d0\u4f9b\u4e863\u79cd\u5ba2\u6237\u7aef\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HTTP Base\u8ba4\u8bc1\uff1a\u901a\u8fc7\u7528\u6237\u540d+\u5bc6\u7801\u7684\u65b9\u5f0f\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    \u8fd9\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u662f\u628a\u201c\u7528\u6237\u540d:\u5bc6\u7801\u201d\u7528BASE64\u7b97\u6cd5\u8fdb\u884c\u7f16\u7801\u540e\u7684\u5b57\u7b26\u4e32\u653e\u5728HTTP\u8bf7\u6c42\u4e2d\u7684Header Authorization\u57df\u91cc\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u3002\u670d\u52a1\u7aef\u6536\u5230\u540e\u8fdb\u884c\u89e3\u7801\uff0c\u83b7\u53d6\u7528\u6237\u540d\u53ca\u5bc6\u7801\uff0c\u7136\u540e\u8fdb\u884c\u7528\u6237\u8eab\u4efd\u8ba4\u8bc1\u7684\u8fc7\u7a0b\u3002\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HTTP Token\u8ba4\u8bc1\uff1a\u901a\u8fc7\u4e00\u4e2aToken\u6765\u8bc6\u522b\u5408\u6cd5\u7528\u6237"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    \u8fd9\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u662f\u7528\u4e00\u4e2a\u5f88\u957f\u7684\u96be\u4ee5\u88ab\u6a21\u4eff\u7684\u5b57\u7b26\u4e32--Token\u6765\u8868\u660e\u5ba2\u6237\u8eab\u4efd\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u6bcf\u4e2aToken\u5bf9\u5e94\u4e00\u4e2a\u7528\u6237\u540d\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77API\u8c03\u7528\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u5728HTTP Header\u91cc\u653e\u5165Token\uff0cAPI Server\u63a5\u5230Token\u540e\u4f1a\u8ddf\u670d\u52a1\u5668\u4e2d\u4fdd\u5b58\u7684token\u8fdb\u884c\u6bd4\u5bf9\uff0c\u7136\u540e\u8fdb\u884c\u7528\u6237\u8eab\u4efd\u8ba4\u8bc1\u7684\u8fc7\u7a0b\u3002\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HTTPS\u8bc1\u4e66\u8ba4\u8bc1\uff1a\u57fa\u4e8eCA\u6839\u8bc1\u4e66\u7b7e\u540d\u7684\u53cc\u5411\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    \u8fd9\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u662f\u5b89\u5168\u6027\u6700\u9ad8\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4f46\u662f\u540c\u65f6\u4e5f\u662f\u64cd\u4f5c\u8d77\u6765\u6700\u9ebb\u70e6\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(595).A+"",width:"980",height:"487"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"HTTPS\u8ba4\u8bc1\u5927\u4f53\u5206\u4e3a3\u4e2a\u8fc7\u7a0b\uff1a"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u8bc1\u4e66\u7533\u8bf7\u548c\u4e0b\u53d1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  HTTPS\u901a\u4fe1\u53cc\u65b9\u7684\u670d\u52a1\u5668\u5411CA\u673a\u6784\u7533\u8bf7\u8bc1\u4e66\uff0cCA\u673a\u6784\u4e0b\u53d1\u6839\u8bc1\u4e66\u3001\u670d\u52a1\u7aef\u8bc1\u4e66\u53ca\u79c1\u94a5\u7ed9\u7533\u8bf7\u8005\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u53cc\u5411\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  1> \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u4e0b\u53d1\u81ea\u5df1\u7684\u8bc1\u4e66\u7ed9\u5ba2\u6237\u7aef\uff0c\r\n     \u5ba2\u6237\u7aef\u63a5\u6536\u5230\u8bc1\u4e66\u540e\uff0c\u901a\u8fc7\u79c1\u94a5\u89e3\u5bc6\u8bc1\u4e66\uff0c\u5728\u8bc1\u4e66\u4e2d\u83b7\u5f97\u670d\u52a1\u7aef\u7684\u516c\u94a5\uff0c\r\n     \u5ba2\u6237\u7aef\u5229\u7528\u670d\u52a1\u5668\u7aef\u7684\u516c\u94a5\u8ba4\u8bc1\u8bc1\u4e66\u4e2d\u7684\u4fe1\u606f\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5219\u8ba4\u53ef\u8fd9\u4e2a\u670d\u52a1\u5668\r\n  2> \u5ba2\u6237\u7aef\u53d1\u9001\u81ea\u5df1\u7684\u8bc1\u4e66\u7ed9\u670d\u52a1\u5668\u7aef\uff0c\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8bc1\u4e66\u540e\uff0c\u901a\u8fc7\u79c1\u94a5\u89e3\u5bc6\u8bc1\u4e66\uff0c\r\n     \u5728\u8bc1\u4e66\u4e2d\u83b7\u5f97\u5ba2\u6237\u7aef\u7684\u516c\u94a5\uff0c\u5e76\u7528\u8be5\u516c\u94a5\u8ba4\u8bc1\u8bc1\u4e66\u4fe1\u606f\uff0c\u786e\u8ba4\u5ba2\u6237\u7aef\u662f\u5426\u5408\u6cd5\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u4fe1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  \u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u534f\u5546\u597d\u52a0\u5bc6\u65b9\u6848\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u4ea7\u751f\u4e00\u4e2a\u968f\u673a\u7684\u79d8\u94a5\u5e76\u52a0\u5bc6\uff0c\u7136\u540e\u53d1\u9001\u5230\u670d\u52a1\u5668\u7aef\u3002\r\n  \u670d\u52a1\u5668\u7aef\u63a5\u6536\u8fd9\u4e2a\u79d8\u94a5\u540e\uff0c\u53cc\u65b9\u63a5\u4e0b\u6765\u901a\u4fe1\u7684\u6240\u6709\u5185\u5bb9\u90fd\u901a\u8fc7\u8be5\u968f\u673a\u79d8\u94a5\u52a0\u5bc6\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u6ce8\u610f: Kubernetes\u5141\u8bb8\u540c\u65f6\u914d\u7f6e\u591a\u79cd\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ea\u8981\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a\u65b9\u5f0f\u8ba4\u8bc1\u901a\u8fc7\u5373\u53ef"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"93-\u6388\u6743\u7ba1\u7406",children:"9.3 \u6388\u6743\u7ba1\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u6388\u6743\u53d1\u751f\u5728\u8ba4\u8bc1\u6210\u529f\u4e4b\u540e\uff0c\u901a\u8fc7\u8ba4\u8bc1\u5c31\u53ef\u4ee5\u77e5\u9053\u8bf7\u6c42\u7528\u6237\u662f\u8c01\uff0c \u7136\u540eKubernetes\u4f1a\u6839\u636e\u4e8b\u5148\u5b9a\u4e49\u7684\u6388\u6743\u7b56\u7565\u6765\u51b3\u5b9a\u7528\u6237\u662f\u5426\u6709\u6743\u9650\u8bbf\u95ee\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u79f0\u4e3a\u6388\u6743\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e2a\u53d1\u9001\u5230ApiServer\u7684\u8bf7\u6c42\u90fd\u5e26\u4e0a\u4e86\u7528\u6237\u548c\u8d44\u6e90\u7684\u4fe1\u606f\uff1a\u6bd4\u5982\u53d1\u9001\u8bf7\u6c42\u7684\u7528\u6237\u3001\u8bf7\u6c42\u7684\u8def\u5f84\u3001\u8bf7\u6c42\u7684\u52a8\u4f5c\u7b49\uff0c\u6388\u6743\u5c31\u662f\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u548c\u6388\u6743\u7b56\u7565\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u7b26\u5408\u7b56\u7565\uff0c\u5219\u8ba4\u4e3a\u6388\u6743\u901a\u8fc7\uff0c\u5426\u5219\u4f1a\u8fd4\u56de\u9519\u8bef\u3002"}),"\n",(0,s.jsx)(n.p,{children:"API Server\u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u6388\u6743\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AlwaysDeny\uff1a\u8868\u793a\u62d2\u7edd\u6240\u6709\u8bf7\u6c42\uff0c\u4e00\u822c\u7528\u4e8e\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.li,{children:"AlwaysAllow\uff1a\u5141\u8bb8\u63a5\u6536\u6240\u6709\u8bf7\u6c42\uff0c\u76f8\u5f53\u4e8e\u96c6\u7fa4\u4e0d\u9700\u8981\u6388\u6743\u6d41\u7a0b\uff08Kubernetes\u9ed8\u8ba4\u7684\u7b56\u7565\uff09"}),"\n",(0,s.jsx)(n.li,{children:"ABAC\uff1a\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u8868\u793a\u4f7f\u7528\u7528\u6237\u914d\u7f6e\u7684\u6388\u6743\u89c4\u5219\u5bf9\u7528\u6237\u8bf7\u6c42\u8fdb\u884c\u5339\u914d\u548c\u63a7\u5236"}),"\n",(0,s.jsx)(n.li,{children:"Webhook\uff1a\u901a\u8fc7\u8c03\u7528\u5916\u90e8REST\u670d\u52a1\u5bf9\u7528\u6237\u8fdb\u884c\u6388\u6743"}),"\n",(0,s.jsx)(n.li,{children:"Node\uff1a\u662f\u4e00\u79cd\u4e13\u7528\u6a21\u5f0f\uff0c\u7528\u4e8e\u5bf9kubelet\u53d1\u51fa\u7684\u8bf7\u6c42\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,s.jsx)(n.li,{children:"RBAC\uff1a\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08kubeadm\u5b89\u88c5\u65b9\u5f0f\u4e0b\u7684\u9ed8\u8ba4\u9009\u9879\uff09"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["RBAC(Role-Based Access Control) \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4e3b\u8981\u662f\u5728\u63cf\u8ff0\u4e00\u4ef6\u4e8b\u60c5\uff1a",(0,s.jsx)(n.strong,{children:"\u7ed9\u54ea\u4e9b\u5bf9\u8c61\u6388\u4e88\u4e86\u54ea\u4e9b\u6743\u9650"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e2d\u6d89\u53ca\u5230\u4e86\u4e0b\u9762\u51e0\u4e2a\u6982\u5ff5\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5bf9\u8c61\uff1aUser\u3001Groups\u3001ServiceAccount"}),"\n",(0,s.jsx)(n.li,{children:"\u89d2\u8272\uff1a\u4ee3\u8868\u7740\u4e00\u7ec4\u5b9a\u4e49\u5728\u8d44\u6e90\u4e0a\u7684\u53ef\u64cd\u4f5c\u52a8\u4f5c(\u6743\u9650)\u7684\u96c6\u5408"}),"\n",(0,s.jsx)(n.li,{children:"\u7ed1\u5b9a\uff1a\u5c06\u5b9a\u4e49\u597d\u7684\u89d2\u8272\u8ddf\u7528\u6237\u7ed1\u5b9a\u5728\u4e00\u8d77"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(5683).A+"",width:"911",height:"464"})}),"\n",(0,s.jsx)(n.p,{children:"RBAC\u5f15\u5165\u4e864\u4e2a\u9876\u7ea7\u8d44\u6e90\u5bf9\u8c61\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Role\u3001ClusterRole\uff1a\u89d2\u8272\uff0c\u7528\u4e8e\u6307\u5b9a\u4e00\u7ec4\u6743\u9650"}),"\n",(0,s.jsx)(n.li,{children:"RoleBinding\u3001ClusterRoleBinding\uff1a\u89d2\u8272\u7ed1\u5b9a\uff0c\u7528\u4e8e\u5c06\u89d2\u8272\uff08\u6743\u9650\uff09\u8d4b\u4e88\u7ed9\u5bf9\u8c61"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Role\u3001ClusterRole"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e2a\u89d2\u8272\u5c31\u662f\u4e00\u7ec4\u6743\u9650\u7684\u96c6\u5408\uff0c\u8fd9\u91cc\u7684\u6743\u9650\u90fd\u662f\u8bb8\u53ef\u5f62\u5f0f\u7684\uff08\u767d\u540d\u5355\uff09\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# Role\u53ea\u80fd\u5bf9\u547d\u540d\u7a7a\u95f4\u5185\u7684\u8d44\u6e90\u8fdb\u884c\u6388\u6743\uff0c\u9700\u8981\u6307\u5b9anameapce\r\nkind: Role\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n  namespace: dev\r\n  name: authorization-role\r\nrules:\r\n- apiGroups: [""]  # \u652f\u6301\u7684API\u7ec4\u5217\u8868,"" \u7a7a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u6838\u5fc3API\u7fa4\r\n  resources: ["pods"] # \u652f\u6301\u7684\u8d44\u6e90\u5bf9\u8c61\u5217\u8868\r\n  verbs: ["get", "watch", "list"] # \u5141\u8bb8\u7684\u5bf9\u8d44\u6e90\u5bf9\u8c61\u7684\u64cd\u4f5c\u65b9\u6cd5\u5217\u8868\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# ClusterRole\u53ef\u4ee5\u5bf9\u96c6\u7fa4\u8303\u56f4\u5185\u8d44\u6e90\u3001\u8de8namespaces\u7684\u8303\u56f4\u8d44\u6e90\u3001\u975e\u8d44\u6e90\u7c7b\u578b\u8fdb\u884c\u6388\u6743\r\nkind: ClusterRole\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n name: authorization-clusterrole\r\nrules:\r\n- apiGroups: [""]\r\n  resources: ["pods"]\r\n  verbs: ["get", "watch", "list"]\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u9700\u8981\u8be6\u7ec6\u8bf4\u660e\u7684\u662f\uff0crules\u4e2d\u7684\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"apiGroups: \u652f\u6301\u7684API\u7ec4\u5217\u8868"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'"","apps", "autoscaling", "batch"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"resources\uff1a\u652f\u6301\u7684\u8d44\u6e90\u5bf9\u8c61\u5217\u8868"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'"services", "endpoints", "pods","secrets","configmaps","crontabs","deployments","jobs",\r\n"nodes","rolebindings","clusterroles","daemonsets","replicasets","statefulsets",\r\n"horizontalpodautoscalers","replicationcontrollers","cronjobs"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"verbs\uff1a\u5bf9\u8d44\u6e90\u5bf9\u8c61\u7684\u64cd\u4f5c\u65b9\u6cd5\u5217\u8868"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'"get", "list", "watch", "create", "update", "patch", "delete", "exec"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"RoleBinding\u3001ClusterRoleBinding"})}),"\n",(0,s.jsx)(n.p,{children:"\u89d2\u8272\u7ed1\u5b9a\u7528\u6765\u628a\u4e00\u4e2a\u89d2\u8272\u7ed1\u5b9a\u5230\u4e00\u4e2a\u76ee\u6807\u5bf9\u8c61\u4e0a\uff0c\u7ed1\u5b9a\u76ee\u6807\u53ef\u4ee5\u662fUser\u3001Group\u6216\u8005ServiceAccount\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# RoleBinding\u53ef\u4ee5\u5c06\u540c\u4e00namespace\u4e2d\u7684subject\u7ed1\u5b9a\u5230\u67d0\u4e2aRole\u4e0b\uff0c\u5219\u6b64subject\u5373\u5177\u6709\u8be5Role\u5b9a\u4e49\u7684\u6743\u9650\r\nkind: RoleBinding\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n  name: authorization-role-binding\r\n  namespace: dev\r\nsubjects:\r\n- kind: User\r\n  name: heima\r\n  apiGroup: rbac.authorization.k8s.io\r\nroleRef:\r\n  kind: Role\r\n  name: authorization-role\r\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# ClusterRoleBinding\u5728\u6574\u4e2a\u96c6\u7fa4\u7ea7\u522b\u548c\u6240\u6709namespaces\u5c06\u7279\u5b9a\u7684subject\u4e0eClusterRole\u7ed1\u5b9a\uff0c\u6388\u4e88\u6743\u9650\r\nkind: ClusterRoleBinding\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n name: authorization-clusterrole-binding\r\nsubjects:\r\n- kind: User\r\n  name: heima\r\n  apiGroup: rbac.authorization.k8s.io\r\nroleRef:\r\n  kind: ClusterRole\r\n  name: authorization-clusterrole\r\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"RoleBinding\u5f15\u7528ClusterRole\u8fdb\u884c\u6388\u6743"})}),"\n",(0,s.jsx)(n.p,{children:"RoleBinding\u53ef\u4ee5\u5f15\u7528ClusterRole\uff0c\u5bf9\u5c5e\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u5185ClusterRole\u5b9a\u4e49\u7684\u8d44\u6e90\u4e3b\u4f53\u8fdb\u884c\u6388\u6743\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    \u4e00\u79cd\u5f88\u5e38\u7528\u7684\u505a\u6cd5\u5c31\u662f\uff0c\u96c6\u7fa4\u7ba1\u7406\u5458\u4e3a\u96c6\u7fa4\u8303\u56f4\u9884\u5b9a\u4e49\u597d\u4e00\u7ec4\u89d2\u8272\uff08ClusterRole\uff09\uff0c\u7136\u540e\u5728\u591a\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u91cd\u590d\u4f7f\u7528\u8fd9\u4e9bClusterRole\u3002\u8fd9\u6837\u53ef\u4ee5\u5927\u5e45\u63d0\u9ad8\u6388\u6743\u7ba1\u7406\u5de5\u4f5c\u6548\u7387\uff0c\u4e5f\u4f7f\u5f97\u5404\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u57fa\u7840\u6027\u6388\u6743\u89c4\u5219\u4e0e\u4f7f\u7528\u4f53\u9a8c\u4fdd\u6301\u4e00\u81f4\u3002\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# \u867d\u7136authorization-clusterrole\u662f\u4e00\u4e2a\u96c6\u7fa4\u89d2\u8272\uff0c\u4f46\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86RoleBinding\r\n# \u6240\u4ee5heima\u53ea\u80fd\u8bfb\u53d6dev\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u8d44\u6e90\r\nkind: RoleBinding\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n  name: authorization-role-binding-ns\r\n  namespace: dev\r\nsubjects:\r\n- kind: User\r\n  name: heima\r\n  apiGroup: rbac.authorization.k8s.io\r\nroleRef:\r\n  kind: ClusterRole\r\n  name: authorization-clusterrole\r\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b9e\u6218\uff1a\u521b\u5efa\u4e00\u4e2a\u53ea\u80fd\u7ba1\u7406dev\u7a7a\u95f4\u4e0bPods\u8d44\u6e90\u7684\u8d26\u53f7"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u521b\u5efa\u8d26\u53f7"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# 1) \u521b\u5efa\u8bc1\u4e66\r\n[root@k8s-master01 pki]# cd /etc/kubernetes/pki/\r\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\r\n\r\n# 2) \u7528apiserver\u7684\u8bc1\u4e66\u53bb\u7b7e\u7f72\r\n# 2-1) \u7b7e\u540d\u7533\u8bf7\uff0c\u7533\u8bf7\u7684\u7528\u6237\u662fdevman,\u7ec4\u662fdevgroup\r\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj "/CN=devman/O=devgroup"     \r\n# 2-2) \u7b7e\u7f72\u8bc1\u4e66\r\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650\r\n\r\n# 3) \u8bbe\u7f6e\u96c6\u7fa4\u3001\u7528\u6237\u3001\u4e0a\u4e0b\u6587\u4fe1\u606f\r\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443\r\n\r\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key\r\n\r\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman\r\n\r\n# \u5207\u6362\u8d26\u6237\u5230devman\r\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\r\nSwitched to context "devman@kubernetes".\r\n\r\n# \u67e5\u770bdev\u4e0bpod\uff0c\u53d1\u73b0\u6ca1\u6709\u6743\u9650\r\n[root@k8s-master01 pki]# kubectl get pods -n dev\r\nError from server (Forbidden): pods is forbidden: User "devman" cannot list resource "pods" in API group "" in the namespace "dev"\r\n\r\n# \u5207\u6362\u5230admin\u8d26\u6237\r\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\r\nSwitched to context "kubernetes-admin@kubernetes".\n'})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09 \u521b\u5efaRole\u548cRoleBinding\uff0c\u4e3adevman\u7528\u6237\u6388\u6743"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'kind: Role\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n  namespace: dev\r\n  name: dev-role\r\nrules:\r\n- apiGroups: [""]\r\n  resources: ["pods"]\r\n  verbs: ["get", "watch", "list"]\r\n  \r\n---\r\n\r\nkind: RoleBinding\r\napiVersion: rbac.authorization.k8s.io/v1beta1\r\nmetadata:\r\n  name: authorization-role-binding\r\n  namespace: dev\r\nsubjects:\r\n- kind: User\r\n  name: devman\r\n  apiGroup: rbac.authorization.k8s.io\r\nroleRef:\r\n  kind: Role\r\n  name: dev-role\r\n  apiGroup: rbac.authorization.k8s.io\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\r\nrole.rbac.authorization.k8s.io/dev-role created\r\nrolebinding.rbac.authorization.k8s.io/authorization-role-binding created\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"\u5207\u6362\u8d26\u6237\uff0c\u518d\u6b21\u9a8c\u8bc1"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# \u5207\u6362\u8d26\u6237\u5230devman\r\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\r\nSwitched to context "devman@kubernetes".\r\n\r\n# \u518d\u6b21\u67e5\u770b\r\n[root@k8s-master01 pki]# kubectl get pods -n dev\r\nNAME                                 READY   STATUS             RESTARTS   AGE\r\nnginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h\r\nnginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h\r\nnginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h\r\n\r\n# \u4e3a\u4e86\u4e0d\u5f71\u54cd\u540e\u9762\u7684\u5b66\u4e60,\u5207\u56deadmin\u8d26\u6237\r\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\r\nSwitched to context "kubernetes-admin@kubernetes".\n'})}),"\n",(0,s.jsx)(n.h3,{id:"94-\u51c6\u5165\u63a7\u5236",children:"9.4 \u51c6\u5165\u63a7\u5236"}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u8fc7\u4e86\u524d\u9762\u7684\u8ba4\u8bc1\u548c\u6388\u6743\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u7ecf\u8fc7\u51c6\u5165\u63a7\u5236\u5904\u7406\u901a\u8fc7\u4e4b\u540e\uff0capiserver\u624d\u4f1a\u5904\u7406\u8fd9\u4e2a\u8bf7\u6c42\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u51c6\u5165\u63a7\u5236\u662f\u4e00\u4e2a\u53ef\u914d\u7f6e\u7684\u63a7\u5236\u5668\u5217\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728Api-Server\u4e0a\u901a\u8fc7\u547d\u4ee4\u884c\u8bbe\u7f6e\u9009\u62e9\u6267\u884c\u54ea\u4e9b\u51c6\u5165\u63a7\u5236\u5668\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,\r\n                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ea\u6709\u5f53\u6240\u6709\u7684\u51c6\u5165\u63a7\u5236\u5668\u90fd\u68c0\u67e5\u901a\u8fc7\u4e4b\u540e\uff0capiserver\u624d\u6267\u884c\u8be5\u8bf7\u6c42\uff0c\u5426\u5219\u8fd4\u56de\u62d2\u7edd\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u524d\u53ef\u914d\u7f6e\u7684Admission Control\u51c6\u5165\u63a7\u5236\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AlwaysAdmit\uff1a\u5141\u8bb8\u6240\u6709\u8bf7\u6c42"}),"\n",(0,s.jsx)(n.li,{children:"AlwaysDeny\uff1a\u7981\u6b62\u6240\u6709\u8bf7\u6c42\uff0c\u4e00\u822c\u7528\u4e8e\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.li,{children:"AlwaysPullImages\uff1a\u5728\u542f\u52a8\u5bb9\u5668\u4e4b\u524d\u603b\u53bb\u4e0b\u8f7d\u955c\u50cf"}),"\n",(0,s.jsx)(n.li,{children:"DenyExecOnPrivileged\uff1a\u5b83\u4f1a\u62e6\u622a\u6240\u6709\u60f3\u5728Privileged Container\u4e0a\u6267\u884c\u547d\u4ee4\u7684\u8bf7\u6c42"}),"\n",(0,s.jsx)(n.li,{children:"ImagePolicyWebhook\uff1a\u8fd9\u4e2a\u63d2\u4ef6\u5c06\u5141\u8bb8\u540e\u7aef\u7684\u4e00\u4e2aWebhook\u7a0b\u5e8f\u6765\u5b8c\u6210admission controller\u7684\u529f\u80fd\u3002"}),"\n",(0,s.jsx)(n.li,{children:"Service Account\uff1a\u5b9e\u73b0ServiceAccount\u5b9e\u73b0\u4e86\u81ea\u52a8\u5316"}),"\n",(0,s.jsx)(n.li,{children:"SecurityContextDeny\uff1a\u8fd9\u4e2a\u63d2\u4ef6\u5c06\u4f7f\u7528SecurityContext\u7684Pod\u4e2d\u7684\u5b9a\u4e49\u5168\u90e8\u5931\u6548"}),"\n",(0,s.jsx)(n.li,{children:"ResourceQuota\uff1a\u7528\u4e8e\u8d44\u6e90\u914d\u989d\u7ba1\u7406\u76ee\u7684\uff0c\u89c2\u5bdf\u6240\u6709\u8bf7\u6c42\uff0c\u786e\u4fdd\u5728namespace\u4e0a\u7684\u914d\u989d\u4e0d\u4f1a\u8d85\u6807"}),"\n",(0,s.jsx)(n.li,{children:"LimitRanger\uff1a\u7528\u4e8e\u8d44\u6e90\u9650\u5236\u7ba1\u7406\uff0c\u4f5c\u7528\u4e8enamespace\u4e0a\uff0c\u786e\u4fdd\u5bf9Pod\u8fdb\u884c\u8d44\u6e90\u9650\u5236"}),"\n",(0,s.jsx)(n.li,{children:"InitialResources\uff1a\u4e3a\u672a\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u4e0e\u9650\u5236\u7684Pod\uff0c\u6839\u636e\u5176\u955c\u50cf\u7684\u5386\u53f2\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\u8fdb\u884c\u8bbe\u7f6e"}),"\n",(0,s.jsx)(n.li,{children:"NamespaceLifecycle\uff1a\u5982\u679c\u5c1d\u8bd5\u5728\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684namespace\u4e2d\u521b\u5efa\u8d44\u6e90\u5bf9\u8c61\uff0c\u5219\u8be5\u521b\u5efa\u8bf7\u6c42\u5c06\u88ab\u62d2\u7edd\u3002\u5f53\u5220\u9664\u4e00\u4e2anamespace\u65f6\uff0c\u7cfb\u7edf\u5c06\u4f1a\u5220\u9664\u8be5namespace\u4e2d\u6240\u6709\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(n.li,{children:"DefaultStorageClass\uff1a\u4e3a\u4e86\u5b9e\u73b0\u5171\u4eab\u5b58\u50a8\u7684\u52a8\u6001\u4f9b\u5e94\uff0c\u4e3a\u672a\u6307\u5b9aStorageClass\u6216PV\u7684PVC\u5c1d\u8bd5\u5339\u914d\u9ed8\u8ba4\u7684StorageClass\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u7528\u6237\u5728\u7533\u8bf7PVC\u65f6\u6240\u9700\u4e86\u89e3\u7684\u540e\u7aef\u5b58\u50a8\u7ec6\u8282"}),"\n",(0,s.jsxs)(n.li,{children:["DefaultTolerationSeconds\uff1a\u8fd9\u4e2a\u63d2\u4ef6\u4e3a\u90a3\u4e9b\u6ca1\u6709\u8bbe\u7f6eforgiveness tolerations\u5e76\u5177\u6709notready",":NoExecute","\u548cunreachable",":NoExecute","\u4e24\u79cdtaints\u7684Pod\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u201c\u5bb9\u5fcd\u201d\u65f6\u95f4\uff0c\u4e3a5min"]}),"\n",(0,s.jsx)(n.li,{children:"PodSecurityPolicy\uff1a\u8fd9\u4e2a\u63d2\u4ef6\u7528\u4e8e\u5728\u521b\u5efa\u6216\u4fee\u6539Pod\u65f6\u51b3\u5b9a\u662f\u5426\u6839\u636ePod\u7684security context\u548c\u53ef\u7528\u7684PodSecurityPolicy\u5bf9Pod\u7684\u5b89\u5168\u7b56\u7565\u8fdb\u884c\u63a7\u5236"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"10-dashboard",children:"10. DashBoard"}),"\n",(0,s.jsx)(n.p,{children:"\u4e4b\u524d\u5728kubernetes\u4e2d\u5b8c\u6210\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u901a\u8fc7\u547d\u4ee4\u884c\u5de5\u5177kubectl\u5b8c\u6210\u7684\u3002\u5176\u5b9e\uff0c\u4e3a\u4e86\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u7528\u6237\u4f53\u9a8c\uff0ckubernetes\u8fd8\u5f00\u53d1\u4e86\u4e00\u4e2a\u57fa\u4e8eweb\u7684\u7528\u6237\u754c\u9762\uff08Dashboard\uff09\u3002\u7528\u6237\u53ef\u4ee5\u4f7f\u7528Dashboard\u90e8\u7f72\u5bb9\u5668\u5316\u7684\u5e94\u7528\uff0c\u8fd8\u53ef\u4ee5\u76d1\u63a7\u5e94\u7528\u7684\u72b6\u6001\uff0c\u6267\u884c\u6545\u969c\u6392\u67e5\u4ee5\u53ca\u7ba1\u7406kubernetes\u4e2d\u5404\u79cd\u8d44\u6e90\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"101-\u90e8\u7f72dashboard",children:"10.1 \u90e8\u7f72Dashboard"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e0b\u8f7dyaml\uff0c\u5e76\u8fd0\u884cDashboard"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7dyaml\r\n[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\r\n\r\n# \u4fee\u6539kubernetes-dashboard\u7684Service\u7c7b\u578b\r\nkind: Service\r\napiVersion: v1\r\nmetadata:\r\n  labels:\r\n    k8s-app: kubernetes-dashboard\r\n  name: kubernetes-dashboard\r\n  namespace: kubernetes-dashboard\r\nspec:\r\n  type: NodePort  # \u65b0\u589e\r\n  ports:\r\n    - port: 443\r\n      targetPort: 8443\r\n      nodePort: 30009  # \u65b0\u589e\r\n  selector:\r\n    k8s-app: kubernetes-dashboard\r\n\r\n# \u90e8\u7f72\r\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\r\n\r\n# \u67e5\u770bnamespace\u4e0b\u7684kubernetes-dashboard\u4e0b\u7684\u8d44\u6e90\r\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\r\nNAME                                            READY   STATUS    RESTARTS   AGE\r\npod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s\r\npod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s\r\n\r\nNAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE\r\nservice/dashboard-metrics-scraper  ClusterIP  10.96.89.218    <none>       8000/TCP        111s\r\nservice/kubernetes-dashboard       NodePort   10.104.178.171  <none>       443:30009/TCP   111s\n"})}),"\n",(0,s.jsx)(n.p,{children:"2\uff09\u521b\u5efa\u8bbf\u95ee\u8d26\u6237\uff0c\u83b7\u53d6token"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u8d26\u53f7\r\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\r\n\r\n# \u6388\u6743\r\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\r\n\r\n# \u83b7\u53d6\u8d26\u53f7token\r\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\r\ndashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s\r\n\r\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\r\nName:         dashboard-admin-token-xbqhh\r\nNamespace:    kubernetes-dashboard\r\nLabels:       <none>\r\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\r\n              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\r\n\r\nType:  kubernetes.io/service-account-token\r\n\r\nData\r\n====\r\nnamespace:  20 bytes\r\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw\r\nca.crt:     1025 bytes\n"})}),"\n",(0,s.jsx)(n.p,{children:"3\uff09\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95eeDashboard\u7684UI"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u767b\u5f55\u9875\u9762\u4e0a\u8f93\u5165\u4e0a\u9762\u7684token"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200520144548997",src:r(3392).A+"",width:"1030",height:"528"})}),"\n",(0,s.jsx)(n.p,{children:"\u51fa\u73b0\u4e0b\u9762\u7684\u9875\u9762\u4ee3\u8868\u6210\u529f"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200520144959353",src:r(8716).A+"",width:"1911",height:"925"})}),"\n",(0,s.jsx)(n.h3,{id:"102-\u4f7f\u7528dashboard",children:"10.2 \u4f7f\u7528DashBoard"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u7ae0\u8282\u4ee5Deployment\u4e3a\u4f8b\u6f14\u793aDashBoard\u7684\u4f7f\u7528"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u67e5\u770b"})}),"\n",(0,s.jsxs)(n.p,{children:["\u9009\u62e9\u6307\u5b9a\u7684\u547d\u540d\u7a7a\u95f4",(0,s.jsx)(n.code,{children:"dev"}),"\uff0c\u7136\u540e\u70b9\u51fb",(0,s.jsx)(n.code,{children:"Deployments"}),"\uff0c\u67e5\u770bdev\u7a7a\u95f4\u4e0b\u7684\u6240\u6709deployment"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(735).A+"",width:"1890",height:"389"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6269\u7f29\u5bb9"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.code,{children:"Deployment"}),"\u4e0a\u70b9\u51fb",(0,s.jsx)(n.code,{children:"\u89c4\u6a21"}),"\uff0c\u7136\u540e\u6307\u5b9a",(0,s.jsx)(n.code,{children:"\u76ee\u6807\u526f\u672c\u6570\u91cf"}),"\uff0c\u70b9\u51fb\u786e\u5b9a"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(8660).A+"",width:"1583",height:"616"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u7f16\u8f91"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.code,{children:"Deployment"}),"\u4e0a\u70b9\u51fb",(0,s.jsx)(n.code,{children:"\u7f16\u8f91"}),"\uff0c\u7136\u540e\u4fee\u6539",(0,s.jsx)(n.code,{children:"yaml\u6587\u4ef6"}),"\uff0c\u70b9\u51fb\u786e\u5b9a"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20200520163253644",src:r(5151).A+"",width:"1557",height:"382"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u67e5\u770bPod"})}),"\n",(0,s.jsxs)(n.p,{children:["\u70b9\u51fb",(0,s.jsx)(n.code,{children:"Pods"}),", \u67e5\u770bpods\u5217\u8868"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(4693).A+"",width:"1879",height:"535"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u64cd\u4f5cPod"})}),"\n",(0,s.jsx)(n.p,{children:"\u9009\u4e2d\u67d0\u4e2aPod\uff0c\u53ef\u4ee5\u5bf9\u5176\u6267\u884c\u65e5\u5fd7\uff08logs\uff09\u3001\u8fdb\u5165\u6267\u884c\uff08exec\uff09\u3001\u7f16\u8f91\u3001\u5220\u9664\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"img",src:r(7323).A+"",width:"1530",height:"313"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Dashboard\u63d0\u4f9b\u4e86kubectl\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\uff0c\u8fd9\u91cc\u4e0d\u518d\u4e00\u4e00\u6f14\u793a"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},7252:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/2232696-20210621233130477-111035427-8a09097b886ad05e579284c06c858c85.png"},2759:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/2232696-20210621233157075-1117518703-e801367c4f0ce1ee75339a8b8adeea0e.png"},2851:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200404094800622-411b106bafe867e713fed91896b6ba33.png"},6429:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200406184656917-1626782168787-ed92f8d2184b2383cf7992a3dcb69b0b.png"},6013:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200406184656917-ed92f8d2184b2383cf7992a3dcb69b0b.png"},5528:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200406225334627-5ddaad8f206467d99804670770f5683f.png"},5121:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200406232838722-d1daf86627aeca3e09ec01eb926b3b33.png"},8471:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200407100850484-83fec7a58d334cadd6219e6dde5211ab.png"},8323:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200407121501907-1626781151898-697ca688e34b7d0d92284682633b5d44.png"},3755:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200407121501907-697ca688e34b7d0d92284682633b5d44.png"},8926:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200408193950807-62ab097e9ba92ed09770eebcd90d3f85.png"},9881:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200408194716912-1626783758946-080686a9bbb35623cfd4236b8a3140ec.png"},830:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200408194716912-080686a9bbb35623cfd4236b8a3140ec.png"},914:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200412111402706-1626782188724-f743c3986584ed494e278bb42b46b4a3.png"},9886:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200413174713773-1538744259c450b8265921f686d8d5ad.png"},9644:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200413214031331-d63cde68362127c2c9b8e7e40b92e5e5.png"},9e3:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200413215133559-b818ff59a2a5b498f4c22fb73c6a716e.png"},322:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200416140251491-444651ae9c8f6a37d1f649af8935ae65.png"},465:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200505183738289-e58302dd8b880122c67400fd5ca39c34.png"},5044:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200509121254425-6b2bb1a563088fcbbdf2d5bc6e035f4e.png"},2105:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200509151424280-8e312f5e45ca2114aca8d26e47813f34.png"},7096:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200509152947714-ffd7807e9bd86ba41fb28bf54f71d764.png"},5e3:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200509153731363-1c392748be2a10f48e97b07b88985d89.png"},9745:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200509191917069-05a026e67ce46302c64d2e4312fe1e69.png"},8101:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200510103945494-facca1540d1fc8b9940b34ae6cde7f56.png"},7829:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200510113311209-3363a56d5d1959da78cf1875d3fc87bf.png"},7131:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200514095913741-bd01d64b1c447f37aad7627af0a15c49.png"},3679:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200514194111567-515c770c703a74cdfcb3eb823444e30c.png"},8276:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200515002806726-93b50e350b54c1f1d3daba0d0b262122.png"},3357:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200516102419998-305edb51b33efcdefe7466b87514d839.png"},5898:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200516112704764-aa410357bb23e4460cff5397ab73324b.png"},595:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200518211037434-77ebb7bb30f7a101461596d3449f287a.png"},5683:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200519181209566-aeb4ebc38cc2a38ae18ccaa76b46eecc.png"},1660:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520102949189-fd25c1b6e48823fff5af473a4497aac8.png"},2677:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520103942580-c7a23955976e4434004d256778f7593b.png"},3392:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520144548997-810535a80acdab0804e222de92b82bf5.png"},8716:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520144959353-ba05068dcffbb1846bcbe1b2402c7982.png"},735:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520154628679-1060a3b85c484ae1c17c5c9987cef365.png"},8660:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520162605102-c61a117b37f9fc2d56d7aee99b190d74.png"},5151:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520163253644-a5bd3d867de1eed4dca69d8053557ac8.png"},4693:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520163552110-84b9424d34a57cb043681ecdc66c1fea.png"},7323:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200520163832827-0f359538f9245131eb036cb49a0a0e65.png"},4103:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200524150339551-5aff6492d9eab99cd1414e52c8d34053.png"},144:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200605021831545-d54a4ff058d0939d6ab6edf78cd6ad47.png"},4756:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200608155858271-25cd78ed97493fa06124618899d39bc3.png"},5780:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200608163326496-df205f0a63fcff2fffb9e78aa93ecca0.png"},1171:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200612005334159-08331e8a22669bed9152c4e1e5bb38a3.png"},6597:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200612005524778-5d1dc838352b3e5bdfb4be22731b1a74.png"},8530:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200612010223537-ce36a119e419344ad25e47ef566c3d7f.png"},3695:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200618213054113-6974b0a67cf6cb79814dbf98d1a3f43b.png"},3046:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200618213149531-d35973774be6c30841f6c2ad8ac6b52e.png"},3192:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200620175731338-9b8317045fadcbe5e6fd407901daa8d8.png"},179:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20200623092808049-18aa9ff68af6bf0ae49ed688cb282d5b.png"},9443:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20210609000002940-d55c5517774a32d76822d4d36aeba83a.png"},713:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20210617223823675-1626781695411-cdc8a5a378599d784fbc3d83f8427299.png"},9788:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20210617223923659-21cc3a44f450f700dd4d189104a41273.png"},2527:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20210617224457945-d3d7ae9d0cb29cb6d838523eaa67189d.png"},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>i});var s=r(6540);const l={},t=s.createContext(l);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);