<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-database/Elasticsearch/elasticsearch" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">ES简易教程 | 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://li-liguang.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://li-liguang.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://li-liguang.github.io/docs/docs/database/Elasticsearch/elasticsearch"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ES简易教程 | 文档"><meta data-rh="true" name="description" content="1. ES安装"><meta data-rh="true" property="og:description" content="1. ES安装"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://li-liguang.github.io/docs/docs/database/Elasticsearch/elasticsearch"><link data-rh="true" rel="alternate" href="https://li-liguang.github.io/docs/docs/database/Elasticsearch/elasticsearch" hreflang="en"><link data-rh="true" rel="alternate" href="https://li-liguang.github.io/docs/docs/database/Elasticsearch/elasticsearch" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="文档 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="文档 Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.1572a292.css">
<script src="/docs/assets/js/runtime~main.3531676d.js" defer="defer"></script>
<script src="/docs/assets/js/main.521caba2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="docs-website" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="docs-website" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">主页</b></a><a class="navbar__item navbar__link" href="/docs/docs/backend/springboot开发技巧/extra_properties">后端</a><a class="navbar__item navbar__link" href="/docs/docs/front">前端</a><a class="navbar__item navbar__link" href="/docs/docs/server/jboss/jboss">服务器</a><a class="navbar__item navbar__link" href="/docs/docs/cloud/docker/docker">云原生</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docs/database/otherconfig">数据库</a><a class="navbar__item navbar__link" href="/docs/docs/other/rpm/build-multi-architectural-rpm-packages">其他</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/docs/database/Elasticsearch/elasticsearch" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://gitee.com/li-liguang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-gitee-link" aria-label="Gitee repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" target="_self" href="/docs/"><img src="/docs/img/logo.svg" alt="docs-website" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="docs-website" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>主页</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/database/otherconfig">SQL注入</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/docs/database/mysql/Linux安装MySql详细步骤">mysql</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/docs/database/redis/redis">redis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/docs/database/Elasticsearch/elasticsearch">Elasticsearch</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/docs/database/Elasticsearch/elasticsearch">ES简易教程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/database/Elasticsearch/elasticsearch-ik">IK分词器</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/database/kingbase">Kingbase数据库</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/docs/database/mongo/mongo">mongo</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Elasticsearch</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ES简易教程</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ES简易教程</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-es安装">1. ES安装<a href="#1-es安装" class="hash-link" aria-label="Direct link to 1. ES安装" title="Direct link to 1. ES安装">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载">下载<a href="#下载" class="hash-link" aria-label="Direct link to 下载" title="Direct link to 下载">​</a></h3>
<p><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch官方下载地址</a></p>
<p>这里使用的是elasticsearch-6.4.1版本</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解压及配置">解压及配置<a href="#解压及配置" class="hash-link" aria-label="Direct link to 解压及配置" title="Direct link to 解压及配置">​</a></h3>
<p>将压缩包解压到<code>/usr/local/elasticsearch/</code>这个目录下，</p>
<p>按照以下说明修改配置文件<code>./config/elasticsearch.yml</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cluster.name: my-elastic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node.name: node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node.master: true  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#node.data: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bootstrap.memory_lock: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.data: /home/elastic/data/node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.logs: /home/elastic/data/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#本机IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network.host: 192.168.90.182</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network.publish_host: 192.168.90.182</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http.port: 9200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transport.tcp.port: 9300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discovery.zen.ping.unicast.hosts: [&quot;192.168.90.182:9300&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discovery.zen.minimum_master_nodes: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster.routing.allocation.enable: all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster.routing.rebalance.enable: all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#跨域</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http.cors.enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http.cors.allow-origin: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http.cors.allow-credentials: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">action.destructive_requires_name: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动es">启动ES<a href="#启动es" class="hash-link" aria-label="Direct link to 启动ES" title="Direct link to 启动ES">​</a></h3>
<p>​	<strong>注：必须使用非root用户启动</strong></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建用户">创建用户<a href="#创建用户" class="hash-link" aria-label="Direct link to 创建用户" title="Direct link to 创建用户">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#创建群组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groupadd elastic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#创建用户并添加到群组中（useradd -g 群组名 用户名）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useradd -g elastic elastic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#修改用户elastic密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">passwd elastic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动es-1">启动ES<a href="#启动es-1" class="hash-link" aria-label="Direct link to 启动ES" title="Direct link to 启动ES">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#切换到新建的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">su - elastic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /usr/local/elasticsearch/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bin/elasticsearch &amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动后的问题及解决方式">启动后的问题及解决方式<a href="#启动后的问题及解决方式" class="hash-link" aria-label="Direct link to 启动后的问题及解决方式" title="Direct link to 启动后的问题及解决方式">​</a></h3>
<p><code>1.bootstrap checks failed</code></p>
<p>​	修改es配置文件：<code>config/elasticsearch.yml</code>
​	<code>bootstrap.memory_lock: true</code>
​	改为:
​	<code>bootstrap.memory_lock: false</code></p>
<p><code>2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</code></p>
<p>​	修改系统配置文件：<code>vim /etc/security/limits.conf</code></p>
<p>​	在文件最后加入两个配置项（*号后面必须有一个空格）：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* soft nofile 65536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* hard nofile 65536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>3.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code></p>
<p>​	修改系统配置文件：<code>vim /etc/sysctl.conf </code></p>
<p>​	添加下面的配置项：<code>vm.max_map_count=655360</code></p>
<p>​	保存并退出后，执行：<code>sysctl -p</code> 使配置生效。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-es常用命令说明">2. ES常用命令说明<a href="#2-es常用命令说明" class="hash-link" aria-label="Direct link to 2. ES常用命令说明" title="Direct link to 2. ES常用命令说明">​</a></h2>
<p>参考: <a href="https://www.ituring.com.cn/book/tupubarticle/18380" target="_blank" rel="noopener noreferrer">https://www.ituring.com.cn/book/tupubarticle/18380</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-_cat命令">2.1 _cat命令<a href="#21-_cat命令" class="hash-link" aria-label="Direct link to 2.1 _cat命令" title="Direct link to 2.1 _cat命令">​</a></h3>
<p><code>_cat</code>命令是系统信息查询相关的，下面分成好几个子命令分类。</p>
<p>可直接在浏览器中访问：<code>http://localhost:9200/_cat</code>，会看到一系列命令：</p>
<p><img decoding="async" loading="lazy" alt="1579505423324" src="/docs/assets/images/1579505423324-9ef49b964531d03395ef938d147efd66.png" width="483" height="639" class="img_ev3q"></p>
<p>例如：<a href="http://192.168.90.182:9200/_cat/indices%EF%BC%8C%E6%9F%A5%E8%AF%A2ES%E5%BA%93%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E7%B4%A2%E5%BC%95%E3%80%82" target="_blank" rel="noopener noreferrer">http://192.168.90.182:9200/_cat/indices，查询ES库中的所有索引。</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-索引相关命令">2.2 索引相关命令<a href="#22-索引相关命令" class="hash-link" aria-label="Direct link to 2.2 索引相关命令" title="Direct link to 2.2 索引相关命令">​</a></h3>
<p>ES中一个索引就类似于数据库中一个数据库的概念。当然ES中的数据是非结构化的，意味着索引中的每条记录可以有不同的字段集合。</p>
<p><strong>注：以下命令为shell命令（<!-- -->indexName<!-- -->：表示索引名）</strong></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查询索引列表">查询索引列表<a href="#查询索引列表" class="hash-link" aria-label="Direct link to 查询索引列表" title="Direct link to 查询索引列表">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl 192.168.90.182:9200/_cat/indices/{indexName}?v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建索引">创建索引<a href="#创建索引" class="hash-link" aria-label="Direct link to 创建索引" title="Direct link to 创建索引">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -XPUT 192.168.90.182:9200/{indexName}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除索引">删除索引<a href="#删除索引" class="hash-link" aria-label="Direct link to 删除索引" title="Direct link to 删除索引">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -XDELETE 192.168.90.182:9200/{indexName}?pretty</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23-查询索引信息">2.3 查询索引信息<a href="#23-查询索引信息" class="hash-link" aria-label="Direct link to 2.3 查询索引信息" title="Direct link to 2.3 查询索引信息">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -XGET 192.168.90.182:9200/{indexName}?pretty</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-es接口简明教程">3. ES接口简明教程<a href="#3-es接口简明教程" class="hash-link" aria-label="Direct link to 3. ES接口简明教程" title="Direct link to 3. ES接口简明教程">​</a></h2>
<p>ES的核心概念：</p>
<table><thead><tr><th>ES的概念</th><th>数据库概念</th></tr></thead><tbody><tr><td>索引</td><td>数据库</td></tr><tr><td>类型</td><td>表</td></tr><tr><td>字段</td><td>字段</td></tr></tbody></table>
<p>ES中的字段与数据库中的字段一样，有名称和类型。</p>
<ul>
<li><strong>说明</strong>：所有的ES操作都是通过一个类<code>RestHighLevelClient</code>来实现的，可通过以下方式创建一个<code>client</code>，可通过<code>@Configuration + @Bean</code>的方式，将client注册为一个<code>Spring Bean</code>，以此可在其他类中使用。</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//ipAddress是一个String数组，由多个ip:port组成（ES集群）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String [] ipAddress = new String[]{&quot;ip1:port1&quot;,&quot;ip2:port2&quot;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpHost[] hosts = Arrays.stream(ipAddress)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .map(this::makeHttpHost)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .filter(Objects::nonNull)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .toArray(HttpHost[]::new);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RestClientBuilder restClientBuilder = RestClient.builder(hosts);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//设置连接超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">restClientBuilder.setMaxRetryTimeoutMillis(60000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//创建客户端链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RestHighLevelClient client = new RestHighLevelClient(restClientBuilder);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="索引与类型操作">索引与类型操作<a href="#索引与类型操作" class="hash-link" aria-label="Direct link to 索引与类型操作" title="Direct link to 索引与类型操作">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="判断索引是否存在">判断索引是否存在<a href="#判断索引是否存在" class="hash-link" aria-label="Direct link to 判断索引是否存在" title="Direct link to 判断索引是否存在">​</a></h4>
<p>判断<code>hbtest</code>索引是否存在：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GetIndexRequest request = new GetIndexRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request.indices(&quot;hbtest&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean exists = client.indices().exists(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger.info(&quot;{}存在性：{}&quot;, &quot;hbtest&quot;, exists);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建索引-1">创建索引<a href="#创建索引-1" class="hash-link" aria-label="Direct link to 创建索引" title="Direct link to 创建索引">​</a></h4>
<p>创建<code>hbtest</code>索引：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CreateIndexRequest createIndexRequest = new CreateIndexRequest(&quot;hbtest&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createIndexRequest.settings(Settings.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .put(&quot;index.number_of_shards&quot;, 3) // 分片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .put(&quot;index.number_of_replicas&quot;, 2)); // 副本？2个副本，还是包括主的。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.indices().create(createIndexRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建类型">创建类型<a href="#创建类型" class="hash-link" aria-label="Direct link to 创建类型" title="Direct link to 创建类型">​</a></h4>
<p>使用<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-put-mapping.html" target="_blank" rel="noopener noreferrer">PutMapping</a>可以创建类型。创建类型时，需要先整理此类型有哪些字段，每种字段都是什么<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank" rel="noopener noreferrer">数据类型</a>。</p>
<p>我们要在<code>hbtest</code>索引上创建<code>files</code>类型，它有如下字段：</p>
<table><thead><tr><th>字段名</th><th>类型</th><th>用途</th></tr></thead><tbody><tr><td>fileName</td><td>text</td><td>文件名</td></tr><tr><td>fileContent</td><td>text</td><td>文件内容</td></tr><tr><td>open</td><td>boolean</td><td>此文件是否公开。</td></tr><tr><td>auth</td><td>keyword</td><td>权限信息。存储可以访问此文件的授权信息。这是一个字符串数组。数组项是由<code>deptId</code>和<code>roleId</code>拼接而成：<code>${deptId}_${roleId}</code></td></tr><tr><td>userId</td><td>keyword</td><td>有权限看此文件的人员id。字符串数组。</td></tr><tr><td>creator</td><td>keyword</td><td>创建人。</td></tr><tr><td>createTime</td><td>date</td><td>文件创建日期。</td></tr></tbody></table>
<p>对应的JSON请求为：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;fileName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;fileContent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;open&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;boolean&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;auth&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;userId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;creator&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keyword&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以使用<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener noreferrer">XContentBuilder</a>创建上面的JSON对象，如下：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">XContentBuilder builder = XContentFactory.jsonBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.startObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  builder.startObject(&quot;properties&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;fileName&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;text&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;fileContent&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;text&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;open&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;boolean&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;auth&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;keyword&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;userId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;keyword&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;creator&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;keyword&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.startObject(&quot;createTime&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      builder.field(&quot;type&quot;, &quot;date&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">builder.endObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后我们创建<code>PutMappingRequest</code>：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PutMappingRequest putMappingRequest = new PutMappingRequest(&quot;hbtest&quot;); // hbtest是索引名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">putMappingRequest.type(&quot;files&quot;); // 类型名称为files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">putMappingRequest.source(builder); // builder是上个步骤创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后发送创建类型的请求：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client.indices().putMapping(putMappingRequest);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除索引删库">删除索引（删库）<a href="#删除索引删库" class="hash-link" aria-label="Direct link to 删除索引（删库）" title="Direct link to 删除索引（删库）">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DeleteIndexRequest request = new DeleteIndexRequest(&quot;hbfiles&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.indices().delete(request, RequestOptions.DEFAULT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="操作数据">操作数据<a href="#操作数据" class="hash-link" aria-label="Direct link to 操作数据" title="Direct link to 操作数据">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增数据">新增数据<a href="#新增数据" class="hash-link" aria-label="Direct link to 新增数据" title="Direct link to 新增数据">​</a></h4>
<p>官方称之为“索引”，因为新增数据最核心的一个功能点就是对&quot;text&quot;类型的数据进行分词索引，才能实现全文检索。</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-document-index.html" target="_blank" rel="noopener noreferrer">官方API文档</a>。</p>
<p>需要将Java对象数据转换成JSON格式数据，才能新增数据。如下面的示例，使用<a href="https://github.com/google/guava" target="_blank" rel="noopener noreferrer">Gson</a>将Java对象转成JSON：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FileInfo file = new FileInfo(.......);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                                       索引名称      类型名称   数据id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IndexRequest request = new IndexRequest(&quot;hbfiles&quot;, &quot;files&quot;, file.getFileId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request.source(new Gson().toJson(file), XContentType.JSON);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IndexResponse response = client.index(request, RequestOptions.DEFAULT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (response.getResult() == DocWriteResponse.Result.CREATED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	System.out.println(&quot;创建成功&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else if (response.getResult() == DocWriteResponse.Result.UPDATED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	System.out.println(&quot;修改成功&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意：如果库中已经存在数据id，则是覆盖已有数据。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除数据">删除数据<a href="#删除数据" class="hash-link" aria-label="Direct link to 删除数据" title="Direct link to 删除数据">​</a></h4>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-document-delete.html" target="_blank" rel="noopener noreferrer">官方API文档</a>。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DeleteRequest request = new DeleteRequest(&quot;hbfiles&quot;, &quot;files&quot;, &quot;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.delete(request, RequestOptions.DEFAULT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(&quot;删除成功&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>DeleteRequest的三个参数分别是：</p>
<ul>
<li>索引名称（库名称），示例代码中是<code>hbfiles</code></li>
<li>类型名称（表名称），示例代码中是<code>files</code></li>
<li>数据id，示例代码中是<code>1</code></li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新">更新<a href="#更新" class="hash-link" aria-label="Direct link to 更新" title="Direct link to 更新">​</a></h5>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-document-update.html" target="_blank" rel="noopener noreferrer">官方API文档</a>。</p>
<p>修改个别字段：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">UpdateRequest request = new UpdateRequest(&quot;hbfiles&quot;, &quot;files&quot;, &quot;1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	&quot;creator&quot;, &quot;userx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	&quot;auth&quot;, [&quot;001_role2&quot;, &quot;002_role3&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.update(request, RequestOptions.DEFAULT);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要整条数据都更新，则可以使用<a href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE">新增数据</a>的知识。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="根据id获取数据">根据id获取数据<a href="#根据id获取数据" class="hash-link" aria-label="Direct link to 根据id获取数据" title="Direct link to 根据id获取数据">​</a></h5>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-document-get.html" target="_blank" rel="noopener noreferrer">官方API文档</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GetRequest getRequest = new GetRequest(&quot;hbfiles&quot;, &quot;files&quot;, &quot;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GetResponse getResponse = client().get(getRequest, RequestOptions.DEFAULT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (getResponse.isExists()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String sourceAsString = getResponse.getSourceAsString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FileInfo result = new Gson().fromJson(sourceAsString, FileInfo.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System.out.println(&quot;数据不存在&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据查询">数据查询<a href="#数据查询" class="hash-link" aria-label="Direct link to 数据查询" title="Direct link to 数据查询">​</a></h4>
<p>官方文档： <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-search.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-high-search.html</a></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查询所有数据">查询所有数据<a href="#查询所有数据" class="hash-link" aria-label="Direct link to 查询所有数据" title="Direct link to 查询所有数据">​</a></h5>
<p>查询<code>hbfiles</code>索引（库）的<code>files</code>类型的数据：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// (1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchRequest searchRequest = new SearchRequest(&quot;hbfiles&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchRequest.types(&quot;files&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// (2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchRequest.source(searchSourceBuilder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// (3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchResponse searchResponse = client().search(searchRequest, RequestOptions.DEFAULT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// (4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchHits hits = searchResponse.getHits();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">long totalHits = hits.getTotalHits().value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(totalHits); // 总数目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// (5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchHit[] searchHits = hits.getHits();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;FileInfo&gt; fileInfos = Lists.newArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (SearchHit hit : searchHits) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String sourceAsString = hit.getSourceAsString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FileInfo fileInfo = new Gson().fromJson(sourceAsString, FileInfo.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fileInfos.add(fileInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(new Gson().toJson(fileInfos));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(1)和(2)两部分代码在构建查询请求。</p>
<p>(3)在发送查询请求。</p>
<p>(4)和(5)部分在处理查询到的结果。</p>
<p>第(2)部分是重点，用来构建查询条件的。本示例中使用<code>QueryBuilders.matchAllQuery()</code>，表示匹配所有数据。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分页查询">分页查询<a href="#分页查询" class="hash-link" aria-label="Direct link to 分页查询" title="Direct link to 分页查询">​</a></h5>
<p>使用<code>SearchSourceBuilder</code>的<code>from</code>和<code>size</code>两个方法即可构建出分页查询。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.from(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.size(10);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指定简单查询条件">指定简单查询条件<a href="#指定简单查询条件" class="hash-link" aria-label="Direct link to 指定简单查询条件" title="Direct link to 指定简单查询条件">​</a></h5>
<p>使用<code>QueryBuilders</code>可创建查询条件。如查询创建人是<code>user1</code>的数据：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(QueryBuilders.termQuery(&quot;creator&quot;, &quot;user1&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>QueryBuilders.termQuery</code>用来构建精确查询。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="采用全文检索条件">采用全文检索条件<a href="#采用全文检索条件" class="hash-link" aria-label="Direct link to 采用全文检索条件" title="Direct link to 采用全文检索条件">​</a></h5>
<p><code>QueryBuilders.matchQuery()</code>可用来构建全文检索查询：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(QueryBuilders.matchQuery(&quot;fileContent&quot;, &quot;中国&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以使用<code>QueryBuilders.multiMatchQuery()</code>一次性指定多个查询字段：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(QueryBuilders.multiMatchQuery(&quot;中国&quot;, &quot;fileContent&quot;, &quot;fileName&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要做查询效果优化，可以参考一下<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html" target="_blank" rel="noopener noreferrer">官方文档</a>。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="范围查询">范围查询<a href="#范围查询" class="hash-link" aria-label="Direct link to 范围查询" title="Direct link to 范围查询">​</a></h5>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer">范围查询规范</a></p>
<p><code>QueryBuilders.rangeQuery()</code>可用来构建范围查询，如日期区间段：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  QueryBuilders.rangeQuery(&quot;createTime&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .format(&quot;yyyy-MM-dd||yyyy&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .from(&quot;2018&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .to(&quot;2019-07-21&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数组查询">数组查询<a href="#数组查询" class="hash-link" aria-label="Direct link to 数组查询" title="Direct link to 数 组查询">​</a></h5>
<p><code>QueryBuilders.termsQuery()</code>可用来构建数组查询。如查询权限字段<code>auth</code>为<code>001_role1</code>或者<code>001001_role2</code>的字段：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">searchSourceBuilder.query(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				QueryBuilders.termsQuery(&quot;auth&quot;, &quot;001_role1&quot;, &quot;001001_role2&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指定多个查询条件">指定多个查询条件<a href="#指定多个查询条件" class="hash-link" aria-label="Direct link to 指定多个查询条件" title="Direct link to 指定多个查询条件">​</a></h5>
<p>查询条件可以通过逻辑关系组合在一起。es提供了以下逻辑关系：</p>
<ul>
<li><code>must</code> - 如果有多个条件，这些条件都必须满足。参与到打分项，相当于<code>AND</code>。</li>
<li><code>should</code> - 如果有多个条件，满足一个或多个即可。参与到打分项，相当于<code>OR</code>。</li>
<li><code>must_not</code> - 与<code>must</code>相反，必须都不满足条件才可以匹配到。相当于<code>!</code>。</li>
<li><code>filter</code> - 过滤，不参与到打分项。</li>
</ul>
<p>可以使用<code>QueryBuilders.boolQuery()</code>将这些添加组合在一起，也可以嵌套使用。</p>
<p>要想组合查询条件，需要从<code>QueryBuilders.boolQuery()</code>开始。如下面的示例，查询标题或者文件内容包含”中国“，但是<code>auth</code>为<code>001_role1</code>或者<code>001001_role2</code>或者创建人是<code>user1</code>的数据：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QueryBuilder queryBuilder = QueryBuilders.boolQuery()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .must(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		QueryBuilders.multiMatchQuery(&quot;中国&quot;, &quot;fileName&quot;, &quot;fileContent&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .filter(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	QueryBuilders.boolQuery()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  		.should(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    		QueryBuilders.termsQuery(&quot;auth&quot;, &quot;001_role1&quot;, &quot;001001_role2&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  		)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  		.should(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        QueryBuilders.termQuery(&quot;creator&quot;, &quot;user1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="排序">排序<a href="#排序" class="hash-link" aria-label="Direct link to 排序" title="Direct link to 排序">​</a></h5>
<p>es默认按照分数排序的，可以添加排序规则。如按照分数升序降序：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sourceBuilder.sort(new ScoreSortBuilder().order(SortOrder.DESC));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再如按照日期排序：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sourceBuilder.sort(new FieldSortBuilder(&quot;createTime&quot;).order(SortOrder.DESC));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="高亮请求构建">高亮（请求构建）<a href="#高亮请求构建" class="hash-link" aria-label="Direct link to 高亮（请求构建）" title="Direct link to 高亮（请求构建）">​</a></h5>
<p>我们需要在构建查询请求时，指定哪些字段需要高亮。如下所示：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Demo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * 构建高亮字段的请求。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public HighlightBuilder highlightFields() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		HighlightBuilder highlightBuilder = new HighlightBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		HighlightBuilder.Field highlightFileName = new HighlightBuilder.Field(&quot;fileName&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		highlightBuilder.field(highlightFileName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		HighlightBuilder.Field highlightContent = new HighlightBuilder.Field(&quot;fileContent&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		highlightBuilder.field(highlightContent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return highlightBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;FileInfo&gt; query() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    searchSourceBuilder.highlighter(highlightFileds());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="高亮返回值处理">高亮（返回值处理）<a href="#高亮返回值处理" class="hash-link" aria-label="Direct link to 高亮（返回值处理）" title="Direct link to 高亮（返回值处理）">​</a></h5>
<p>在返回值中有高亮的数据。如下所示：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SearchHits hits = searchResponse.getHits();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (SearchHit hit : hits.getHits()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HighlightField fileNameHightlight = highlightFields.get(&quot;fileName&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	if (fileNameHightlight != null &amp;&amp; fileNameHightlight.isFragment()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Text[] fragments = fileNameHightlight.fragments();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	String fragmentString = fragments[0].string();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.out.print(&quot;fileName高亮文本是：&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.out.println(fragmentString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	HighlightField fileContentHightlight = highlightFields.get(&quot;fileContent&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  	if (fileContentHightlight != null &amp;&amp; fileContentHightlight.isFragment()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Text[] fragments = fileContentHightlight.fragments();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	String fragmentString = fragments[0].string();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.out.print(&quot;fileContent高亮文本是：&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.out.println(fragmentString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="如何做查询结果优化">如何做查询结果优化<a href="#如何做查询结果优化" class="hash-link" aria-label="Direct link to 如何做查询结果优化" title="Direct link to 如何做查询结果优化">​</a></h5>
<ul>
<li>分词优化</li>
<li>查询优化</li>
</ul>
<p><a href="https://www.jianshu.com/p/914f102bc174" target="_blank" rel="noopener noreferrer">Elasticsearch搜索中文分词优化</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="各类请求总结">各类请求总结<a href="#各类请求总结" class="hash-link" aria-label="Direct link to 各类请求总结" title="Direct link to 各类请求总结">​</a></h3>
<p>任何一个ES操作都需要先创建一个请求request</p>
<table><thead><tr><th style="text-align:center">序号</th><th>请求</th><th style="text-align:left">说明</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td>GetIndexRequest()</td><td style="text-align:left">获取索引的请求</td><td style="text-align:center">client.indices().exists(request,<br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">2</td><td>CreateIndexRequest(indexName)</td><td style="text-align:left">创建索引的请求</td><td style="text-align:center">client.indices().create(request)</td></tr><tr><td style="text-align:center">3</td><td>PutMappingRequest(indexName)</td><td style="text-align:left">创建类型的请求</td><td style="text-align:center">client.indices().putMapping(request)</td></tr><tr><td style="text-align:center">4</td><td>DeleteIndexRequest(indexName)</td><td style="text-align:left">删除索引的请求</td><td style="text-align:center">client.indices().delete(request, <br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">5</td><td>IndexRequest(indexName, type, ID)</td><td style="text-align:left">索引请求</td><td style="text-align:center">client.index(request, <br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">6</td><td>DeleteRequest(indexName, type,ID)</td><td style="text-align:left">删除数据请求</td><td style="text-align:center">client.delete(request,<br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">7</td><td>UpdateRequest(indexName, type,ID)</td><td style="text-align:left">更新请求</td><td style="text-align:center">client.update(request,<br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">8</td><td>GetRequest(indexName, type,ID)</td><td style="text-align:left">根据ID查询请求</td><td style="text-align:center">client.get(request,<br>RequestOptions.DEFAULT)</td></tr><tr><td style="text-align:center">9</td><td>SearchRequest(indexName)</td><td style="text-align:left">查询请求</td><td style="text-align:center">client().search(request, <br>RequestOptions.DEFAULT)</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查询条件总结">查询条件总结<a href="#查询条件总结" class="hash-link" aria-label="Direct link to 查询条件总结" title="Direct link to 查询条件总结">​</a></h3>
<table><thead><tr><th style="text-align:center">序号</th><th>查询类型</th><th>方法</th><th>示例</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td>精确查询</td><td>termQuery</td><td>QueryBuilders.termQuery(&quot;creator&quot;, &quot;user1&quot;)</td><td style="text-align:center">查询creator字段为user1的数据</td></tr><tr><td style="text-align:center">2</td><td>全文检索查询</td><td>matchQuery</td><td>QueryBuilders.matchQuery(&quot;content&quot;, &quot;中国&quot;)</td><td style="text-align:center">匹配content字段包含“中国”的数据（类似like查询）</td></tr><tr><td style="text-align:center">3</td><td>多字段全文检索</td><td>multiMatchQuery</td><td>QueryBuilders.multiMatchQuery(&quot;中国&quot;, &quot;content&quot;, &quot;name&quot;)</td><td style="text-align:center">匹配content或name字段包含“中国”的数据</td></tr><tr><td style="text-align:center">4</td><td>范围查询</td><td>rangeQuery</td><td>QueryBuilders.rangeQuery(&quot;createTime&quot;)<br>.format(&quot;yyyy-MM-dd||yyyy&quot;)<br>.from(startDate).to(endDate)</td><td style="text-align:center">如果是日期，需要用format指定日期类型,可指定多个日期格式</td></tr><tr><td style="text-align:center">5</td><td>数组查询</td><td>termsQuery</td><td>QueryBuilders.termsQuery(&quot;auth&quot;, &quot;001&quot;, &quot;001001&quot;,······)</td><td style="text-align:center">auth字段有一个精确匹配即可</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/database/4-Elasticsearch/0-elasticsearch简易教程.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/docs/database/redis/redis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">redis常见问题</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/docs/database/Elasticsearch/elasticsearch-ik"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IK分词器</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-es安装" class="table-of-contents__link toc-highlight">1. ES安装</a><ul><li><a href="#下载" class="table-of-contents__link toc-highlight">下载</a></li><li><a href="#解压及配置" class="table-of-contents__link toc-highlight">解压及配置</a></li><li><a href="#启动es" class="table-of-contents__link toc-highlight">启动ES</a></li><li><a href="#启动后的问题及解决方式" class="table-of-contents__link toc-highlight">启动后的问题及解决方式</a></li></ul></li><li><a href="#2-es常用命令说明" class="table-of-contents__link toc-highlight">2. ES常用命令说明</a><ul><li><a href="#21-_cat命令" class="table-of-contents__link toc-highlight">2.1 _cat命令</a></li><li><a href="#22-索引相关命令" class="table-of-contents__link toc-highlight">2.2 索引相关命令</a></li><li><a href="#23-查询索引信息" class="table-of-contents__link toc-highlight">2.3 查询索引信息</a></li></ul></li><li><a href="#3-es接口简明教程" class="table-of-contents__link toc-highlight">3. ES接口简明教程</a><ul><li><a href="#索引与类型操作" class="table-of-contents__link toc-highlight">索引与类型操作</a></li><li><a href="#操作数据" class="table-of-contents__link toc-highlight">操作数据</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a><ul><li><a href="#各类请求总结" class="table-of-contents__link toc-highlight">各类请求总结</a></li><li><a href="#查询条件总结" class="table-of-contents__link toc-highlight">查询条件总结</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/li-liguang" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>